2025-03-03 00:44:50.152  INFO 25076 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 25076 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:44:50.156 DEBUG 25076 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:44:50.157  INFO 25076 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:44:50.609  INFO 25076 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:44:50.610  INFO 25076 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:44:50.630  INFO 25076 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 00:44:50.994  INFO 25076 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:44:50.999  INFO 25076 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:44:51.000  INFO 25076 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:44:51.087  INFO 25076 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:44:51.088  INFO 25076 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 892 ms
2025-03-03 00:44:51.303  INFO 25076 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:44:51.304  INFO 25076 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:44:51.853  INFO 25076 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:44:51.957  INFO 25076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477247865263538204&access_key=7cb8e10f27cb4da9a702ce324585c38c&service_id=33554678&ticket=9db4efda-250d-449c-9e93-0705b43eced4 [conn_id=7477247865263538204]
2025-03-03 00:44:52.258  INFO 25076 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:44:52.265  INFO 25076 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.377 seconds (JVM running for 2.968)
2025-03-03 00:44:56.269  INFO 25076 --- [pool-3-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740933894}
2025-03-03 00:44:56.301  WARN 25076 --- [pool-3-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 00:44:56.310  INFO 25076 --- [pool-3-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:44:56.590  INFO 25076 --- [pool-3-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:44:56.595 DEBUG 25076 --- [pool-3-thread-2] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 00:44:56.607 DEBUG 25076 --- [pool-3-thread-2] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:44:56.639 DEBUG 25076 --- [pool-3-thread-2] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 00:44:56.647 DEBUG 25076 --- [pool-3-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:44:56.648 DEBUG 25076 --- [pool-3-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:44:56.667 DEBUG 25076 --- [pool-3-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:03.067  INFO 25076 --- [pool-3-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740933901}
2025-03-03 00:45:03.087 DEBUG 25076 --- [pool-3-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:03.088 DEBUG 25076 --- [pool-3-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:03.108 DEBUG 25076 --- [pool-3-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:03.109 DEBUG 25076 --- [pool-3-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:45:03.109 DEBUG 25076 --- [pool-3-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:45:03.131 DEBUG 25076 --- [pool-3-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:45:03.131  INFO 25076 --- [pool-3-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 00:45:03.577  INFO 25076 --- [pool-3-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:45:03.579  INFO 25076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:45:04.036  INFO 25076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:45:02 GMT"],"eagleid":["b75d669517409339022107541e"],"request-id":["cf38af03-3217-4593-b5d4-6190a2febf56"],"server":["Tengine"],"server-timing":["inner; dur=389","cdn-cache;desc=MISS,edge;dur=0,origin;dur=420"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache1.cn6912[420,0]"],"x-lgw-dst-svc":["jk6FWTZjFd2U8BdyqPcRGHuVevx4pIaxXLgwI2Dgq5jRxRjCYKrmaw0dTLRT1w7uB6lRw8An_lHZ4qUEc7ZFi1wx6_hDsu75uW1Cn1HEGO6rfeaQFnywPW64Q5XJOP84dIvPyeK2PrSpIZU4sSUEUVBGXBfdTeDkC0OlSzE9O4qASghXDXP8xTwVW1G1XwOwuivNDMup0rFJPEURKVj5sxztTpOlzDyRsOCLrHBW9qHoejA5aq6PO2Ww7hVeCYyrYfkPvwm3WP66iiTarlN9qEcgNGi0DGGjKpnSn6nKdWkt00EuCbRZuns="],"x-request-id":["cf38af03-3217-4593-b5d4-6190a2febf56"],"x-timestamp":["1740933902.615"],"x-tt-logid":["2025030300450270BCC4796A6C73B9647B"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b0da271b9a4d45f8bb5d0771742ce391a3743e067e5b0f187faf9d80a8a1c413f9f28fc0110ea4e4f1df62fedfdd98b541816f7ce386aa9576ca59d48a179e0a412038d71d0b28c3627367fc0aa1205e38"],"x-tt-trace-id":["00-25030300450270BCC4796A6C73B9647B-46A3181E7FF11706-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030300450270BCC4796A6C73B9647B","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030300450270BCC4796A6C73B9647B"}
2025-03-03 00:45:04.037  INFO 25076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 00:45:04.516  INFO 25076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 00:45:04.536 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:04.537 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:04.555 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:04.702 ERROR 25076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:04.703  INFO 25076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 00:45:04.705  INFO 25076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 00:45:04.705 DEBUG 25076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 00:45:04.855 ERROR 25076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$Unauthorized: 401 UNAUTHORIZED: [no body]
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:105) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFileForMessage(DifyKnowledgeServiceImpl.java:285) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:197) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:45:04.856 DEBUG 25076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/process
2025-03-03 00:45:04.917 ERROR 25076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:212) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:45:04.917 ERROR 25076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 00:45:04.918 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:04.918 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:04.939 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:05.073 ERROR 25076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:05.076 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:05.076 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:05.097 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:05.217 ERROR 25076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:05.222 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:05.222 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:05.241 DEBUG 25076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:05.345 ERROR 25076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:49.641  INFO 25076 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 00:45:49.648  INFO 25076 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 00:45:54.169  INFO 23404 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 23404 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:45:54.171 DEBUG 23404 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:45:54.171  INFO 23404 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:45:54.569  INFO 23404 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:45:54.570  INFO 23404 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:45:54.589  INFO 23404 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 00:45:54.918  INFO 23404 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:45:54.925  INFO 23404 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:45:54.925  INFO 23404 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:45:55.018  INFO 23404 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:45:55.018  INFO 23404 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 812 ms
2025-03-03 00:45:55.240  INFO 23404 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:45:55.241  INFO 23404 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:45:55.786  INFO 23404 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:45:56.013  INFO 23404 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477247557833932802&access_key=b3370c7d5558b4e40b87051ba1f84e9f&service_id=33554678&ticket=7015ff0c-9669-435a-a0a3-05931c3d018a [conn_id=7477247557833932802]
2025-03-03 00:45:56.240  INFO 23404 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:45:56.250  INFO 23404 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.438 seconds (JVM running for 2.976)
2025-03-03 00:45:56.503  INFO 23404 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740933954}
2025-03-03 00:45:56.541  WARN 23404 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 00:45:56.550  INFO 23404 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:45:56.873  INFO 23404 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:45:56.882 DEBUG 23404 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:56.910 DEBUG 23404 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:56.948 DEBUG 23404 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:56.953 DEBUG 23404 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:45:56.953 DEBUG 23404 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:45:56.979 DEBUG 23404 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:45:56.979  INFO 23404 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 00:45:57.689  INFO 23404 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:45:57.691  INFO 23404 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:45:58.245  INFO 23404 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:45:56 GMT"],"eagleid":["77243f2817409339563215320e"],"request-id":["7baa12eb-60be-4d65-961c-7f179c96d4b9"],"server":["Tengine"],"server-timing":["inner; dur=315","cdn-cache;desc=MISS,edge;dur=0,origin;dur=406"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn7330[406,0]"],"x-lgw-dst-svc":["9m7fauZKyeg24WV7vCiNTqExTcEii8TOBx01KmgoKpVWyG1OOYFYO4Dd1aWMXyItCLszv88rdCtYXwviQ-QWIXBZ4yFHPLHw0y8X7J31L7eXftpu7PATftadASPhgktK_JGedWKpx1qaucMjR2XZVc9bKDxbHus8_v2sQhMmtoJ4uka9gp6bMN5gbyc6o6Z53XjW-oZGTw3wtv00I6l0_gzo7TP_8XSO6YLrZTkqnLStaAKCB8bA5udN7EvFL0jLAdKbbqfY6D3oNxZe_CRcEZdZR90Fb6uKir97E_jytAGATUJKzha5IZo="],"x-request-id":["7baa12eb-60be-4d65-961c-7f179c96d4b9"],"x-timestamp":["1740933956.712"],"x-tt-logid":["20250303004556BDE030E5694642BBBEB7"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71b01be44a6910d26c3ff0d2941c4dda0b5c7cd07a51b07485638a2dc35bd3d499836d551908b598ae001ee24baf9c92cf86b02f44a8634f504f424e3f87bee9f88ea72ee4090ea37ed80a9ceefb0abd1a"],"x-tt-trace-id":["00-250303004556BDE030E5694642BBBEB7-3F3F3040072DB0B6-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303004556BDE030E5694642BBBEB7","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303004556BDE030E5694642BBBEB7"}
2025-03-03 00:45:58.246  INFO 23404 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 00:45:58.669  INFO 23404 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 00:45:58.694 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:58.694 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:58.718 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:58.820 ERROR 23404 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:58.821  INFO 23404 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 00:45:58.823  INFO 23404 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 00:45:58.823 DEBUG 23404 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 00:45:58.986 ERROR 23404 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$Unauthorized: 401 UNAUTHORIZED: [no body]
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:105) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFileForMessage(DifyKnowledgeServiceImpl.java:285) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:197) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:45:58.987 DEBUG 23404 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/process
2025-03-03 00:45:59.045 ERROR 23404 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:212) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:45:59.045  INFO 23404 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 00:45:59.046 ERROR 23404 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 00:45:59.046 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:59.047 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:59.069 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:59.209 ERROR 23404 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:59.211 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:59.212 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:59.236 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:59.370 ERROR 23404 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:45:59.373 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:45:59.374 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:45:59.397 DEBUG 23404 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:45:59.497 ERROR 23404 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:51:14.002  INFO 23404 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 00:51:14.008  INFO 23404 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 00:51:18.984  INFO 31604 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 31604 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:51:18.986 DEBUG 31604 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:51:18.987  INFO 31604 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:51:19.545  INFO 31604 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:51:19.547  INFO 31604 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:51:19.570  INFO 31604 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 00:51:20.041  INFO 31604 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:51:20.047  INFO 31604 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:51:20.047  INFO 31604 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:51:20.177  INFO 31604 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:51:20.177  INFO 31604 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1148 ms
2025-03-03 00:51:20.406  INFO 31604 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:51:20.408  INFO 31604 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:51:20.959  INFO 31604 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:51:21.068  INFO 31604 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477249227414274049&access_key=69aa24e2ee23a072e6eaa58eab54ed70&service_id=33554678&ticket=e89768de-1acd-42c4-868a-11e0ee498931 [conn_id=7477249227414274049]
2025-03-03 00:51:21.336  INFO 31604 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:51:21.343  INFO 31604 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.729 seconds (JVM running for 3.35)
2025-03-03 00:51:41.553  INFO 31604 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934300}
2025-03-03 00:51:41.586  WARN 31604 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 00:51:41.594  INFO 31604 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:51:41.904  INFO 31604 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:51:41.910 DEBUG 31604 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:51:41.923 DEBUG 31604 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:51:41.958 DEBUG 31604 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:51:41.962 DEBUG 31604 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:51:41.962 DEBUG 31604 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:51:41.985 DEBUG 31604 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:51:41.985  INFO 31604 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 00:51:42.736  INFO 31604 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:51:42.738  INFO 31604 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:51:43.290  INFO 31604 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:51:41 GMT"],"eagleid":["7abfaaa417409343013741622e"],"request-id":["425f322c-bd49-4df9-992d-f04b4aa51f07"],"server":["Tengine"],"server-timing":["inner; dur=382","cdn-cache;desc=MISS,edge;dur=0,origin;dur=443"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache16.cn6553[443,0]"],"x-lgw-dst-svc":["Ag4HgVBbjiyCFjJzXUWiaGpty01I2LetHkoM39Hhe1dRYlbWc6KL_m7WqXvrH9I79zvlgy43fC2ZVjoKd5P9KEHbu8-veJR2WtolDHcViOIB3STESvZpbLCTluhvTc18yZM9cGVgJ0sQSnlGzu80xjfCHVciE8vgfhc_wUCCv6VO-eWO5ZfRG-2ABK1FqQsLX5yIkLb5wsda2lhO8_SutZgt8VNChV4r6S9nGqnTEGp0vWXwhlXfUTt2vxxyeVbO2bwfAy088_8a-MwFgY-Gu4W8BbZ0D0hrjM1vHHlk1KIt-WYNaRp1pUE="],"x-request-id":["425f322c-bd49-4df9-992d-f04b4aa51f07"],"x-timestamp":["1740934301.806"],"x-tt-logid":["2025030300514165C474936DA065BAFBBA"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64154cc7338b1b53bd5898b78ad066e13b5819da78ba7fcb49509a7a21fae0ce549e7285a4a0af017b1ef9ead21e58dcf8c70a11a7857c6a9b028a0d138a5da98f36ede2f1915ce3bc99761d3bf686fb72"],"x-tt-trace-id":["00-25030300514165C474936DA065BAFBBA-4BA6E6A150A8C325-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030300514165C474936DA065BAFBBA","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030300514165C474936DA065BAFBBA"}
2025-03-03 00:51:43.291  INFO 31604 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 00:51:43.729  INFO 31604 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 00:51:43.753 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:51:43.754 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:51:43.777 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:51:43.893 ERROR 31604 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:51:43.894  INFO 31604 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 00:51:43.895  INFO 31604 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 00:51:43.895 DEBUG 31604 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 00:51:44.051 ERROR 31604 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$Unauthorized: 401 UNAUTHORIZED: [no body]
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:105) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFileForMessage(DifyKnowledgeServiceImpl.java:287) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:197) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:51:44.052 DEBUG 31604 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/process
2025-03-03 00:51:44.121 ERROR 31604 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:212) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:51:44.121  INFO 31604 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 00:51:44.121 ERROR 31604 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 00:51:44.122 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:51:44.122 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:51:44.153 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:51:44.285 ERROR 31604 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:51:44.287 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:51:44.287 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:51:44.310 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:51:44.457 ERROR 31604 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:51:44.461 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:51:44.461 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:51:44.484 DEBUG 31604 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:51:44.601 ERROR 31604 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:52:42.482 ERROR 31604 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 00:52:42.483  INFO 31604 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477249227414274049&access_key=69aa24e2ee23a072e6eaa58eab54ed70&service_id=33554678&ticket=e89768de-1acd-42c4-868a-11e0ee498931 [conn_id=7477249227414274049]
2025-03-03 00:52:42.483  INFO 31604 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 00:52:43.380  INFO 31604 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 00:52:43.761  INFO 31604 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477250845005529089&access_key=2d34b20c623f5fe3f98c5000f0c0bdcb&service_id=33554678&ticket=28a3c919-a846-4a03-84b6-7f03e7873c72 [conn_id=7477250845005529089]
2025-03-03 00:54:26.692  INFO 31604 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 00:54:26.698  INFO 31604 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 00:54:31.241  INFO 17552 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 17552 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:54:31.243 DEBUG 17552 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:54:31.244  INFO 17552 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:54:31.709  INFO 17552 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:54:31.711  INFO 17552 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:54:31.735  INFO 17552 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-03-03 00:54:32.189  INFO 17552 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:54:32.199  INFO 17552 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:54:32.199  INFO 17552 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:54:32.334  INFO 17552 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:54:32.334  INFO 17552 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1056 ms
2025-03-03 00:54:32.684  INFO 17552 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:54:32.686  INFO 17552 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:54:33.448  INFO 17552 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:54:33.579  INFO 17552 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477250845005758465&access_key=c155a999ec5797c4fdf1acd2b727ba80&service_id=33554678&ticket=4085e983-f94a-47e9-bda7-91118d95afba [conn_id=7477250845005758465]
2025-03-03 00:54:34.084  INFO 17552 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:54:34.093  INFO 17552 --- [main] em.backend.BackendApplication            : Started BackendApplication in 3.208 seconds (JVM running for 3.745)
2025-03-03 00:54:36.378  INFO 17552 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934474}
2025-03-03 00:54:36.419  WARN 17552 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 00:54:36.427  INFO 17552 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:54:36.723  INFO 17552 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:54:36.728 DEBUG 17552 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:54:36.741 DEBUG 17552 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:54:36.772 DEBUG 17552 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:54:36.776 DEBUG 17552 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:54:36.776 DEBUG 17552 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:54:36.798 DEBUG 17552 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:54:36.798  INFO 17552 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 00:54:37.426  INFO 17552 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:54:37.427  INFO 17552 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:54:37.931  INFO 17552 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:54:36 GMT"],"eagleid":["b75d66a817409344760606639e"],"request-id":["08df32d2-517f-4861-be4e-6bd3ddcdce7f"],"server":["Tengine"],"server-timing":["inner; dur=355","cdn-cache;desc=MISS,edge;dur=0,origin;dur=390"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn6912[390,0]"],"x-lgw-dst-svc":["AAkjzd2xOo7iG6TSIfaj-KcF1FDyxUIJh9YgqR93v4Gu4-Oh74hrIJcr0l_OpUfuhKPxRs5hZ8Eq5hasiQ4o3CTXOf9_9P2_6ETVKW6q74y9IbsJChFjtiO2H45W6x2hCuEr25bNSIr6CCaC0vi_jEQym5lIDQoVApyjBl78neBEYtBfNNmfrT-b7yFJbyRobQ-mKioksZ3laMvfREtv4TwXKlXTgGe0CWPWDlxDGdGoeNGAzL_uq8nUlr5C8UnQs5TJ7erYPGKmdkr4lDO_vYoN0WymYOxkRrKtgBtTuJYs8jOEL9vCLv4="],"x-request-id":["08df32d2-517f-4861-be4e-6bd3ddcdce7f"],"x-timestamp":["1740934476.434"],"x-tt-logid":["20250303005436054894FC257579BAA8CA"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b07054485e102510e51742cca293e3c30a071c0cfe2a2649e60a2eeec6659bf73aaa2c6f2c960f94afff4d962e0111ef6b5349e48ee28c0bfbbddecc44e4d2ce760dc12f182c219c67bf5d566853e6cb21"],"x-tt-trace-id":["00-250303005436054894FC257579BAA8CA-00EF10F263407D03-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303005436054894FC257579BAA8CA","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303005436054894FC257579BAA8CA"}
2025-03-03 00:54:37.931  INFO 17552 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 00:54:38.280  INFO 17552 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 00:54:38.301 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:54:38.301 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:54:38.322 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:54:38.433 ERROR 17552 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:54:38.435  INFO 17552 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 00:54:38.437  INFO 17552 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 00:54:38.437 DEBUG 17552 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 00:54:38.608 ERROR 17552 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$Unauthorized: 401 UNAUTHORIZED: [no body]
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:105) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFileForMessage(DifyKnowledgeServiceImpl.java:286) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:197) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:54:38.608 DEBUG 17552 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/process
2025-03-03 00:54:38.667 ERROR 17552 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:212) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:240) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:54:38.668  INFO 17552 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 00:54:38.668 ERROR 17552 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 00:54:38.669 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:54:38.669 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:54:38.689 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:54:38.833 ERROR 17552 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:54:38.836 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:54:38.837 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:54:38.857 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:54:38.993 ERROR 17552 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:54:38.998 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:54:38.998 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:54:39.018 DEBUG 17552 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:54:39.126 ERROR 17552 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:55:37.391 ERROR 17552 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 00:55:37.392  INFO 17552 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477250845005758465&access_key=c155a999ec5797c4fdf1acd2b727ba80&service_id=33554678&ticket=4085e983-f94a-47e9-bda7-91118d95afba [conn_id=7477250845005758465]
2025-03-03 00:55:37.392  INFO 17552 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 00:56:00.594  INFO 17552 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 00:56:00.935  INFO 17552 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477250854124634113&access_key=0850f8778e3a6cca2a0c8b7552a8acb1&service_id=33554678&ticket=19869316-372d-498a-9916-9665fcb0bc3e [conn_id=7477250854124634113]
2025-03-03 00:56:02.161  INFO 17552 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 00:56:02.165  INFO 17552 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 00:56:06.168  INFO 18104 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 18104 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:56:06.169 DEBUG 18104 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:56:06.170  INFO 18104 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:56:06.563  INFO 18104 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:56:06.565  INFO 18104 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:56:06.589  INFO 18104 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-03-03 00:56:07.069  INFO 18104 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:56:07.073  INFO 18104 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:56:07.074  INFO 18104 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:56:07.159  INFO 18104 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:56:07.159  INFO 18104 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 961 ms
2025-03-03 00:56:07.416  INFO 18104 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:56:07.417  INFO 18104 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:56:08.029  INFO 18104 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:56:08.287  INFO 18104 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477252877300842498&access_key=8ff645dd1524d6cf80c1b6ae30a3d9c9&service_id=33554678&ticket=0eba5de4-c834-4754-bf8d-9b5e4bce9ec8 [conn_id=7477252877300842498]
2025-03-03 00:56:08.539  INFO 18104 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:56:08.545  INFO 18104 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.647 seconds (JVM running for 3.168)
2025-03-03 00:56:37.413  INFO 31764 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 31764 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:56:37.417 DEBUG 31764 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:56:37.417  INFO 31764 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:56:37.851  INFO 31764 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:56:37.854  INFO 31764 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:56:37.878  INFO 31764 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-03-03 00:56:38.238  INFO 31764 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:56:38.242  INFO 31764 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:56:38.242  INFO 31764 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:56:38.327  INFO 31764 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:56:38.327  INFO 31764 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 877 ms
2025-03-03 00:56:38.546  INFO 31764 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:56:38.546  INFO 31764 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:56:39.083  INFO 31764 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:56:39.296  INFO 31764 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477252877300940802&access_key=682fb7dd48726f4ed0a839a189a753d0&service_id=33554678&ticket=47404c8b-9535-4287-a82b-614fcb938d05 [conn_id=7477252877300940802]
2025-03-03 00:56:39.465  INFO 31764 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:56:39.472  INFO 31764 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.38 seconds (JVM running for 2.959)
2025-03-03 00:56:40.482  INFO 31764 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934598}
2025-03-03 00:56:40.529  WARN 31764 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 00:56:40.540  INFO 31764 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:56:40.844  INFO 31764 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:56:40.849 DEBUG 31764 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:56:40.864 DEBUG 31764 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:56:40.902 DEBUG 31764 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:56:40.906 DEBUG 31764 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:56:40.906 DEBUG 31764 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:56:40.932 DEBUG 31764 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:56:40.933  INFO 31764 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 00:56:41.589  INFO 31764 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:56:41.590  INFO 31764 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:56:42.069  INFO 31764 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:56:40 GMT"],"eagleid":["77243f2117409346002267143e"],"request-id":["c75334c6-8d2e-4cf7-804e-77ad772a679c"],"server":["Tengine"],"server-timing":["inner; dur=342","cdn-cache;desc=MISS,edge;dur=0,origin;dur=369"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache13.cn7330[369,0]"],"x-lgw-dst-svc":["87LtzTxUjpSRpy6INBx_IoMwk9WulM7kH0pr36g8oLOD25MYAIWnwlC4mOqKuYGB0yZVMwIZdr36upT3qZc9H42QQXfK2gOVD3wD5eHfrLJgOb2ocde2UhqelxKDUpvM_AgG401KrTPuF11d1mKi0-t_zLSUozpODHdlySYdI2RoSsAezHLR7NZr5ASKqirVYEqfc-KES9oyJ4Wpvru3k-2ZjXl12iUl1G8hNxyROLFxWvDTN8aC6Mh7imvpnogW_gBNQsyXIectNWiThjSIMO2RpZcajCiBYBInn0E2sQNlVIfyccQd"],"x-request-id":["c75334c6-8d2e-4cf7-804e-77ad772a679c"],"x-timestamp":["1740934600.579"],"x-tt-logid":["2025030300564025352E2FD1962BBAF25A"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71bb99353cd556b64abb9bd1fd30f0cec04d7fa03b545a52ed6057257daf6f22260fa5b9480ffa4c17112bbce039bb9ebfbceb5d1ea1b23c09f402e896ce77545790d34ce15a71aba3a6b39ab4e9912ad6"],"x-tt-trace-id":["00-25030300564025352E2FD1962BBAF25A-0B4B8C5D1AAB56AD-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030300564025352E2FD1962BBAF25A","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030300564025352E2FD1962BBAF25A"}
2025-03-03 00:56:42.070  INFO 31764 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 00:56:42.468  INFO 31764 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 00:56:42.496 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:56:42.497 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:56:42.522 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:56:42.634 ERROR 31764 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:56:42.634  INFO 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 00:56:42.637  INFO 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 00:56:42.637 DEBUG 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 00:56:42.638 DEBUG 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 00:56:42.824 ERROR 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: status=201 CREATED, body={"id": "171be000-2b1a-416b-a80b-22f060686c0b", "name": "\u7a0b\u963f\u91d1\u548c\u89e3\u901a\u77e5.jpg", "size": 381767, "extension": "jpg", "mime_type": "image/jpeg", "created_by": "914e6d6a-e382-454a-bf74-ae9d6a52f536", "created_at": 1740934601}

2025-03-03 00:56:42.824 DEBUG 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/process
2025-03-03 00:56:42.911 ERROR 31764 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:215) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:243) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:56:42.913  INFO 31764 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 00:56:42.913 ERROR 31764 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 00:56:42.914 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:56:42.915 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:56:42.941 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:56:43.090 ERROR 31764 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:56:43.092 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:56:43.092 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:56:43.119 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:56:43.250 ERROR 31764 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:56:43.255 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:56:43.255 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:56:43.281 DEBUG 31764 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:56:43.426 ERROR 31764 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:58:08.846  INFO 31764 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 00:58:08.851  INFO 31764 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 00:58:12.936  INFO 34864 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 34864 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:58:12.937 DEBUG 34864 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:58:12.938  INFO 34864 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:58:13.391  INFO 34864 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:58:13.392  INFO 34864 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:58:13.414  INFO 34864 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 00:58:13.824  INFO 34864 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:58:13.831  INFO 34864 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:58:13.831  INFO 34864 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:58:13.936  INFO 34864 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:58:13.936  INFO 34864 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 956 ms
2025-03-03 00:58:14.239  INFO 34864 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:58:14.240  INFO 34864 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:58:14.820  INFO 34864 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:58:14.921  INFO 34864 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477250845006135297&access_key=ea946ccaaf12a81f01d8e83f0e3257b4&service_id=33554678&ticket=55c782da-b9ee-48ee-9dc8-638a11c8daa3 [conn_id=7477250845006135297]
2025-03-03 00:58:15.265  INFO 34864 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:58:15.272  INFO 34864 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.616 seconds (JVM running for 3.128)
2025-03-03 00:58:26.559  INFO 34864 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934705}
2025-03-03 00:58:26.597  WARN 34864 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 00:58:26.604  INFO 34864 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:58:26.917  INFO 34864 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:58:26.922 DEBUG 34864 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:58:26.935 DEBUG 34864 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:58:26.970 DEBUG 34864 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:58:26.974 DEBUG 34864 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:58:26.974 DEBUG 34864 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:58:26.998 DEBUG 34864 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:58:26.998  INFO 34864 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 00:58:27.640  INFO 34864 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:58:27.642  INFO 34864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 00:58:28.124  INFO 34864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:58:26 GMT"],"eagleid":["b75d66ac17409347062774879e"],"request-id":["99b120e5-388c-4bbb-af7f-4858549f033b"],"server":["Tengine"],"server-timing":["inner; dur=342","cdn-cache;desc=MISS,edge;dur=0,origin;dur=365"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache24.cn6912[365,0]"],"x-lgw-dst-svc":["_yoGsa2I-CFjCW6tcQakH9qgL0MsVOkylOIuG_lyF_iDVOkQ5flWaCVfuPK1gQSM2pg7tIpuchLqlQL79I8eEaxEnLritMBu28-y7ta_cv5LAp1-uevDec28yt7NXUCZ51zLAFmGsMQcQUQvYIymBfCrHhz-xyBuS4RJKz225VOhWjzfxIc1jAbwX0-uDfq8vtMmybLwyVWG8n9iSGAI1fjblz6uEM2XgULanmNlmJWlOMb1ahjz5KJfjX2HDYw0CzJmAq6swD5a31Ls0wirs9nQ-o-oTfbgmlkHyWvaMAKke_iAFglkLw=="],"x-request-id":["99b120e5-388c-4bbb-af7f-4858549f033b"],"x-timestamp":["1740934706.629"],"x-tt-logid":["20250303005826780572B53E2E38BCB7D1"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b0b92fdcea607f4f4d8ce9d92a889d5f68d2f3d4db8b7ffa092ea8b3cdccc623df4b1dace9ec808026f3eb2cfeda2b60086fe2b48eeda3b2bf978e34090d130a41b6ab4b51a8c684a2c61f63c819186fa2"],"x-tt-trace-id":["00-250303005826780572B53E2E38BCB7D1-427504F92B79513E-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303005826780572B53E2E38BCB7D1","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303005826780572B53E2E38BCB7D1"}
2025-03-03 00:58:28.125  INFO 34864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 00:58:28.521  INFO 34864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 00:58:28.545 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:58:28.546 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:58:28.568 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:58:28.674 ERROR 34864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:58:28.676  INFO 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 00:58:28.677  INFO 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 00:58:28.678 DEBUG 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 00:58:28.678 DEBUG 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 00:58:28.860  INFO 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d5a48d65-5044-4fea-99cb-4e8242c21d1f
2025-03-03 00:58:28.861 DEBUG 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run
2025-03-03 00:58:28.925 ERROR 34864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$UnsupportedMediaType: 415 UNSUPPORTED MEDIA TYPE: "{"code": "unsupported_media_type", "message": "Did not attempt to load JSON data because the request Content-Type was not 'application/json'.", "status": 415}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:133) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:215) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:243) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 00:58:28.925  INFO 34864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 00:58:28.925 ERROR 34864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 00:58:28.926 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:58:28.926 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:58:28.949 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:58:29.078 ERROR 34864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:58:29.080 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:58:29.080 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:58:29.103 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:58:29.243 ERROR 34864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:58:29.248 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:58:29.248 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:58:29.271 DEBUG 34864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:58:29.376 ERROR 34864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 00:59:50.443  INFO 34864 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 00:59:50.447  INFO 34864 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 00:59:55.080  INFO 41580 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 41580 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 00:59:55.081 DEBUG 41580 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 00:59:55.082  INFO 41580 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 00:59:55.497  INFO 41580 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 00:59:55.499  INFO 41580 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 00:59:55.517  INFO 41580 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 00:59:55.855  INFO 41580 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 00:59:55.860  INFO 41580 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 00:59:55.860  INFO 41580 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 00:59:55.948  INFO 41580 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 00:59:55.948  INFO 41580 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 837 ms
2025-03-03 00:59:56.179  INFO 41580 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 00:59:56.180  INFO 41580 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 00:59:56.789  INFO 41580 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 00:59:56.979  INFO 41580 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477250854125027329&access_key=e59317cb7b13bc7f1c199de9c6c701af&service_id=33554678&ticket=f6e4ea82-a934-4eb4-9916-1f0504267919 [conn_id=7477250854125027329]
2025-03-03 00:59:57.250  INFO 41580 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 00:59:57.259  INFO 41580 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.476 seconds (JVM running for 2.982)
2025-03-03 00:59:59.232  INFO 41580 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934797}
2025-03-03 00:59:59.268  WARN 41580 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 00:59:59.276  INFO 41580 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 00:59:59.592  INFO 41580 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 00:59:59.597 DEBUG 41580 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 00:59:59.610 DEBUG 41580 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 00:59:59.643 DEBUG 41580 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 00:59:59.647 DEBUG 41580 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 00:59:59.647 DEBUG 41580 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 00:59:59.671 DEBUG 41580 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 00:59:59.671  INFO 41580 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:00:00.410  INFO 41580 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:00:00.411  INFO 41580 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:00:00.910  INFO 41580 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 16:59:59 GMT"],"eagleid":["772449ad17409347990484822e"],"request-id":["68e56867-1b85-4dad-9f83-4d331faa996c"],"server":["Tengine"],"server-timing":["inner; dur=348","cdn-cache;desc=MISS,edge;dur=0,origin;dur=380"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache25.cn8115[380,0]"],"x-lgw-dst-svc":["zIaY9kiiDq6Jf4YgpU_BjC8mCYBJYslaZzwNrCPvA--hgeciVx6CeeaDFAH2H5p4d2UW0Y3HV-v5QB5xuZsp8TMljQ248Ft1E92It7Fm0FUqK7ovyunm7JTRNnPEzR0dGtNv5BvhPewxV4TorOq5Dbw_lH744cR25TkvqRXFhxmy_osy6MXORtP5Hi56pFthoDQ8AhN8S7QMcQT16r7-G7ZC26_Jx41L1UeVO_2PXzw_xWHRl_AQmw-4o6h8FcpX72R3Hfs3VfS4NlHhZ0alobvErSEbB9rMzkIFGa7hRe2jLFXBPSrAQk4="],"x-request-id":["68e56867-1b85-4dad-9f83-4d331faa996c"],"x-timestamp":["1740934799.412"],"x-tt-logid":["202503030059590E0AC523D985E0D06118"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee7156d744cd0a41d5c6f673ba93b1fc7b072e2bb898c218cadce7d4c65fdc708b615d810dac80799c6988d47d17acf47697bb059319d1e88263bd90a5634c44bb079f50cfb2afeafb78dae0dc12b1bdce77"],"x-tt-trace-id":["00-2503030059590E0AC523D985E0D06118-78781C1B2F42681E-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030059590E0AC523D985E0D06118","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030059590E0AC523D985E0D06118"}
2025-03-03 01:00:00.911  INFO 41580 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:00:01.276  INFO 41580 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:00:01.301 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:01.301 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:01.323 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:01.449 ERROR 41580 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:01.450  INFO 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:00:01.450  INFO 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:00:01.452 DEBUG 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:00:01.452 DEBUG 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:00:01.623  INFO 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=56021b96-6371-4225-8d73-c173ecaf2038
2025-03-03 01:00:01.624 DEBUG 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"files":[{"type":"image","transfer_method":"local_file","upload_file_id":"56021b96-6371-4225-8d73-c173ecaf2038"}],"response_mode":"blocking","conversation_id":"adae7da5-b6e9-42cc-a383-6ffaa4315067"}
2025-03-03 01:00:01.657 ERROR 41580 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "Arg user must be provided.", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:214) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:242) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:00:01.657  INFO 41580 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:00:01.657 ERROR 41580 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:00:01.658 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:01.658 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:01.682 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:01.857 ERROR 41580 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:01.859 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:01.859 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:01.884 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:02.030 ERROR 41580 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:02.034 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:02.034 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:02.057 DEBUG 41580 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:02.175 ERROR 41580 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:40.568  INFO 41580 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:00:40.575  INFO 41580 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:00:45.141  INFO 38988 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 38988 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:00:45.143 DEBUG 38988 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:00:45.143  INFO 38988 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:00:45.613  INFO 38988 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:00:45.614  INFO 38988 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:00:45.636  INFO 38988 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 01:00:46.051  INFO 38988 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:00:46.057  INFO 38988 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:00:46.058  INFO 38988 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:00:46.172  INFO 38988 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:00:46.172  INFO 38988 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 987 ms
2025-03-03 01:00:46.446  INFO 38988 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:00:46.446  INFO 38988 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:00:47.044  INFO 38988 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:00:47.255  INFO 38988 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477254890738302977&access_key=81f0473e3072b6f71d37a0c7985e8e5a&service_id=33554678&ticket=30429aa6-d84b-4654-ba0e-a85baba93bdd [conn_id=7477254890738302977]
2025-03-03 01:00:47.524  INFO 38988 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:00:47.532  INFO 38988 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.702 seconds (JVM running for 3.226)
2025-03-03 01:00:47.628  INFO 38988 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934846}
2025-03-03 01:00:47.672  WARN 38988 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 01:00:47.683  INFO 38988 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:00:47.957  INFO 38988 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:00:47.961 DEBUG 38988 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:47.979 DEBUG 38988 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:48.017 DEBUG 38988 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:48.020 DEBUG 38988 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:00:48.021 DEBUG 38988 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:00:48.044 DEBUG 38988 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:00:48.045  INFO 38988 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:00:48.671  INFO 38988 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:00:48.672  INFO 38988 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:00:49.128  INFO 38988 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:00:47 GMT"],"eagleid":["7abfaaa517409348473057950e"],"request-id":["1c958f6c-c83f-4490-aa48-fa4a9c21610b"],"server":["Tengine"],"server-timing":["inner; dur=334","cdn-cache;desc=MISS,edge;dur=0,origin;dur=356"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache17.cn6553[356,0]"],"x-lgw-dst-svc":["OEHH1c-ekZJqeVSukkl7UUwLJ6DAjua-aotL-7OlNtjoqw-lESraKU3flvA7yxrFMohCSJIcYkhyb62sr0Ozsi_gFTF1hYaZmYjSuhXqpHgQeDvhyn-XjEx0G_fUhox7X5DSG8IBLw5uMSenWozJ3EdNr_jXU6F6NqI-Ji6Oij_qulp4K6t4qWdVpUNMjmxOK9DvmE2xOki1Y8seUrWBO1IEnL4tvEDW0Oa9MlYKA37vqf6_p_afqUW7tbsgsR7seqhcd8XpK5y6BbUAGYe7iJ68nDI1RbNKtcJwURat6i9zpYFI-vk0eS0="],"x-request-id":["1c958f6c-c83f-4490-aa48-fa4a9c21610b"],"x-timestamp":["1740934847.649"],"x-tt-logid":["20250303010047C2AD0BECB589EBB8531E"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba640fe1227c6130594b8b379672a7f6c2d8e7760f92135c261fc13aa8ded6c48f755c165d49646e9f257340cdb195b7b638a55c74f6667271dfc600237641e0335708df11da1c0a5ffa608c3ea59d86d38c"],"x-tt-trace-id":["00-250303010047C2AD0BECB589EBB8531E-3534F7E273B3D18F-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303010047C2AD0BECB589EBB8531E","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303010047C2AD0BECB589EBB8531E"}
2025-03-03 01:00:49.128  INFO 38988 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:00:49.502  INFO 38988 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:00:49.526 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:49.526 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:49.550 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:49.667 ERROR 38988 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:49.668  INFO 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:00:49.668  INFO 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:00:49.670 DEBUG 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:00:49.671 DEBUG 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:00:49.842  INFO 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8aee1e62-1a86-438b-92a3-e06f61fe5a2e
2025-03-03 01:00:49.842 DEBUG 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"files":[{"type":"image","transfer_method":"local_file","upload_file_id":"8aee1e62-1a86-438b-92a3-e06f61fe5a2e"}],"response_mode":"blocking","conversation_id":"a8861598-382c-4585-92c1-888db559b0f6","user":"fyjw"}
2025-03-03 01:00:49.877 ERROR 38988 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "Missing required parameter in the JSON body", "params": "inputs"}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:215) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:243) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:00:49.878  INFO 38988 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:00:49.878 ERROR 38988 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:00:49.879 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:49.879 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:49.902 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:50.031 ERROR 38988 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:50.034 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:50.034 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:50.057 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:50.187 ERROR 38988 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:00:50.191 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:00:50.191 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:00:50.215 DEBUG 38988 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:00:50.357 ERROR 38988 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:01:41.534  INFO 38988 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:01:41.542  INFO 38988 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:01:43.600  INFO 15288 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 15288 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:01:43.607 DEBUG 15288 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:01:43.607  INFO 15288 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:01:44.026  INFO 15288 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:01:44.027  INFO 15288 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:01:44.047  INFO 15288 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 01:01:44.406  INFO 15288 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:01:44.410  INFO 15288 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:01:44.410  INFO 15288 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:01:44.498  INFO 15288 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:01:44.498  INFO 15288 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 856 ms
2025-03-03 01:01:44.757  INFO 15288 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:01:44.758  INFO 15288 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:01:45.352  INFO 15288 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:01:45.528  INFO 15288 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477252877301547010&access_key=6284e529e429c874a4071432e2a78d50&service_id=33554678&ticket=2d7ab5f3-e6f6-4cc1-8a70-b4ae348334db [conn_id=7477252877301547010]
2025-03-03 01:01:45.896  INFO 15288 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:01:45.904  INFO 15288 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.61 seconds (JVM running for 3.28)
2025-03-03 01:01:46.658  INFO 15288 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934905}
2025-03-03 01:01:46.722  WARN 15288 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 01:01:46.734  INFO 15288 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:01:47.051  INFO 15288 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:01:47.056 DEBUG 15288 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:01:47.072 DEBUG 15288 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:01:47.107 DEBUG 15288 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:01:47.111 DEBUG 15288 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:01:47.112 DEBUG 15288 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:01:47.132 DEBUG 15288 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:01:47.132  INFO 15288 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:01:47.870  INFO 15288 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:01:47.871  INFO 15288 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:01:48.432  INFO 15288 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:01:46 GMT"],"eagleid":["b75d66a117409349065068130e"],"request-id":["76797d18-b69f-4672-bb3a-1cd274ed55ce"],"server":["Tengine"],"server-timing":["inner; dur=299","cdn-cache;desc=MISS,edge;dur=0,origin;dur=389"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache13.cn6912[389,0]"],"x-lgw-dst-svc":["rLJNs4vEstLZw_UFcs78sX5oPkq2sxOeRNUlC1HLZWS5BEaU1OscwGmvVf4HVfWJeYoCCT6lhzfwwlQJOjmhcrKHCha6dDRlt_O_t46aBzlwvStpJ5yCFqbqQnRZligyQ4xEt99zcTBOUR1AoG1Y36hn4P_vdozZ94yyqMCYrdWxO86IV012RRippFUyrIXw6sAgQ6ETTBxZ4jN7iXUq-yI6lPcCb_0qgD0WMdT2x-8bkeN8HXhpdHSz4oO6jG2dn5MzyrgkKAggUMKZm2SQCfq1MgjuPpT9n5JtVfvKrS2W61Qw_OY0b6Y="],"x-request-id":["76797d18-b69f-4672-bb3a-1cd274ed55ce"],"x-timestamp":["1740934906.880"],"x-tt-logid":["20250303010146980BE8B44907F2BF3766"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b06a511a783d9d3af78ec6072f7eb344d732e628d854ccac4c9a2f52cc19c20a6096d16da9da119d2372930d4e8645023eed3cd3cf64c5e4ca996b714defc1a6d37f19a0696ecfbeec185eb9ba4015e0f2"],"x-tt-trace-id":["00-250303010146980BE8B44907F2BF3766-0C51BC2A1DC0BD8B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303010146980BE8B44907F2BF3766","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303010146980BE8B44907F2BF3766"}
2025-03-03 01:01:48.433  INFO 15288 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:01:48.781  INFO 15288 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:01:48.801 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:01:48.801 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:01:48.823 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:01:48.953 ERROR 15288 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:01:48.954  INFO 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:01:48.955  INFO 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:01:48.958 DEBUG 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:01:48.959 DEBUG 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:01:49.152  INFO 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=dd10bbab-138f-48d9-90c6-d205c9d1d407
2025-03-03 01:01:49.153 DEBUG 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"files":[{"type":"image","transfer_method":"local_file","upload_file_id":"dd10bbab-138f-48d9-90c6-d205c9d1d407"}],"response_mode":"blocking","conversation_id":"9d9885b7-b98c-47bf-b3f8-8d366398bf81","user":"fyjw","inputs":{}}
2025-03-03 01:01:49.214 ERROR 15288 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "file is required in input form", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:216) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:244) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:358) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:230) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:01:49.215  INFO 15288 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:01:49.215 ERROR 15288 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:01:49.216 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:01:49.216 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:01:49.307 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:01:49.532 ERROR 15288 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:01:49.534 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:01:49.535 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:01:49.572 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:01:49.708 ERROR 15288 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:01:49.714 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:01:49.714 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:01:49.746 DEBUG 15288 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:01:49.924 ERROR 15288 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:02:26.373  INFO 15288 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:02:26.378  INFO 15288 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:02:31.545  INFO 16656 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 16656 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:02:31.546 DEBUG 16656 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:02:31.547  INFO 16656 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:02:31.956  INFO 16656 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:02:31.958  INFO 16656 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:02:31.990  INFO 16656 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-03-03 01:02:32.352  INFO 16656 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:02:32.356  INFO 16656 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:02:32.356  INFO 16656 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:02:32.438  INFO 16656 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:02:32.438  INFO 16656 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 858 ms
2025-03-03 01:02:32.696  INFO 16656 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:02:32.697  INFO 16656 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:02:33.180  INFO 16656 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:02:33.395  INFO 16656 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477254890738548737&access_key=3ad5529a4a91c854982a12e8f083a07f&service_id=33554678&ticket=86605c27-090e-43b2-adcf-98898ee864cb [conn_id=7477254890738548737]
2025-03-03 01:02:33.570  INFO 16656 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:02:33.576  INFO 16656 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.313 seconds (JVM running for 2.886)
2025-03-03 01:02:34.935  INFO 16656 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740934953}
2025-03-03 01:02:34.977  WARN 16656 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 01:02:34.986  INFO 16656 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:02:35.235  INFO 16656 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:02:35.240 DEBUG 16656 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:02:35.258 DEBUG 16656 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:02:35.291 DEBUG 16656 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:02:35.295 DEBUG 16656 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:02:35.295 DEBUG 16656 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:02:35.317 DEBUG 16656 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:02:35.317  INFO 16656 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:02:36.097  INFO 16656 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:02:36.098  INFO 16656 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:02:36.572  INFO 16656 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:02:35 GMT"],"eagleid":["772449a817409349547333765e"],"request-id":["0ab4aac1-04dc-4d85-b6b5-967d0e1b890b"],"server":["Tengine"],"server-timing":["inner; dur=324","cdn-cache;desc=MISS,edge;dur=0,origin;dur=355"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn8115[355,0]"],"x-lgw-dst-svc":["W2XF-2bGE_IO5cm4K9OiAIM6dMZ_oR9cYjfMh9IeOUKv-RGF1a4uWVoxv0TemM7cuXYf0_-zuUwFtICwmVTwiVPpkaKDsdZgDwesAoUr19BtN_KhIe4wYE4SuuFU2iOFibtIhyByJkuuRda_g4MDFTip-ZWhNJZbaM1ny5XqIvs_Z2xPkdSHbpfKoCVmwQztsC4a3ZsdirvpjJjlMcGoGXDPhCc9VhpyLv7TC4s6-ar3g6bzVwmQvScuhNuUZnOzxVvdS3KBCoiox08VvCvwNMyCzCzLee8D2VHlOdv-F_PXviRtZjWCIXY="],"x-request-id":["0ab4aac1-04dc-4d85-b6b5-967d0e1b890b"],"x-timestamp":["1740934955.073"],"x-tt-logid":["20250303010234057D48532594C9BAC102"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee714422167ffa9ea79fff3e9804ca37ddb73b4e4a99363e4edf4962754b608b501d0490a91a424f2bcfdbab734c0c9b5843ceabbb54e8d569ff8638fecf25d4f0606e08868d9ac99bef2ff32d2af6d94acb"],"x-tt-trace-id":["00-250303010234057D48532594C9BAC102-2BC8B66864043637-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303010234057D48532594C9BAC102","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303010234057D48532594C9BAC102"}
2025-03-03 01:02:36.572  INFO 16656 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:02:36.987  INFO 16656 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:02:37.008 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:02:37.009 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:02:37.029 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:02:37.142 ERROR 16656 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:02:37.144  INFO 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:02:37.144  INFO 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:02:37.146 DEBUG 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:02:37.146 DEBUG 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:02:37.326  INFO 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=300eccdb-c8ed-427c-a390-7218244b850a
2025-03-03 01:02:37.326 DEBUG 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"300eccdb-c8ed-427c-a390-7218244b850a"}},"response_mode":"blocking","conversation_id":"8fc1e90e-3844-4836-9fa8-70da82151f43","user":"fyjw"}
2025-03-03 01:02:46.109  INFO 16656 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, answer=null
2025-03-03 01:02:46.109  INFO 16656 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:02:46.109 ERROR 16656 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:02:46.129 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:02:46.129 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:02:46.149 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:02:46.304 ERROR 16656 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:02:46.305 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:02:46.305 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:02:46.325 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:02:46.466 ERROR 16656 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:02:46.470 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:02:46.470 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:02:46.490 DEBUG 16656 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:02:46.602 ERROR 16656 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:04:18.223  INFO 16656 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:04:18.229  INFO 16656 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:04:22.856  INFO 19180 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 19180 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:04:22.858 DEBUG 19180 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:04:22.859  INFO 19180 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:04:23.486  INFO 19180 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:04:23.488  INFO 19180 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:04:23.505  INFO 19180 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 01:04:23.857  INFO 19180 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:04:23.862  INFO 19180 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:04:23.862  INFO 19180 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:04:23.952  INFO 19180 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:04:23.952  INFO 19180 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1046 ms
2025-03-03 01:04:24.248  INFO 19180 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:04:24.250  INFO 19180 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:04:24.854  INFO 19180 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:04:25.086  INFO 19180 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477252877301891074&access_key=aaa8a05c10bc8093327e7d62dae7d51a&service_id=33554678&ticket=e7b9a6b8-0ed9-4842-ad38-6c662c7101bb [conn_id=7477252877301891074]
2025-03-03 01:04:25.248  INFO 19180 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:04:25.256  INFO 19180 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.74 seconds (JVM running for 3.379)
2025-03-03 01:05:20.652  INFO 35972 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 35972 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:05:20.656 DEBUG 35972 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:05:20.656  INFO 35972 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:05:21.112  INFO 35972 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:05:21.112  INFO 35972 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:05:21.130  INFO 35972 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 01:05:21.478  INFO 35972 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:05:21.482  INFO 35972 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:05:21.482  INFO 35972 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:05:21.566  INFO 35972 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:05:21.567  INFO 35972 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 858 ms
2025-03-03 01:05:21.800  INFO 35972 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:05:21.800  INFO 35972 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:05:22.329  INFO 35972 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:05:22.433  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477252877301972994&access_key=3a7c136c3e53ca8db107b642e57b188e&service_id=33554678&ticket=3c2c36a0-e442-446a-8999-1b8dd4cc45e6 [conn_id=7477252877301972994]
2025-03-03 01:05:22.810  INFO 35972 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:05:22.818  INFO 35972 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.48 seconds (JVM running for 3.262)
2025-03-03 01:05:28.616  INFO 35972 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740935127}
2025-03-03 01:05:28.655  WARN 35972 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @1786dec2
2025-03-03 01:05:28.664  INFO 35972 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:05:28.934  INFO 35972 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:05:28.938 DEBUG 35972 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:05:28.951 DEBUG 35972 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:05:28.982 DEBUG 35972 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:05:28.985 DEBUG 35972 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:05:28.985 DEBUG 35972 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:05:29.006 DEBUG 35972 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:05:29.007  INFO 35972 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:05:29.688  INFO 35972 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:05:29.690  INFO 35972 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:05:30.232  INFO 35972 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:05:28 GMT"],"eagleid":["772449a317409351283262919e"],"request-id":["8c26c52e-4000-4bd2-833e-d843f26c57b9"],"server":["Tengine"],"server-timing":["inner; dur=368","cdn-cache;desc=MISS,edge;dur=0,origin;dur=403"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache15.cn8115[403,0]"],"x-lgw-dst-svc":["Di4x5x0rFiZHnKKmC0k4nqDLJZ9gpJtuAHrTHsJTXTy0eHwsjWVsmCCa9zoZS-YTKi7r6IvW56tPwm7Mhj2zCW5QE857EwXV_fhqPnftad8kSxcgMtVv9_xLRBxwIR-DJo60L_oQtouWaDGZ3pBMp0h7b5q4Yc6L7QquW8vyDVvsUxwbQTG1XdlyWcpBsG1dNEcggPMTJMR3A3epOi5RDSq-YtZ6LanNMMMMObrianw881NmNVT-kDnu3Za7M94ueHKy_j16l7Nf3DYIcwHKMq1boxbQGloOcNCWVeAAAXJYwZsbJjx8GHc="],"x-request-id":["8c26c52e-4000-4bd2-833e-d843f26c57b9"],"x-timestamp":["1740935128.714"],"x-tt-logid":["202503030105283F356FE11D9A10B5823E"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71967e77f4950d203ac695112ae09bbc3a37d1c45a5594e79878ad8973cd4b0c80a85135a37eab308e9cba37291317738a4266df574d151a2538b2cad9fdf48730f8afa86ef32381f9a2bd42e0d449d99a"],"x-tt-trace-id":["00-2503030105283F356FE11D9A10B5823E-3936CAC4307C129D-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030105283F356FE11D9A10B5823E","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030105283F356FE11D9A10B5823E"}
2025-03-03 01:05:30.232  INFO 35972 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:05:30.598  INFO 35972 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:05:30.618 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:05:30.619 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:05:30.639 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:05:30.750 ERROR 35972 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:05:30.751  INFO 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:05:30.751  INFO 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:05:30.752 DEBUG 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:05:30.754 DEBUG 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:05:30.948  INFO 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ca3b110d-4669-4c4e-b201-a13e474f6fa5
2025-03-03 01:05:30.949 DEBUG 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"ca3b110d-4669-4c4e-b201-a13e474f6fa5"}},"response_mode":"blocking","conversation_id":"3237bb65-7ab4-48e0-81ad-4ade56c11b8f","user":"fyjw"}
2025-03-03 01:05:39.214  INFO 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=null
2025-03-03 01:05:39.214 DEBUG 35972 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"36e9a22e-2934-4396-b98d-8d9e622987f4","workflow_run_id":"9799edef-acb3-459b-bfce-70e9538f180f","data":{"id":"9799edef-acb3-459b-bfce-70e9538f180f","workflow_id":"c90a1701-a50a-45f7-8c7d-3c3f6ca53689","status":"succeeded","outputs":{},"elapsed_time":8.221288850996643,"total_tokens":786,"total_steps":4,"created_at":1740935129,"finished_at":1740935137}}
2025-03-03 01:05:39.214  INFO 35972 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:05:39.214 ERROR 35972 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:05:39.234 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:05:39.234 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:05:39.254 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:05:39.405 ERROR 35972 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:05:39.407 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:05:39.407 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:05:39.429 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:05:39.550 ERROR 35972 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:05:39.554 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:05:39.554 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:05:39.574 DEBUG 35972 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:05:39.688 ERROR 35972 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:06:30.601  INFO 35972 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740935189}
2025-03-03 01:06:30.622 DEBUG 35972 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:06:30.622 DEBUG 35972 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:06:30.642 DEBUG 35972 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:06:30.642 DEBUG 35972 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:06:30.642 DEBUG 35972 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:06:30.662 DEBUG 35972 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:06:30.662  INFO 35972 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:06:31.244  INFO 35972 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:06:31.245  INFO 35972 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:06:31.698  INFO 35972 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:06:30 GMT"],"eagleid":["772449a317409351898821901e"],"request-id":["4feb0656-c24d-4319-b85b-28611c164f79"],"server":["Tengine"],"server-timing":["inner; dur=349","cdn-cache;desc=MISS,edge;dur=0,origin;dur=380"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache15.cn8115[380,0]"],"x-lgw-dst-svc":["oNqay9Iee19p58YFwcuL5MVqoEQJ0w8RmjZpkeSC1w0rKOMIBizb9P7YqiWvYPJZekYVKDxh3OXJunXAWxYV_Brsz0ne5tETG8eB5T5nELIr2EcmknkjQOAIsMRWwCAIlPxyoW-4hrSnpYor2ngG9-3kupaSvJZueFw5E13OZ48Cfb7W1RarSATTfVaX--cdvhvZ6G_FqItMHU_pPwdtY81aJp3kA1gRlLtyRx3u57ZaIwCLWnt_n-l6Hmo7Fdb1tCvrkcqftlVfc6iVc-pViaJ2Ygzt_cMmu8UCvGSGiWx4nIRqyAfffXU="],"x-request-id":["4feb0656-c24d-4319-b85b-28611c164f79"],"x-timestamp":["1740935190.247"],"x-tt-logid":["20250303010629854B1454C7C8CEB89B3B"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71173105a3fd4435fb56c3c2b9fc2d753ceabdd32f2247166a2cfa21e511b5800555c13edc3e2ac60e940b952bfbb93b54636a4111fa97ff6439ff4e9e633bd5f33e3038a70a7124921fc5efc7846b7401"],"x-tt-trace-id":["00-250303010629854B1454C7C8CEB89B3B-2C3D33027E357EEE-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303010629854B1454C7C8CEB89B3B","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303010629854B1454C7C8CEB89B3B"}
2025-03-03 01:06:31.698  INFO 35972 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:06:32.085  INFO 35972 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:06:32.106 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:06:32.107 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:06:32.127 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:06:32.263 ERROR 35972 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:06:32.265  INFO 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:06:32.265  INFO 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:06:32.265 DEBUG 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:06:32.265 DEBUG 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:06:32.402  INFO 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=eec52aa8-2c9b-4853-9d02-0325f3fd09af
2025-03-03 01:06:32.402 DEBUG 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"eec52aa8-2c9b-4853-9d02-0325f3fd09af"}},"response_mode":"blocking","conversation_id":"180cdcef-ded7-441c-97bf-2cb422553b3f","user":"fyjw"}
2025-03-03 01:06:39.712  INFO 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=null
2025-03-03 01:06:39.713 DEBUG 35972 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"cd7d064e-a76e-43b9-98bb-cff63cadbca9","workflow_run_id":"8bcd5641-aa1c-4792-aee2-92362f1598a8","data":{"id":"8bcd5641-aa1c-4792-aee2-92362f1598a8","workflow_id":"cb8e9df0-6d30-49c9-afc6-a26a9f12faf3","status":"succeeded","outputs":{},"elapsed_time":7.270697748055682,"total_tokens":687,"total_steps":4,"created_at":1740935191,"finished_at":1740935198}}
2025-03-03 01:06:39.713  INFO 35972 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:06:39.713 ERROR 35972 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:06:39.732 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:06:39.733 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:06:39.751 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:06:39.865 ERROR 35972 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:06:39.866 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:06:39.866 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:06:39.886 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:06:40.043 ERROR 35972 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:06:40.044 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:06:40.044 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:06:40.064 DEBUG 35972 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:06:40.195 ERROR 35972 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:08:21.438 ERROR 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 01:08:21.438  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477252877301972994&access_key=3a7c136c3e53ca8db107b642e57b188e&service_id=33554678&ticket=3c2c36a0-e442-446a-8999-1b8dd4cc45e6 [conn_id=7477252877301972994]
2025-03-03 01:08:21.438  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 01:08:50.295  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 01:08:50.618  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477256160846725122&access_key=6268faa8c82035100fb71170d637d702&service_id=33554678&ticket=80cb1517-1874-4f4b-a501-302aaab3d216 [conn_id=7477256160846725122]
2025-03-03 01:10:21.434 ERROR 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 01:10:21.434  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477256160846725122&access_key=6268faa8c82035100fb71170d637d702&service_id=33554678&ticket=80cb1517-1874-4f4b-a501-302aaab3d216 [conn_id=7477256160846725122]
2025-03-03 01:10:21.434  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 01:10:39.595  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 01:10:39.899  INFO 35972 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477256160846921730&access_key=da9049ef7353c9f0f5d604975f89c950&service_id=33554678&ticket=b7b8ab52-915a-4ba6-97bd-d38fc94abbc2 [conn_id=7477256160846921730]
2025-03-03 01:19:35.754  INFO 35972 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:19:35.760  INFO 35972 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:19:39.978  INFO 17376 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 17376 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:19:39.980 DEBUG 17376 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:19:39.981  INFO 17376 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:19:40.443  INFO 17376 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:19:40.445  INFO 17376 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:19:40.463  INFO 17376 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 01:19:40.893  INFO 17376 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:19:40.898  INFO 17376 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:19:40.898  INFO 17376 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:19:40.985  INFO 17376 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:19:40.986  INFO 17376 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 967 ms
2025-03-03 01:19:41.276  INFO 17376 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:19:41.278  INFO 17376 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:19:41.840  INFO 17376 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:19:42.038  INFO 17376 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477256160847904770&access_key=f979389b58b4bba449546d198eb1d30b&service_id=33554678&ticket=63585962-be9d-4de4-824f-cb3c7107dcbc [conn_id=7477256160847904770]
2025-03-03 01:19:42.291  INFO 17376 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:19:42.296  INFO 17376 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.655 seconds (JVM running for 3.399)
2025-03-03 01:19:43.660  INFO 17376 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740935982}
2025-03-03 01:19:43.702  WARN 17376 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 01:19:43.710  INFO 17376 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:19:44.002  INFO 17376 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:19:44.007 DEBUG 17376 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:19:44.020 DEBUG 17376 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:19:44.059 DEBUG 17376 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:19:44.062 DEBUG 17376 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:19:44.062 DEBUG 17376 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:19:44.089 DEBUG 17376 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:19:44.090  INFO 17376 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:19:44.811  INFO 17376 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:19:44.812  INFO 17376 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:19:45.385  INFO 17376 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:19:43 GMT"],"eagleid":["7abfaab017409359834546484e"],"request-id":["039d14d0-c870-4851-869a-87776004292e"],"server":["Tengine"],"server-timing":["inner; dur=389","cdn-cache;desc=MISS,edge;dur=0,origin;dur=461"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache28.cn6553[461,0]"],"x-lgw-dst-svc":["Lp2h4W6WEkOfpg6EfUVVCwqjdpjXPjh1lO_dvKN7QKsnPgoJz59gCQdTiDWZupfFwrSB3s0Jl_CCZzEP6qCUI067eymQ_cpz67cucolyyf1taPtDnx0GPgDb0uSD4b__u26y2u_P0T8yrl2lwhDA5eW_cYDy9Go4L-sQkWUO4kVbkRcOd1ZQoq-SCusRnIkjr6qOA5f4hO4I0IltrEqquj9QbXkrm4QGz6cib6G0hjVvDQLdUe008nzq5800Namml9rbUftGqwg_vgutNvENbqDEqJEFdnn4FZbTTsr4AmYg0euXF2Q5vMs="],"x-request-id":["039d14d0-c870-4851-869a-87776004292e"],"x-timestamp":["1740935983.899"],"x-tt-logid":["20250303011943A59F43D7D7AD84B77488"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64e9110f2703a580212fe26992697b3c3c525e8ce8f27d92d7b4a7331a80d0c9afe2ff73ef521c3a416f6f3ca88a34d824956dd4f65b06cc4659f921d39e4fdd74261073b5e0facd6673ee58129943aa92"],"x-tt-trace-id":["00-250303011943A59F43D7D7AD84B77488-19FBEDFA4E7A1ABA-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303011943A59F43D7D7AD84B77488","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303011943A59F43D7D7AD84B77488"}
2025-03-03 01:19:45.385  INFO 17376 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:19:45.806  INFO 17376 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:19:45.832 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:19:45.833 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:19:45.859 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:19:45.992 ERROR 17376 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:19:45.992  INFO 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:19:45.993  INFO 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:19:45.995 DEBUG 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:19:45.995 DEBUG 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:19:46.176  INFO 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b1b9c5c4-7785-430d-be59-dde55758ce58
2025-03-03 01:19:46.176 DEBUG 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"b1b9c5c4-7785-430d-be59-dde55758ce58"}},"response_mode":"blocking","conversation_id":"11740488-b65b-4c41-a201-a41802980c5b","user":"fyjw"}
2025-03-03 01:19:53.231  INFO 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=null
2025-03-03 01:19:53.231 DEBUG 17376 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"764fa311-79fd-41fd-a754-e2e25ea95e54","workflow_run_id":"7a700cbc-6626-4b37-81eb-1a274e529db8","data":{"id":"7a700cbc-6626-4b37-81eb-1a274e529db8","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩滔新城区金姚东方置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：2022001716383），约定的购房款付款方式为按揭贷款。\n\n本人与贵公司签订购房合同后，因个人征信原因未能办理按揭贷款，故而向贵公司申请变更付款方式为一次性付款，并全额支付房款。\n\n在此过程中，本人多次向贵公司提出补充协议签订申请，但贵公司以需民法典规定的利息为由要求支付利息，而未能签订相关补充协议，致使至今未能办理网签。对此，本人未予认可且多次协商未果。\n\n现本人根据相关法律法规及购房合同约定，拒绝支付利息，并向贵司明确表示，若贵司在2023年12月8日前仍未能与本人签订补充协议并办理网签，贵司应承担由此产生的后果及一切法律责任。\n\n在该通知函下达后若贵司正式受理，请立即与我联系。\n\n联系人：程甲午 联系电话：13262792367  \n杨晓翟 联系电话：15821247462  \n\n2023年11月28日\n```"},"elapsed_time":7.006871177116409,"total_tokens":922,"total_steps":4,"created_at":1740935984,"finished_at":1740935991}}
2025-03-03 01:19:53.231  INFO 17376 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : null
2025-03-03 01:19:53.231 ERROR 17376 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:19:53.258 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:19:53.259 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:19:53.285 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:19:53.421 ERROR 17376 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:19:53.423 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:19:53.423 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:19:53.455 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:19:53.599 ERROR 17376 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:19:53.603 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:19:53.603 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:19:53.630 DEBUG 17376 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:19:53.728 ERROR 17376 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:20:50.433  INFO 17376 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:20:50.438  INFO 17376 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:20:56.051  INFO 36816 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 36816 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:20:56.053 DEBUG 36816 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:20:56.053  INFO 36816 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:20:56.575  INFO 36816 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:20:56.576  INFO 36816 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:20:56.602  INFO 36816 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.
2025-03-03 01:20:57.042  INFO 36816 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:20:57.048  INFO 36816 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:20:57.048  INFO 36816 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:20:57.180  INFO 36816 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:20:57.180  INFO 36816 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1085 ms
2025-03-03 01:20:57.480  INFO 36816 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:20:57.482  INFO 36816 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:20:58.080  INFO 36816 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:20:58.192  INFO 36816 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477259594755014684&access_key=506626d1242df06ccc9f5966f46a865b&service_id=33554678&ticket=82a2b7a7-9c8c-4e05-9dda-1ba2494af56c [conn_id=7477259594755014684]
2025-03-03 01:20:58.515  INFO 36816 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:20:58.521  INFO 36816 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.796 seconds (JVM running for 3.311)
2025-03-03 01:21:01.037  INFO 36816 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740936059}
2025-03-03 01:21:01.075  WARN 36816 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 01:21:01.084  INFO 36816 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:21:01.399  INFO 36816 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:21:01.403 DEBUG 36816 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:21:01.419 DEBUG 36816 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:21:01.453 DEBUG 36816 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:21:01.457 DEBUG 36816 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:21:01.457 DEBUG 36816 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:21:01.481 DEBUG 36816 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:21:01.481  INFO 36816 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:21:02.173  INFO 36816 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:21:02.175  INFO 36816 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:21:02.659  INFO 36816 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:21:01 GMT"],"eagleid":["7abfaa9817409360608138681e"],"request-id":["4c2e8edd-fc1e-4f7c-8593-7375d3ea8a04"],"server":["Tengine"],"server-timing":["inner; dur=339","cdn-cache;desc=MISS,edge;dur=0,origin;dur=364"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache4.cn6553[364,0]"],"x-lgw-dst-svc":["JaGDbFkZ1dw_b4cuFaViCdKn4dj1ybGFoSZBlbbhAJd2o3EFNJ_zrFgQfVskN5DlKbcBQMLSmjIg2RMO3I7mSBfnM28XOxp6z0rR3MGD0datMJ26ajTjMZ1Z8Er2kSG9DbgS_RxrjQBNv76AE8WTYVs3bnzWJlUoAFvIc4-YY94RIaM_ESilGeU7SHtY5UsEM80Ut6kAsGNu2ietu0JmRJLvA2AH3uV67yt-zeW4Tgge6-pUNdPyW4ZZtesaF8OGdvD-eFismsAjs6TdEPqzT4xPRoX488RkR5AezttxrjFi_p5kc55B0WI="],"x-request-id":["4c2e8edd-fc1e-4f7c-8593-7375d3ea8a04"],"x-timestamp":["1740936061.165"],"x-tt-logid":["20250303012100F506C52A7C2013C1E5C4"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64f78101b5ba2aecbd45f25be0426225026c295e55ccbabc88d1764ac84b0fdca871bca162b51280d226d402192bce8ef1660068c89b96a350609d178d2e4dcecb14437a683627235c33c384445645f0e3"],"x-tt-trace-id":["00-250303012100F506C52A7C2013C1E5C4-799A4DBB5B2D8D4D-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303012100F506C52A7C2013C1E5C4","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303012100F506C52A7C2013C1E5C4"}
2025-03-03 01:21:02.660  INFO 36816 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:21:03.058  INFO 36816 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:21:03.083 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:21:03.083 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:21:03.106 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:21:03.219 ERROR 36816 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:21:03.220  INFO 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:21:03.221  INFO 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:21:03.222 DEBUG 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:21:03.222 DEBUG 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:21:03.396  INFO 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f4da22e3-82e6-43bf-9c3e-9284919c9a94
2025-03-03 01:21:03.396 DEBUG 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f4da22e3-82e6-43bf-9c3e-9284919c9a94"}},"response_mode":"blocking","conversation_id":"0c967372-a763-4ae3-86f8-cfc6024ea946","user":"fyjw"}
2025-03-03 01:21:11.528  INFO 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知

上海浩瀚新区金地先方置业有限公司：

2022年9月13日与贵司签订的《上海市商品房预售合同》（合同编号：2022016716383），因贵司未能按合同约定履行相关义务，造成的中又受到金地先方置业公司通知函的影响，导致我司无法按时支付购房款项。

本小区房屋交付至今，我司始终未能入住，现我司要求贵司承担违约责任并赔偿我司的相关损失。根据相关法律法规规定，商品房买卖合同中约定的延期交付违约金标准为日万分之二，但若违约金超过银行同期贷款利率的4倍，则应按照银行同期贷款利率的4.75%计算。

在正式进入司法程序前，我司已正式发函贵司，限：2023年12月8日前支付违约金及赔偿款项，否则我司将保留依法追究贵司相关法律责任的权利。

特此通知！

联系人：程向云  
电话：13262792367  
杨晓瑶  
电话：15821244783  

2023年11月28日
```
2025-03-03 01:21:11.529 DEBUG 36816 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"b99e0f71-94b3-4eb1-8416-86232692383c","workflow_run_id":"1dc90dc0-f58a-4788-ae70-a75bd9a2babd","data":{"id":"1dc90dc0-f58a-4788-ae70-a75bd9a2babd","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知\n\n上海浩瀚新区金地先方置业有限公司：\n\n2022年9月13日与贵司签订的《上海市商品房预售合同》（合同编号：2022016716383），因贵司未能按合同约定履行相关义务，造成的中又受到金地先方置业公司通知函的影响，导致我司无法按时支付购房款项。\n\n本小区房屋交付至今，我司始终未能入住，现我司要求贵司承担违约责任并赔偿我司的相关损失。根据相关法律法规规定，商品房买卖合同中约定的延期交付违约金标准为日万分之二，但若违约金超过银行同期贷款利率的4倍，则应按照银行同期贷款利率的4.75%计算。\n\n在正式进入司法程序前，我司已正式发函贵司，限：2023年12月8日前支付违约金及赔偿款项，否则我司将保留依法追究贵司相关法律责任的权利。\n\n特此通知！\n\n联系人：程向云  \n电话：13262792367  \n杨晓瑶  \n电话：15821244783  \n\n2023年11月28日\n```"},"elapsed_time":8.086869361810386,"total_tokens":901,"total_steps":4,"created_at":1740936062,"finished_at":1740936070}}
2025-03-03 01:21:11.529  INFO 36816 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : ```markdown
# 通 知

上海浩瀚新区金地先方置业有限公司：

2022年9月13日与贵司签订的《上海市商品房预售合同》（合同编号：2022016716383），因贵司未能按合同约定履行相关义务，造成的中又受到金地先方置业公司通知函的影响，导致我司无法按时支付购房款项。

本小区房屋交付至今，我司始终未能入住，现我司要求贵司承担违约责任并赔偿我司的相关损失。根据相关法律法规规定，商品房买卖合同中约定的延期交付违约金标准为日万分之二，但若违约金超过银行同期贷款利率的4倍，则应按照银行同期贷款利率的4.75%计算。

在正式进入司法程序前，我司已正式发函贵司，限：2023年12月8日前支付违约金及赔偿款项，否则我司将保留依法追究贵司相关法律责任的权利。

特此通知！

联系人：程向云  
电话：13262792367  
杨晓瑶  
电话：15821244783  

2023年11月28日
```
2025-03-03 01:21:11.529  INFO 36816 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 01:21:11.553 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:21:11.553 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:21:11.577 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:21:11.712 ERROR 36816 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:21:11.713 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:21:11.714 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:21:11.737 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:21:11.878 ERROR 36816 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:21:11.886 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:21:11.887 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:21:11.911 DEBUG 36816 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:21:12.021 ERROR 36816 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:23:57.420 ERROR 36816 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 01:23:57.420  INFO 36816 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477259594755014684&access_key=506626d1242df06ccc9f5966f46a865b&service_id=33554678&ticket=82a2b7a7-9c8c-4e05-9dda-1ba2494af56c [conn_id=7477259594755014684]
2025-03-03 01:23:57.420  INFO 36816 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 01:24:11.225  INFO 36816 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 01:24:11.614  INFO 36816 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477258021183455260&access_key=d3f516df47aba536d4094e6b3cb1ce79&service_id=33554678&ticket=f2c0ae07-ed9d-4019-8060-432de912ee8f [conn_id=7477258021183455260]
2025-03-03 01:25:16.833 ERROR 36816 --- [pool-2-thread-5] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: ee190f3d-0de0-4c62-aeb4-95d9f7e72568, trace_id: 3af5df05b8f2570a8c794512367ea45b, [conn_id=7477258021183455260]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:25:22.576  INFO 36816 --- [pool-2-thread-6] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740932404}
2025-03-03 01:25:22.601 DEBUG 36816 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:25:22.602 DEBUG 36816 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:25:22.625 DEBUG 36816 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:25:22.626 DEBUG 36816 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:25:22.626 DEBUG 36816 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:25:22.652 DEBUG 36816 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:25:22.653  INFO 36816 --- [pool-2-thread-6] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:25:23.175  INFO 36816 --- [pool-2-thread-6] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:25:23.176  INFO 36816 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:25:23.604  INFO 36816 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:25:22 GMT"],"eagleid":["77243f1517409363218173518e"],"request-id":["88db1b88-87f7-4006-8b57-db8fe72dc326"],"server":["Tengine"],"server-timing":["inner; dur=379","cdn-cache;desc=MISS,edge;dur=0,origin;dur=420"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache1.cn7330[420,0]"],"x-lgw-dst-svc":["GL70wCiN3e5y9clh_TAr_0DMW4dAiz2bJDWifEXu67L07UBDKuFfOxMe6zCESyFKtgxabdCD9UzvBeZIcHmxwvdAiUxLcRpDNbcD1WPPDbBhOeW8BcNgan7mZq88CVdUtVYuwBRNZ_mMfIOlnqqzQEY0OKShw9ujxo3r4TPnlgTf06Z7wQ7dlH2EicR590GcZosWDnyuu1TKukBLG82_uf2p44cdiNOnQ2NbaJlYqd_ncyb2DB6x1j_XWzgnc9WtrguG9M-Qb9mNy3xhl-xAJFTe_wI5MKdDToAkMoVHcw9rDUKcdb2qZ3c="],"x-request-id":["88db1b88-87f7-4006-8b57-db8fe72dc326"],"x-timestamp":["1740936322.220"],"x-tt-logid":["2025030301252137A2767711D692D727C6"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71853a44625697f674f9ddc2962a89da83a23e212c220e63a92cb70f5391fdecf59b4e1ff329637273cb8175d5071d46196435561b091245fdc8f3d6732b2ab319234ba26498f800477eab2a5b38650fb0"],"x-tt-trace-id":["00-25030301252137A2767711D692D727C6-3180067555BD85CE-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030301252137A2767711D692D727C6","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030301252137A2767711D692D727C6"}
2025-03-03 01:25:23.604  INFO 36816 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:25:23.925  INFO 36816 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:25:23.948 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:25:23.948 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:25:23.972 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:25:24.102 ERROR 36816 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:25:24.104  INFO 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:25:24.104  INFO 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:25:24.104 DEBUG 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:25:24.104 DEBUG 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:25:24.267  INFO 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=aad307fc-a02b-4aa3-8e89-1168d923dda1
2025-03-03 01:25:24.267 DEBUG 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"aad307fc-a02b-4aa3-8e89-1168d923dda1"}},"response_mode":"blocking","conversation_id":"ccc87665-46be-4678-bbee-d20998f7a4f9","user":"fyjw"}
2025-03-03 01:25:34.331  INFO 36816 --- [pool-2-thread-7] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740932416}
2025-03-03 01:25:39.390  INFO 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浩港新区鑫姚东方置业有限公司：

2022年9月1日与上海浩港新区鑫姚东方置业有限公司签订的《上海市商品房预售合同》（合同编号：202200176383），约定按揭贷款方式购买我司房源。

本小区现房产证已办理完毕，根据目前的房价情况，您原合同约定的总房价款已远低于现行市场房价，且您合同约定的贷款银行尚未放款。

在此情况下，根据合同约定，我司有权要求您解除原合同或全额支付房款。如您仍坚持按揭贷款方式，需在2023年12月8日前支付房价款的20%，同时您须承担因延期付款产生的违约金（按总房价款4.75%标准计算）。否则，我司将依合同约定解除合同并追究您的违约责任。

在规定时间内，若能按时按要求支付正式发票，请联系以下人员：

- 姓名：程向云  
  电话：13262792367  
- 杨晓琼  
  电话：15821244703

2023年11月28日
```
2025-03-03 01:25:39.391 DEBUG 36816 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d1fe5194-1d61-4495-8ae0-39cb6019cfdf","workflow_run_id":"7b19d34b-e953-4adc-a5e1-bb3b356ececf","data":{"id":"7b19d34b-e953-4adc-a5e1-bb3b356ececf","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浩港新区鑫姚东方置业有限公司：\n\n2022年9月1日与上海浩港新区鑫姚东方置业有限公司签订的《上海市商品房预售合同》（合同编号：202200176383），约定按揭贷款方式购买我司房源。\n\n本小区现房产证已办理完毕，根据目前的房价情况，您原合同约定的总房价款已远低于现行市场房价，且您合同约定的贷款银行尚未放款。\n\n在此情况下，根据合同约定，我司有权要求您解除原合同或全额支付房款。如您仍坚持按揭贷款方式，需在2023年12月8日前支付房价款的20%，同时您须承担因延期付款产生的违约金（按总房价款4.75%标准计算）。否则，我司将依合同约定解除合同并追究您的违约责任。\n\n在规定时间内，若能按时按要求支付正式发票，请联系以下人员：\n\n- 姓名：程向云  \n  电话：13262792367  \n- 杨晓琼  \n  电话：15821244703\n\n2023年11月28日\n```"},"elapsed_time":15.081545126857236,"total_tokens":892,"total_steps":4,"created_at":1740936322,"finished_at":1740936338}}
2025-03-03 01:25:39.391  INFO 36816 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : ```markdown
# 通知函

上海浩港新区鑫姚东方置业有限公司：

2022年9月1日与上海浩港新区鑫姚东方置业有限公司签订的《上海市商品房预售合同》（合同编号：202200176383），约定按揭贷款方式购买我司房源。

本小区现房产证已办理完毕，根据目前的房价情况，您原合同约定的总房价款已远低于现行市场房价，且您合同约定的贷款银行尚未放款。

在此情况下，根据合同约定，我司有权要求您解除原合同或全额支付房款。如您仍坚持按揭贷款方式，需在2023年12月8日前支付房价款的20%，同时您须承担因延期付款产生的违约金（按总房价款4.75%标准计算）。否则，我司将依合同约定解除合同并追究您的违约责任。

在规定时间内，若能按时按要求支付正式发票，请联系以下人员：

- 姓名：程向云  
  电话：13262792367  
- 杨晓琼  
  电话：15821244703

2023年11月28日
```
2025-03-03 01:25:39.391  INFO 36816 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 01:25:39.413 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:25:39.414 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:25:39.437 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:25:39.573 ERROR 36816 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:25:39.574 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:25:39.575 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:25:39.599 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:25:39.714 ERROR 36816 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:25:39.714 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:25:39.715 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:25:39.737 DEBUG 36816 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:25:39.856 ERROR 36816 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:40:05.581  INFO 36816 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:40:05.585  INFO 36816 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:40:10.789  INFO 4716 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 4716 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:40:10.791 DEBUG 4716 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:40:10.791  INFO 4716 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:40:11.178  INFO 4716 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:40:11.180  INFO 4716 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:40:11.205  INFO 4716 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 01:40:11.549  INFO 4716 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:40:11.553  INFO 4716 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:40:11.553  INFO 4716 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:40:11.635  INFO 4716 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:40:11.635  INFO 4716 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 815 ms
2025-03-03 01:40:11.860  INFO 4716 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:40:11.860  INFO 4716 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:40:12.079  WARN 4716 --- [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuEventController' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'messageEventHandler' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 3; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'caseServiceImpl': Requested bean is currently in creation: Is there an unresolvable circular reference?
2025-03-03 01:40:12.081  INFO 4716 --- [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-03-03 01:40:12.087  INFO 4716 --- [main] ConditionEvaluationReportLoggingListener : 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2025-03-03 01:40:12.095 ERROR 4716 --- [main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

The dependencies of some of the beans in the application context form a cycle:

   feishuEventController defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]
      ↓
   messageEventHandler defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]
      ↓
   fileMessageServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]
┌─────┐
|  caseServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]
↑     ↓
|  feishuFolderServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]
└─────┘


Action:

Relying upon circular references is discouraged and they are prohibited by default. Update your application to remove the dependency cycle between beans. As a last resort, it may be possible to break the cycle automatically by setting spring.main.allow-circular-references to true.

2025-03-03 01:40:26.793  INFO 9652 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 9652 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:40:26.794 DEBUG 9652 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:40:26.795  INFO 9652 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:40:27.171  INFO 9652 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:40:27.172  INFO 9652 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:40:27.188  INFO 9652 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 01:40:27.522  INFO 9652 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:40:27.531  INFO 9652 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:40:27.531  INFO 9652 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:40:27.621  INFO 9652 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:40:27.621  INFO 9652 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 798 ms
2025-03-03 01:40:27.841  INFO 9652 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:40:27.842  INFO 9652 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:40:28.053  WARN 9652 --- [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuEventController' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'messageEventHandler' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 3; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'caseServiceImpl': Requested bean is currently in creation: Is there an unresolvable circular reference?
2025-03-03 01:40:28.054  INFO 9652 --- [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-03-03 01:40:28.060  INFO 9652 --- [main] ConditionEvaluationReportLoggingListener : 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2025-03-03 01:40:28.069 ERROR 9652 --- [main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

The dependencies of some of the beans in the application context form a cycle:

   feishuEventController defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]
      ↓
   messageEventHandler defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]
      ↓
   fileMessageServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]
┌─────┐
|  caseServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]
↑     ↓
|  feishuFolderServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]
└─────┘


Action:

Relying upon circular references is discouraged and they are prohibited by default. Update your application to remove the dependency cycle between beans. As a last resort, it may be possible to break the cycle automatically by setting spring.main.allow-circular-references to true.

2025-03-03 01:47:56.299  INFO 11712 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 11712 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:47:56.300 DEBUG 11712 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:47:56.300  INFO 11712 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:47:56.745  INFO 11712 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:47:56.747  INFO 11712 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:47:56.773  INFO 11712 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-03-03 01:47:57.175  INFO 11712 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:47:57.182  INFO 11712 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:47:57.182  INFO 11712 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:47:57.294  INFO 11712 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:47:57.294  INFO 11712 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 963 ms
2025-03-03 01:47:57.593  INFO 11712 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:47:57.594  INFO 11712 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:47:58.187  INFO 11712 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:47:58.388  INFO 11712 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477264878987411484&access_key=df507d1207453e247d1df6d64fa61daf&service_id=33554678&ticket=2c8698ac-9d65-4a56-b7e4-dcd4c2687b20 [conn_id=7477264878987411484]
2025-03-03 01:47:58.681  INFO 11712 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:47:58.688  INFO 11712 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.67 seconds (JVM running for 3.181)
2025-03-03 01:48:10.811  INFO 11712 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740937689}
2025-03-03 01:48:10.851  WARN 11712 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 01:48:10.859  INFO 11712 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:48:11.157  INFO 11712 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:48:11.163 DEBUG 11712 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:48:11.175 DEBUG 11712 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:48:11.210 DEBUG 11712 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:48:11.213 DEBUG 11712 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:48:11.214 DEBUG 11712 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:48:11.236 DEBUG 11712 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 0
2025-03-03 01:48:11.241 ERROR 11712 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 处理菜单事件异常

java.lang.NullPointerException: Cannot invoke "em.backend.pojo.CaseInfo.getDifyKnowledgeId()" because "currentCaseInfo" is null
	at em.backend.handler.MenuEventHandler.handle(MenuEventHandler.java:71) ~[classes/:na]
	at em.backend.controller.FeishuEventController$2.handle(FeishuEventController.java:57) ~[classes/:na]
	at em.backend.controller.FeishuEventController$2.handle(FeishuEventController.java:1) ~[classes/:na]
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:290) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:51:53.969  INFO 11712 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:51:53.975  INFO 11712 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:51:59.475  INFO 36652 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 36652 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:51:59.478 DEBUG 36652 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:51:59.478  INFO 36652 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:52:00.080  INFO 36652 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:52:00.082  INFO 36652 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:52:00.110  INFO 36652 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 0 Redis repository interfaces.
2025-03-03 01:52:00.664  INFO 36652 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:52:00.674  INFO 36652 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:52:00.674  INFO 36652 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:52:00.819  INFO 36652 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:52:00.819  INFO 36652 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1293 ms
2025-03-03 01:52:01.196  INFO 36652 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:52:01.197  INFO 36652 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:52:01.826  INFO 36652 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:52:02.027  INFO 36652 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477265127648034818&access_key=5aab7ec6c1b74ef955f7368a1f6acd78&service_id=33554678&ticket=1946f530-2529-4e36-b441-fa326935daa0 [conn_id=7477265127648034818]
2025-03-03 01:52:02.432  INFO 36652 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:52:02.439  INFO 36652 --- [main] em.backend.BackendApplication            : Started BackendApplication in 3.336 seconds (JVM running for 3.994)
2025-03-03 01:52:06.678  INFO 36652 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740937925}
2025-03-03 01:52:06.718  WARN 36652 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 01:52:06.729  INFO 36652 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:52:07.003  INFO 36652 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:52:07.008 DEBUG 36652 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:52:07.022 DEBUG 36652 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:52:07.057 DEBUG 36652 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:52:07.063 DEBUG 36652 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:52:07.063 DEBUG 36652 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:52:07.087 DEBUG 36652 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 01:52:07.090 ERROR 36652 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 处理菜单事件异常

org.apache.ibatis.exceptions.TooManyResultsException: Expected one result (or null) to be returned by selectOne(), but found: 4
	at com.baomidou.mybatisplus.core.mapper.BaseMapper.selectOne(BaseMapper.java:177) ~[mybatis-plus-core-3.5.3.1.jar:3.5.3.1]
	at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:732) ~[na:na]
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy$DefaultMethodInvoker.invoke(MybatisMapperProxy.java:162) ~[mybatis-plus-core-3.5.3.1.jar:3.5.3.1]
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:89) ~[mybatis-plus-core-3.5.3.1.jar:3.5.3.1]
	at jdk.proxy2/jdk.proxy2.$Proxy79.selectOne(Unknown Source) ~[na:na]
	at com.baomidou.mybatisplus.extension.service.impl.ServiceImpl.getOne(ServiceImpl.java:202) ~[mybatis-plus-extension-3.5.3.1.jar:3.5.3.1]
	at com.baomidou.mybatisplus.extension.service.IService.getOne(IService.java:320) ~[mybatis-plus-extension-3.5.3.1.jar:3.5.3.1]
	at em.backend.service.impl.CaseServiceImpl.getCurrentCaseInfo(CaseServiceImpl.java:217) ~[classes/:na]
	at em.backend.service.impl.CaseServiceImpl$$FastClassBySpringCGLIB$$abd48970.invoke(<generated>) ~[classes/:na]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218) ~[spring-core-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.CglibAopProxy.invokeMethod(CglibAopProxy.java:386) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.CglibAopProxy.access$000(CglibAopProxy.java:85) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:704) ~[spring-aop-5.3.24.jar:5.3.24]
	at em.backend.service.impl.CaseServiceImpl$$EnhancerBySpringCGLIB$$28d228c1.getCurrentCaseInfo(<generated>) ~[classes/:na]
	at em.backend.handler.MenuEventHandler.handle(MenuEventHandler.java:68) ~[classes/:na]
	at em.backend.controller.FeishuEventController$2.handle(FeishuEventController.java:57) ~[classes/:na]
	at em.backend.controller.FeishuEventController$2.handle(FeishuEventController.java:1) ~[classes/:na]
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:290) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:53:50.252  INFO 36652 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 01:53:50.257  INFO 36652 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 01:53:54.835  INFO 22992 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 22992 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 01:53:54.837 DEBUG 22992 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 01:53:54.837  INFO 22992 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 01:53:55.366  INFO 22992 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 01:53:55.367  INFO 22992 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 01:53:55.393  INFO 22992 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 0 Redis repository interfaces.
2025-03-03 01:53:55.771  INFO 22992 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 01:53:55.777  INFO 22992 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 01:53:55.777  INFO 22992 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 01:53:55.880  INFO 22992 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 01:53:55.880  INFO 22992 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1008 ms
2025-03-03 01:53:56.140  INFO 22992 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 01:53:56.141  INFO 22992 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 01:53:56.721  INFO 22992 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 01:53:56.936  INFO 22992 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477267008410271772&access_key=81b45676a2bbad84237f1a5bb31fa66e&service_id=33554678&ticket=99a70505-9b30-4f5c-805f-82533b8f812b [conn_id=7477267008410271772]
2025-03-03 01:53:57.165  INFO 22992 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 01:53:57.174  INFO 22992 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.64 seconds (JVM running for 3.191)
2025-03-03 01:53:57.264  INFO 22992 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740938035}
2025-03-03 01:53:57.311  WARN 22992 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 01:53:57.320  INFO 22992 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 01:53:57.572  INFO 22992 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 01:53:57.576 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:53:57.589 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:53:57.619 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:53:57.622 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:53:57.623 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:53:57.644 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:53:57.644 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 01:53:57.644 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 01:53:57.664 DEBUG 22992 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 01:53:57.664  INFO 22992 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 01:53:58.452  INFO 22992 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:53:58.453  INFO 22992 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 01:53:59.083  INFO 22992 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 17:53:57 GMT"],"eagleid":["772449aa17409380371067413e"],"request-id":["6a24905f-44c1-4796-9821-3e712aa36813"],"server":["Tengine"],"server-timing":["inner; dur=379","cdn-cache;desc=MISS,edge;dur=0,origin;dur=460"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache22.cn8115[460,0]"],"x-lgw-dst-svc":["pB5P-INB3BGasW53l6CwAO1kVSQCbDM_pXBrEYfK0L1IPvxjzEYDqbqUWUzzGXUQ2LQ1OsCEGGFYl1hRUZgYpVp7HWX7984TvrZoOLC6pIYfKkCw-DSigjH_bXrtBB73RCY2HyFXxo-Fef69rdAJQ83KESFG8YjdD553ErmKU9qTbw1qpnLa3wfoOXWuYppdSO_ZmOMrFq2m55QtEiZgnw9nwGGqefpWnO-QpuokU0fjEzkNp53_BS8_XFQoyeTxN0eM-qWhAGVmng29nu3Jcq-UZCCHVGucopvE_s9Jo-977fAFzvWIswo="],"x-request-id":["6a24905f-44c1-4796-9821-3e712aa36813"],"x-timestamp":["1740938037.551"],"x-tt-logid":["202503030153576F2C7917E8DE61C19ED4"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71ad0a29bc566f35479bdc147b71e4e571b4cb985078ab774a666c17564c9695bb3ad5e49a7d02d2d818ff93c49af9bcd6d906532886382b32ee0fbb88ec083e9ccd8698896b2c326e004d9fa94b884bf6"],"x-tt-trace-id":["00-2503030153576F2C7917E8DE61C19ED4-7C9193587DA46E58-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030153576F2C7917E8DE61C19ED4","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030153576F2C7917E8DE61C19ED4"}
2025-03-03 01:53:59.083  INFO 22992 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 01:53:59.475  INFO 22992 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 01:53:59.496 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:53:59.496 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:53:59.517 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:53:59.639 ERROR 22992 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:53:59.640  INFO 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 01:53:59.640  INFO 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 01:53:59.642 DEBUG 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 01:53:59.643 DEBUG 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 01:53:59.834  INFO 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=edd4cd9f-db0a-4013-8fe9-b5ef3b1d3c25
2025-03-03 01:53:59.835 DEBUG 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"edd4cd9f-db0a-4013-8fe9-b5ef3b1d3c25"}},"response_mode":"blocking","conversation_id":"23abbc52-904e-4cfb-b820-0bf1bf68c01c","user":"fyjw"}
2025-03-03 01:54:02.079 ERROR 22992 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:267) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:289) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:364) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:236) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 01:54:02.080 ERROR 22992 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析失败: 程阿金和解通知.jpg
2025-03-03 01:54:02.135 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:54:02.137 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:54:02.163 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:54:02.356 ERROR 22992 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:54:02.357 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:54:02.357 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:54:02.392 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:54:02.765 ERROR 22992 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 01:54:02.769 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 01:54:02.770 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 01:54:06.008 DEBUG 22992 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 01:54:06.133 ERROR 22992 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:07:15.791  INFO 22992 --- [pool-2-thread-9] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740938834}
2025-03-03 02:07:15.812 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:07:15.812 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:07:15.832 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:07:15.833 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:07:15.833 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:07:15.853 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:07:15.854 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:07:15.854 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:07:15.874 DEBUG 22992 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:07:15.874  INFO 22992 --- [pool-2-thread-9] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:07:16.452  INFO 22992 --- [pool-2-thread-9] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:07:16.452  INFO 22992 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:07:16.851  INFO 22992 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:07:15 GMT"],"eagleid":["77243f1617409388351033660e"],"request-id":["728e7d03-42ce-4710-905b-bf0289a15fc8"],"server":["Tengine"],"server-timing":["inner; dur=358","cdn-cache;desc=MISS,edge;dur=0,origin;dur=387"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache2.cn7330[387,0]"],"x-lgw-dst-svc":["2CusB7WHeHh4U8QcSSd2RR602eZe5roOvVL4ZZ1TO3FM35cHNl7r89vuS63GGJq5aU9nj2a49c9NKED3jn9vlOsEr9lgYKPKWXdCepsBFr3sfkb-R0Yz8J-qqxA10nkrCkSEXkGc5cSLsvxUT6CybYhKi2ELfynmzdkR03DYGBTI8-VD2plz8eBLKNFudTzWn1zFjBSOLz-ktUbSzTz4qnpFulX4AJBjyIFq7vnCF1h6-YV-s2t_WKsh4M7_hVrsea-iAwT0_2w3nYVNE8KLw1ZklDy3wuLw83LCFaeTidQiAYBYB54J1JM="],"x-request-id":["728e7d03-42ce-4710-905b-bf0289a15fc8"],"x-timestamp":["1740938835.473"],"x-tt-logid":["2025030302071537F783B8DC7E8DBAC855"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71dd5cec60ee864a17bdeb17f40724405f311b6346bf3efeb5cefe5c3b89958345edb9da8252e290cc6d67c30b6a39bbb4c6dbcfa36199d5b433eca5990d9a87679825aed15914283930c871c36b344d2b"],"x-tt-trace-id":["00-25030302071537F783B8DC7E8DBAC855-03ECA98E3A1D87AB-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030302071537F783B8DC7E8DBAC855","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030302071537F783B8DC7E8DBAC855"}
2025-03-03 02:07:16.852  INFO 22992 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:07:17.191  INFO 22992 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:07:17.211 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:07:17.211 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:07:17.230 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:07:17.348 ERROR 22992 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:07:17.349  INFO 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:07:17.349  INFO 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:07:17.349 DEBUG 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:07:17.349 DEBUG 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:07:17.495  INFO 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f745c8b7-db30-4b27-ba8a-6c977e740491
2025-03-03 02:07:17.495 DEBUG 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f745c8b7-db30-4b27-ba8a-6c977e740491"}},"response_mode":"blocking","conversation_id":"a14b6ca7-541b-41ef-aa63-822daa0ab018","user":"fyjw"}
2025-03-03 02:07:29.452  INFO 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浩瀚新区金维东方置业有限公司：

2022年9月15日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定交房时间为：2023年12月31日。

本小区项目因疫情影响导致材料、人工供应紧张、资金短缺的又一系列原因，造成项目建设工期延误，预计延期至2024年6月30日交付。对此，我司深感抱歉！

在此，我司向贵司诚恳说明情况并致以最深的歉意。为减少因延期交房对贵司的损失，我司愿意向贵司支付延期交房违约金，违约金计算标准按照《上海市商品房预售合同》相关约定：每日支付房款万分之四点七五标准。

在该楼盘项目竣工备案表正式完成后，即：2024年12月8日之前，我司将及时通知贵司办理交房手续。

如有疑问，请及时与我司联系。

联系人：程四平  
电话：13262792367  

杨晓强  
电话：15821244780  

2023年11月28日
```
2025-03-03 02:07:29.452 DEBUG 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"33e46036-1c40-4d75-b4c4-4d02d79b292b","workflow_run_id":"de0b624d-bfb4-460f-9881-fd277def6467","data":{"id":"de0b624d-bfb4-460f-9881-fd277def6467","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浩瀚新区金维东方置业有限公司：\n\n2022年9月15日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定交房时间为：2023年12月31日。\n\n本小区项目因疫情影响导致材料、人工供应紧张、资金短缺的又一系列原因，造成项目建设工期延误，预计延期至2024年6月30日交付。对此，我司深感抱歉！\n\n在此，我司向贵司诚恳说明情况并致以最深的歉意。为减少因延期交房对贵司的损失，我司愿意向贵司支付延期交房违约金，违约金计算标准按照《上海市商品房预售合同》相关约定：每日支付房款万分之四点七五标准。\n\n在该楼盘项目竣工备案表正式完成后，即：2024年12月8日之前，我司将及时通知贵司办理交房手续。\n\n如有疑问，请及时与我司联系。\n\n联系人：程四平  \n电话：13262792367  \n\n杨晓强  \n电话：15821244780  \n\n2023年11月28日\n```"},"elapsed_time":11.906461260979995,"total_tokens":899,"total_steps":4,"created_at":1740938836,"finished_at":1740938848}}
2025-03-03 02:07:29.452  INFO 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:07:29.452 DEBUG 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"\n","max_tokens":500}}},"doc_type":"business_document"}
2025-03-03 02:07:29.501 ERROR 22992 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_metadata", "message": "Both doc_type and doc_metadata must be provided when adding metadata", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:145) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:374) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:236) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:07:29.501 ERROR 22992 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:07:29.520 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:07:29.521 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:07:29.541 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:07:29.672 ERROR 22992 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:07:29.673 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:07:29.674 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:07:29.693 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:07:29.806 ERROR 22992 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:07:29.809 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:07:29.809 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:07:29.828 DEBUG 22992 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:07:29.961 ERROR 22992 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:11:15.243  INFO 22992 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:11:15.247  INFO 22992 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:11:19.578  INFO 10424 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 10424 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:11:19.579 DEBUG 10424 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:11:19.580  INFO 10424 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:11:20.065  INFO 10424 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:11:20.066  INFO 10424 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:11:20.091  INFO 10424 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 02:11:20.517  INFO 10424 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:11:20.522  INFO 10424 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:11:20.522  INFO 10424 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:11:20.655  INFO 10424 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:11:20.655  INFO 10424 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1043 ms
2025-03-03 02:11:20.974  INFO 10424 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:11:20.975  INFO 10424 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:11:21.583  INFO 10424 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:11:21.822  INFO 10424 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477270380215795714&access_key=be0b837cccc5ec1fa31752935c056cd0&service_id=33554678&ticket=d7070a52-e7c1-4050-9910-9196873ce19d [conn_id=7477270380215795714]
2025-03-03 02:11:22.057  INFO 10424 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:11:22.066  INFO 10424 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.76 seconds (JVM running for 3.408)
2025-03-03 02:11:26.642  INFO 10424 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740939085}
2025-03-03 02:11:26.682  WARN 10424 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 02:11:26.692  INFO 10424 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:11:26.946  INFO 10424 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:11:26.953 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:11:26.965 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:11:27.000 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:11:27.004 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:11:27.004 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:11:27.024 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:11:27.025 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:11:27.025 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:11:27.045 DEBUG 10424 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:11:27.046  INFO 10424 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:11:27.754  INFO 10424 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:11:27.756  INFO 10424 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:11:28.267  INFO 10424 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:11:26 GMT"],"eagleid":["77243f2817409390864136281e"],"request-id":["cc335646-09dc-414a-a18c-b34d05a5db93"],"server":["Tengine"],"server-timing":["inner; dur=316","cdn-cache;desc=MISS,edge;dur=0,origin;dur=389"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn7330[389,0]"],"x-lgw-dst-svc":["upWgmjR836VDLEP0xeqnSqEWVMmhG1NbUmUUpiJCxtoYv8lB1QoAtArNlOeLKlpwAhecM0xdDOBXxC2rgMPY4MVYKpWTJJOJMZV3IegAOLD_9EEnRMBOhiJQhvQ2XZEIlTpv8RYD8JO31zbcD6krLuHgiHHu-O4AaKlnElz86o32HeEB7w4I1-LgeVdtyVVbBCX6ryG3l6K1fZtb3JwF4swbmMVWSSxINld5iLhIvDQ3tvVnpiUwcYGIOo5yZGnVvJONZHRfeEn-kX8DE09-EipA8l8ZKaFeDQbWJfkpbcAFWKst-EkFgOY="],"x-request-id":["cc335646-09dc-414a-a18c-b34d05a5db93"],"x-timestamp":["1740939086.790"],"x-tt-logid":["202503030211266B4C6A777A03BAC8591D"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71d33069a87bff4898dd674b8121244f79233bc098eb885141508ff3e84382488c50d0fbc1ebf409a58fef153f472d65d7c8364d27f2cc42ec35eb91c264692f3811019296ec57b0947beec42b64ba21f1"],"x-tt-trace-id":["00-2503030211266B4C6A777A03BAC8591D-502DE0DF1602D3D3-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030211266B4C6A777A03BAC8591D","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030211266B4C6A777A03BAC8591D"}
2025-03-03 02:11:28.267  INFO 10424 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:11:28.637  INFO 10424 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:11:28.657 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:11:28.658 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:11:28.677 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:11:28.780 ERROR 10424 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:11:28.781  INFO 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:11:28.781  INFO 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:11:28.783 DEBUG 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:11:28.784 DEBUG 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:11:28.974  INFO 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8d8d0c78-64b1-4b31-acba-132d1ef2100e
2025-03-03 02:11:28.974 DEBUG 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"8d8d0c78-64b1-4b31-acba-132d1ef2100e"}},"response_mode":"blocking","conversation_id":"64cb0939-a981-4819-983a-2cc358f3ca2c","user":"fyjw"}
2025-03-03 02:11:36.264  INFO 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浩瀚新社区金地先声置业有限公司

2022年9月5日与上海浩瀚新社区《上海市商品房预售合同》（合同编号：202200176383），约定购房款支付方式为按揭贷款。

本人因贷后管理原因，导致我在银行的信用等级受影响，当前的个人征信系统中有2笔贷款逾期情况，已还款未结清。银行回复需等待个人征信更新，我将继续跟进更新进度，争取尽快完成贷款审批。

在汇丰银行按揭贷款因个人原因未能通过审批的情况下，我承诺将于2023年12月8日前，将首付款以外剩余购房款以全款支付至贵司指定账户。若未能在上述时间内完成全款支付，我同意将按合同总价款4.75%承担逾期付款违约责任。

在该通知函签署后，我将积极配合正式完成购房事宜。

特此通知。

签署人：程**  
身份证号：13262792367  
杨晓跃 电话：15821244732  

2023年11月28日
```
2025-03-03 02:11:36.264 DEBUG 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"a0036070-a418-496b-b0f1-69585ba2f64f","workflow_run_id":"5a809de8-dd50-4875-9c00-bec68668c286","data":{"id":"5a809de8-dd50-4875-9c00-bec68668c286","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浩瀚新社区金地先声置业有限公司\n\n2022年9月5日与上海浩瀚新社区《上海市商品房预售合同》（合同编号：202200176383），约定购房款支付方式为按揭贷款。\n\n本人因贷后管理原因，导致我在银行的信用等级受影响，当前的个人征信系统中有2笔贷款逾期情况，已还款未结清。银行回复需等待个人征信更新，我将继续跟进更新进度，争取尽快完成贷款审批。\n\n在汇丰银行按揭贷款因个人原因未能通过审批的情况下，我承诺将于2023年12月8日前，将首付款以外剩余购房款以全款支付至贵司指定账户。若未能在上述时间内完成全款支付，我同意将按合同总价款4.75%承担逾期付款违约责任。\n\n在该通知函签署后，我将积极配合正式完成购房事宜。\n\n特此通知。\n\n签署人：程**  \n身份证号：13262792367  \n杨晓跃 电话：15821244732  \n\n2023年11月28日\n```"},"elapsed_time":7.250219518085942,"total_tokens":890,"total_steps":4,"created_at":1740939087,"finished_at":1740939094}}
2025-03-03 02:11:36.264  INFO 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:11:36.265 DEBUG 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"\n","max_tokens":500}}},"doc_type":"business_document"}
2025-03-03 02:11:36.316 ERROR 10424 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_metadata", "message": "Both doc_type and doc_metadata must be provided when adding metadata", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:145) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:11:36.316 ERROR 10424 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:11:36.336 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:11:36.336 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:11:36.356 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:11:36.498 ERROR 10424 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:11:36.500 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:11:36.501 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:11:36.520 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:11:36.676 ERROR 10424 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:11:36.679 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:11:36.679 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:11:36.699 DEBUG 10424 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:11:36.806 ERROR 10424 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:18:39.031  INFO 10424 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:18:39.036  INFO 10424 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:18:41.017  INFO 30096 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 30096 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:18:41.019 DEBUG 30096 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:18:41.019  INFO 30096 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:18:41.457  INFO 30096 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:18:41.459  INFO 30096 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:18:41.480  INFO 30096 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.
2025-03-03 02:18:41.905  INFO 30096 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:18:41.910  INFO 30096 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:18:41.910  INFO 30096 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:18:41.993  INFO 30096 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:18:41.994  INFO 30096 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 936 ms
2025-03-03 02:18:42.254  INFO 30096 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:18:42.255  INFO 30096 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:18:42.815  INFO 30096 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:18:42.917  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477272683371249666&access_key=8d50b02aff7c8b5aefb03d5187c4c100&service_id=33554678&ticket=ffc5fe4b-d771-4bb1-9506-2ba58b4bde9d [conn_id=7477272683371249666]
2025-03-03 02:18:43.190  INFO 30096 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:18:43.197  INFO 30096 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.584 seconds (JVM running for 3.248)
2025-03-03 02:18:44.829  INFO 30096 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740939523}
2025-03-03 02:18:44.864  WARN 30096 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 02:18:44.873  INFO 30096 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:18:45.151  INFO 30096 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:18:45.156 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:18:45.172 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:18:45.206 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:18:45.210 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:18:45.210 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:18:45.231 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:18:45.232 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:18:45.232 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:18:45.252 DEBUG 30096 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:18:45.252  INFO 30096 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:18:46.045  INFO 30096 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:18:46.047  INFO 30096 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:18:46.664  INFO 30096 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:18:45 GMT"],"eagleid":["7724499e17409395247023311e"],"request-id":["b4030713-a8b6-4d42-b676-e1eb66e512af"],"server":["Tengine"],"server-timing":["inner; dur=331","cdn-cache;desc=MISS,edge;dur=0,origin;dur=413"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache10.cn8115[413,0]"],"x-lgw-dst-svc":["yUPBq89WbOR3W081DZOJP9VXZkSXKNZTOIbVoEZPnYxybx07Y4IcXasVeQiX-HAfkYbbN13uW1bzKAUy5TCyCA-Jqh_hP9iYqIuiyFXQVM381KBg6xua6cfHSY0UycUNuQjWF0qYMT4YZRAy4PK-73OV_ww0SnSaOA1iiltKA2qXc-KuxUeVcF6PCncyMCJchYokzLMY2FJta26cMgezLbUGshz-PhG7xz008pyM9N568wO3_rJEsxHF-bUwjSAOIg2O1oTiKrpsTeMVnxpwo3sVXuftoGItFYu2hQHJRLo11ULKFHxrvw=="],"x-request-id":["b4030713-a8b6-4d42-b676-e1eb66e512af"],"x-timestamp":["1740939525.101"],"x-tt-logid":["202503030218440B186ECF6D4711C93A06"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee716dc38e1e28d63588368fcb2fe9d937db25fe22c2907badd9306c41e44a0705db5043a9a27bb6f28cbd1219919ae4b543082209c31270cc173b21c3fc743383956536d05926fb0a0d4ca1e3f67aecc5d2"],"x-tt-trace-id":["00-2503030218440B186ECF6D4711C93A06-2D66EB5434D13118-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030218440B186ECF6D4711C93A06","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030218440B186ECF6D4711C93A06"}
2025-03-03 02:18:46.664  INFO 30096 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:18:47.080  INFO 30096 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:18:47.100 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:18:47.100 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:18:47.121 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:18:47.247 ERROR 30096 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:18:47.249  INFO 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:18:47.250  INFO 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:18:47.256 DEBUG 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:18:47.257 DEBUG 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:18:47.479  INFO 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=5649e2b4-0963-4a8a-aec1-ab4ef8502a04
2025-03-03 02:18:47.480 DEBUG 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"5649e2b4-0963-4a8a-aec1-ab4ef8502a04"}},"response_mode":"blocking","conversation_id":"e8fe8788-30ae-48ee-8bfb-4334ee76f6bc","user":"fyjw"}
2025-03-03 02:18:55.589  INFO 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知

上海临港新片区鑫姚东方置业有限公司：

2022年9月1日与贵司签订的“上海市商品房预约合同”（合同编号：202200176383），合同约定的房屋为：**海玥名邸**。  
本小区因开发企业资金链断裂，导致项目资金紧张，危机的中心又处在房屋按揭贷款无法按时发放，造成项目资金的进一步恶化。  
为此，贵司应本着为政府分忧、为民解困的原则，尽快为广大人民群众排忧解难，尽到贵司的社会责任，尽最大努力为购房者解决相关问题，尽快完成项目的交付工作。贵司如因拖延交付造成购房者损失的，需按照合同约定支付违约金。违约金自2023年1月1日起计算，违约金利率将按照年利率4.75%累加计算。

在此通知贵司，项目按揭手续正式受理时间：2023年12月8日之前。  
请贵司在此时间之前尽快准备好相关材料，尽快办理按揭手续！

联系人：程四合  
电话：13262792367  
杨晓丽 电话：15821204734  

2023年11月28日
```
2025-03-03 02:18:55.590 DEBUG 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"5d95af6c-932d-446f-b0dc-38ebb1c9cd6b","workflow_run_id":"deaa96e7-a696-4281-82d0-8694e795c609","data":{"id":"deaa96e7-a696-4281-82d0-8694e795c609","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知\n\n上海临港新片区鑫姚东方置业有限公司：\n\n2022年9月1日与贵司签订的“上海市商品房预约合同”（合同编号：202200176383），合同约定的房屋为：**海玥名邸**。  \n本小区因开发企业资金链断裂，导致项目资金紧张，危机的中心又处在房屋按揭贷款无法按时发放，造成项目资金的进一步恶化。  \n为此，贵司应本着为政府分忧、为民解困的原则，尽快为广大人民群众排忧解难，尽到贵司的社会责任，尽最大努力为购房者解决相关问题，尽快完成项目的交付工作。贵司如因拖延交付造成购房者损失的，需按照合同约定支付违约金。违约金自2023年1月1日起计算，违约金利率将按照年利率4.75%累加计算。\n\n在此通知贵司，项目按揭手续正式受理时间：2023年12月8日之前。  \n请贵司在此时间之前尽快准备好相关材料，尽快办理按揭手续！\n\n联系人：程四合  \n电话：13262792367  \n杨晓丽 电话：15821204734  \n\n2023年11月28日\n```"},"elapsed_time":8.060707935132086,"total_tokens":928,"total_steps":4,"created_at":1740939526,"finished_at":1740939534}}
2025-03-03 02:18:55.590  INFO 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:18:55.591 DEBUG 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","doc_form":"text_model","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 02:18:55.647 ERROR 30096 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:157) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:18:55.648 ERROR 30096 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:18:55.667 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:18:55.668 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:18:55.688 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:18:55.822 ERROR 30096 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:18:55.824 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:18:55.825 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:18:55.845 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:18:55.979 ERROR 30096 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:18:55.984 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:18:55.985 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:18:56.005 DEBUG 30096 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:18:56.106 ERROR 30096 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:19:45.417 ERROR 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:19:45.417  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477272683371249666&access_key=8d50b02aff7c8b5aefb03d5187c4c100&service_id=33554678&ticket=ffc5fe4b-d771-4bb1-9506-2ba58b4bde9d [conn_id=7477272683371249666]
2025-03-03 02:19:45.417  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:20:07.964  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:20:08.192  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477272250821328898&access_key=50c0066522f0e567dff2f384a572289c&service_id=33554678&ticket=259c4def-3e98-48a1-b06e-e3c7f819a000 [conn_id=7477272250821328898]
2025-03-03 02:22:12.373 ERROR 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:22:12.373  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477272250821328898&access_key=50c0066522f0e567dff2f384a572289c&service_id=33554678&ticket=259c4def-3e98-48a1-b06e-e3c7f819a000 [conn_id=7477272250821328898]
2025-03-03 02:22:12.373  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:22:22.221  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:22:22.490  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477274109882859521&access_key=14c2fb575150c8bc3e16aa5e2e46f889&service_id=33554678&ticket=f27ee78f-be32-4bb1-917c-d032bdb5f646 [conn_id=7477274109882859521]
2025-03-03 02:23:42.408 ERROR 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:23:42.408  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477274109882859521&access_key=14c2fb575150c8bc3e16aa5e2e46f889&service_id=33554678&ticket=f27ee78f-be32-4bb1-917c-d032bdb5f646 [conn_id=7477274109882859521]
2025-03-03 02:23:42.408  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:24:04.624  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:24:04.849  INFO 30096 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477275149877018626&access_key=525e1c5fb3cbf1b1bd18af61e7ff8539&service_id=33554678&ticket=1c45b643-7e40-41a3-9e98-5116dcaa3d32 [conn_id=7477275149877018626]
2025-03-03 02:24:37.859  INFO 30096 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:24:37.865  INFO 30096 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:24:40.161  INFO 2056 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 2056 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:24:40.162 DEBUG 2056 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:24:40.163  INFO 2056 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:24:40.546  INFO 2056 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:24:40.548  INFO 2056 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:24:40.566  INFO 2056 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 02:24:40.922  INFO 2056 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:24:40.928  INFO 2056 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:24:40.928  INFO 2056 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:24:41.055  INFO 2056 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:24:41.056  INFO 2056 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 863 ms
2025-03-03 02:24:41.374  INFO 2056 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:24:41.376  INFO 2056 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:24:41.947  INFO 2056 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:24:42.062  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477274109883187201&access_key=cf7cb73e321c6faa138012feaf395164&service_id=33554678&ticket=2e73aacf-a806-4078-8270-191a35e27fc5 [conn_id=7477274109883187201]
2025-03-03 02:24:42.445  INFO 2056 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:24:42.454  INFO 2056 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.568 seconds (JVM running for 3.187)
2025-03-03 02:24:44.297  INFO 2056 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740939882}
2025-03-03 02:24:44.350  WARN 2056 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 02:24:44.361  INFO 2056 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:24:44.651  INFO 2056 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:24:44.657 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:24:44.675 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:24:44.709 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:24:44.714 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:24:44.714 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:24:44.734 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:24:44.735 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:24:44.735 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:24:44.755 DEBUG 2056 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:24:44.755  INFO 2056 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:24:45.485  INFO 2056 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:24:45.488  INFO 2056 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:24:46.016  INFO 2056 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:24:44 GMT"],"eagleid":["77243f2217409398841514209e"],"request-id":["17055620-9edf-454f-83c0-e927be50fd8e"],"server":["Tengine"],"server-timing":["inner; dur=349","cdn-cache;desc=MISS,edge;dur=0,origin;dur=377"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache14.cn7330[377,0]"],"x-lgw-dst-svc":["g8w-Qry7j1ImSp6Tw7DvnRQuih4l6QkZSp3UHxjmh5c2-34IN9TAdLXeqfCWWI3H5ifJkCxISVQDwTr2-h8CjZXAk2LlJH6pl-h_jUZbMDy8jcMB4t4Fdh7rmJwC1fhHdFhw9iE2UMXf7pJ5-ljJg4JQys9_HZk5thI1LQ5THCNHTRSMYbeOmEJJH2xsvu5VDwcm9gUD6dVqGJ0iWP10z4oCw61UZgxZZVdasTJrYc7g0FhewMM6xLzKJ2KPrCtK1hQShOVrCxd8J2vLfFzyCWHvn_T8fVsEI84D22iFoIVd266Ascz04yI="],"x-request-id":["17055620-9edf-454f-83c0-e927be50fd8e"],"x-timestamp":["1740939884.514"],"x-tt-logid":["2025030302244438F9A3CA50DE26D82363"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71affed21a2e36af16880f05c31eac8a478d877e6173ac69f39769a5f59cbdb2044cdd638b910d68d0d79d3e3e0c6ac8988cc87b1100a3bc61347689c0264953eeda35bd44f4fbdc4fac1a1e71788d5601"],"x-tt-trace-id":["00-25030302244438F9A3CA50DE26D82363-3890870F7D8E6B2D-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030302244438F9A3CA50DE26D82363","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030302244438F9A3CA50DE26D82363"}
2025-03-03 02:24:46.017  INFO 2056 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:24:46.336  INFO 2056 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:24:46.357 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:24:46.358 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:24:46.379 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:24:46.494 ERROR 2056 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:24:46.495  INFO 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:24:46.495  INFO 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:24:46.497 DEBUG 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:24:46.498 DEBUG 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:24:46.682  INFO 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=83d2cf78-fd51-4bca-997d-4a85045cefcc
2025-03-03 02:24:46.682 DEBUG 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"83d2cf78-fd51-4bca-997d-4a85045cefcc"}},"response_mode":"blocking","conversation_id":"2a7e9170-7173-4be6-8a8a-f1f5ddb170a1","user":"fyjw"}
2025-03-03 02:24:55.420  INFO 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩灿新能源科技有限公司：

2022年9月1日与贵司签订的《上海市商品房租赁合同》（合同编号：202200167383），约定租赁场地为上海市嘉定区**，租赁用途为仓储。

本小区是产权性质的住宅小区，场地原用途为住宅。根据中华人民共和国《住宅设计规范》规定，本场地不符合仓储使用的安全条件，存在严重消防安全隐患。

在汇仁物业公司向我司反馈贵司将租赁房屋用作仓储、存在安全隐患后，我司于2023年10月19日对贵司发出《告知函》，要求贵司在30天内将租赁房屋恢复住宅用途并搬离相关物品。现我司再次通知贵司，请贵司于2023年12月8日前将租赁房屋恢复住宅用途并搬离相关物品，逾期我司将依据合同约定每日按照年租赁费用4.75%标准收取违约金。

在送达本通知函后，我司将按法律正式要求贵司履约。

特此通知。

联系人：程四会  
联系电话：13262792367  
杨晓斌  
联系电话：15821246730  

2023年11月28日
```
2025-03-03 02:24:55.420 DEBUG 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d547603a-55e0-4f9b-ae91-0543a5a560e8","workflow_run_id":"ac7e486c-bd07-4f4d-8add-441d66b3abba","data":{"id":"ac7e486c-bd07-4f4d-8add-441d66b3abba","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩灿新能源科技有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房租赁合同》（合同编号：202200167383），约定租赁场地为上海市嘉定区**，租赁用途为仓储。\n\n本小区是产权性质的住宅小区，场地原用途为住宅。根据中华人民共和国《住宅设计规范》规定，本场地不符合仓储使用的安全条件，存在严重消防安全隐患。\n\n在汇仁物业公司向我司反馈贵司将租赁房屋用作仓储、存在安全隐患后，我司于2023年10月19日对贵司发出《告知函》，要求贵司在30天内将租赁房屋恢复住宅用途并搬离相关物品。现我司再次通知贵司，请贵司于2023年12月8日前将租赁房屋恢复住宅用途并搬离相关物品，逾期我司将依据合同约定每日按照年租赁费用4.75%标准收取违约金。\n\n在送达本通知函后，我司将按法律正式要求贵司履约。\n\n特此通知。\n\n联系人：程四会  \n联系电话：13262792367  \n杨晓斌  \n联系电话：15821246730  \n\n2023年11月28日\n```"},"elapsed_time":8.682660101912916,"total_tokens":921,"total_steps":4,"created_at":1740939885,"finished_at":1740939894}}
2025-03-03 02:24:55.420  INFO 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:24:55.421 DEBUG 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","doc_form":"text_model","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 02:24:55.463 ERROR 2056 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:155) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:24:55.463 ERROR 2056 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:24:55.482 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:24:55.483 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:24:55.503 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:24:55.637 ERROR 2056 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:24:55.638 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:24:55.638 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:24:55.658 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:24:55.761 ERROR 2056 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:24:55.765 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:24:55.765 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:24:55.786 DEBUG 2056 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:24:55.898 ERROR 2056 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:26:15.377 ERROR 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:26:15.377  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477274109883187201&access_key=cf7cb73e321c6faa138012feaf395164&service_id=33554678&ticket=2e73aacf-a806-4078-8270-191a35e27fc5 [conn_id=7477274109883187201]
2025-03-03 02:26:15.377  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:26:42.756  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:26:43.019  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477275149877215234&access_key=b2a54fa273a378f9568e438d222b7895&service_id=33554678&ticket=50d9e473-62a6-4195-84b2-dbf92746acf4 [conn_id=7477275149877215234]
2025-03-03 02:27:42.398 ERROR 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:27:42.398  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477275149877215234&access_key=b2a54fa273a378f9568e438d222b7895&service_id=33554678&ticket=50d9e473-62a6-4195-84b2-dbf92746acf4 [conn_id=7477275149877215234]
2025-03-03 02:27:42.398  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:27:54.086  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:27:54.330  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477274109883645953&access_key=bfe0a7d07ebc8351dd73e84273f5aec1&service_id=33554678&ticket=d49b72ca-9162-44a8-a053-3a5116ab69de [conn_id=7477274109883645953]
2025-03-03 02:30:11.400 ERROR 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:30:11.400  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477274109883645953&access_key=bfe0a7d07ebc8351dd73e84273f5aec1&service_id=33554678&ticket=d49b72ca-9162-44a8-a053-3a5116ab69de [conn_id=7477274109883645953]
2025-03-03 02:30:11.400  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:30:39.334  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:30:39.764  INFO 2056 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477277685958508545&access_key=f3c229981308241a653f261b1e3fd3a3&service_id=33554678&ticket=e2329c35-166b-40d1-ada0-3cdfbee2ab99 [conn_id=7477277685958508545]
2025-03-03 02:36:36.582  INFO 2056 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:36:36.588  INFO 2056 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:36:40.465  INFO 9140 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 9140 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:36:40.466 DEBUG 9140 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:36:40.466  INFO 9140 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:36:40.860  INFO 9140 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:36:40.861  INFO 9140 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:36:40.883  INFO 9140 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 02:36:41.274  INFO 9140 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:36:41.284  INFO 9140 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:36:41.284  INFO 9140 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:36:41.387  INFO 9140 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:36:41.387  INFO 9140 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 886 ms
2025-03-03 02:36:41.682  INFO 9140 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:36:41.683  INFO 9140 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:36:42.310  INFO 9140 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:36:42.417  INFO 9140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477278982762610690&access_key=7efde3936beacbce2562d45eae720656&service_id=33554678&ticket=bee831f4-d8bf-4fd0-afe2-57ed9d86e1b8 [conn_id=7477278982762610690]
2025-03-03 02:36:42.801  INFO 9140 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:36:42.812  INFO 9140 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.624 seconds (JVM running for 3.131)
2025-03-03 02:36:44.802  INFO 9140 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740940603}
2025-03-03 02:36:44.839  WARN 9140 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 02:36:44.847  INFO 9140 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:36:45.132  INFO 9140 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:36:45.136 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:36:45.148 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:36:45.181 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:36:45.184 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:36:45.184 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:36:45.206 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:36:45.206 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:36:45.206 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:36:45.226 DEBUG 9140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:36:45.226  INFO 9140 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:36:46.007  INFO 9140 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:36:46.009  INFO 9140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:36:46.552  INFO 9140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:36:45 GMT"],"eagleid":["b75d66a117409406046696510e"],"request-id":["d9122bb4-3178-4515-9e3a-a7f9e04c8950"],"server":["Tengine"],"server-timing":["inner; dur=369","cdn-cache;desc=MISS,edge;dur=0,origin;dur=443"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache13.cn6912[443,0]"],"x-lgw-dst-svc":["pUR6hendNo2SsaPrOuDtQS1Mu5MnyHcSxjmeCsT0RperTvYWPU3OyZhe5Jcgx-DAJaawqeOYCRuOSoblPrky-2zCdSobQ6Ig3DZxfrGw340_ZxyjBqF0EcidGNxehVwtsbRGXMa3B33DDWktUiJ8IjjNINWdJtyTW6N00oxXPbk_P8fe0Uc5Un1M81-JADnwRi5hHJUpKIsWXIaNkoG5l_RJPl-b2rbvYN7yHCjsdzwQVaZT0PusLski_oN7xwlcw-0L57y1FCUXurcweeqiflnL_bX0UBSTSky0eAGXKJ79ingteLrxCRI="],"x-request-id":["d9122bb4-3178-4515-9e3a-a7f9e04c8950"],"x-timestamp":["1740940605.099"],"x-tt-logid":["202503030236448423534D74FE3AC0F97C"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b06a511a783d9d3af78ec6072f7eb344d7f7a23098d0de2c2604b4f8e9edf1e677b7c345ade00d8f355cc4c0586e10b0002d35131049ca0eb439162f7055fce1f3963b5f9c62f734865048ed1a4b8a4188"],"x-tt-trace-id":["00-2503030236448423534D74FE3AC0F97C-550C66174FC2CE21-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030236448423534D74FE3AC0F97C","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030236448423534D74FE3AC0F97C"}
2025-03-03 02:36:46.553  INFO 9140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:36:46.903  INFO 9140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:36:46.923 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:36:46.923 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:36:46.943 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:36:47.065 ERROR 9140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:36:47.066  INFO 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:36:47.066  INFO 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:36:47.068 DEBUG 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:36:47.068 DEBUG 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:36:47.245  INFO 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=42848523-b5cb-4601-955a-06812e1ca4ee
2025-03-03 02:36:47.245 DEBUG 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"42848523-b5cb-4601-955a-06812e1ca4ee"}},"response_mode":"blocking","conversation_id":"34c1854b-8502-429a-9671-f9e85ed07942","user":"fyjw"}
2025-03-03 02:36:54.856  INFO 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知

上海浩港新区金港先开实业有限公司：

2022年9月13日与贵公司签订的“上海市商品房预售合同”（合同编号：202200176383），因贵公司未按合同约定按时支付购房款。

本小区为配套商品房，政府配套商品房的收入来源，需用作向其他动迁居民支付购房款。因贵公司逾期支付购房款，导致本小区其他动迁居民无法按时支付购房款，已严重影响动迁居民的生活。

在正式起诉贵公司前，我司郑重通知贵公司，请贵公司在收到本通知后10日内支付剩余购房款，并支付违约金（按合同约定的支付标准，违约金以购房款的4.75%计算，从逾期之日起至实际支付之日止）。

在送达本通知超过10日后，我司将正式起诉贵公司。

特此通知。

时间：2023年12月8日

联系人：程四合 手机：13262793267  
杨晓斌 手机：15821240734  

2023年11月28日
```
2025-03-03 02:36:54.856 DEBUG 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"ad1ab2d1-85ad-4d7a-8531-ef852abc5baa","workflow_run_id":"fb387d7f-2d6f-47b5-8a23-4f9cdddfb70f","data":{"id":"fb387d7f-2d6f-47b5-8a23-4f9cdddfb70f","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知\n\n上海浩港新区金港先开实业有限公司：\n\n2022年9月13日与贵公司签订的“上海市商品房预售合同”（合同编号：202200176383），因贵公司未按合同约定按时支付购房款。\n\n本小区为配套商品房，政府配套商品房的收入来源，需用作向其他动迁居民支付购房款。因贵公司逾期支付购房款，导致本小区其他动迁居民无法按时支付购房款，已严重影响动迁居民的生活。\n\n在正式起诉贵公司前，我司郑重通知贵公司，请贵公司在收到本通知后10日内支付剩余购房款，并支付违约金（按合同约定的支付标准，违约金以购房款的4.75%计算，从逾期之日起至实际支付之日止）。\n\n在送达本通知超过10日后，我司将正式起诉贵公司。\n\n特此通知。\n\n时间：2023年12月8日\n\n联系人：程四合 手机：13262793267  \n杨晓斌 手机：15821240734  \n\n2023年11月28日\n```"},"elapsed_time":7.55756322410889,"total_tokens":889,"total_steps":4,"created_at":1740940605,"finished_at":1740940613}}
2025-03-03 02:36:54.856  INFO 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:36:54.856 DEBUG 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"economy","doc_form":"text_model"}
2025-03-03 02:36:54.897 ERROR 9140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:125) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:36:54.897 ERROR 9140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:36:54.917 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:36:54.917 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:36:54.938 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:36:55.077 ERROR 9140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:36:55.078 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:36:55.078 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:36:55.098 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:36:55.228 ERROR 9140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:36:55.232 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:36:55.232 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:36:55.252 DEBUG 9140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:36:55.377 ERROR 9140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:38:15.379 ERROR 9140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 02:38:15.379  INFO 9140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477278982762610690&access_key=7efde3936beacbce2562d45eae720656&service_id=33554678&ticket=bee831f4-d8bf-4fd0-afe2-57ed9d86e1b8 [conn_id=7477278982762610690]
2025-03-03 02:38:15.379  INFO 9140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 02:38:20.670  INFO 9140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 02:38:21.016  INFO 9140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477278982577602561&access_key=edf8e862819c8879a6847896876b04a0&service_id=33554678&ticket=626ef21d-24bc-4f96-a002-7aef07912469 [conn_id=7477278982577602561]
2025-03-03 02:43:13.760  INFO 9140 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:43:13.769  INFO 9140 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:43:19.203  INFO 38768 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 38768 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:43:19.205 DEBUG 38768 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:43:19.205  INFO 38768 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:43:19.726  INFO 38768 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:43:19.728  INFO 38768 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:43:19.747  INFO 38768 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 02:43:20.177  INFO 38768 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:43:20.183  INFO 38768 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:43:20.183  INFO 38768 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:43:20.291  INFO 38768 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:43:20.291  INFO 38768 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1046 ms
2025-03-03 02:43:20.580  INFO 38768 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:43:20.581  INFO 38768 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:43:21.236  INFO 38768 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:43:21.342  INFO 38768 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477278982578274305&access_key=5eea178889ec086868994661d42c52de&service_id=33554678&ticket=77046fc5-ac41-40e1-b3b8-fdf1dacfbfa5 [conn_id=7477278982578274305]
2025-03-03 02:43:21.962  INFO 38768 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:43:21.969  INFO 38768 --- [main] em.backend.BackendApplication            : Started BackendApplication in 3.093 seconds (JVM running for 3.66)
2025-03-03 02:43:31.756  INFO 38768 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740941010}
2025-03-03 02:43:31.797  WARN 38768 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 02:43:31.806  INFO 38768 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:43:32.077  INFO 38768 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:43:32.082 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:43:32.094 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:43:32.130 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:43:32.133 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:43:32.133 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:43:32.156 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:43:32.157 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:43:32.157 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:43:32.180 DEBUG 38768 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:43:32.181  INFO 38768 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:43:32.925  INFO 38768 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:43:32.926  INFO 38768 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:43:33.518  INFO 38768 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:43:32 GMT"],"eagleid":["7724499c17409410115891516e"],"request-id":["6a491f9e-fef6-401d-921a-ffa02b88b886"],"server":["Tengine"],"server-timing":["inner; dur=353","cdn-cache;desc=MISS,edge;dur=0,origin;dur=468"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache8.cn8115[468,0]"],"x-lgw-dst-svc":["LZXaQMlgMyMGURkwAWY6zPHPvk9CmHZMq8LbxPhSQd6zfAY_GeH-K3OIJKcOIpto_iIEjADsuBc0FLAmaxZM90-i0HBB-52evj_2gVhZJhP0VCJBaVEtyFWvaPf_8rIXZy6ee4IhUN2Br78fTVRpS8jKGXWeHYWHYBgfqkX28jXtF2Zv_Lf3gGai0MBDhPbI8UHF2qh6nyFvfcdjbiTxN8DpSm272pTBCXPgFydUy0SkBWFr03jJ65asIX3f_nDK3N_v280nXGR4CiEtNtxMYUA7KKzCDvicVGTHuj3sY63ZRW27dqFJRLY="],"x-request-id":["6a491f9e-fef6-401d-921a-ffa02b88b886"],"x-timestamp":["1740941012.038"],"x-tt-logid":["20250303024331FC8A35058E2BE2B50BE6"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee715eb6b430736be2e9d2e71affa83edd34d8078b8c1fa6d5935a20ad835945cbd7489e948eceb8d4c3305d55131e5ebcce919e7cc7067c062915ef7ae4adeb0e959c4849b861794397e7d76c6c120046ad"],"x-tt-trace-id":["00-250303024331FC8A35058E2BE2B50BE6-217F5AC57196244B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303024331FC8A35058E2BE2B50BE6","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303024331FC8A35058E2BE2B50BE6"}
2025-03-03 02:43:33.518  INFO 38768 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:43:33.916  INFO 38768 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:43:33.940 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:43:33.940 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:43:33.963 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:43:34.099 ERROR 38768 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:43:34.100  INFO 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:43:34.100  INFO 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:43:34.103 DEBUG 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:43:34.105 DEBUG 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:43:34.294  INFO 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=24e9d750-ccf0-4e3c-b7ea-d23af79f521e
2025-03-03 02:43:34.294 DEBUG 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"24e9d750-ccf0-4e3c-b7ea-d23af79f521e"}},"response_mode":"blocking","conversation_id":"3bf271f0-9939-4c2a-8a15-42a8a656afca","user":"fyjw"}
2025-03-03 02:43:42.869  INFO 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浦东新区金港苑东方置业有限公司：

2022年9月1日与贵司签订的《上海市商品房租赁合同》（合同编号：202201716383），约定租赁场地位于金港苑停车库负一层。

本小区居民近日反映停车库内存在消防通道占用等安全隐患，危机生命及财产安全，故要求解除上述租赁合同并向贵司发出通知。

在正式解除合同前，请贵司于2023年12月8日前自行拆除并搬离上述租赁场地内的所有设施及设备，并在搬离后将场地恢复原状。若贵司未在规定时间内完成搬离及恢复原状，我司将视贵司为放弃租赁场地内的所有设施及设备的所有权，并有权对场地内的设施及设备进行清理。清理费用按日租金的4.75倍扣除贵司已交的租赁费。

在送达通知书之日起，上述合同将正式提前解除。期：2023年12月8日。

特此函告，请贵司给予积极配合。

联系人：程四合 电话：13262792367  
杨晓丽 电话：15821244787  

2023年11月28日
```
2025-03-03 02:43:42.869 DEBUG 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"3eea3e48-7b23-49a8-891d-68c1f84aadf1","workflow_run_id":"d74ecf1c-6fdb-4e77-987c-0991adbac2fb","data":{"id":"d74ecf1c-6fdb-4e77-987c-0991adbac2fb","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浦东新区金港苑东方置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房租赁合同》（合同编号：202201716383），约定租赁场地位于金港苑停车库负一层。\n\n本小区居民近日反映停车库内存在消防通道占用等安全隐患，危机生命及财产安全，故要求解除上述租赁合同并向贵司发出通知。\n\n在正式解除合同前，请贵司于2023年12月8日前自行拆除并搬离上述租赁场地内的所有设施及设备，并在搬离后将场地恢复原状。若贵司未在规定时间内完成搬离及恢复原状，我司将视贵司为放弃租赁场地内的所有设施及设备的所有权，并有权对场地内的设施及设备进行清理。清理费用按日租金的4.75倍扣除贵司已交的租赁费。\n\n在送达通知书之日起，上述合同将正式提前解除。期：2023年12月8日。\n\n特此函告，请贵司给予积极配合。\n\n联系人：程四合 电话：13262792367  \n杨晓丽 电话：15821244787  \n\n2023年11月28日\n```"},"elapsed_time":8.52774574700743,"total_tokens":921,"total_steps":4,"created_at":1740941012,"finished_at":1740941021}}
2025-03-03 02:43:42.869  INFO 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:43:42.869 DEBUG 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"economy","doc_form":"text_model"}
2025-03-03 02:43:42.916 ERROR 38768 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常: 

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:128) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:43:42.917 ERROR 38768 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:43:42.941 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:43:42.941 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:43:42.963 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:43:43.119 ERROR 38768 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:43:43.120 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:43:43.122 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:43:43.148 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:43:43.280 ERROR 38768 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:43:43.283 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:43:43.284 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:43:43.309 DEBUG 38768 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:43:43.421 ERROR 38768 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:44:48.507  INFO 38768 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:44:48.511  INFO 38768 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:44:54.451  INFO 17692 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 17692 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:44:54.453 DEBUG 17692 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:44:54.453  INFO 17692 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:44:54.860  INFO 17692 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:44:54.861  INFO 17692 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:44:54.878  INFO 17692 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 02:44:55.234  INFO 17692 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:44:55.240  INFO 17692 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:44:55.240  INFO 17692 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:44:55.350  INFO 17692 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:44:55.350  INFO 17692 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 862 ms
2025-03-03 02:44:55.620  INFO 17692 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:44:55.621  INFO 17692 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:44:56.202  INFO 17692 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:44:56.429  INFO 17692 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477278982763577346&access_key=ea96c597ac0d4dddbbdf0c97aa2b7e99&service_id=33554678&ticket=0d087585-49e5-471a-9bb0-942f07754bc0 [conn_id=7477278982763577346]
2025-03-03 02:44:56.664  INFO 17692 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:44:56.672  INFO 17692 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.502 seconds (JVM running for 3.129)
2025-03-03 02:45:02.122  INFO 17692 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740941100}
2025-03-03 02:45:02.167  WARN 17692 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @79e2c065
2025-03-03 02:45:02.175  INFO 17692 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:45:02.449  INFO 17692 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:45:02.454 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:45:02.471 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:45:02.510 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:45:02.515 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:45:02.515 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:45:02.539 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:45:02.540 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:45:02.540 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:45:02.563 DEBUG 17692 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:45:02.564  INFO 17692 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:45:03.243  INFO 17692 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:45:03.244  INFO 17692 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:45:03.836  INFO 17692 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:45:02 GMT"],"eagleid":["b75d669917409411019062918e"],"request-id":["4baaa968-7c35-44e8-b957-28d738a310dc"],"server":["Tengine"],"server-timing":["inner; dur=361","cdn-cache;desc=MISS,edge;dur=0,origin;dur=389"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache5.cn6912[389,0]"],"x-lgw-dst-svc":["CDfOvfFs6ZLsAqtvmxi4u_94KVES5inbR5gORYFmsIzVRdW3B4uTNS5WgqFOpJkgWFq4ggqtaKHGe3Luwlgc_e7oqs5W-mJryBpArpivrrujUMMpr0Ie90GZApB8ZQocRO77vXAcwATvL0qM0ufXHDKzmvYxFpkcZ3pkHdGUJ3_Z2U1d2it_Es5e7vzLLVbVCv9nujgRXL7hqgU8NlMTvBmVtF-RuAAnGPsgdoEF0LKlKRJesz7xSa9A2w7iMjyUzvGUj21NBHGFnWdI1PUd4ljbdtqh2DmQi_zcGaweydHIUCDrEY7i8OM="],"x-request-id":["4baaa968-7c35-44e8-b957-28d738a310dc"],"x-timestamp":["1740941102.283"],"x-tt-logid":["202503030245011E956F87E340FFFB4732"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b00ee15a03a27884df0a2e1e95a485299f72408508b4af9314775f2169c8cac1e785effb586ec5c068b9b4d3b807455d8cca177b623c618efbd04a41d2e7568fcf2ee51e0db4f139247f4a097d112f37af"],"x-tt-trace-id":["00-2503030245011E956F87E340FFFB4732-002B5E573F387006-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030245011E956F87E340FFFB4732","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030245011E956F87E340FFFB4732"}
2025-03-03 02:45:03.837  INFO 17692 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:45:04.180  INFO 17692 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:45:04.206 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:45:04.206 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:45:04.230 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:45:04.349 ERROR 17692 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:45:04.349  INFO 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:45:04.349  INFO 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:45:04.351 DEBUG 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:45:04.351 DEBUG 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:45:04.545  INFO 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=633ed621-6c0a-4688-9901-35f9695f66b5
2025-03-03 02:45:04.546 DEBUG 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"633ed621-6c0a-4688-9901-35f9695f66b5"}},"response_mode":"blocking","conversation_id":"3b2295ad-d382-428d-a88d-57d0fc41fd82","user":"fyjw"}
2025-03-03 02:45:50.581  INFO 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩谦新社区金地先进产业业有限公司：

2022年9月1日与贵司签订的“上海市商品房预售合同”（合同编号：202200176383），因贵司未按合同约定的付款节点支付购房款。

本小区项目建设过程中受疫情、宏观经济、金融、中介的叠加影响导致项目建设进度滞后。贵司在未如约支付购房款的情况下，多次要求退房，并向人民法院提起诉讼，严重影响了公司正常的经营活动及项目推进工作。

在此情况下，公司综合考虑决定对贵司的退房要求予以支持，但需贵司撤诉后我公司才能正式办理贵司的退房退款手续，同时我公司将根据合同约定扣除定金人民币200万元，并赔偿我公司按同期银行贷款利率4.75%计算的利息损失。

在贵司撤诉及相关手续正式完成之前，时间：2023年12月8日之前，请贵司尽快与我司联系办理相关事宜。

联系人：程四合   电话：13262792367  
杨晓斌   电话：15821420374  

2023年11月28日
```
2025-03-03 02:45:50.581 DEBUG 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"62d72133-df80-4a52-b1ee-dd0e22ef4ad0","workflow_run_id":"efcd9788-e7df-4597-b2d8-b6961f7db2a2","data":{"id":"efcd9788-e7df-4597-b2d8-b6961f7db2a2","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩谦新社区金地先进产业业有限公司：\n\n2022年9月1日与贵司签订的“上海市商品房预售合同”（合同编号：202200176383），因贵司未按合同约定的付款节点支付购房款。\n\n本小区项目建设过程中受疫情、宏观经济、金融、中介的叠加影响导致项目建设进度滞后。贵司在未如约支付购房款的情况下，多次要求退房，并向人民法院提起诉讼，严重影响了公司正常的经营活动及项目推进工作。\n\n在此情况下，公司综合考虑决定对贵司的退房要求予以支持，但需贵司撤诉后我公司才能正式办理贵司的退房退款手续，同时我公司将根据合同约定扣除定金人民币200万元，并赔偿我公司按同期银行贷款利率4.75%计算的利息损失。\n\n在贵司撤诉及相关手续正式完成之前，时间：2023年12月8日之前，请贵司尽快与我司联系办理相关事宜。\n\n联系人：程四合   电话：13262792367  \n杨晓斌   电话：15821420374  \n\n2023年11月28日\n```"},"elapsed_time":45.96649801102467,"total_tokens":904,"total_steps":4,"created_at":1740941103,"finished_at":1740941149}}
2025-03-03 02:45:50.581  INFO 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:45:50.581 DEBUG 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"economy","doc_form":"text_model"}
2025-03-03 02:45:50.622 ERROR 17692 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常: 

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "Extra data: line 1 column 57 (char 56)", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:125) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:45:50.622 ERROR 17692 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:45:50.645 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:45:50.646 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:45:50.669 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:45:50.838 ERROR 17692 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:45:50.840 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:45:50.840 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:45:50.863 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:45:51.058 ERROR 17692 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:45:51.064 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:45:51.064 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:45:51.087 DEBUG 17692 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:45:51.293 ERROR 17692 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:49:11.493  INFO 17692 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 02:49:11.501  INFO 17692 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 02:49:16.063  INFO 34068 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 34068 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:49:16.064 DEBUG 34068 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:49:16.064  INFO 34068 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:49:16.523  INFO 34068 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:49:16.525  INFO 34068 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:49:16.551  INFO 34068 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-03-03 02:49:16.995  INFO 34068 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:49:17.003  INFO 34068 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:49:17.004  INFO 34068 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:49:17.136  INFO 34068 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:49:17.136  INFO 34068 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1039 ms
2025-03-03 02:49:17.402  INFO 34068 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:49:17.402  INFO 34068 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:49:17.626  WARN 34068 --- [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuEventController' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'messageEventHandler' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 2; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
2025-03-03 02:49:17.629  INFO 34068 --- [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-03-03 02:49:17.635  INFO 34068 --- [main] ConditionEvaluationReportLoggingListener : 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2025-03-03 02:49:17.651 ERROR 34068 --- [main] o.s.boot.SpringApplication               : Application run failed

org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuEventController' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'messageEventHandler' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 2; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:229) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1372) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1222) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:955) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:918) ~[spring-context-5.3.24.jar:5.3.24]
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:583) ~[spring-context-5.3.24.jar:5.3.24]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:147) ~[spring-boot-2.7.6.jar:2.7.6]
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:731) ~[spring-boot-2.7.6.jar:2.7.6]
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:408) ~[spring-boot-2.7.6.jar:2.7.6]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:307) ~[spring-boot-2.7.6.jar:2.7.6]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1303) ~[spring-boot-2.7.6.jar:2.7.6]
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1292) ~[spring-boot-2.7.6.jar:2.7.6]
	at em.backend.BackendApplication.main(BackendApplication.java:14) ~[classes/:na]
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'messageEventHandler' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 2; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:229) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1372) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1222) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1391) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1311) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-5.3.24.jar:5.3.24]
	... 19 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 2; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:229) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1372) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1222) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1391) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1311) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-5.3.24.jar:5.3.24]
	... 33 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 2; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:229) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1372) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1222) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1391) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1311) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-5.3.24.jar:5.3.24]
	... 47 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 2; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:800) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:229) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1372) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1222) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1391) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1311) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-5.3.24.jar:5.3.24]
	... 61 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'difyKnowledgeServiceImpl': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:289) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1302) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1219) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:582) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:542) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1391) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1311) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:887) ~[spring-beans-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-5.3.24.jar:5.3.24]
	... 75 common frames omitted
Caused by: java.lang.IllegalStateException: Failed to introspect Class [em.backend.service.impl.DifyKnowledgeServiceImpl] from ClassLoader [jdk.internal.loader.ClassLoaders$AppClassLoader@63947c6b]
	at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:485) ~[spring-core-5.3.24.jar:5.3.24]
	at org.springframework.util.ReflectionUtils.doWithLocalMethods(ReflectionUtils.java:321) ~[spring-core-5.3.24.jar:5.3.24]
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:267) ~[spring-beans-5.3.24.jar:5.3.24]
	... 88 common frames omitted
Caused by: java.lang.NoClassDefFoundError: em/backend/service/impl/DifyKnowledgeServiceImpl$1
	at java.base/java.lang.Class.getDeclaredMethods0(Native Method) ~[na:na]
	at java.base/java.lang.Class.privateGetDeclaredMethods(Class.java:3402) ~[na:na]
	at java.base/java.lang.Class.getDeclaredMethods(Class.java:2504) ~[na:na]
	at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:467) ~[spring-core-5.3.24.jar:5.3.24]
	... 90 common frames omitted
Caused by: java.lang.ClassNotFoundException: em.backend.service.impl.DifyKnowledgeServiceImpl$1
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641) ~[na:na]
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188) ~[na:na]
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520) ~[na:na]
	... 94 common frames omitted

2025-03-03 02:49:23.282  INFO 34316 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 34316 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 02:49:23.283 DEBUG 34316 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 02:49:23.284  INFO 34316 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 02:49:23.706  INFO 34316 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 02:49:23.708  INFO 34316 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 02:49:23.727  INFO 34316 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 02:49:24.140  INFO 34316 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 02:49:24.148  INFO 34316 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 02:49:24.148  INFO 34316 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 02:49:24.256  INFO 34316 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 02:49:24.257  INFO 34316 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 936 ms
2025-03-03 02:49:24.589  INFO 34316 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 02:49:24.590  INFO 34316 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 02:49:25.168  INFO 34316 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 02:49:25.352  INFO 34316 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477282470312968194&access_key=d8c8d5eda89bd287b540118b0d09f5a5&service_id=33554678&ticket=99603f1b-6d01-4dab-8328-22a6d1888354 [conn_id=7477282470312968194]
2025-03-03 02:49:25.649  INFO 34316 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 02:49:25.656  INFO 34316 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.663 seconds (JVM running for 3.262)
2025-03-03 02:49:25.922  INFO 34316 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740941364}
2025-03-03 02:49:25.967  WARN 34316 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @38c6f217
2025-03-03 02:49:25.976  INFO 34316 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 02:49:26.235  INFO 34316 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 02:49:26.239 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:49:26.251 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:49:26.283 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:49:26.286 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:49:26.287 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:49:26.307 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:49:26.307 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 02:49:26.308 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 02:49:26.327 DEBUG 34316 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 02:49:26.327  INFO 34316 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 02:49:27.087  INFO 34316 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:49:27.088  INFO 34316 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 02:49:27.623  INFO 34316 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 18:49:26 GMT"],"eagleid":["7724499817409413657562633e"],"request-id":["c7865036-c9e2-4778-93ec-44ce61e1f47f"],"server":["Tengine"],"server-timing":["inner; dur=329","cdn-cache;desc=MISS,edge;dur=0,origin;dur=406"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache4.cn8115[406,0]"],"x-lgw-dst-svc":["3201WuTv_V6KeB5t5aO2tjg7aBvaIfxbyJwR4GoDe8TqRBKnSidI0KexZ7XCajej2NTZq-cORpY5BS6iE5-nvtKEQunUFnJLUQBaraOcvBnBIpi42pkZVxbxM0LZIuKOUcz4p_nubpv0DVywmhi2RryAfZcbzcHCnkWBDdPbfqiab_VMfO4NbNCVko-nAuVcUtzwJY4Q7xF4IHtEXk6G7yct1X2YEO1MtB_gLm2bQ7nzt9gWIYI4K_ObOp8PYZXtl-ddy3RDKoT3VLNRtOzfSWxZb-x-SV2Z91eaJF6iNHjfyi7yHmg4JQ=="],"x-request-id":["c7865036-c9e2-4778-93ec-44ce61e1f47f"],"x-timestamp":["1740941366.147"],"x-tt-logid":["20250303024925FE77242D4B6789C52854"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee7155cce68c050fa9e5d50450ca03a4e5980726232d53fc1a5005c22a79c3fc73d78914d409d405a613a641f15eeb59f61e3f1ba1617cf6bb0d771995a4d51e6d772f964f854fdb6d42738bad84e0710c40"],"x-tt-trace-id":["00-250303024925FE77242D4B6789C52854-657770797AF07E5E-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303024925FE77242D4B6789C52854","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303024925FE77242D4B6789C52854"}
2025-03-03 02:49:27.624  INFO 34316 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 02:49:27.971  INFO 34316 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 02:49:27.992 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:49:27.992 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:49:28.014 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:49:28.129 ERROR 34316 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:49:28.129  INFO 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 02:49:28.129  INFO 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 02:49:28.132 DEBUG 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 02:49:28.133 DEBUG 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 02:49:28.322  INFO 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=7b61573b-3957-4527-a314-6c54d8b01510
2025-03-03 02:49:28.322 DEBUG 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"7b61573b-3957-4527-a314-6c54d8b01510"}},"response_mode":"blocking","conversation_id":"2375e5f2-f36d-4904-ada0-fe2c70b80b18","user":"fyjw"}
2025-03-03 02:49:39.928  INFO 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浦滨新区鑫姚东方置业有限公司：

2022年9月15日与贵司签订的《上海市商品房预售合同》（合同编号：202201761383），约定贵司应于2023年11月30日前交付房屋。

本小区现房屋尚在建设过程中，未达到交付条件，贵司的行为又一次严重违反了合同约定，给购房人造成了极大的困扰和损失。

在此我们要求贵司立即采取有效措施加快项目建设，确保人民法院在2023年12月8日的房屋交付执行期限之前完成房屋交付工作。同时，贵司应承诺在此期限内交付房屋，否则我们将在人民法院支持购房人要求解除购房合同并退还购房款、支付违约金、赔偿因逾期交付房屋而造成的经济损失的情况下，要求贵司承担逾期交付房屋的违约金，违约金按购房款总额的4.75%承担直至房屋交付之日止。

在法律规定的框架内我们将正式发起诉讼。期限：2023年12月8日之前，如未交付房屋，我们将对贵司采取法律措施。

联系人：程四合  
电话：13262792367  
杨晓强  
电话：15821244730  

2023年11月28日
```
2025-03-03 02:49:39.929 DEBUG 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"243a8a44-383a-4b17-a8d6-50741b73f4ff","workflow_run_id":"2517ddb4-fbcf-4100-9cac-f008f7a4bf6c","data":{"id":"2517ddb4-fbcf-4100-9cac-f008f7a4bf6c","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浦滨新区鑫姚东方置业有限公司：\n\n2022年9月15日与贵司签订的《上海市商品房预售合同》（合同编号：202201761383），约定贵司应于2023年11月30日前交付房屋。\n\n本小区现房屋尚在建设过程中，未达到交付条件，贵司的行为又一次严重违反了合同约定，给购房人造成了极大的困扰和损失。\n\n在此我们要求贵司立即采取有效措施加快项目建设，确保人民法院在2023年12月8日的房屋交付执行期限之前完成房屋交付工作。同时，贵司应承诺在此期限内交付房屋，否则我们将在人民法院支持购房人要求解除购房合同并退还购房款、支付违约金、赔偿因逾期交付房屋而造成的经济损失的情况下，要求贵司承担逾期交付房屋的违约金，违约金按购房款总额的4.75%承担直至房屋交付之日止。\n\n在法律规定的框架内我们将正式发起诉讼。期限：2023年12月8日之前，如未交付房屋，我们将对贵司采取法律措施。\n\n联系人：程四合  \n电话：13262792367  \n杨晓强  \n电话：15821244730  \n\n2023年11月28日\n```"},"elapsed_time":11.53186075296253,"total_tokens":950,"total_steps":4,"created_at":1740941367,"finished_at":1740941378}}
2025-03-03 02:49:39.930  INFO 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 02:49:39.932 DEBUG 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 02:49:39.982 ERROR 34316 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常: 

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:157) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 02:49:39.983 ERROR 34316 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 02:49:40.006 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:49:40.006 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:49:40.026 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:49:40.172 ERROR 34316 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:49:40.176 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:49:40.176 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:49:40.197 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:49:40.306 ERROR 34316 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 02:49:40.313 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 02:49:40.313 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 02:49:40.334 DEBUG 34316 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 02:49:40.453 ERROR 34316 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:04:04.319  INFO 2772 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 2772 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:04:04.321 DEBUG 2772 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:04:04.322  INFO 2772 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:04:04.842  INFO 2772 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:04:04.845  INFO 2772 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:04:04.874  INFO 2772 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 03:04:05.327  INFO 2772 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:04:05.331  INFO 2772 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:04:05.332  INFO 2772 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:04:05.439  INFO 2772 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:04:05.439  INFO 2772 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1072 ms
2025-03-03 03:04:05.744  INFO 2772 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:04:05.745  INFO 2772 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:04:06.304  INFO 2772 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:04:06.502  INFO 2772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477284300691423260&access_key=233707410764f2558e26078d97cedcf8&service_id=33554678&ticket=64a97011-8b7c-416c-8205-1c6bde565c2b [conn_id=7477284300691423260]
2025-03-03 03:04:06.830  INFO 2772 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:04:06.838  INFO 2772 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.893 seconds (JVM running for 3.498)
2025-03-03 03:05:00.639 ERROR 2772 --- [pool-2-thread-2] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: b7a45095-4bd4-4824-8c00-4ee084edf15a, trace_id: 8fbb48fb7948f084fa84fa7a6726941d, [conn_id=7477284300691423260]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 03:05:07.500  INFO 2772 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740942306}
2025-03-03 03:05:07.536  WARN 2772 --- [pool-2-thread-3] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @35cabb2a
2025-03-03 03:05:07.544  INFO 2772 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:05:07.865  INFO 2772 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:05:07.869 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:05:07.881 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:05:07.917 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:05:07.920 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:05:07.921 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:05:07.945 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:05:07.945 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:05:07.945 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:05:07.970 DEBUG 2772 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:05:07.970  INFO 2772 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:05:08.628  INFO 2772 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:05:08.629  INFO 2772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:05:09.187  INFO 2772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:05:07 GMT"],"eagleid":["b75d66af17409423073727533e"],"request-id":["940f5fb8-0b4d-4369-9992-d6f9d2648883"],"server":["Tengine"],"server-timing":["inner; dur=390","cdn-cache;desc=MISS,edge;dur=0,origin;dur=416"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache27.cn6912[416,0]"],"x-lgw-dst-svc":["CO32u2q5Pl0AyTKsBMbC8V9U8MMkak7LC9OnGQq4ORCH74GXKDabRUpf4mSCg2D5GelqrH2HSv648iCOqRPSHUU5uve7ymMKVvXdOu8TcafldPLwhOPoQ8ALn0-FyeFjK2XOE9v15dDEKP8IXR-lTpLhMb7Ammwf6rD2KXwxqG0sXSQVD7rFizsVJNqZMkf11vwyuS_wkySAGfhkcOmrSNaHILHAl36syjK81qK9gnsxmTGJiI0syGmnbbEOeT20jDwL5qfri8WR_r2S8GmtJ7ZZvOID1Ce5bnNWP7lxZGNzcodXQQlyXTw="],"x-request-id":["940f5fb8-0b4d-4369-9992-d6f9d2648883"],"x-timestamp":["1740942307.774"],"x-tt-logid":["202503030305072DF9F6C71860DDCCECF3"],"x-tt-trace-host":["01ccaa9006929504934b60aae96e7176b0016a25b111c961bf65c770868160783aff9547639e15710fe0e2ddcd1b06fac4e67fa41e72e6e380f74dcd0aa351bd730d09e4f3fbef6867f3c575fafd4c6a07874f5b0b4459b044419613399ca50472"],"x-tt-trace-id":["00-2503030305072DF9F6C71860DDCCECF3-2402DE227863A2C4-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030305072DF9F6C71860DDCCECF3","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030305072DF9F6C71860DDCCECF3"}
2025-03-03 03:05:09.188  INFO 2772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:05:09.632  INFO 2772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:05:09.656 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:05:09.656 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:05:09.680 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:05:09.797 ERROR 2772 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:05:09.798  INFO 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:05:09.798  INFO 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:05:09.799 DEBUG 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:05:09.800 DEBUG 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:05:09.974  INFO 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=7381f769-9f1b-422f-964f-410df0395657
2025-03-03 03:05:09.974 DEBUG 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"7381f769-9f1b-422f-964f-410df0395657"}},"response_mode":"blocking","conversation_id":"f875bb6a-13ab-4d69-ab6c-55312418e6e0","user":"fyjw"}
2025-03-03 03:05:15.464 ERROR 2772 --- [pool-2-thread-4] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 35eb6bbd-3246-4464-aa1e-89c5ed9dfbe8, trace_id: 8fbb48fb7948f084fa84fa7a6726941d, [conn_id=7477284300691423260]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 03:05:17.727  INFO 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浦溢新区金港苑开发经营有限公司：

2022年9月1日与贵公司签订的《上海市商品房租赁合同》（合同编号：202200176383），约定租期自2022年9月1日至2023年8月31日。

本小区物业管理费标准按面积分别为4.5元/平方米·月、住宅的中又夹杂部分商业用途的物业管理费按6元/平方米·月、商业物业管理费按8元/平方米·月。

在汇丰御园一二期物业交付后，为了更好地维护小区公共秩序，提升居民生活质量，物业服务公司对物业管理服务人员薪资进行了调整，同时在2023年9月小区召开业主大会时通过了物业管理费标准调整的决定，住宅物业管理费将从4.5元/平方米·月调整为5元/平方米·月。

在这里通知贵公司该物业正式变更日期：即2023年12月8日起将按新的物业管理费标准执行，并请您及时缴费。

联系人：程四合 电话：13262792367  
杨晓斌 电话：15821247364

2023年11月28日
```
2025-03-03 03:05:17.728 DEBUG 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"ebe75070-c273-4a1c-a028-05644a19a4ba","workflow_run_id":"43087649-a250-4ff1-87b4-559b4dd251d7","data":{"id":"43087649-a250-4ff1-87b4-559b4dd251d7","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浦溢新区金港苑开发经营有限公司：\n\n2022年9月1日与贵公司签订的《上海市商品房租赁合同》（合同编号：202200176383），约定租期自2022年9月1日至2023年8月31日。\n\n本小区物业管理费标准按面积分别为4.5元/平方米·月、住宅的中又夹杂部分商业用途的物业管理费按6元/平方米·月、商业物业管理费按8元/平方米·月。\n\n在汇丰御园一二期物业交付后，为了更好地维护小区公共秩序，提升居民生活质量，物业服务公司对物业管理服务人员薪资进行了调整，同时在2023年9月小区召开业主大会时通过了物业管理费标准调整的决定，住宅物业管理费将从4.5元/平方米·月调整为5元/平方米·月。\n\n在这里通知贵公司该物业正式变更日期：即2023年12月8日起将按新的物业管理费标准执行，并请您及时缴费。\n\n联系人：程四合 电话：13262792367  \n杨晓斌 电话：15821247364\n\n2023年11月28日\n```"},"elapsed_time":7.708980445982888,"total_tokens":903,"total_steps":4,"created_at":1740942308,"finished_at":1740942316}}
2025-03-03 03:05:17.728  INFO 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:05:17.728 DEBUG 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:05:17.773 ERROR 2772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常: 

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:156) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 03:05:17.773 ERROR 2772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:05:17.798 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:05:17.798 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:05:17.821 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:05:17.984 ERROR 2772 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:05:17.985 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:05:17.986 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:05:18.010 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:05:18.120 ERROR 2772 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:05:18.123 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:05:18.124 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:05:18.147 DEBUG 2772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:05:18.351 ERROR 2772 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:07:13.840  INFO 2772 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:07:13.848  INFO 2772 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:07:18.263  INFO 25024 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 25024 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:07:18.264 DEBUG 25024 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:07:18.264  INFO 25024 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:07:18.655  INFO 25024 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:07:18.656  INFO 25024 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:07:18.675  INFO 25024 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 03:07:19.040  INFO 25024 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:07:19.045  INFO 25024 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:07:19.045  INFO 25024 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:07:19.133  INFO 25024 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:07:19.133  INFO 25024 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 834 ms
2025-03-03 03:07:19.381  INFO 25024 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:07:19.382  INFO 25024 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:07:19.908  INFO 25024 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:07:20.017  INFO 25024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477286118800326658&access_key=0121d3e8bdd8b4a74b782380d732942c&service_id=33554678&ticket=ab56b1a1-271e-4ab4-a062-9a3e9dfe39e8 [conn_id=7477286118800326658]
2025-03-03 03:07:20.279  INFO 25024 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:07:20.284  INFO 25024 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.29 seconds (JVM running for 2.787)
2025-03-03 03:07:24.368  INFO 25024 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740942442}
2025-03-03 03:07:24.402  WARN 25024 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @3a93b025
2025-03-03 03:07:24.410  INFO 25024 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:07:24.652  INFO 25024 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:07:24.655 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:07:24.668 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:07:24.700 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:07:24.703 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:07:24.703 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:07:24.724 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:07:24.725 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:07:24.725 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:07:24.745 DEBUG 25024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:07:24.745  INFO 25024 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:07:25.498  INFO 25024 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:07:25.501  INFO 25024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:07:26.027  INFO 25024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:07:24 GMT"],"eagleid":["7abfaaae17409424442483889e"],"request-id":["8d1991ae-4a75-46e6-adf8-2e0cbc8e8c6f"],"server":["Tengine"],"server-timing":["inner; dur=322","cdn-cache;desc=MISS,edge;dur=0,origin;dur=416"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache26.cn6553[416,0]"],"x-lgw-dst-svc":["qGHG9j9BeJLBQSbk_kdWXRSNyHLVoT8_Jm-DF5hccsKmIxuh51hrwqA-wXlhQd8_44aRDAYizbI3om4g0VWe5hcHDwFUBruS5NOl9QvJ-ooBcUdz9Mj7SCYHHAFTdqZ0RZMsAKyNJ90fhWiwn2_r0pAVvhba1uMYGGSxTRavsRc5C9-S08x7ywXMdgnusPLq0gRbB7HIvDrIcD4byQTdMXoXtmbMCOLXOZqPPGgYwa4RfE1Z52i3KyKxdXHS8NSSU3zUjiX4dzxMm-UPirwYXJpTmBYND0rHSvc-BPmapqWhQNivjqH88jM="],"x-request-id":["8d1991ae-4a75-46e6-adf8-2e0cbc8e8c6f"],"x-timestamp":["1740942444.649"],"x-tt-logid":["2025030303072491EE390BBE1604C5E7D4"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64d860ba72ff4932147d8ea34b468233fa9c18d8a01f1d7f06d22121dcc1d3787e131ad7fe65846183f733f9810402b8022d01bb80401f66ed2fceca1b6820b2c0fcef757a7b9ad1d9bb8d7e75ec2ee398"],"x-tt-trace-id":["00-25030303072491EE390BBE1604C5E7D4-74682EB021F5218F-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030303072491EE390BBE1604C5E7D4","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030303072491EE390BBE1604C5E7D4"}
2025-03-03 03:07:26.028  INFO 25024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:07:26.458  INFO 25024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:07:26.478 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:07:26.479 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:07:26.500 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:07:26.613 ERROR 25024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:07:26.614  INFO 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:07:26.614  INFO 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:07:26.617 DEBUG 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:07:26.617 DEBUG 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:07:26.824  INFO 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=34c77bb4-6bd8-4ef1-8ecc-c505d20b398e
2025-03-03 03:07:26.824 DEBUG 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"34c77bb4-6bd8-4ef1-8ecc-c505d20b398e"}},"response_mode":"blocking","conversation_id":"53313367-3876-440f-bc1a-b54a4830f475","user":"fyjw"}
2025-03-03 03:07:40.247  INFO 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通  知  函

上海浩港新村区鑫姚齐九业主委员会有限公司：

2022年9月1日与上海市浩港新村《上海市商品房租赁合同》(合同编号：202201761838)》签订的租赁合同即将到期。

由于本小区业主委员会为居民提供物业服务未收费、无盈利的义务性质组织，业委会日常办公经费需由业主共同承担，现因资金不足无法继续支付租赁费用。

在正式退出前，为保障业委会能顺利开展工作，现向贵司提出申请建议：继续将浩港新村9号楼1楼租赁给业主委员会作为办公场地使用，租赁费用按照贵司当前浩港新村租赁场地价格4.75元/平方米计算。

在送达我方后，请贵司尽快正式回复。时间：2023年12月8日之前。

联系人：程四全  
联系电话：13262792367  
杨晓瑶  
联系电话：15821244730  

2023年11月28日
```

2025-03-03 03:07:40.248 DEBUG 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"38059b6b-318a-479c-a1e4-9da71459e3e5","workflow_run_id":"09ba6012-ae98-4957-9c00-21f27ed543ab","data":{"id":"09ba6012-ae98-4957-9c00-21f27ed543ab","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通  知  函\n\n上海浩港新村区鑫姚齐九业主委员会有限公司：\n\n2022年9月1日与上海市浩港新村《上海市商品房租赁合同》(合同编号：202201761838)》签订的租赁合同即将到期。\n\n由于本小区业主委员会为居民提供物业服务未收费、无盈利的义务性质组织，业委会日常办公经费需由业主共同承担，现因资金不足无法继续支付租赁费用。\n\n在正式退出前，为保障业委会能顺利开展工作，现向贵司提出申请建议：继续将浩港新村9号楼1楼租赁给业主委员会作为办公场地使用，租赁费用按照贵司当前浩港新村租赁场地价格4.75元/平方米计算。\n\n在送达我方后，请贵司尽快正式回复。时间：2023年12月8日之前。\n\n联系人：程四全  \n联系电话：13262792367  \n杨晓瑶  \n联系电话：15821244730  \n\n2023年11月28日\n```\n"},"elapsed_time":13.362850527046248,"total_tokens":871,"total_steps":4,"created_at":1740942445,"finished_at":1740942458}}
2025-03-03 03:07:40.248  INFO 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:07:40.248 DEBUG 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 请求体内容: {data=[<{"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}},[]>], file=[Byte array resource [resource loaded from byte array]]}
2025-03-03 03:07:40.249 DEBUG 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:07:40.293 ERROR 25024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传异常: 

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:156) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 03:07:40.294 ERROR 25024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:07:40.314 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:07:40.314 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:07:40.333 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:07:40.470 ERROR 25024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:07:40.471 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:07:40.473 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:07:40.494 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:07:40.634 ERROR 25024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:07:40.639 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:07:40.640 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:07:40.659 DEBUG 25024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:07:40.775 ERROR 25024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:08:55.299 ERROR 25024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:08:55.299  INFO 25024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477286118800326658&access_key=0121d3e8bdd8b4a74b782380d732942c&service_id=33554678&ticket=ab56b1a1-271e-4ab4-a062-9a3e9dfe39e8 [conn_id=7477286118800326658]
2025-03-03 03:08:55.299  INFO 25024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:09:18.801  INFO 25024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:09:19.026  INFO 25024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477285674555949057&access_key=05bf45debedc781f3a41bb14b194438d&service_id=33554678&ticket=bd0732ba-584d-4425-9731-e1b9f42befb8 [conn_id=7477285674555949057]
2025-03-03 03:09:44.787  INFO 25024 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:09:44.792  INFO 25024 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:16:50.832  INFO 32324 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 32324 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:16:50.833 DEBUG 32324 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:16:50.834  INFO 32324 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:16:51.294  INFO 32324 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:16:51.296  INFO 32324 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:16:51.318  INFO 32324 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 03:16:51.724  INFO 32324 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:16:51.731  INFO 32324 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:16:51.731  INFO 32324 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:16:51.852  INFO 32324 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:16:51.853  INFO 32324 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 986 ms
2025-03-03 03:16:52.154  INFO 32324 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:16:52.154  INFO 32324 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:16:52.754  INFO 32324 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:16:52.872  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785159196&access_key=d94711f56fcb5c5c8577ee5c7cfe059a&service_id=33554678&ticket=1b692d7d-bb93-4e75-9d25-590ac3e5dd23 [conn_id=7477289342785159196]
2025-03-03 03:16:53.247  INFO 32324 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:16:53.257  INFO 32324 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.693 seconds (JVM running for 3.347)
2025-03-03 03:17:09.354  INFO 32324 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943027}
2025-03-03 03:17:09.382  WARN 32324 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @7f3b84b8
2025-03-03 03:17:09.388  INFO 32324 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:17:09.617  INFO 32324 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:17:09.623 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:17:09.638 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:17:09.670 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:17:09.673 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:17:09.674 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:17:09.694 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:17:09.694 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:17:09.694 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:17:09.716 DEBUG 32324 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:17:09.716  INFO 32324 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:17:10.389  INFO 32324 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:17:10.390  INFO 32324 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:17:10.915  INFO 32324 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:17:09 GMT"],"eagleid":["7abfaaa217409430291398290e"],"request-id":["7da81d45-307d-431d-903b-1c1a287abc4a"],"server":["Tengine"],"server-timing":["inner; dur=339","cdn-cache;desc=MISS,edge;dur=0,origin;dur=367"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache14.cn6553[367,0]"],"x-lgw-dst-svc":["LoGOcGj5-VD_iL1yn1bSW3lWnAfAZtc-33gqctgXjBWt0xvKN3VktLch1gao14S_nehckHt9ssXnM9T2ZpnIojMmDpOtfG6JEufSaTFm1R309Ohhcz9fYxXn8BzdRx22p9r7u3EfTBuiOZwescDM1LcN-dpENhlIb7fm5-TvQdxJAd3awAuLP4uCwgrIiLWNstmiUya33rSomEZYTCe5LlcE7qOXIdLewL9R0XOZzGJHExte1AHjyTrCln0sFt-yrTLvsEHSUZ1BQMYA11h6zm9knkya4DLQv3j5Oy1dSvjccm_kwu32Si4="],"x-request-id":["7da81d45-307d-431d-903b-1c1a287abc4a"],"x-timestamp":["1740943029.488"],"x-tt-logid":["202503030317090C6136FD7A6263CC7824"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64a8a01d2d1dc6b675d6005743d69ded400820f0fe1e5ecdbab33d0efc3ad4c82919d6caaca1c4dc139cb90dcfd83046616b01a729dbb3c3098deeab8d31858410ca9aafeeda4746c51ba96e1c6a209d31"],"x-tt-trace-id":["00-2503030317090C6136FD7A6263CC7824-2E127C534D90364B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030317090C6136FD7A6263CC7824","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030317090C6136FD7A6263CC7824"}
2025-03-03 03:17:10.916  INFO 32324 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:17:11.277  INFO 32324 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:17:11.297 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:17:11.298 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:17:11.316 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:17:11.427 ERROR 32324 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:17:11.427  INFO 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:17:11.427  INFO 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:17:11.429 DEBUG 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:17:11.429 DEBUG 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:17:11.625  INFO 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ff9dbe58-1a6b-4481-900b-026427bd6a2e
2025-03-03 03:17:11.625 DEBUG 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"ff9dbe58-1a6b-4481-900b-026427bd6a2e"}},"response_mode":"blocking","conversation_id":"ee03ed83-ec3e-4cab-be48-7fda29752a05","user":"fyjw"}
2025-03-03 03:17:19.345  INFO 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浦港新区鑫姚东方置业有限公司：

2022年9月1日与贵司签订的《上海市商品房预约合同》（合同编号：202201716383），约定的购房贷款利率为：

> “本认购房屋如申请商业性住房贷款，贷款利率为贷款合同签订时的LPR利率加点形成的实际执行利率。”

在上述贷款利率的基础上，贵司与我司所签订的《上海市商品房预约合同》中又明确约定“若贷款利率发生调整，按照国家相关政策执行”。

在汇丰银行最新贷款利率调整政策中规定：自2023年9月25日起，居民首套房贷利率下限调整为不低于贷款市场报价利率（LPR）。根据此规定，本人申请的首套住房贷款利率将调整为4.75%（不含加点）。

因此，我司建议贵司应根据上述国家政策调整购房贷款利率为4.75%并履行合同约定。

在该贷款利率调整政策正式实施前，即2023年12月8日之前，请贵司与我司协商并签订补充协议。

联系人：程四合  
联系电话：13262793267  
杨晓瑶  
联系电话：15821247304  

2023年11月28日
```
2025-03-03 03:17:19.346 DEBUG 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"52694666-cd26-4a9f-aada-1f111cc08b3c","workflow_run_id":"35713362-ca51-4644-8614-72827ac748cb","data":{"id":"35713362-ca51-4644-8614-72827ac748cb","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浦港新区鑫姚东方置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房预约合同》（合同编号：202201716383），约定的购房贷款利率为：\n\n> “本认购房屋如申请商业性住房贷款，贷款利率为贷款合同签订时的LPR利率加点形成的实际执行利率。”\n\n在上述贷款利率的基础上，贵司与我司所签订的《上海市商品房预约合同》中又明确约定“若贷款利率发生调整，按照国家相关政策执行”。\n\n在汇丰银行最新贷款利率调整政策中规定：自2023年9月25日起，居民首套房贷利率下限调整为不低于贷款市场报价利率（LPR）。根据此规定，本人申请的首套住房贷款利率将调整为4.75%（不含加点）。\n\n因此，我司建议贵司应根据上述国家政策调整购房贷款利率为4.75%并履行合同约定。\n\n在该贷款利率调整政策正式实施前，即2023年12月8日之前，请贵司与我司协商并签订补充协议。\n\n联系人：程四合  \n联系电话：13262793267  \n杨晓瑶  \n联系电话：15821247304  \n\n2023年11月28日\n```"},"elapsed_time":7.661504607880488,"total_tokens":931,"total_steps":4,"created_at":1740943030,"finished_at":1740943038}}
2025-03-03 03:17:19.346  INFO 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:17:19.354 DEBUG 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:17:19.418 ERROR 32324 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: code=400, body={"code": "invalid_param", "message": "", "status": 400}

2025-03-03 03:17:19.418 ERROR 32324 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:17:19.437 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:17:19.437 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:17:19.458 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:17:19.561 ERROR 32324 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:17:19.563 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:17:19.564 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:17:19.583 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:17:19.701 ERROR 32324 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:17:19.704 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:17:19.705 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:17:19.725 DEBUG 32324 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:17:19.848 ERROR 32324 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:18:10.358 ERROR 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:18:10.358  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785159196&access_key=d94711f56fcb5c5c8577ee5c7cfe059a&service_id=33554678&ticket=1b692d7d-bb93-4e75-9d25-590ac3e5dd23 [conn_id=7477289342785159196]
2025-03-03 03:18:10.358  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:18:14.316  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:18:14.528  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785355804&access_key=0471293824ef9ae4fb52570e64f97871&service_id=33554678&ticket=c5a8daea-18ab-4edc-a957-26749531354a [conn_id=7477289342785355804]
2025-03-03 03:19:52.330 ERROR 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:19:52.330  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785355804&access_key=0471293824ef9ae4fb52570e64f97871&service_id=33554678&ticket=c5a8daea-18ab-4edc-a957-26749531354a [conn_id=7477289342785355804]
2025-03-03 03:19:52.331  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:20:20.724  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:20:21.014  INFO 32324 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289757216014364&access_key=49538ea0e5dc09d65cf9d6b630988401&service_id=33554678&ticket=d6a1988d-96d9-45af-b975-5e46e1c40d30 [conn_id=7477289757216014364]
2025-03-03 03:20:44.989  INFO 32324 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:20:44.995  INFO 32324 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:20:48.924  INFO 5076 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 5076 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:20:48.926 DEBUG 5076 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:20:48.926  INFO 5076 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:20:49.335  INFO 5076 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:20:49.336  INFO 5076 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:20:49.357  INFO 5076 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 03:20:49.723  INFO 5076 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:20:49.730  INFO 5076 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:20:49.731  INFO 5076 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:20:49.838  INFO 5076 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:20:49.839  INFO 5076 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 879 ms
2025-03-03 03:20:50.077  INFO 5076 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:20:50.078  INFO 5076 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:20:50.674  INFO 5076 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:20:50.783  INFO 5076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289757216063516&access_key=92f1b4ab0accc0497cb0cfb76555fa90&service_id=33554678&ticket=048e9460-62f4-4bb5-b9a2-86dd781dcd64 [conn_id=7477289757216063516]
2025-03-03 03:20:51.060  INFO 5076 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:20:51.066  INFO 5076 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.418 seconds (JVM running for 2.941)
2025-03-03 03:20:59.668  INFO 5076 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943258}
2025-03-03 03:20:59.705  WARN 5076 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @7f3b84b8
2025-03-03 03:20:59.716  INFO 5076 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:20:59.993  INFO 5076 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:20:59.998 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:21:00.012 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:21:00.047 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:21:00.050 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:21:00.050 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:21:00.077 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:21:00.078 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:21:00.078 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:21:00.102 DEBUG 5076 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:21:00.103  INFO 5076 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:21:00.861  INFO 5076 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:21:00.863  INFO 5076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:21:01.395  INFO 5076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:21:00 GMT"],"eagleid":["772449b217409432596144888e"],"request-id":["4aa3f96d-d395-4e0e-b7cb-d0ddd0698ad3"],"server":["Tengine"],"server-timing":["inner; dur=329","cdn-cache;desc=MISS,edge;dur=0,origin;dur=418"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache30.cn8115[418,0]"],"x-lgw-dst-svc":["_ou5Zqbc2M1O3GzWm51Qfu035Oym3Ue1HIr_hIwHZ3Fsjy8b3tkM1lX6VkjRR_P3eh2pycZgIAzeiS2dx8qwVvGC0RHQlRP29Mnp4R3k3TudZcVGCzf3cvG6EDdipuPciMpJiMli_khEmbhJOLzPeYeb8xGORJfyu7wdjxhoLJdBFSFYN-Th3ipDPAVIKHxdsqgipKNdIHhj3GpbjUZPWVnFrkoEYPXW9RK1NAHpJMV9xwGDTx6p_IappPevFatpIzWoLJQeaJ_Vxub3pTtIgctT6hcwP4126jxzttuCHfb2KZO8Pc-78G0="],"x-request-id":["4aa3f96d-d395-4e0e-b7cb-d0ddd0698ad3"],"x-timestamp":["1740943260.008"],"x-tt-logid":["2025030303205916D7F5F488FB52F77788"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71470b06a3f6f70c724219134d001cd1a29144103f9008a266f7bfbfe701d7071d5c84818ea8f70ce2f4501c84fbb4457af9f70657859ad1f38b5363554171def2ff71ccd4b43c73ac757c0d98bbd37c39"],"x-tt-trace-id":["00-25030303205916D7F5F488FB52F77788-5F6326EC446BC4A0-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030303205916D7F5F488FB52F77788","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030303205916D7F5F488FB52F77788"}
2025-03-03 03:21:01.396  INFO 5076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:21:01.777  INFO 5076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:21:01.801 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:21:01.801 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:21:01.827 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:21:01.953 ERROR 5076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:21:01.954  INFO 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:21:01.954  INFO 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:21:01.957 DEBUG 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:21:01.958 DEBUG 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:21:02.130  INFO 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=4c49268b-d1cd-436c-b631-1e3ec3e4b1b4
2025-03-03 03:21:02.131 DEBUG 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"4c49268b-d1cd-436c-b631-1e3ec3e4b1b4"}},"response_mode":"blocking","conversation_id":"bc10b54f-7747-4f79-97e1-62b5efd4807b","user":"fyjw"}
2025-03-03 03:21:09.533  INFO 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩瀚新社区金姚东方置业有限公司：

2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定的贷款银行为上海农商银行。

本小区项目开发建设中因受疫情、经济大势、金融中的又贷新政等多方面影响，导致部分业主银行贷款在审批放款过程中受阻，逾期未能放款，从而导致业主向贵司支付的购房款未能按时到位。

在汇丰银行贷款审批过程中，因本小区项目开发建设中存在的贷款逾期问题，银行未能按时完成审批放款，导致贷款审批时间延长并推迟放款时间，现阶段贷款利率为4.75%不超合同约定利率。

在贷款审批完成后，银行将按正常流程放款时间预计：2023年12月8日之前完成贷款审批及放款。对于因此带来的不便，敬请谅解。

联系人：程四合 电话：13262792367  
杨晓瑶 电话：15821240734  

2023年11月28日
```
2025-03-03 03:21:09.533 DEBUG 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"1f29a1a0-2cab-4e93-b112-64fb61f7cf53","workflow_run_id":"289058b7-a7f6-4408-95e7-884fa82d22d9","data":{"id":"289058b7-a7f6-4408-95e7-884fa82d22d9","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩瀚新社区金姚东方置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定的贷款银行为上海农商银行。\n\n本小区项目开发建设中因受疫情、经济大势、金融中的又贷新政等多方面影响，导致部分业主银行贷款在审批放款过程中受阻，逾期未能放款，从而导致业主向贵司支付的购房款未能按时到位。\n\n在汇丰银行贷款审批过程中，因本小区项目开发建设中存在的贷款逾期问题，银行未能按时完成审批放款，导致贷款审批时间延长并推迟放款时间，现阶段贷款利率为4.75%不超合同约定利率。\n\n在贷款审批完成后，银行将按正常流程放款时间预计：2023年12月8日之前完成贷款审批及放款。对于因此带来的不便，敬请谅解。\n\n联系人：程四合 电话：13262792367  \n杨晓瑶 电话：15821240734  \n\n2023年11月28日\n```"},"elapsed_time":7.355253248009831,"total_tokens":894,"total_steps":4,"created_at":1740943260,"finished_at":1740943268}}
2025-03-03 03:21:09.533  INFO 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:21:09.542 DEBUG 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:21:09.603 ERROR 5076 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: code=400, body={"code": "invalid_param", "message": "", "status": 400}

2025-03-03 03:21:09.603 ERROR 5076 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:21:09.625 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:21:09.626 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:21:09.649 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:21:09.770 ERROR 5076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:21:09.771 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:21:09.772 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:21:09.795 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:21:09.933 ERROR 5076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:21:09.938 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:21:09.940 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:21:09.962 DEBUG 5076 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:21:10.095 ERROR 5076 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:22:00.283 ERROR 5076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:22:00.283  INFO 5076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289757216063516&access_key=92f1b4ab0accc0497cb0cfb76555fa90&service_id=33554678&ticket=048e9460-62f4-4bb5-b9a2-86dd781dcd64 [conn_id=7477289757216063516]
2025-03-03 03:22:00.283  INFO 5076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:22:24.259  INFO 5076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:22:24.515  INFO 5076 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785634332&access_key=da6ee372285086fa367a8c92b14a61ed&service_id=33554678&ticket=391c0216-22c0-4e0a-ba5f-f0663dd08e12 [conn_id=7477289342785634332]
2025-03-03 03:23:09.844  INFO 5076 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:23:09.851  INFO 5076 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:23:14.762  INFO 28252 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 28252 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:23:14.764 DEBUG 28252 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:23:14.764  INFO 28252 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:23:15.233  INFO 28252 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:23:15.235  INFO 28252 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:23:15.254  INFO 28252 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 03:23:15.688  INFO 28252 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:23:15.696  INFO 28252 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:23:15.697  INFO 28252 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:23:15.828  INFO 28252 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:23:15.828  INFO 28252 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1027 ms
2025-03-03 03:23:16.061  INFO 28252 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:23:16.062  INFO 28252 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:23:16.840  INFO 28252 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:23:16.943  INFO 28252 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785749020&access_key=b819a614a183006910282e8bbf3e89cb&service_id=33554678&ticket=58bdd16a-1db6-444e-b859-0bfe7ea38c67 [conn_id=7477289342785749020]
2025-03-03 03:23:17.207  INFO 28252 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:23:17.215  INFO 28252 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.715 seconds (JVM running for 3.277)
2025-03-03 03:23:18.343  INFO 28252 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943396}
2025-03-03 03:23:18.374  WARN 28252 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @7f3b84b8
2025-03-03 03:23:18.382  INFO 28252 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:23:18.623  INFO 28252 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:23:18.628 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:23:18.639 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:23:18.669 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:23:18.673 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:23:18.673 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:23:18.694 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:23:18.695 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:23:18.695 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:23:18.716 DEBUG 28252 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:23:18.716  INFO 28252 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:23:19.485  INFO 28252 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:23:19.487  INFO 28252 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:23:19.992  INFO 28252 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:23:18 GMT"],"eagleid":["7724499d17409433982371377e"],"request-id":["338bf550-56f9-42df-bd3e-f14b765ac03d"],"server":["Tengine"],"server-timing":["inner; dur=335","cdn-cache;desc=MISS,edge;dur=0,origin;dur=405"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache9.cn8115[405,0]"],"x-lgw-dst-svc":["Bi2ohW5p-pzYONputzgXVNuVc0s-ndE44doqvn9lMa5oMTb_3SD8qnT5WCMBq3Qw6qomPaqHeHtQK5jFnJNwlcr4YDbKUuRT-VJlaMV78U4MRAHByCsl93Yf-RyvrUFFIS6CxvhNkOUDVcNUHtM0E_pxDJMLXusyxRf6h7WHrGYKaFKZfhfT-BjnoXUlYcVp4l_F36fqdgterjllBoi4PeUBK8HRxdK16k2bGtdx96PvNRjHRTScovZ_tlkVCZ2E_fmUwyv6XrjQA73cQYrsaDClUC09Fjl84dkdABfFdkgRVlhVQP-JPvI="],"x-request-id":["338bf550-56f9-42df-bd3e-f14b765ac03d"],"x-timestamp":["1740943398.630"],"x-tt-logid":["202503030323185577D86C2FD441C1139B"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71e6281a795829adf1712a13b0805dfaf6eb0dbc9467e1efe7ea66389add62a45df699338682fe3e005906ea9eb36ed8aacf4d8a73db69854521c3cec8a877f7f0d13bbb248f7c2ef8995fe82f6e70d745"],"x-tt-trace-id":["00-2503030323185577D86C2FD441C1139B-3AC634D258CF3BAD-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030323185577D86C2FD441C1139B","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030323185577D86C2FD441C1139B"}
2025-03-03 03:23:19.992  INFO 28252 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:23:20.383  INFO 28252 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:23:20.405 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:23:20.406 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:23:20.426 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:23:20.537 ERROR 28252 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:23:20.538  INFO 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:23:20.538  INFO 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:23:20.542 DEBUG 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:23:20.543 DEBUG 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:23:20.724  INFO 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=56146df4-c630-4a7f-a295-ed9d2d8613d5
2025-03-03 03:23:20.724 DEBUG 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"56146df4-c630-4a7f-a295-ed9d2d8613d5"}},"response_mode":"blocking","conversation_id":"ad43ca6b-0780-4dfe-bed6-c665d030cd5c","user":"fyjw"}
2025-03-03 03:23:27.584  INFO 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩瀚新区金港先开置业有限公司：

2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定的购房款项支付方式为商业贷款。

本小区原约定的商业贷款利率为4.9%，因国家政策、金融机构政策调整，现目前商业贷款利率已调整至4.75%。为降低购房者的购房成本，我司向政府金融主管部门申请调整按揭贷款利率。

在汇丰银行的通力配合下，目前已完成按揭贷款利率调整为4.75%及相关的手续办理流程。我司现同步对您的按揭贷款利率调整为4.75%。在您申请贷款银行放款后，仍按4.75%执行。

在该通知函发出后，因涉及合同变更事项，需自2023年12月8日之前至我司财务部门签署补充协议完成办理。如未按期办理变更手续的，仍按原合同的贷款利率执行。

联系人：程向文  
电话：13262792367  
杨晓瑶  
电话：15821244730  

2023年11月28日
```
2025-03-03 03:23:27.585 DEBUG 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"cce5eaab-921e-4fa1-a093-138cf641d90d","workflow_run_id":"939bfae3-50e6-4e19-b9b3-7a323262e083","data":{"id":"939bfae3-50e6-4e19-b9b3-7a323262e083","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩瀚新区金港先开置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定的购房款项支付方式为商业贷款。\n\n本小区原约定的商业贷款利率为4.9%，因国家政策、金融机构政策调整，现目前商业贷款利率已调整至4.75%。为降低购房者的购房成本，我司向政府金融主管部门申请调整按揭贷款利率。\n\n在汇丰银行的通力配合下，目前已完成按揭贷款利率调整为4.75%及相关的手续办理流程。我司现同步对您的按揭贷款利率调整为4.75%。在您申请贷款银行放款后，仍按4.75%执行。\n\n在该通知函发出后，因涉及合同变更事项，需自2023年12月8日之前至我司财务部门签署补充协议完成办理。如未按期办理变更手续的，仍按原合同的贷款利率执行。\n\n联系人：程向文  \n电话：13262792367  \n杨晓瑶  \n电话：15821244730  \n\n2023年11月28日\n```"},"elapsed_time":6.799672089982778,"total_tokens":906,"total_steps":4,"created_at":1740943399,"finished_at":1740943406}}
2025-03-03 03:23:27.586  INFO 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:23:27.595 DEBUG 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:23:27.665 ERROR 28252 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: code=400, body={"code": "invalid_param", "message": "", "status": 400}
, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:23:27.665 ERROR 28252 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:23:27.687 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:23:27.687 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:23:27.706 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:23:27.838 ERROR 28252 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:23:27.840 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:23:27.840 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:23:27.862 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:23:27.994 ERROR 28252 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:23:27.998 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:23:27.998 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:23:28.027 DEBUG 28252 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:23:28.146 ERROR 28252 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:24:19.272 ERROR 28252 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:24:19.272  INFO 28252 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785749020&access_key=b819a614a183006910282e8bbf3e89cb&service_id=33554678&ticket=58bdd16a-1db6-444e-b859-0bfe7ea38c67 [conn_id=7477289342785749020]
2025-03-03 03:24:19.272  INFO 28252 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:24:40.282  INFO 28252 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:24:40.460  INFO 28252 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289342785896476&access_key=47953bb46a095446ab122847ff1c7547&service_id=33554678&ticket=9f8b39ac-92c2-402c-a8bf-a12cf73de805 [conn_id=7477289342785896476]
2025-03-03 03:26:08.522  INFO 28252 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:26:08.529  INFO 28252 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:26:13.560  INFO 2492 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 2492 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:26:13.562 DEBUG 2492 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:26:13.562  INFO 2492 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:26:13.948  INFO 2492 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:26:13.950  INFO 2492 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:26:13.975  INFO 2492 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 03:26:14.307  INFO 2492 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:26:14.313  INFO 2492 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:26:14.314  INFO 2492 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:26:14.430  INFO 2492 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:26:14.431  INFO 2492 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 837 ms
2025-03-03 03:26:14.677  INFO 2492 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:26:14.678  INFO 2492 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:26:15.255  INFO 2492 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:26:15.462  INFO 2492 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409715220481&access_key=1e55f251f26ef88f681b112b74842663&service_id=33554678&ticket=ee3fbcce-b6f9-42ff-9d6c-bca3910654ab [conn_id=7477290409715220481]
2025-03-03 03:26:15.676  INFO 2492 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:26:15.684  INFO 2492 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.383 seconds (JVM running for 2.901)
2025-03-03 03:26:20.292  INFO 2492 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943578}
2025-03-03 03:26:20.325  WARN 2492 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @2b662a77
2025-03-03 03:26:20.333  INFO 2492 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:26:20.607  INFO 2492 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:26:20.611 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:20.626 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:20.660 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:20.664 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:26:20.664 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:26:20.688 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:26:20.688 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:26:20.688 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:26:20.711 DEBUG 2492 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:26:20.711  INFO 2492 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:26:21.399  INFO 2492 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:26:21.401  INFO 2492 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:26:21.946  INFO 2492 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:26:20 GMT"],"eagleid":["7abfaaa817409435801532400e"],"request-id":["879d394f-c4b1-430e-8216-436d7267a686"],"server":["Tengine"],"server-timing":["inner; dur=359","cdn-cache;desc=MISS,edge;dur=0,origin;dur=449"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn6553[449,0]"],"x-lgw-dst-svc":["hmrKjUaafj7zuA4fbjJPkgS51b06RuXjpJb4wGyjFsqvy9dzO5qRXGtTLOeh6aGSfgCJNpddLFCmvLMuyEM3OpApr2xsnTfkwWp3eeBHEsYkVocbjBdlUDTKe36hGUVbfu_gKrfCJIYc-XvnAce_sdZK68RSFbQHfaakTxH6nUE5BDBZVFsj78SWwVaMNArqX88dv3M6lVmLtgwA_Qb3D6BIYTrEeDzdDopMWt2zUwhpohiDXnkQJU7rmNOdg2GgUt7vKao04r3u09oKeB0aZnrNB9em-6Sm8l5RRjl27hj52AJYRmoDGVM="],"x-request-id":["879d394f-c4b1-430e-8216-436d7267a686"],"x-timestamp":["1740943580.588"],"x-tt-logid":["202503030326205D5FF54C66A731ACC99C"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba6482f0fe0cd87a5ddfc03ccee6fdd3fbf90c062f90f8f53eb9b36322ff5b97f8ac908160ddaea41bccf6839ac38c885ea256599500c7b21dc7f0fcf1d65f4691a66c5ce82c1d58aaaeb1d5c49d88462dac"],"x-tt-trace-id":["00-2503030326205D5FF54C66A731ACC99C-6B26F2FD1CED110A-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030326205D5FF54C66A731ACC99C","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030326205D5FF54C66A731ACC99C"}
2025-03-03 03:26:21.947  INFO 2492 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:26:22.319  INFO 2492 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:26:22.342 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:22.342 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:22.366 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:22.468 ERROR 2492 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:22.469  INFO 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:26:22.469  INFO 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:26:22.472 DEBUG 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:26:22.473 DEBUG 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:26:22.669  INFO 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=bb255d4b-5486-4edc-8c67-d7a097e7caf1
2025-03-03 03:26:22.670 DEBUG 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"bb255d4b-5486-4edc-8c67-d7a097e7caf1"}},"response_mode":"blocking","conversation_id":"007f9130-af03-4c30-a727-e721aedec26d","user":"fyjw"}
2025-03-03 03:26:30.323  INFO 2492 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943574}
2025-03-03 03:26:30.347 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:30.347 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:30.372 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:30.372 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:26:30.372 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:26:30.395 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:26:30.395 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:26:30.395 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:26:30.419 DEBUG 2492 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:26:30.420  INFO 2492 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:26:30.882  INFO 2492 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:26:30.882  INFO 2492 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:26:31.213  INFO 2492 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:26:29 GMT"],"eagleid":["7abfaaa817409435896347298e"],"request-id":["db911709-459a-4de8-9a7d-44087e5fa953"],"server":["Tengine"],"server-timing":["inner; dur=297","cdn-cache;desc=MISS,edge;dur=0,origin;dur=322"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn6553[322,0]"],"x-lgw-dst-svc":["jcw0Tsz3UK-LCy8g5NcZBP5pO3jrCd1EQ16siI_a1U-hWaYY-aTOQFyEiJKCpFLLbUZhbIQUZYCvFeEhBA4cdYByYuOEj3T1wj7CWuqaaZhMg1fTvr9V6qTohKBS2sr8y0k6TPIeKMA28FelFK_HGQP5Z0OZtw2oViGyoD3sdlre5hAG3vz9YMh5DxSZ4_mitWbHrQlze4aYFKQ_bDcpI56ekuwlA9BqeA9ywWTKlBMMVAlF0WsaPvrHuzNLGDeWiFTmASEcwluYgkGm-tr4dc3biYicQwpzCFddUgjqtcnzqH9fEjj4XWY="],"x-request-id":["db911709-459a-4de8-9a7d-44087e5fa953"],"x-timestamp":["1740943589.941"],"x-tt-logid":["202503030326299874878AE4CAA7C0C46C"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64ef35a3680900ded6436ea3925a04807cc0c22b1b8b88a23a6923501d16a0d53dea8b609cd9468a748b6e26d1b1685301024f6188fe7ffdbb10bbcb1313dfa50af91e9fb046b31e706d43bedf633a6b53"],"x-tt-trace-id":["00-2503030326299874878AE4CAA7C0C46C-2479BBBF1735FFDB-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030326299874878AE4CAA7C0C46C","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030326299874878AE4CAA7C0C46C"}
2025-03-03 03:26:31.213  INFO 2492 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:26:31.531  INFO 2492 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:26:31.553 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:31.553 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:31.576 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:31.691 ERROR 2492 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:31.692  INFO 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:26:31.692  INFO 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:26:31.692 DEBUG 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:26:31.692 DEBUG 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:26:31.838  INFO 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=951595db-e25b-4b82-b141-2888bc974a42
2025-03-03 03:26:31.838 DEBUG 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"951595db-e25b-4b82-b141-2888bc974a42"}},"response_mode":"blocking","conversation_id":"874ca969-9197-4a6b-8c5f-12762b9f79bc","user":"fyjw"}
2025-03-03 03:26:32.038  INFO 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩瀚新社区会选东方元置业有限公司：

2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定贵司向我司出售房屋。

根据该合同约定，本小区契税由贵司统一代收代缴。现因房价的下调及贵司未履行相关承诺，我司要求贵司退还代收的契税款。

在此情况下，我司多次通过电话、微信等方式与贵司相关人员联系，并要求贵司退还契税款，但贵司至今未予退还，严重侵害了我司的合法权益。现再次郑重要求贵司退还我司代收的契税款项共计人民币**4.75万元**（大写：人民币肆万柒仟伍佰元整）。

在贵司收到本通知后，请于**2023年12月8日**前将代收的契税款通过银行转账的方式退还我司。

账户名：程四合  
账号：13262792367  
杨晓斌  电话：15821244730  

2023年11月28日
```

注意：此文本为通知函的内容，涉及到日期、金额和联系方式等，请确保无误。
2025-03-03 03:26:32.039 DEBUG 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"47f26556-60f0-4bc9-ad47-03b2f3101463","workflow_run_id":"a910d8a5-2bc6-49bb-8bcc-e5feca676ee3","data":{"id":"a910d8a5-2bc6-49bb-8bcc-e5feca676ee3","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩瀚新社区会选东方元置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），约定贵司向我司出售房屋。\n\n根据该合同约定，本小区契税由贵司统一代收代缴。现因房价的下调及贵司未履行相关承诺，我司要求贵司退还代收的契税款。\n\n在此情况下，我司多次通过电话、微信等方式与贵司相关人员联系，并要求贵司退还契税款，但贵司至今未予退还，严重侵害了我司的合法权益。现再次郑重要求贵司退还我司代收的契税款项共计人民币**4.75万元**（大写：人民币肆万柒仟伍佰元整）。\n\n在贵司收到本通知后，请于**2023年12月8日**前将代收的契税款通过银行转账的方式退还我司。\n\n账户名：程四合  \n账号：13262792367  \n杨晓斌  电话：15821244730  \n\n2023年11月28日\n```\n\n注意：此文本为通知函的内容，涉及到日期、金额和联系方式等，请确保无误。"},"elapsed_time":9.325982529204339,"total_tokens":925,"total_steps":4,"created_at":1740943581,"finished_at":1740943590}}
2025-03-03 03:26:32.039  INFO 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:26:32.047 DEBUG 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:26:32.119 ERROR 2492 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: code=400, body={"code": "invalid_param", "message": "", "status": 400}
, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:26:32.120 ERROR 2492 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:26:32.142 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:32.143 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:32.165 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:32.298 ERROR 2492 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:32.299 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:32.299 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:32.332 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:32.434 ERROR 2492 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:32.437 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:32.438 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:32.462 DEBUG 2492 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:32.575 ERROR 2492 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:41.751  INFO 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浩瀚新社区金姚升元置业有限公司：

2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202201716383），约定的房屋交付时间为2023年9月30日。

本小区项目因疫情等不可抗力及政策调整等多重因素，造成的中途复工复产时间延误，现导致项目施工进度滞后，故无法如期交付。

在工期延误的情况下，我司已积极采取措施，克服困难加快工程进度，并诚挚地向您致歉。经多方努力，现预计于2023年12月8日将房屋交付使用。在此期间，我司将根据合同约定支付您合同总房款的4.75%作为违约金。

在此恳请您谅解并接受我司正式交房日期：2023年12月8日。

特此通知！

联系人：程阳   电话：13262792367  
杨晓瑶   电话：15821247364  

2023年11月28日
```
2025-03-03 03:26:41.751 DEBUG 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"b410c5f3-5e22-4a2e-bf06-c47ca39161db","workflow_run_id":"30ac4f82-5fc8-4253-82f3-354aa2f0d54c","data":{"id":"30ac4f82-5fc8-4253-82f3-354aa2f0d54c","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浩瀚新社区金姚升元置业有限公司：\n\n2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202201716383），约定的房屋交付时间为2023年9月30日。\n\n本小区项目因疫情等不可抗力及政策调整等多重因素，造成的中途复工复产时间延误，现导致项目施工进度滞后，故无法如期交付。\n\n在工期延误的情况下，我司已积极采取措施，克服困难加快工程进度，并诚挚地向您致歉。经多方努力，现预计于2023年12月8日将房屋交付使用。在此期间，我司将根据合同约定支付您合同总房款的4.75%作为违约金。\n\n在此恳请您谅解并接受我司正式交房日期：2023年12月8日。\n\n特此通知！\n\n联系人：程阳   电话：13262792367  \n杨晓瑶   电话：15821247364  \n\n2023年11月28日\n```"},"elapsed_time":9.863147282972932,"total_tokens":880,"total_steps":4,"created_at":1740943590,"finished_at":1740943600}}
2025-03-03 03:26:41.751  INFO 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:26:41.752 DEBUG 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:26:41.783 ERROR 2492 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: code=400, body={"code": "invalid_param", "message": "", "status": 400}
, data={"indexing_technique":"high_quality","process_rule":{"mode":"custom","rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}}}}
2025-03-03 03:26:41.783 ERROR 2492 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:26:41.806 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:41.807 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:41.830 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:41.933 ERROR 2492 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:41.934 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:41.934 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:41.957 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:42.066 ERROR 2492 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:26:42.068 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:26:42.068 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:26:42.090 DEBUG 2492 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:26:42.202 ERROR 2492 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:27:00.428  INFO 2492 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:27:00.433  INFO 2492 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:27:04.566  INFO 31548 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 31548 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:27:04.568 DEBUG 31548 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:27:04.568  INFO 31548 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:27:04.980  INFO 31548 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:27:04.981  INFO 31548 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:27:04.996  INFO 31548 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 03:27:05.396  INFO 31548 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:27:05.403  INFO 31548 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:27:05.403  INFO 31548 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:27:05.511  INFO 31548 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:27:05.512  INFO 31548 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 914 ms
2025-03-03 03:27:05.768  INFO 31548 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:27:05.769  INFO 31548 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:27:06.466  INFO 31548 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:27:06.667  INFO 31548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409715318785&access_key=eb0cf93e5824be5a6960ac163a32546c&service_id=33554678&ticket=f5a640a6-bf11-4884-9e25-8ff9bc1654b6 [conn_id=7477290409715318785]
2025-03-03 03:27:06.837  INFO 31548 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:27:06.845  INFO 31548 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.568 seconds (JVM running for 3.097)
2025-03-03 03:27:23.034  INFO 31548 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943641}
2025-03-03 03:27:23.063  WARN 31548 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @7f3b84b8
2025-03-03 03:27:23.071  INFO 31548 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:27:23.390  INFO 31548 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:27:23.394 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:27:23.409 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:27:23.444 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:27:23.447 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:27:23.447 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:27:23.471 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:27:23.471 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:27:23.471 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:27:23.496 DEBUG 31548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:27:23.496  INFO 31548 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:27:24.233  INFO 31548 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:27:24.234  INFO 31548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:27:24.698  INFO 31548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:27:23 GMT"],"eagleid":["77243f2317409436429896261e"],"request-id":["54b87bf3-ecf6-4def-b59b-89f76e818569"],"server":["Tengine"],"server-timing":["inner; dur=348","cdn-cache;desc=MISS,edge;dur=0,origin;dur=371"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache15.cn7330[371,0]"],"x-lgw-dst-svc":["tOoTcl0sw9YZQUEjdv3ZTVL9uF7eeBFk16SQq7Q34rLQgWp7Febh0v7k7hEMQq8wUzbVbD5pzjpdy8lW4QWO4Y6kui-TEhK83zF67hnJHUTJ-XvDqdrtLvzGu90WnaxCaHv9XHsFcib8C2Ozwr022TRQCeJo5vY8MJVzk8FFEFslqTwKZrtqhCgaIMdr9XVpSK0N9qQCCV2ZLTin39Qz8fv0j7R-IqcUD5__GZp-CXhzVF2ypoTHHDa0r4UHxdRhhaEADmbLQDuQ1Slz71C2L5ZJGs5CIztHmZmHP7mhLr_2JbFApcHxzQ=="],"x-request-id":["54b87bf3-ecf6-4def-b59b-89f76e818569"],"x-timestamp":["1740943643.347"],"x-tt-logid":["20250303032722C7305E8D604025706FC1"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71a35419eb0cf0bc7d663fbd5f5b28e3200f6e07fbfae56cc26195612c0b8a1b7f947824517c2f7741e67494ff94ec958c4d3cfeb0b3e2fcd746b69b554e662d3808d205505270ed391c69d6dcf31ebf86"],"x-tt-trace-id":["00-250303032722C7305E8D604025706FC1-72CF00FB0A817CE9-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303032722C7305E8D604025706FC1","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303032722C7305E8D604025706FC1"}
2025-03-03 03:27:24.698  INFO 31548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:27:25.085  INFO 31548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:27:25.110 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:27:25.110 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:27:25.134 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:27:25.258 ERROR 31548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:27:25.259  INFO 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:27:25.259  INFO 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:27:25.261 DEBUG 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:27:25.261 DEBUG 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:27:25.477  INFO 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a7e67087-6469-4c26-9661-57a81cc24745
2025-03-03 03:27:25.478 DEBUG 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"a7e67087-6469-4c26-9661-57a81cc24745"}},"response_mode":"blocking","conversation_id":"193f0299-6cef-40c1-b169-39f1a55013ff","user":"fyjw"}
2025-03-03 03:27:32.888  INFO 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浦滨新村区鑫姚东方置业有限公司：

2022年9月1日与贵司签订的“上海市商品房预售合同”（合同编号：202200176383），因贵司至今未能按合同约定的日期交房。

本小区是浦东新区政府重点民生工程、重大项目。您延期的交房又是浦东新区政府重点的民生问题，社会矛盾较为突出。

在此情况下，为了减少社会矛盾，促进社会和谐稳定，我司已向浦东新区人民法院提起诉讼，并完成了公益仲裁。仲裁裁决如下：贵司赔偿我司因延期交房给业主支付的延期交房赔偿款，赔偿金额按合同约定的4.75%标准支付。

在该判决书生效后，我司将正式要求贵司履行。

特此通知！

结算时间：2023年12月8日前  
联系人：程四金  电话：13262793267  
杨晓瑾    电话：15821244732  

2023年11月28日
```

2025-03-03 03:27:32.889 DEBUG 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"ca841c10-0b3b-488c-811e-e69a51242104","workflow_run_id":"c72b4ee1-99d6-4624-8181-8bd5ac7de2f0","data":{"id":"c72b4ee1-99d6-4624-8181-8bd5ac7de2f0","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浦滨新村区鑫姚东方置业有限公司：\n\n2022年9月1日与贵司签订的“上海市商品房预售合同”（合同编号：202200176383），因贵司至今未能按合同约定的日期交房。\n\n本小区是浦东新区政府重点民生工程、重大项目。您延期的交房又是浦东新区政府重点的民生问题，社会矛盾较为突出。\n\n在此情况下，为了减少社会矛盾，促进社会和谐稳定，我司已向浦东新区人民法院提起诉讼，并完成了公益仲裁。仲裁裁决如下：贵司赔偿我司因延期交房给业主支付的延期交房赔偿款，赔偿金额按合同约定的4.75%标准支付。\n\n在该判决书生效后，我司将正式要求贵司履行。\n\n特此通知！\n\n结算时间：2023年12月8日前  \n联系人：程四金  电话：13262793267  \n杨晓瑾    电话：15821244732  \n\n2023年11月28日\n```\n"},"elapsed_time":7.355508805951104,"total_tokens":882,"total_steps":4,"created_at":1740943644,"finished_at":1740943651}}
2025-03-03 03:27:32.889  INFO 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:27:32.896 DEBUG 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, data={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 03:27:32.958 ERROR 31548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: code=400, body={"code": "invalid_param", "message": "", "status": 400}
, data={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 03:27:32.958 ERROR 31548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:27:32.982 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:27:32.982 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:27:33.007 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:27:33.139 ERROR 31548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:27:33.140 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:27:33.141 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:27:33.164 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:27:33.273 ERROR 31548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:27:33.276 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:27:33.277 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:27:33.301 DEBUG 31548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:27:33.407 ERROR 31548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:28:40.889  INFO 31548 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:28:40.898  INFO 31548 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:28:42.841  INFO 18624 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 18624 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:28:42.843 DEBUG 18624 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:28:42.843  INFO 18624 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:28:43.307  INFO 18624 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:28:43.310  INFO 18624 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:28:43.331  INFO 18624 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.
2025-03-03 03:28:43.758  INFO 18624 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:28:43.765  INFO 18624 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:28:43.766  INFO 18624 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:28:43.870  INFO 18624 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:28:43.870  INFO 18624 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 993 ms
2025-03-03 03:28:44.106  INFO 18624 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:28:44.107  INFO 18624 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:28:44.655  INFO 18624 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:28:44.842  INFO 18624 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409715449857&access_key=ce097c335fab7582fe596a2a4dd1ffa4&service_id=33554678&ticket=7c67f61b-fa75-4a5c-8b73-60eafb63d9fe [conn_id=7477290409715449857]
2025-03-03 03:28:45.023  INFO 18624 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943723}
2025-03-03 03:28:45.069  INFO 18624 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:28:45.071  WARN 18624 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @2b662a77
2025-03-03 03:28:45.078  INFO 18624 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.614 seconds (JVM running for 3.278)
2025-03-03 03:28:45.081  INFO 18624 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:28:45.369  INFO 18624 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:28:45.375 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:28:45.387 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:28:45.422 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:28:45.426 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:28:45.426 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:28:45.450 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:28:45.451 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:28:45.452 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:28:45.476 DEBUG 18624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:28:45.477  INFO 18624 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:28:46.122  INFO 18624 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:28:46.124  INFO 18624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:28:46.607  INFO 18624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:28:45 GMT"],"eagleid":["7abfaa9817409437248752867e"],"request-id":["ba36dd5f-a1cf-4e10-a004-78cf2187df3f"],"server":["Tengine"],"server-timing":["inner; dur=333","cdn-cache;desc=MISS,edge;dur=0,origin;dur=363"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache4.cn6553[363,0]"],"x-lgw-dst-svc":["9lTEJjeDmoAm_ZkOGZLFkYQZHpAvyMvopajCdFYW06u9fZdO8uC1T2hfYkRl1Ynm1mXSW_pqq9uF_S4i8ErnveyRbicvJu4870KhQJOV5GlWIeoJAIb1-6Sw3UQcibERNhRM5E_is4bO6odh2mSrPptezjyVC7PHyC0bprT2ncR6BxikDa-WvtSf-JxyEX1T4AFMDemwnXUBY5askEo2IRqLTt76fuUcCw_0ZzBxaXZkArLpsd-4cz4REjYdAvQc8OI9YuRC_3B7xsr3JjOV_WfRF0eHGkoZqH0JDCfUzHkBD3He46BJgSo="],"x-request-id":["ba36dd5f-a1cf-4e10-a004-78cf2187df3f"],"x-timestamp":["1740943725.225"],"x-tt-logid":["20250303032844DE5A0E72B23964BAD2A0"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba6490f173378eeb0e9b30201f536c33e5e75d9b395deafd04ab310d044b54eced785710cd5c24321bcfbd3d6e06197ee3b43c2f40d8fa292b484df165c4e4f3bca9ed4a41de080fe949e399a822c718c6df"],"x-tt-trace-id":["00-250303032844DE5A0E72B23964BAD2A0-0B591E391097EDDC-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303032844DE5A0E72B23964BAD2A0","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303032844DE5A0E72B23964BAD2A0"}
2025-03-03 03:28:46.608  INFO 18624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:28:46.943  INFO 18624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:28:46.966 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:28:46.967 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:28:46.991 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:28:47.096 ERROR 18624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:28:47.097  INFO 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:28:47.097  INFO 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:28:47.099 DEBUG 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:28:47.100 DEBUG 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:28:47.288  INFO 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f843f587-1359-4222-a8b1-7a3971f20943
2025-03-03 03:28:47.288 DEBUG 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f843f587-1359-4222-a8b1-7a3971f20943"}},"response_mode":"blocking","conversation_id":"5288019e-ed08-4582-89e2-e8ac6a8126d3","user":"fyjw"}
2025-03-03 03:28:54.244  INFO 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浦进新城区金姚东方置业有限公司：

2022年9月1日与贵司签署的《上海市商品房预约合同》（合同编号：202200176383），约定贵司于2023年7月31日前交付房屋。

由于贵司未能如期交付房屋并已延期超过90天，依据合同中相关条款的约定，同时根据政府有关政策规定，我司在此通知贵司：  

在正式交付房屋前，我司自2023年11月1日起对贵司支付的房款按中国人民银行同期贷款利率4.75%计付购房款利息，直至房屋实际交付之日止。

在上述期间，如贵司决定退房，我司将按照贵司支付的全额房款及自2023年11月1日起计至退款实际支付日止的同期贷款利率4.75%支付利息。

在该通知函送达贵司后即正式发生法律效力。

特此通知。

日期：2023年11月28日  
联系人：程四合  
联系电话：13262792367  
杨晓强  
联系电话：15821247304
```

2025-03-03 03:28:54.245 DEBUG 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"a95d5e9a-9bbe-453c-ac2f-0932c0309815","workflow_run_id":"e54f1b4a-7168-4428-8f86-d8988d958e3e","data":{"id":"e54f1b4a-7168-4428-8f86-d8988d958e3e","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浦进新城区金姚东方置业有限公司：\n\n2022年9月1日与贵司签署的《上海市商品房预约合同》（合同编号：202200176383），约定贵司于2023年7月31日前交付房屋。\n\n由于贵司未能如期交付房屋并已延期超过90天，依据合同中相关条款的约定，同时根据政府有关政策规定，我司在此通知贵司：  \n\n在正式交付房屋前，我司自2023年11月1日起对贵司支付的房款按中国人民银行同期贷款利率4.75%计付购房款利息，直至房屋实际交付之日止。\n\n在上述期间，如贵司决定退房，我司将按照贵司支付的全额房款及自2023年11月1日起计至退款实际支付日止的同期贷款利率4.75%支付利息。\n\n在该通知函送达贵司后即正式发生法律效力。\n\n特此通知。\n\n日期：2023年11月28日  \n联系人：程四合  \n联系电话：13262792367  \n杨晓强  \n联系电话：15821247304\n```\n"},"elapsed_time":6.914640751201659,"total_tokens":891,"total_steps":4,"created_at":1740943726,"finished_at":1740943732}}
2025-03-03 03:28:54.245  INFO 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:28:54.252 DEBUG 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, headers=Authorization: ██
, data={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 03:28:54.315 ERROR 18624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, code=400, headers=Server: nginx/1.27.4
Date: Sun, 02 Mar 2025 19:28:53 GMT
Content-Type: application/json
Content-Length: 56
Connection: keep-alive
Access-Control-Allow-Origin: *
X-Version: 1.0.0
X-Env: PRODUCTION
, body={"code": "invalid_param", "message": "", "status": 400}
, data={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 03:28:54.315 ERROR 18624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:28:54.339 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:28:54.339 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:28:54.362 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:28:54.494 ERROR 18624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:28:54.496 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:28:54.497 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:28:54.521 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:28:54.645 ERROR 18624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:28:54.648 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:28:54.649 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:28:54.672 DEBUG 18624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:28:54.779 ERROR 18624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:30:12.183  INFO 18624 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:30:12.189  INFO 18624 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:30:16.289  INFO 19016 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 19016 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:30:16.291 DEBUG 19016 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:30:16.291  INFO 19016 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:30:16.733  INFO 19016 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:30:16.736  INFO 19016 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:30:16.758  INFO 19016 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.
2025-03-03 03:30:17.174  INFO 19016 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:30:17.180  INFO 19016 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:30:17.180  INFO 19016 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:30:17.280  INFO 19016 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:30:17.281  INFO 19016 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 954 ms
2025-03-03 03:30:17.501  INFO 19016 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:30:17.503  INFO 19016 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:30:18.072  INFO 19016 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:30:18.189  INFO 19016 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409715646465&access_key=d3d5433f308bb14b168677d23edca9dc&service_id=33554678&ticket=82ef95ab-544f-4006-b2ce-b59ebafeeff7 [conn_id=7477290409715646465]
2025-03-03 03:30:18.472  INFO 19016 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:30:18.479  INFO 19016 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.462 seconds (JVM running for 3.045)
2025-03-03 03:30:35.209  INFO 21740 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 21740 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:30:35.210 DEBUG 21740 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:30:35.210  INFO 21740 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:30:35.669  INFO 21740 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:30:35.671  INFO 21740 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:30:35.692  INFO 21740 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 03:30:36.110  INFO 21740 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:30:36.116  INFO 21740 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:30:36.116  INFO 21740 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:30:36.235  INFO 21740 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:30:36.235  INFO 21740 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 985 ms
2025-03-03 03:30:36.551  INFO 21740 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:30:36.551  INFO 21740 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:30:37.090  INFO 21740 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:30:37.188  INFO 21740 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289757216915484&access_key=837734b7392b923144b48b2ae46c200d&service_id=33554678&ticket=7092eed5-d7e1-4df3-b1b0-fbe6505b2768 [conn_id=7477289757216915484]
2025-03-03 03:30:37.555  INFO 21740 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:30:37.563  INFO 21740 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.69 seconds (JVM running for 3.411)
2025-03-03 03:30:40.736  INFO 21740 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943839}
2025-03-03 03:30:40.780  WARN 21740 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @77847718
2025-03-03 03:30:40.791  INFO 21740 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:30:41.034  INFO 21740 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:30:41.038 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:41.050 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:41.080 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:41.084 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:30:41.084 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:30:41.105 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:30:41.105 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:30:41.105 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:30:41.126 DEBUG 21740 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:30:41.126  INFO 21740 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:30:41.886  INFO 21740 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:30:41.888  INFO 21740 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:30:42.459  INFO 21740 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:30:41 GMT"],"eagleid":["77243f3017409438406453281e"],"request-id":["d8df68c5-a45a-42ce-ae24-f37eb9d7778f"],"server":["Tengine"],"server-timing":["inner; dur=342","cdn-cache;desc=MISS,edge;dur=0,origin;dur=422"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache28.cn7330[422,0]"],"x-lgw-dst-svc":["pcwsrArE_BOoX9QviHN0oGd3xmL5F2psT_5r9og4LT_jPZEFg_UYfBB4k-2pHbU6LZOoVuL6ds3KWnCqHEY2Hm3vGEqRoTGRiR_J9rnxi7ihr24b_S8hiWGFBotyE-UDSH7i42oZN73JBzxA0Nr7PRWa18DMm1pL6yGmdm_tSg1jWW0VOohHR_Gamj6ZnFz6CLVCZpNM4sJBu5XmLzpRkwltuwdSFDGDwTtwNVH7kBstgte6yoQlO8S6X_PwIQZ-sJl40Q_aLE5OnUn56839SWGtwcs7jk4i9HHNySmJoBFC9L8y8_UbSw=="],"x-request-id":["d8df68c5-a45a-42ce-ae24-f37eb9d7778f"],"x-timestamp":["1740943841.053"],"x-tt-logid":["202503030330406C8073D5A0679EC59C00"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee710c473702ab0c9e5b45e45723781d9984ca3cdbbcdef0757df33a59efd19650473e9e5efda7715cf4dd1e96a9eb07b997f025a75a5b307df0c60c5278daa759a3a5957fd2311f4984e22fd4fb3d6a5dc0"],"x-tt-trace-id":["00-2503030330406C8073D5A0679EC59C00-2C8CD18F7E74B3DC-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030330406C8073D5A0679EC59C00","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030330406C8073D5A0679EC59C00"}
2025-03-03 03:30:42.460  INFO 21740 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:30:42.855  INFO 21740 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:30:42.876 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:42.877 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:42.897 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:43.015 ERROR 21740 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:30:43.016  INFO 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:30:43.016  INFO 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:30:43.018 DEBUG 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:30:43.018 DEBUG 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:30:43.207  INFO 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=e54078b2-c8bb-45e7-a718-dc0a633424c9
2025-03-03 03:30:43.207 DEBUG 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"e54078b2-c8bb-45e7-a718-dc0a633424c9"}},"response_mode":"blocking","conversation_id":"f0c9afd3-34c2-4b11-b260-fe59749be38c","user":"fyjw"}
2025-03-03 03:30:53.112  INFO 21740 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740943835}
2025-03-03 03:30:53.133 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:53.133 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:53.154 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:53.155 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:30:53.155 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:30:53.174 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:30:53.174 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:30:53.175 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:30:53.195 DEBUG 21740 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:30:53.195  INFO 21740 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:30:53.640  INFO 21740 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:30:53.641  INFO 21740 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:30:53.987  INFO 21740 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:30:52 GMT"],"eagleid":["77243f3017409438523987586e"],"request-id":["a939e00e-d158-4d21-ba16-7a910a72cda4"],"server":["Tengine"],"server-timing":["inner; dur=297","cdn-cache;desc=MISS,edge;dur=0,origin;dur=334"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache28.cn7330[334,0]"],"x-lgw-dst-svc":["uK9y5OhRcSSWQPv6kiJeMixEeC6n9AmIYNycmM43xsMVjf-p00DsJeV8DlbG7Kr4Gv5qok_IYB7tSSzzcqfh6xlNrz-UJcni8va-T0EtpPGxJG9FWIbFx5bIB10DfcYvORyekU0IUWEBcVQLayFWJ5dalHKgbsefHUzms2FWGg4VyNDgwN4KBWWV0cebQS2QSjnPZUnMxtB7dJxCOYUu5kBpxxghWukCzDbGvPkaAmvDHbgSJBq0tS1L2gvtn-UlmsdX8fjxRC3G7iTHeejJXWs8HjlDgusZMBUxewWIV0U75o7wCl1N5i8="],"x-request-id":["a939e00e-d158-4d21-ba16-7a910a72cda4"],"x-timestamp":["1740943852.716"],"x-tt-logid":["202503030330522EA1E253DA7113C9A184"],"x-tt-trace-host":["01c3a7f1fa315b508dfb4ec7a383e2ee71cfb69fb2aae1bab1b186e9e481ce34874afec0190057ea0f6cb7a02e432f3b9619cf8b7ffcc7e07bded731765396be3f7cde78f9080749eb423a3bf1aa534fc0252ea5fdb633f0604e425ad06c8885a0"],"x-tt-trace-id":["00-2503030330522EA1E253DA7113C9A184-7AB8DAB8268F77C5-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503030330522EA1E253DA7113C9A184","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503030330522EA1E253DA7113C9A184"}
2025-03-03 03:30:53.988  INFO 21740 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:30:54.333  INFO 21740 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:30:54.353 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:54.354 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:54.373 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:54.482 ERROR 21740 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:30:54.482  INFO 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:30:54.483  INFO 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:30:54.483 DEBUG 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:30:54.483 DEBUG 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:30:54.631  INFO 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2587e2df-8c64-4bdf-873b-dc88824e60d5
2025-03-03 03:30:54.631 DEBUG 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"2587e2df-8c64-4bdf-873b-dc88824e60d5"}},"response_mode":"blocking","conversation_id":"7319efda-c36d-4ec7-a89e-70d4fc3ac20c","user":"fyjw"}
2025-03-03 03:30:57.009  INFO 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海临港新片区鑫姚东方置业有限公司：

2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202200176383），约定您购买本公司的商铺，总价为人民币**万元。

本小区商铺为集中式商业，因贵公司逾期办理贷款，直接的或间接的又未按合同约定支付剩余购房款，现本公司正式通知您：

在正式逾期期间，即从2023年9月1日起，您应支付剩余购房款的民法定违约金。依据《商品房买卖合同》第十条约定，违约金按每日万分之五标准支付。经计算，截止2023年11月28日，您需支付的违约金为人民币**元，且违约金总额不得超过购房总价款的4.75%为止。

在该通知函发出后，您应尽快补足正式交房款，并：2023年12月8日前支付剩余款项违约金。否则，我公司将保留进一步追究您法律责任的权利！

签发人：程四合  
电话：13262793267  
杨晓瑶  
电话：15821247034  

2023年11月28日
```
2025-03-03 03:30:57.009 DEBUG 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"be509d9d-b2b8-4442-9abe-63247f0e5e64","workflow_run_id":"c4c81aa6-409a-47fa-a83e-739bfb10f6ca","data":{"id":"c4c81aa6-409a-47fa-a83e-739bfb10f6ca","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海临港新片区鑫姚东方置业有限公司：\n\n2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202200176383），约定您购买本公司的商铺，总价为人民币**万元。\n\n本小区商铺为集中式商业，因贵公司逾期办理贷款，直接的或间接的又未按合同约定支付剩余购房款，现本公司正式通知您：\n\n在正式逾期期间，即从2023年9月1日起，您应支付剩余购房款的民法定违约金。依据《商品房买卖合同》第十条约定，违约金按每日万分之五标准支付。经计算，截止2023年11月28日，您需支付的违约金为人民币**元，且违约金总额不得超过购房总价款的4.75%为止。\n\n在该通知函发出后，您应尽快补足正式交房款，并：2023年12月8日前支付剩余款项违约金。否则，我公司将保留进一步追究您法律责任的权利！\n\n签发人：程四合  \n电话：13262793267  \n杨晓瑶  \n电话：15821247034  \n\n2023年11月28日\n```"},"elapsed_time":13.761618226999417,"total_tokens":925,"total_steps":4,"created_at":1740943841,"finished_at":1740943855}}
2025-03-03 03:30:57.009  INFO 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:30:57.017 DEBUG 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, headers=Authorization: ██
Content-Type: multipart/form-data
, data="{"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}"
2025-03-03 03:30:57.083 ERROR 21740 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, code=400, headers=Server: nginx/1.27.4
Date: Sun, 02 Mar 2025 19:30:55 GMT
Content-Type: application/json
Content-Length: 92
Connection: keep-alive
Access-Control-Allow-Origin: *
X-Version: 1.0.0
X-Env: PRODUCTION
, body={"code": "invalid_param", "message": "Extra data: line 1 column 4 (char 3)", "status": 400}
, data="{"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}"
2025-03-03 03:30:57.083 ERROR 21740 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:30:57.103 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:57.104 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:57.126 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:57.243 ERROR 21740 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:30:57.245 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:57.245 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:57.265 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:57.398 ERROR 21740 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:30:57.402 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:30:57.402 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:30:57.423 DEBUG 21740 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:30:57.537 ERROR 21740 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:31:10.979  INFO 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浩澜新区金融先行示范业有限公司：

2022年9月1日与上海浩澜新区签订的《上海市商品房租赁合同》（合同编号：202200176383），合同中约定租赁期限为一年，至2023年8月31日到期。

本小区业委会反映目前合同到期后，贵公司未续约，依照合同约定及法律规定，合同到期后，承租方应立即搬离。现因贵公司未搬离，导致本小区居民无法正常使用车位，居民多次向我司投诉。

在此情况下，我司多次与贵公司沟通，要求贵公司尽快搬离并完成车位移交，但贵公司并未实际履行搬离义务。鉴于此，我司决定自2023年12月8日起，贵公司未搬离的车位恢复为小区公共车位，贵公司车位卡作废。对于贵公司未搬离的车辆占用车位，我司将按每车每日4.75元标准收取车位使用管理费。

在贵公司车辆搬离后，我司将按正式要求结算费用。

特此通知！搬离期限：2023年12月8日  

联系人：程甲金 电话：13262792367  
杨晓瑶 电话：15821247834  

2023年11月28日
```
2025-03-03 03:31:10.979 DEBUG 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"8d23e291-e027-4b75-b557-fa37f2941c50","workflow_run_id":"3c1dea9e-ef30-4efe-98fe-29bbd4493fb7","data":{"id":"3c1dea9e-ef30-4efe-98fe-29bbd4493fb7","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浩澜新区金融先行示范业有限公司：\n\n2022年9月1日与上海浩澜新区签订的《上海市商品房租赁合同》（合同编号：202200176383），合同中约定租赁期限为一年，至2023年8月31日到期。\n\n本小区业委会反映目前合同到期后，贵公司未续约，依照合同约定及法律规定，合同到期后，承租方应立即搬离。现因贵公司未搬离，导致本小区居民无法正常使用车位，居民多次向我司投诉。\n\n在此情况下，我司多次与贵公司沟通，要求贵公司尽快搬离并完成车位移交，但贵公司并未实际履行搬离义务。鉴于此，我司决定自2023年12月8日起，贵公司未搬离的车位恢复为小区公共车位，贵公司车位卡作废。对于贵公司未搬离的车辆占用车位，我司将按每车每日4.75元标准收取车位使用管理费。\n\n在贵公司车辆搬离后，我司将按正式要求结算费用。\n\n特此通知！搬离期限：2023年12月8日  \n\n联系人：程甲金 电话：13262792367  \n杨晓瑶 电话：15821247834  \n\n2023年11月28日\n```"},"elapsed_time":16.310721720103174,"total_tokens":941,"total_steps":4,"created_at":1740943853,"finished_at":1740943869}}
2025-03-03 03:31:10.979  INFO 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件到知识库: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:31:10.979 DEBUG 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, headers=Authorization: ██
Content-Type: multipart/form-data
, data="{"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}"
2025-03-03 03:31:11.014 ERROR 21740 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传失败: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, code=400, headers=Server: nginx/1.27.4
Date: Sun, 02 Mar 2025 19:31:09 GMT
Content-Type: application/json
Content-Length: 92
Connection: keep-alive
Access-Control-Allow-Origin: *
X-Version: 1.0.0
X-Env: PRODUCTION
, body={"code": "invalid_param", "message": "Extra data: line 1 column 4 (char 3)", "status": 400}
, data="{"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}"
2025-03-03 03:31:11.014 ERROR 21740 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:31:11.034 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:31:11.034 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:31:11.054 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:31:11.184 ERROR 21740 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:31:11.185 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:31:11.185 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:31:11.206 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:31:11.313 ERROR 21740 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:31:11.314 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:31:11.315 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:31:11.335 DEBUG 21740 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:31:11.448 ERROR 21740 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:31:53.267 ERROR 21740 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:31:53.267  INFO 21740 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477289757216915484&access_key=837734b7392b923144b48b2ae46c200d&service_id=33554678&ticket=7092eed5-d7e1-4df3-b1b0-fbe6505b2768 [conn_id=7477289757216915484]
2025-03-03 03:31:53.267  INFO 21740 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:32:22.166  INFO 21740 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:32:22.505  INFO 21740 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477292383927844892&access_key=c271166333f2a21bd2d639a9f80bf8d4&service_id=33554678&ticket=fc80dd3f-70ca-4459-a55d-3b4441f2bf85 [conn_id=7477292383927844892]
2025-03-03 03:34:26.166  INFO 21740 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 03:34:26.170  INFO 21740 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 03:34:31.347  INFO 32024 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 32024 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 03:34:31.349 DEBUG 32024 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 03:34:31.349  INFO 32024 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 03:34:31.770  INFO 32024 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 03:34:31.772  INFO 32024 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 03:34:31.789  INFO 32024 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 03:34:32.148  INFO 32024 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 03:34:32.152  INFO 32024 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 03:34:32.152  INFO 32024 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 03:34:32.263  INFO 32024 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 03:34:32.263  INFO 32024 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 886 ms
2025-03-03 03:34:32.531  INFO 32024 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 03:34:32.532  INFO 32024 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 03:34:33.180  INFO 32024 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 03:34:33.287  INFO 32024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409715974145&access_key=3011a39cfe2c99a44b7d3db8d174ed34&service_id=33554678&ticket=c3592ae6-25c2-42ee-8f02-a870ba843245 [conn_id=7477290409715974145]
2025-03-03 03:34:33.603  INFO 32024 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 03:34:33.610  INFO 32024 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.556 seconds (JVM running for 3.071)
2025-03-03 03:34:36.332  INFO 32024 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740944074}
2025-03-03 03:34:36.368  WARN 32024 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @7f3b84b8
2025-03-03 03:34:36.375  INFO 32024 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 03:34:36.619  INFO 32024 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 03:34:36.624 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:36.639 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:36.676 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:36.681 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:34:36.682 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:34:36.703 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:34:36.704 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:34:36.704 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:34:36.726 DEBUG 32024 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:34:36.726  INFO 32024 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:34:37.398  INFO 32024 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:34:37.399  INFO 32024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:34:37.925  INFO 32024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:34:36 GMT"],"eagleid":["7abfaab017409440761561036e"],"request-id":["0e1773c1-81f2-45d3-b9a2-55890f3cc872"],"server":["Tengine"],"server-timing":["inner; dur=367","cdn-cache;desc=MISS,edge;dur=0,origin;dur=396"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache28.cn6553[396,0]"],"x-lgw-dst-svc":["1N4mQndaxbJTV6-sv7ws_bBsGFagdPSJBni-CZzrzgxTU9QUIjhy580XQAKdPu0fGDvER_gi16AnWjQNsg3MSI3u30rBaU6gEbmmO_sxrr30eXG__dfJQ1PgGrySPYe4C-iboD-0q3PO-5Ag6Gq3hyBRGw4CncdRQPJT8xCzOcs697dUZXGmNPcBYSI41Tle3-7cD4VKlg0rBkyYV1FhXONXKpe5GJ-7FFClz_jL3R7Sb5QrEoYoFcoA4oitZLdFsWF9-plG-i-ij87H5Idwpgy8nHzESq5x0gd4RjP7FigmbWr-kr0a0A=="],"x-request-id":["0e1773c1-81f2-45d3-b9a2-55890f3cc872"],"x-timestamp":["1740944076.536"],"x-tt-logid":["20250303033436A5B5232640A880C20903"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64e9110f2703a580212fe26992697b3c3c4d9498a66737e052cdeb6d64a4f3375f2bb1305ebbc5c2daffaa786ad54e2453d232644b382ef8d64ca2b56952edab37df399e68301082c45a79f8d974eb7076"],"x-tt-trace-id":["00-250303033436A5B5232640A880C20903-11AAA1D13B54102B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303033436A5B5232640A880C20903","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303033436A5B5232640A880C20903"}
2025-03-03 03:34:37.926  INFO 32024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:34:38.305  INFO 32024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:34:38.326 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:38.327 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:38.347 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:38.462 ERROR 32024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:38.463  INFO 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:34:38.463  INFO 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:34:38.464 DEBUG 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:34:38.465 DEBUG 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:34:38.661  INFO 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=e5567da5-d72f-4801-ba23-cecf2de7c990
2025-03-03 03:34:38.661 DEBUG 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"e5567da5-d72f-4801-ba23-cecf2de7c990"}},"response_mode":"blocking","conversation_id":"50809526-a590-4fd6-a0ef-3657b925feb8","user":"fyjw"}
2025-03-03 03:34:46.211  INFO 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知

上海浩港新区金港苑开发实业有限公司：

2022年9月1日与本公司签署的《上海市商品房预售合同》（合同编号：202200176383），因贵司未能按合同约定及时支付购房款。

本小区原定交房时间为2023年12月8日，因贵公司未及时支付购房款，本公司在收取贵司购房款后方可进行后续装修、竣工验收、办理交房手续等相关工作，导致交付周期延迟。

在此情况下，如贵公司于2023年12月8日前未能支付剩余购房款款项，则本公司将依照合同约定，按日向贵公司收取剩余购房款4.75%滞纳金（滞纳金按日计算）。

在该通知发出后，贵司应尽快履行合同义务。请于2023年12月8日前将全部购房款交至以下账号，否则本公司将依照合同约定追究贵公司的违约责任。

收款人姓名：程四合  
开户行：XX银行  
账号：13262792367  

杨晓丽 电话：15821247367

2023年11月28日
```
2025-03-03 03:34:46.212 DEBUG 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"82460379-a3a0-478c-9410-8d78f2010839","workflow_run_id":"b35dc8f7-7ec8-497b-8dd2-c34d062525b3","data":{"id":"b35dc8f7-7ec8-497b-8dd2-c34d062525b3","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知\n\n上海浩港新区金港苑开发实业有限公司：\n\n2022年9月1日与本公司签署的《上海市商品房预售合同》（合同编号：202200176383），因贵司未能按合同约定及时支付购房款。\n\n本小区原定交房时间为2023年12月8日，因贵公司未及时支付购房款，本公司在收取贵司购房款后方可进行后续装修、竣工验收、办理交房手续等相关工作，导致交付周期延迟。\n\n在此情况下，如贵公司于2023年12月8日前未能支付剩余购房款款项，则本公司将依照合同约定，按日向贵公司收取剩余购房款4.75%滞纳金（滞纳金按日计算）。\n\n在该通知发出后，贵司应尽快履行合同义务。请于2023年12月8日前将全部购房款交至以下账号，否则本公司将依照合同约定追究贵公司的违约责任。\n\n收款人姓名：程四合  \n开户行：XX银行  \n账号：13262792367  \n\n杨晓丽 电话：15821247367\n\n2023年11月28日\n```"},"elapsed_time":7.4870320041663945,"total_tokens":909,"total_steps":4,"created_at":1740944077,"finished_at":1740944084}}
2025-03-03 03:34:46.212  INFO 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:34:46.212 DEBUG 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/documents/create-by-file, fileName=程阿金和解通知.jpg
2025-03-03 03:34:46.250 ERROR 32024 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:126) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 03:34:46.250 ERROR 32024 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:34:46.271 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:46.273 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:46.294 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:46.409  INFO 32024 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740944069}
2025-03-03 03:34:46.411 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:46.412 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:46.434 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:46.434 ERROR 32024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:46.434 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:34:46.434 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:34:46.457 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:34:46.458 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 03:34:46.458 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 03:34:46.460 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:46.461 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:46.479 DEBUG 32024 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 03:34:46.480  INFO 32024 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 03:34:46.485 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:46.589 ERROR 32024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:46.595 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:46.596 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:46.620 DEBUG 32024 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:46.758 ERROR 32024 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:46.934  INFO 32024 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:34:46.935  INFO 32024 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 03:34:47.271  INFO 32024 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Sun, 02 Mar 2025 19:34:46 GMT"],"eagleid":["7abfaab017409440856916878e"],"request-id":["b760dcd2-a859-4f21-bed6-5b980a94f472"],"server":["Tengine"],"server-timing":["inner; dur=288","cdn-cache;desc=MISS,edge;dur=0,origin;dur=325"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache28.cn6553[325,0]"],"x-lgw-dst-svc":["bIfvOyXBdpARbZ2cel3d3SyAh-JxYNXooViw8fzH_Lu9lBfwBz49lXXIyyzJfzjegHnE8aMZ7gCZnGpQnN36UQocVxjIJsp_CQi0wDMiCe33Gz--NeCOlQteFKBYG9MOBnK-HhWzp61_XQw_zQJgGUg1nysLYrHwps_A_wP13IlnfTjZQe1lryPuaah7jt4V_UzicZxHh7MaV8Ja13D8wFeTHSybeTMKyir_PADkGElksoaVEzALINdJxsCILHxRQfoUnySJ4-JqbFP3_x5bNMIjsVsFMXwvPcORGQsFkoD90ZbduHRlAg=="],"x-request-id":["b760dcd2-a859-4f21-bed6-5b980a94f472"],"x-timestamp":["1740944086.000"],"x-tt-logid":["2025030303344591A66713BB47F9BBF602"],"x-tt-trace-host":["01c73a59bb8f99cb8cf5bf3a12d4d1ba64ae76313404ff636cbf333573314af7120654a38442c19e0ebaecc5ece434b215188b5a25da99108c613618aa2b9f986d03105ac3e695dbd31397c02fb7499e15506e6cc66f2a0c2dc6dc229a23f75eca"],"x-tt-trace-id":["00-25030303344591A66713BB47F9BBF602-4954108D4AC8670C-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030303344591A66713BB47F9BBF602","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030303344591A66713BB47F9BBF602"}
2025-03-03 03:34:47.271  INFO 32024 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 03:34:47.648  INFO 32024 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 03:34:47.671 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:47.672 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:47.693 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:47.805 ERROR 32024 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:47.806  INFO 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 03:34:47.806  INFO 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 03:34:47.807 DEBUG 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 03:34:47.807 DEBUG 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 03:34:47.888  INFO 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=4c34adab-30b3-4290-8668-b75ebb43f122
2025-03-03 03:34:47.888 DEBUG 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"4c34adab-30b3-4290-8668-b75ebb43f122"}},"response_mode":"blocking","conversation_id":"cacf7a09-b677-4177-bc5f-2290e8338825","user":"fyjw"}
2025-03-03 03:34:55.897  INFO 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海临港新片区鑫姚东方置业有限公司：

2022年9月订立的贵司与我司签署的《上海市商品房预售合同》（合同编号：202200176383），约定贵司所购商品房为 **洋房8号楼**。

本小区现房验收备案已完成，贵司所购房屋现房状态，危房的户又发现外墙渗水、墙体开裂等质量问题。贵司所购房屋工程质量存在严重问题，侵犯了购房人的合法权益。

在正式验收中，我司发现贵司所购房屋外立面质量问题已严重违反国家住宅质量规范及相关规定，要求贵司立即采取有效整改措施并对相关问题做详细说明。若贵司拒绝整改，我司将保留法律诉讼权利及向贵司索赔一切损失。鉴于贵司贷款资金占用我司，目前贵司所购房屋按揭利率 4.75% 不超过还款额。

在该通知发出后，请贵司按时正式完成整改，时间：2023年12月8日之前完成整改并答复我司，否则视为贵司放弃购房资格。

联系人：程甲云  
电话：13262792367  
杨晓强  
电话：15821247034  

2023年11月28日
```

2025-03-03 03:34:55.897 DEBUG 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c7d9528d-09db-4b08-b2f9-bd2075b4ce68","workflow_run_id":"e6499c30-bd4c-43e1-99eb-39029aeb68ff","data":{"id":"e6499c30-bd4c-43e1-99eb-39029aeb68ff","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海临港新片区鑫姚东方置业有限公司：\n\n2022年9月订立的贵司与我司签署的《上海市商品房预售合同》（合同编号：202200176383），约定贵司所购商品房为 **洋房8号楼**。\n\n本小区现房验收备案已完成，贵司所购房屋现房状态，危房的户又发现外墙渗水、墙体开裂等质量问题。贵司所购房屋工程质量存在严重问题，侵犯了购房人的合法权益。\n\n在正式验收中，我司发现贵司所购房屋外立面质量问题已严重违反国家住宅质量规范及相关规定，要求贵司立即采取有效整改措施并对相关问题做详细说明。若贵司拒绝整改，我司将保留法律诉讼权利及向贵司索赔一切损失。鉴于贵司贷款资金占用我司，目前贵司所购房屋按揭利率 4.75% 不超过还款额。\n\n在该通知发出后，请贵司按时正式完成整改，时间：2023年12月8日之前完成整改并答复我司，否则视为贵司放弃购房资格。\n\n联系人：程甲云  \n电话：13262792367  \n杨晓强  \n电话：15821247034  \n\n2023年11月28日\n```\n"},"elapsed_time":7.936817970126867,"total_tokens":937,"total_steps":4,"created_at":1740944086,"finished_at":1740944094}}
2025-03-03 03:34:55.898  INFO 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg
2025-03-03 03:34:55.898 DEBUG 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/documents/create-by-file, fileName=程阿金和解通知.jpg
2025-03-03 03:34:55.931 ERROR 32024 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:126) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeImage(FeishuFolderServiceImpl.java:384) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:246) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 03:34:55.932 ERROR 32024 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 程阿金和解通知.jpg
2025-03-03 03:34:55.952 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:55.953 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:55.974 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:56.095 ERROR 32024 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:56.097 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:56.097 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:56.118 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:56.232 ERROR 32024 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:34:56.233 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 03:34:56.233 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 03:34:56.254 DEBUG 32024 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 03:34:56.364 ERROR 32024 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 03:35:46.331 ERROR 32024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 03:35:46.331  INFO 32024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409715974145&access_key=3011a39cfe2c99a44b7d3db8d174ed34&service_id=33554678&ticket=c3592ae6-25c2-42ee-8f02-a870ba843245 [conn_id=7477290409715974145]
2025-03-03 03:35:46.331  INFO 32024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 03:36:12.359  INFO 32024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 03:36:12.740  INFO 32024 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477290409716187137&access_key=26dbb363362159c9b810f615086ab355&service_id=33554678&ticket=72b844e6-0250-4ab3-a609-c8445555e4c8 [conn_id=7477290409716187137]
2025-03-03 10:53:56.621  INFO 3340 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 3340 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 10:53:56.624 DEBUG 3340 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 10:53:56.624  INFO 3340 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 10:53:57.096  INFO 3340 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 10:53:57.097  INFO 3340 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 10:53:57.125  INFO 3340 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 0 Redis repository interfaces.
2025-03-03 10:53:57.644  INFO 3340 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 10:53:57.654  INFO 3340 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 10:53:57.655  INFO 3340 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 10:53:57.775  INFO 3340 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 10:53:57.775  INFO 3340 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1120 ms
2025-03-03 10:53:57.994  INFO 3340 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 10:53:57.994  INFO 3340 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 10:53:58.549  INFO 3340 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 10:53:58.774  INFO 3340 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477407763767033857&access_key=5a17119ad73cbfa5d4a6c2537a02d70c&service_id=33554678&ticket=9034848f-297f-4e18-ad52-8dc2ce7fcc5d [conn_id=7477407763767033857]
2025-03-03 10:53:58.882  INFO 3340 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 10:53:58.887  INFO 3340 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.502 seconds (JVM running for 3.033)
2025-03-03 10:54:03.538 ERROR 3340 --- [pool-2-thread-2] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: c09cf2fa-50ca-4857-865e-9d54534a45cd, trace_id: 1f974e5b51e9d071933197a3f6796940, [conn_id=7477407763767033857]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 10:54:04.664  INFO 3340 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740970442}
2025-03-03 10:54:04.692  WARN 3340 --- [pool-2-thread-3] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @158d2680
2025-03-03 10:54:04.698  INFO 3340 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 10:54:04.971  INFO 3340 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 10:54:04.974 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 10:54:04.985 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 10:54:05.017 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 10:54:05.019 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 10:54:05.019 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 10:54:05.041 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 10:54:05.041 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 10:54:05.041 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 10:54:05.061 DEBUG 3340 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 10:54:05.061  INFO 3340 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 10:54:05.955  INFO 3340 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 10:54:05.957  INFO 3340 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 10:54:06.624  INFO 3340 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 02:54:04 GMT"],"eagleid":["74c4871817409704442052154e"],"request-id":["64a7ab66-9487-45e0-8bdd-cbb1259154e0"],"server":["Tengine"],"server-timing":["inner; dur=540","cdn-cache;desc=MISS,edge;dur=0,origin;dur=567"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache19.cn7535[567,0]"],"x-lgw-dst-svc":["7Pz8h1_SDWTjT4KAWYTD8YVkKV3CQ31SWcWFHoRiyfv1dQiTn-X0-_iU5TCtvTnKLUaaL21-kVAViAPbywobTvTBCQvF59Pn1i4vs5xOhppUPqnjcBzuZSH0lDbG8V_X1a2z3W1nzJ-dWVYRGvy8pBNzajFsjeVLXvi3_SAoi5Xld0h7pUN07JaU_mEsOljDtuglWwR1OX3iZTWWEwV2i1WKXdf-_1zADT0WmacpWNaYLozHM1Xw0OB6kw_OTtNfHyZvumScnxQ8AAAUOBCa39D9SBwuwJp0nZDNMVvrdNB79mdUs1WsLvU="],"x-request-id":["64a7ab66-9487-45e0-8bdd-cbb1259154e0"],"x-timestamp":["1740970444.763"],"x-tt-logid":["20250303105404B7527A39E8C3F6E1D0D0"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be2236ae61fb6bafb136d41fd3b7547bf55f795b188034b6487e1aae2f54588a8bae5a720aaa9bb499723c6c5e24513baf896845dbaacd4d7375d46d2b031e09a907742efc82dff1b6c9014dd5d7c30ba5"],"x-tt-trace-id":["00-250303105404B7527A39E8C3F6E1D0D0-06E6F66612D14440-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303105404B7527A39E8C3F6E1D0D0","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303105404B7527A39E8C3F6E1D0D0"}
2025-03-03 10:54:06.625  INFO 3340 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 10:54:07.072  INFO 3340 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 10:54:07.097 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 10:54:07.097 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 10:54:07.120 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 10:54:07.300 ERROR 3340 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 10:54:07.300  INFO 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 10:54:07.300  INFO 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 10:54:07.302 DEBUG 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 10:54:07.302 DEBUG 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 10:54:07.567  INFO 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f5acdf46-a1b7-4756-b396-d9cf7f127f08
2025-03-03 10:54:07.568 DEBUG 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f5acdf46-a1b7-4756-b396-d9cf7f127f08"}},"response_mode":"blocking","conversation_id":"746d51a4-5a1d-4f87-a018-ac3708772b3e","user":"fyjw"}
2025-03-03 10:54:19.122 ERROR 3340 --- [pool-2-thread-4] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: d9371dc3-b179-40d7-b2e4-1b9044179573, trace_id: 1f974e5b51e9d071933197a3f6796940, [conn_id=7477407763767033857]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 10:54:23.686  INFO 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海临港新片区鑫姚东方置业有限公司：

2022年9月1日与贵司签订的《上海市商品房买卖合同》（合同编号：202200176383），约定购房款首付款金额为人民币壹佰零捌万元整。

本人与贵司签订合同后，因疫情原因导致收入减少、征信的再次更新以及再次申贷政策变化等多重因素，导致贷款金额不足，未能全额支付购房款项。经多次调整贷款方案，仍无法满足贵司要求的余款支付，且前期支付的订金、首付款共计人民币壹拾伍万元整已超出我本人的支付能力范围。

在无法满足贵司所要求的支付条件情况下，本人已向贵司提出退房申请，取消合同的履行，并愿意承担贵司要求的违约责任，按合同约定支付合同总价款4.75%承担违约责任。

在退房申请获得贵司批准正式受理前，即：2023年12月8日前，若贵司有其他补充的解决方案，本人愿意积极配合并全力支持。

特此函告！

联系人：程甲乙  
联系电话：13262792367  
杨晓瑶：15821247364  

2023年11月28日
```
2025-03-03 10:54:23.686 DEBUG 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"805986e5-1d7b-40ab-848b-4688cff71a78","workflow_run_id":"62e6ec82-9878-4717-8348-4fbfc24aca87","data":{"id":"62e6ec82-9878-4717-8348-4fbfc24aca87","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海临港新片区鑫姚东方置业有限公司：\n\n2022年9月1日与贵司签订的《上海市商品房买卖合同》（合同编号：202200176383），约定购房款首付款金额为人民币壹佰零捌万元整。\n\n本人与贵司签订合同后，因疫情原因导致收入减少、征信的再次更新以及再次申贷政策变化等多重因素，导致贷款金额不足，未能全额支付购房款项。经多次调整贷款方案，仍无法满足贵司要求的余款支付，且前期支付的订金、首付款共计人民币壹拾伍万元整已超出我本人的支付能力范围。\n\n在无法满足贵司所要求的支付条件情况下，本人已向贵司提出退房申请，取消合同的履行，并愿意承担贵司要求的违约责任，按合同约定支付合同总价款4.75%承担违约责任。\n\n在退房申请获得贵司批准正式受理前，即：2023年12月8日前，若贵司有其他补充的解决方案，本人愿意积极配合并全力支持。\n\n特此函告！\n\n联系人：程甲乙  \n联系电话：13262792367  \n杨晓瑶：15821247364  \n\n2023年11月28日\n```"},"elapsed_time":15.35784431709908,"total_tokens":925,"total_steps":4,"created_at":1740970445,"finished_at":1740970461}}
2025-03-03 10:54:23.687  INFO 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1152
2025-03-03 10:54:23.687 DEBUG 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 10:54:23.797  INFO 3340 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"f28e0c42-2e85-4b15-86c2-54a070efe24f"},"data_source_detail_dict":{"upload_file":{"id":"f28e0c42-2e85-4b15-86c2-54a070efe24f","name":"程阿金和解通知.md","size":1152,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970461.969589}},"dataset_process_rule_id":"47b442cb-e817-47ca-ad23-35972c3305da","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":0,"indexing_status":"parsing","enabled":true,"archived":false,"display_status":"indexing","word_count":0,"hit_count":0,"doc_form":"text_model"},"batch":"20250303025421832870"}
2025-03-03 10:54:23.798  INFO 3340 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 10:54:23.820 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 10:54:23.820 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 10:54:23.842 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 10:54:23.981 ERROR 3340 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 10:54:23.982 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 10:54:23.982 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 10:54:24.004 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 10:54:24.219 ERROR 3340 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 10:54:24.222 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 10:54:24.223 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 10:54:24.244 DEBUG 3340 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 10:54:24.443 ERROR 3340 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 10:59:19.814 ERROR 3340 --- [pool-2-thread-7] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: e35acd04-eb0b-4809-8f1e-b47fe5e30d40, trace_id: 1f974e5b51e9d071933197a3f6796940, [conn_id=7477407763767033857]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:22:31.639  INFO 28256 --- [main] em.backend.BackendApplicationTests       : Starting BackendApplicationTests using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 28256 (started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:22:31.639 DEBUG 28256 --- [main] em.backend.BackendApplicationTests       : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:22:31.639  INFO 28256 --- [main] em.backend.BackendApplicationTests       : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:22:31.982  INFO 28256 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:22:31.983  INFO 28256 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:22:31.999  INFO 28256 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 11:22:32.466  INFO 28256 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:22:32.467  INFO 28256 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key Ѽ: 
2025-03-03 11:22:33.320  INFO 28256 --- [main] e.b.controller.FeishuEventController     : ¼
2025-03-03 11:22:33.545  INFO 28256 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477414539122163713&access_key=9cf266d77c79e75aac87e12a10d25108&service_id=33554678&ticket=c62352b9-f14c-482f-9de7-a6f7d3a527f1 [conn_id=7477414539122163713]
2025-03-03 11:22:33.936  INFO 28256 --- [main] em.backend.BackendApplicationTests       : Started BackendApplicationTests in 2.476 seconds (JVM running for 2.943)
2025-03-03 11:23:57.016  INFO 3340 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:23:57.017  INFO 3340 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:23:59.367  INFO 31864 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 31864 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:23:59.368 DEBUG 31864 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:23:59.368  INFO 31864 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:23:59.629  INFO 31864 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:23:59.630  INFO 31864 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:23:59.642  INFO 31864 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 11:23:59.895  INFO 31864 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:23:59.902  INFO 31864 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:23:59.903  INFO 31864 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:23:59.979  INFO 31864 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:23:59.980  INFO 31864 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 592 ms
2025-03-03 11:24:00.139  INFO 31864 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:24:00.139  INFO 31864 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:24:00.719  INFO 31864 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:24:00.971  INFO 31864 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477416661949513756&access_key=c757097db40de0f00f4e191da3ade5f5&service_id=33554678&ticket=0792960d-98b4-4136-b074-92fd28b73eab [conn_id=7477416661949513756]
2025-03-03 11:24:01.011  INFO 31864 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:24:01.016  INFO 31864 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.824 seconds (JVM running for 2.14)
2025-03-03 11:24:38.766  INFO 31864 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740972276}
2025-03-03 11:24:38.790  WARN 31864 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 11:24:38.797  INFO 31864 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:24:39.098  INFO 31864 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:24:39.103 DEBUG 31864 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 11:24:39.113 DEBUG 31864 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:24:39.154 DEBUG 31864 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 11:24:39.161 DEBUG 31864 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:24:39.161 DEBUG 31864 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:24:39.187 DEBUG 31864 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:24:41.188  INFO 31864 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"case_overview","timestamp":1740972279}
2025-03-03 11:24:41.213 DEBUG 31864 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 11:24:41.214 DEBUG 31864 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:24:41.239 DEBUG 31864 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 11:24:41.240 DEBUG 31864 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:24:41.240 DEBUG 31864 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:24:41.344 DEBUG 31864 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:24:44.673  INFO 31864 --- [pool-2-thread-4] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14191646f559d758","user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"},"token":"c-1817f6d10e0005e3c6849a2025eb452f8047a52d","action":{"tag":"button","timezone":"Asia/Shanghai","name":"case_overview_callback","form_value":{"Select_case":"19"}},"host":"im_message","context":{"open_message_id":"om_ee2b11e2b23d1ba4e11232f35b63553a","open_chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac"}},"schema":"2.0","header":{"event_id":"0ae4148651528107e2a671966ebb87e7","event_type":"card.action.trigger","app_id":"cli_a73c62ce90b0d013","tenant_key":"14191646f559d758","create_time":"1740972282880673","token":"za3iBwmP42XM4YMo9z0tq1OgMlRAG7tc"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,48,97,101,52,49,52,56,54,53,49,53,50,56,49,48,55,101,50,97,54,55,49,57,54,54,101,98,98,56,55,101,55,34,44,34,116,111,107,101,110,34,58,34,122,97,51,105,66,119,109,80,52,50,88,77,52,89,77,111,57,122,48,116,113,49,79,103,77,108,82,65,71,55,116,99,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,50,56,50,56,56,48,54,55,51,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,125,44,34,116,111,107,101,110,34,58,34,99,45,49,56,49,55,102,54,100,49,48,101,48,48,48,53,101,51,99,54,56,52,57,97,50,48,50,53,101,98,52,53,50,102,56,48,52,55,97,53,50,100,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,49,57,34,125,44,34,110,97,109,101,34,58,34,99,97,115,101,95,111,118,101,114,118,105,101,119,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,101,101,50,98,49,49,101,50,98,50,51,100,49,98,97,52,101,49,49,50,51,50,102,51,53,98,54,51,53,53,51,97,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,125,125,125],"headers":{}}}
2025-03-03 11:24:44.673  INFO 31864 --- [pool-2-thread-4] em.backend.handler.CardEventHandler      : 案件总览选择的案件ID: 19
2025-03-03 11:24:44.697 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:24:44.697 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:24:44.721 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:24:44.802 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-03-03 11:24:44.802 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:24:44.932 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-03-03 11:24:44.934 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-03-03 11:24:44.934 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 19(Long), 创建知识库test2(String), ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:24:45.136 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-03-03 11:24:45.343 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:24:45.343 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:24:45.725 DEBUG 31864 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:25:52.434  INFO 31864 --- [pool-2-thread-5] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740972350}
2025-03-03 11:25:52.471 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:25:52.471 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:25:52.497 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:25:52.498 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:25:52.498 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:25:52.533 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:25:52.533 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:25:52.534 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:25:52.557 DEBUG 31864 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:25:52.557  INFO 31864 --- [pool-2-thread-5] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:25:53.311  INFO 31864 --- [pool-2-thread-5] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:25:53.312  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:25:53.850  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:25:51 GMT"],"eagleid":["1bde140817409723515764859e"],"request-id":["661a1dca-897f-4f12-8407-e2a8ecdec0a1"],"server":["Tengine"],"server-timing":["inner; dur=409","cdn-cache;desc=MISS,edge;dur=0,origin;dur=467"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache4.cn6725[467,0]"],"x-lgw-dst-svc":["1XBOsy65_QD4Jg43ob8IYdxr4ugmgIhHUQaeiN99Sm8iWz9iWsLCTFN41bhLuK2rN_XK_QmVp0MyDpXAH91AMz5HdgLEB9HFUl3wL7cxhSeswcDHrBSIm0CF0Ip4IEc_fPyWXkNs7dlhLRRMvt4bWy7WnRXZ5figHEOo6VZxFhS8ktKZ7yt3LGqZ2Gh_XvhGchq9QP45ZIRFVUXcQYtnX8CRUYbg40jk-Won4_cWOqrQJ3inS61rrf_KpEwIkRMidFXz-u2Q4gK4vL7pQQZbM5wcd2swa6mjL2rbuo2I6qfYaBkM7l7iBtU="],"x-request-id":["661a1dca-897f-4f12-8407-e2a8ecdec0a1"],"x-timestamp":["1740972351.999"],"x-tt-logid":["20250303112551CE128C5B49255DE336A1"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e98bca4eb7bc5c6916f9c48281415037d51d1b589e3e2666bb9228a24e39753c14dd437563a1a4ed415ca261ce3a9fd3d60be547f63a80677b7b6dce47da1bd15a4662801418764551067661f23fcaf1937"],"x-tt-trace-id":["00-250303112551CE128C5B49255DE336A1-6CF21F52612C07C3-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303112551CE128C5B49255DE336A1","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303112551CE128C5B49255DE336A1"}
2025-03-03 11:25:53.850  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:25:54.543  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:25:54.593 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:25:54.594 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:25:54.619 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:25:54.791 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:25:54.791  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:25:54.791  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:25:54.793 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:25:54.794 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:25:55.022  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=61b95862-4aac-4076-a127-ecb101d5ef65
2025-03-03 11:25:55.022 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"61b95862-4aac-4076-a127-ecb101d5ef65"}},"response_mode":"blocking","conversation_id":"9214aec3-779c-48c9-b842-887b1ae94df2","user":"fyjw"}
2025-03-03 11:25:55.069 ERROR 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:245) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:280) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:25:55.070  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:25:55.070 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:25:55.070 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:25:55.097 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:25:55.267 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:25:56.436  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:25:56.436  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:25:56.436 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:25:56.436 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:25:56.665  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=6d77fcb4-ca10-495b-9819-e9060acd1ae0
2025-03-03 11:25:56.665 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"6d77fcb4-ca10-495b-9819-e9060acd1ae0"}},"response_mode":"blocking","conversation_id":"d7133ce5-d53e-42ee-a4f2-a2c41f6badc3","user":"fyjw"}
2025-03-03 11:26:19.538  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制
```
2025-03-03 11:26:19.538 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"614a88ef-458d-4a2d-ba29-3d542d56d031","workflow_run_id":"dbd2a8b8-383a-41ec-aa40-51f672702bbf","data":{"id":"dbd2a8b8-383a-41ec-aa40-51f672702bbf","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制\n```"},"elapsed_time":22.802312234882265,"total_tokens":648,"total_steps":4,"created_at":1740972354,"finished_at":1740972377}}
2025-03-03 11:26:20.727  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:26:20.727  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:26:20.727 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:26:20.727 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:26:21.798  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=74b1d7fb-fcdf-4287-b684-920d89a1bf7f
2025-03-03 11:26:21.798 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"74b1d7fb-fcdf-4287-b684-920d89a1bf7f"}},"response_mode":"blocking","conversation_id":"ad99c545-c50d-409f-a9ee-761251f57717","user":"fyjw"}
2025-03-03 11:28:09.047 ERROR 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:258) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:280) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:28:09.049  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=96
2025-03-03 11:28:09.049 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:28:09.145  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"b6118d52-d9a3-4200-be7d-f0a58f1b705f"},"data_source_detail_dict":{"upload_file":{"id":"b6118d52-d9a3-4200-be7d-f0a58f1b705f","name":"东九交付许可证.md","size":96,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487.319056}},"dataset_process_rule_id":"77af8317-b180-4ef7-8efb-8fd2d582e988","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":43,"hit_count":0,"doc_form":"text_model"},"batch":"20250303032807456678"}
2025-03-03 11:28:09.145  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 11:28:09.174 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:28:09.175 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:28:09.202 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:28:09.467 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:28:09.469 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:28:09.469 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:28:09.496 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:28:09.664 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:28:10.137  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:28:10.163 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:28:10.164 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:28:10.188 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:28:10.338 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:28:10.340  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:28:10.340  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 11:28:10.340 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:28:10.341 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:28:10.415  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=3c2a99cf-9087-46f7-96f9-4d7c526073f1
2025-03-03 11:28:10.415 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"3c2a99cf-9087-46f7-96f9-4d7c526073f1"}},"response_mode":"blocking","conversation_id":"6267561e-9e30-4ee1-a9f0-a9bb5eec9fa5","user":"fyjw"}
2025-03-03 11:28:10.498 ERROR 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:245) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:280) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:28:10.500  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:28:10.501 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:28:10.501 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:28:10.527 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:28:10.718 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:28:10.971  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png
2025-03-03 11:28:10.971  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, userId=system
2025-03-03 11:28:10.972 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:28:10.972 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:28:11.089  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=122f9f61-4acd-4f26-9746-f067934759e5
2025-03-03 11:28:11.089 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"122f9f61-4acd-4f26-9746-f067934759e5"}},"response_mode":"blocking","conversation_id":"9c9e66dc-71d4-42a3-8a4e-7a35deebe42f","user":"fyjw"}
2025-03-03 11:28:45.411  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, text=```markdown
# 2024 届高三命题专项大赛真题

## 一. 完形填空（从括号里选择的词语或用一个单词填空完成句子。共10题，每题2分）

1. I have confidence ______ (succeed) in my future.

2. ______ (What/How) beautiful the East Lake is!

3. John ______ (be/is/are) familiar with Chinese culture.

4. There are ______ (much/many) ways to help others.

5. I have not seen the girl since I ______ (have/has/had) seen the sea.

6. I’m sure he will come ______ (before/if) you return on time.

7. Team lend my bike to you after he ______ (great/greatly) changed the way of thinking.

8. When you were young, Dad often ______ (took/take) me to the museum.

9. It has been announced that the project ______ (would/will) begin next month.

10. The source of life is ______ (Water/Fire).

---
## 二. 填空题

11. My family ______ (reading books / enjoy) ______.

12. The beauty around you is for you to ______ (discover / enjoy).

13. He was sold / should / to realize our dreams / achieve. ______.

14. ______ was translated into his / book / last year / French. ______.
```

**Note:** Please fill in the blanks as per the intended meaning of the text.
2025-03-03 11:28:45.411 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"4141fc6a-9fc3-49bc-8d6f-956f0ef0fbe1","workflow_run_id":"d4ae6409-a759-42ef-888b-1b2df42b37cf","data":{"id":"d4ae6409-a759-42ef-888b-1b2df42b37cf","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 2024 届高三命题专项大赛真题\n\n## 一. 完形填空（从括号里选择的词语或用一个单词填空完成句子。共10题，每题2分）\n\n1. I have confidence ______ (succeed) in my future.\n\n2. ______ (What/How) beautiful the East Lake is!\n\n3. John ______ (be/is/are) familiar with Chinese culture.\n\n4. There are ______ (much/many) ways to help others.\n\n5. I have not seen the girl since I ______ (have/has/had) seen the sea.\n\n6. I’m sure he will come ______ (before/if) you return on time.\n\n7. Team lend my bike to you after he ______ (great/greatly) changed the way of thinking.\n\n8. When you were young, Dad often ______ (took/take) me to the museum.\n\n9. It has been announced that the project ______ (would/will) begin next month.\n\n10. The source of life is ______ (Water/Fire).\n\n---\n## 二. 填空题\n\n11. My family ______ (reading books / enjoy) ______.\n\n12. The beauty around you is for you to ______ (discover / enjoy).\n\n13. He was sold / should / to realize our dreams / achieve. ______.\n\n14. ______ was translated into his / book / last year / French. ______.\n```\n\n**Note:** Please fill in the blanks as per the intended meaning of the text."},"elapsed_time":34.18520577903837,"total_tokens":700,"total_steps":4,"created_at":1740972489,"finished_at":1740972523}}
2025-03-03 11:28:45.693  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png
2025-03-03 11:28:45.693  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, userId=system
2025-03-03 11:28:45.694 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:28:45.694 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:28:45.804  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=6ddede2c-e174-45cc-ab01-0ce066377845
2025-03-03 11:28:45.804 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"6ddede2c-e174-45cc-ab01-0ce066377845"}},"response_mode":"blocking","conversation_id":"f1db17f9-f809-4528-a371-721da308d309","user":"fyjw"}
2025-03-03 11:28:55.810  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, text=```markdown
16. has attracted / more and more people / Life in the countryside

---

### 三、阅读理解（根据文章内容完成填空，每空词数不限），共 2 篇 10 题，每题 2 分

---

#### Passage 1

**Kids Need Free Play**

**Who:** Giving our kids time to play is not a choice but a ______(1)______.

**Why:** It is important to improve the ______(2)______ social, emotional and well-being of children and youth.

**What:** Parents should _____(3)_____ free play. The word "free" means both "no _____(4)_____" and "with no _____(5)_____".

**Why:** Free play enables kids to ______(6)______ with others and learn important social skills.

---

#### Passage 2

**Keep an Eye on Giraffes**

**What:** Giraffes are quietly ______(7)______ because of this the GCF decided to work with African Parks. Their goal is to find. GPS collars make it easier to keep an eye on giraffes but they only last ______(8)______ on for long.

**How:** New tracking devices, which are also ______(9)______ solar-powered, and don’t ______(10)______ their necks, are used to stop illegal hunting to keep giraffes safe.

---

### 四、阅读理解（根据文章内容完成填空），共 2 题，每题 2 分
```
2025-03-03 11:28:55.811 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c7655cab-3f98-40f8-bdc7-ea33b91c5733","workflow_run_id":"a58c72cf-aa64-4363-b305-fe605343429c","data":{"id":"a58c72cf-aa64-4363-b305-fe605343429c","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n16. has attracted / more and more people / Life in the countryside\n\n---\n\n### 三、阅读理解（根据文章内容完成填空，每空词数不限），共 2 篇 10 题，每题 2 分\n\n---\n\n#### Passage 1\n\n**Kids Need Free Play**\n\n**Who:** Giving our kids time to play is not a choice but a ______(1)______.\n\n**Why:** It is important to improve the ______(2)______ social, emotional and well-being of children and youth.\n\n**What:** Parents should _____(3)_____ free play. The word \"free\" means both \"no _____(4)_____\" and \"with no _____(5)_____\".\n\n**Why:** Free play enables kids to ______(6)______ with others and learn important social skills.\n\n---\n\n#### Passage 2\n\n**Keep an Eye on Giraffes**\n\n**What:** Giraffes are quietly ______(7)______ because of this the GCF decided to work with African Parks. Their goal is to find. GPS collars make it easier to keep an eye on giraffes but they only last ______(8)______ on for long.\n\n**How:** New tracking devices, which are also ______(9)______ solar-powered, and don’t ______(10)______ their necks, are used to stop illegal hunting to keep giraffes safe.\n\n---\n\n### 四、阅读理解（根据文章内容完成填空），共 2 题，每题 2 分\n```"},"elapsed_time":9.957885767100379,"total_tokens":931,"total_steps":4,"created_at":1740972524,"finished_at":1740972534}}
2025-03-03 11:28:56.120  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png
2025-03-03 11:28:56.120  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, userId=system
2025-03-03 11:28:56.120 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:28:56.120 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:28:56.244  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=6e281e68-2bd7-450c-8d49-6cea99490a39
2025-03-03 11:28:56.244 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"6e281e68-2bd7-450c-8d49-6cea99490a39"}},"response_mode":"blocking","conversation_id":"72bee830-299b-4b73-b351-bf377ea7ee85","user":"fyjw"}
2025-03-03 11:29:13.692  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, text=```markdown
## Passage 3

(第一段改为) It was on Sunday morning, when Sam went to see his grandfather alone.【原文改】

27. When did the story happen?  
___

28. How did Sam go to see his grandfather, by bike or by bus?  
___

29. Who gave up the seat to the old lady?  
___

30. Why did other passengers also get up?  
___

31. Translate the sentence “what a lovely little girl” into Chinese.  
___

---

## Passage 4

In my job, I get to write about something new every day.  

After I graduated from university, I got my first writing job for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game starts to watch the teams practice.  

When the game starts, everyone is so busy. I hurry down to wait outside the changing area when I manage to get a short interview with one of the players after the game. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects of the next game.  

However, the real work takes place not on the action as it happens, but after the game. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.  

Finally, it is time for me to pull all my notes together into the finished article to send to the editor.
```
2025-03-03 11:29:13.693 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c9816ef5-50d8-43c6-b283-9d8a3b4754d6","workflow_run_id":"76f1c4a4-1487-4640-9785-a0029291e01f","data":{"id":"76f1c4a4-1487-4640-9785-a0029291e01f","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n## Passage 3\n\n(第一段改为) It was on Sunday morning, when Sam went to see his grandfather alone.【原文改】\n\n27. When did the story happen?  \n___\n\n28. How did Sam go to see his grandfather, by bike or by bus?  \n___\n\n29. Who gave up the seat to the old lady?  \n___\n\n30. Why did other passengers also get up?  \n___\n\n31. Translate the sentence “what a lovely little girl” into Chinese.  \n___\n\n---\n\n## Passage 4\n\nIn my job, I get to write about something new every day.  \n\nAfter I graduated from university, I got my first writing job for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game starts to watch the teams practice.  \n\nWhen the game starts, everyone is so busy. I hurry down to wait outside the changing area when I manage to get a short interview with one of the players after the game. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects of the next game.  \n\nHowever, the real work takes place not on the action as it happens, but after the game. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.  \n\nFinally, it is time for me to pull all my notes together into the finished article to send to the editor.\n```"},"elapsed_time":17.401784199057147,"total_tokens":968,"total_steps":4,"created_at":1740972534,"finished_at":1740972551}}
2025-03-03 11:29:13.911  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png
2025-03-03 11:29:13.911  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, userId=system
2025-03-03 11:29:13.911 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:29:13.912 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:29:14.053  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d0cc9508-dd60-4a80-ba2a-368d1155d349
2025-03-03 11:29:14.053 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"d0cc9508-dd60-4a80-ba2a-368d1155d349"}},"response_mode":"blocking","conversation_id":"80bc7553-1f93-4d01-a784-2fdb4bb101cf","user":"fyjw"}
2025-03-03 11:29:24.541  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, text=```markdown
32. What newspaper articles does the writer write about?  
________________________________________________________  

33. Why does the writer ask only a few important questions?  
________________________________________________________  

34. Who wins the baseball game in the end?  
________________________________________________________  

35. How many hours does the writer have to write up his article?  
________________________________________________________  

36. Translate the sentence "I love sharing my love for sport through words" into Chinese.  
________________________________________________________  

---

### 五、单项选择（共10小题，每小题1分，共10分。请将答案填在空白处。）

37. _________ you when you went to college? (old)  
你上大学时你 _________？  

38. I don’t know where _________. (live)  
我不知道他 _________。  

39. You should try to wonder where _________. (live)  
你应该试着 _________ 的地方。  

40. Please _________ that you have enough rest. (sure)  
请确保你休息得足够。  
```
```
2025-03-03 11:29:24.541 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"37d95e3f-b165-4f4c-88a6-1d1d3cd168a7","workflow_run_id":"4d7159f9-17a9-4102-ab62-0a0f1a6f77b3","data":{"id":"4d7159f9-17a9-4102-ab62-0a0f1a6f77b3","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n32. What newspaper articles does the writer write about?  \n________________________________________________________  \n\n33. Why does the writer ask only a few important questions?  \n________________________________________________________  \n\n34. Who wins the baseball game in the end?  \n________________________________________________________  \n\n35. How many hours does the writer have to write up his article?  \n________________________________________________________  \n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.  \n________________________________________________________  \n\n---\n\n### 五、单项选择（共10小题，每小题1分，共10分。请将答案填在空白处。）\n\n37. _________ you when you went to college? (old)  \n你上大学时你 _________？  \n\n38. I don’t know where _________. (live)  \n我不知道他 _________。  \n\n39. You should try to wonder where _________. (live)  \n你应该试着 _________ 的地方。  \n\n40. Please _________ that you have enough rest. (sure)  \n请确保你休息得足够。  \n```\n```"},"elapsed_time":10.445757590001449,"total_tokens":842,"total_steps":4,"created_at":1740972552,"finished_at":1740972562}}
2025-03-03 11:29:24.780  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png
2025-03-03 11:29:24.780  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, userId=system
2025-03-03 11:29:24.780 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:29:24.780 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:29:24.867  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=75569479-adda-4073-b957-7d2af0672f77
2025-03-03 11:29:24.867 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"75569479-adda-4073-b957-7d2af0672f77"}},"response_mode":"blocking","conversation_id":"80fe1aba-3ab8-443d-9f5f-f8a13c70b179","user":"fyjw"}
2025-03-03 11:29:36.959  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, text=```markdown
41. Travel can give us a chance _________ people from different cultures. (meet)  
旅行能让我们有机会认识来自不同文化背景的人。

42. The snow is so _________ that the whole world is covered in silver. (heavy)  
雪下得如此之大，整个世界都覆盖着银装素裹。

---

## 六、写作（共10分）

根据提示信息，填写一张邀请卡以邀请你的朋友Tom。主要内容包括：  
1. 举办一个英语阅读讨论会；  
2. 时间：本周六上午9点；  
3. 地点：302 Reading；  
4. 欢迎他参加；  
5. 签名：请使用你个人姓名完成邀请卡。  

> 提示：  
> 1. 邀请卡需写清楚主要信息；  
> 2. 文中不得出现除个人姓名以外的信息。
```
2025-03-03 11:29:36.959 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"769def2c-60ff-4cae-808c-70318adb3af8","workflow_run_id":"8f9b2203-d87b-43af-b28a-e33ba8a06271","data":{"id":"8f9b2203-d87b-43af-b28a-e33ba8a06271","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n41. Travel can give us a chance _________ people from different cultures. (meet)  \n旅行能让我们有机会认识来自不同文化背景的人。\n\n42. The snow is so _________ that the whole world is covered in silver. (heavy)  \n雪下得如此之大，整个世界都覆盖着银装素裹。\n\n---\n\n## 六、写作（共10分）\n\n根据提示信息，填写一张邀请卡以邀请你的朋友Tom。主要内容包括：  \n1. 举办一个英语阅读讨论会；  \n2. 时间：本周六上午9点；  \n3. 地点：302 Reading；  \n4. 欢迎他参加；  \n5. 签名：请使用你个人姓名完成邀请卡。  \n\n> 提示：  \n> 1. 邀请卡需写清楚主要信息；  \n> 2. 文中不得出现除个人姓名以外的信息。\n```"},"elapsed_time":12.045135878957808,"total_tokens":820,"total_steps":4,"created_at":1740972563,"finished_at":1740972575}}
2025-03-03 11:29:36.960  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=5733
2025-03-03 11:29:36.960 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:29:37.044  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"c403acc1-6d84-44ef-89ac-d73dcd15cbd9"},"data_source_detail_dict":{"upload_file":{"id":"c403acc1-6d84-44ef-89ac-d73dcd15cbd9","name":"2024届湖北专升本英语真题_20240517141034.md","size":5733,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575.23435}},"dataset_process_rule_id":"71d09b94-7268-4852-a5c9-3206ffcb493a","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":194,"hit_count":0,"doc_form":"text_model"},"batch":"20250303032935643784"}
2025-03-03 11:29:37.044  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:29:37.071 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:29:37.071 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:29:37.100 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:29:37.286 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:29:37.287 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:29:37.287 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:29:37.309 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:29:37.528 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:29:38.107  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 11:29:38.129 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:29:38.129 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:29:38.153 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:29:38.375 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:29:38.376  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 11:29:38.376  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 11:29:38.376 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:29:38.376 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:29:38.447  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=13f4d184-15ad-45c3-9f43-01fe5eb8187b
2025-03-03 11:29:38.447 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"13f4d184-15ad-45c3-9f43-01fe5eb8187b"}},"response_mode":"blocking","conversation_id":"65b1e2f3-6064-48b0-858c-539211b5ea8e","user":"fyjw"}
2025-03-03 11:30:09.909  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浦锦新村社区鑫雅苑实业有限公司：

2022年9月1日与上海浦锦新村社区签订的《上海市商品房租赁合同》（合同编号：202201767383），约定租期为一年，租金为每月人民币80000元整。

本小区原租赁物业用作幼儿园用途，因原租赁单位资金、能源的不足导致幼儿园无法持续经营，严重影响小区居民子女就近入学需求。为满足小区居民子女就近入学需求，现决定整体收回幼儿园物业，继续用于幼儿园用途。

在正式收回幼儿园物业之前，您需缴纳至2023年12月的租金及相关费用（含物业管理费、水电费等），共计人民币380000元整（其中剩余租金320000元整，物业管理费、水电费、租赁保证金共计60000元整）。如未按时缴纳费用，我方将依据合同条款约定从您缴纳的租赁保证金中扣除相应费用，扣除后剩余款项将退还您，并按合同约定收取每日4.75%滞纳金。

在您完成所有费用缴纳后，我方将正式收回物业时间：即2023年12月8日早上8点。请提前完成搬离工作，逾期搬离，我方将依法处理。

联系人：程向云 电话：13262792367  
杨晓斌 电话：15821244733  

2023年11月28日
```
2025-03-03 11:30:09.910 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"9c3b027c-7a6e-425f-9c1b-b47a2596b6cb","workflow_run_id":"15acb323-a4f9-485b-9b61-699156081587","data":{"id":"15acb323-a4f9-485b-9b61-699156081587","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浦锦新村社区鑫雅苑实业有限公司：\n\n2022年9月1日与上海浦锦新村社区签订的《上海市商品房租赁合同》（合同编号：202201767383），约定租期为一年，租金为每月人民币80000元整。\n\n本小区原租赁物业用作幼儿园用途，因原租赁单位资金、能源的不足导致幼儿园无法持续经营，严重影响小区居民子女就近入学需求。为满足小区居民子女就近入学需求，现决定整体收回幼儿园物业，继续用于幼儿园用途。\n\n在正式收回幼儿园物业之前，您需缴纳至2023年12月的租金及相关费用（含物业管理费、水电费等），共计人民币380000元整（其中剩余租金320000元整，物业管理费、水电费、租赁保证金共计60000元整）。如未按时缴纳费用，我方将依据合同条款约定从您缴纳的租赁保证金中扣除相应费用，扣除后剩余款项将退还您，并按合同约定收取每日4.75%滞纳金。\n\n在您完成所有费用缴纳后，我方将正式收回物业时间：即2023年12月8日早上8点。请提前完成搬离工作，逾期搬离，我方将依法处理。\n\n联系人：程向云 电话：13262792367  \n杨晓斌 电话：15821244733  \n\n2023年11月28日\n```"},"elapsed_time":31.413092300063,"total_tokens":984,"total_steps":4,"created_at":1740972576,"finished_at":1740972608}}
2025-03-03 11:30:09.910  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1303
2025-03-03 11:30:09.911 DEBUG 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:30:10.003  INFO 31864 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"d49adcea-f0fe-46b8-a4fc-424d67f05494"},"data_source_detail_dict":{"upload_file":{"id":"d49adcea-f0fe-46b8-a4fc-424d67f05494","name":"程阿金和解通知.md","size":1303,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972608.189598}},"dataset_process_rule_id":"5fd36983-db63-41ed-ab4d-f0b897cc11ae","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":446,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":432,"hit_count":0,"doc_form":"text_model"},"batch":"20250303033008469146"}
2025-03-03 11:30:10.004  INFO 31864 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 11:30:10.028 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:30:10.029 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:30:10.052 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:30:10.245 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:30:10.246 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:30:10.247 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:30:10.279 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:30:10.455 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:30:10.459 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:30:10.459 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:30:10.484 DEBUG 31864 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:30:10.656 ERROR 31864 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:33:11.574  INFO 31864 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:33:11.577  INFO 31864 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:33:14.661  INFO 26688 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 26688 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:33:14.662 DEBUG 26688 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:33:14.663  INFO 26688 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:33:14.910  INFO 26688 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:33:14.911  INFO 26688 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:33:14.922  INFO 26688 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 11:33:15.164  INFO 26688 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:33:15.168  INFO 26688 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:33:15.168  INFO 26688 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:33:15.243  INFO 26688 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:33:15.243  INFO 26688 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 563 ms
2025-03-03 11:33:15.397  INFO 26688 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:33:15.398  INFO 26688 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:33:15.957  INFO 26688 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:33:16.216  INFO 26688 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477419574190587906&access_key=083ebf0fe0801933d5b315eb513008cf&service_id=33554678&ticket=0bd5ef4d-54d5-4b94-ae2c-7a625e40d7f6 [conn_id=7477419574190587906]
2025-03-03 11:33:16.258  INFO 26688 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:33:16.265  INFO 26688 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.762 seconds (JVM running for 2.09)
2025-03-03 11:33:31.541  INFO 26688 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740972809}
2025-03-03 11:33:31.568  WARN 26688 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 11:33:31.574  INFO 26688 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:33:31.847  INFO 26688 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:33:31.851 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:33:31.862 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:33:31.893 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:33:31.896 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:33:31.896 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:33:31.931 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:33:31.932 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:33:31.932 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:33:31.958 DEBUG 26688 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:33:31.959  INFO 26688 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:33:32.846  INFO 26688 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:33:32.848  INFO 26688 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:33:33.408  INFO 26688 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:33:31 GMT"],"eagleid":["74c48fac17409728111065656e"],"request-id":["35e73634-ef51-4601-9f1d-5178be9b2e02"],"server":["Tengine"],"server-timing":["inner; dur=447","cdn-cache;desc=MISS,edge;dur=0,origin;dur=462"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache24.cn7149[462,0]"],"x-lgw-dst-svc":["8FK-54SvXWU2GVsrsba99wBenmk5y7ATbAimnxFVhz6QAWl0JJpmm_QFSvdGOGKj-jBGmoJ5TbP6o2nrg9lXsVXthjiTfVROTeSY5IG1KOIa3S9hWzYVMElfWE11B80pR_uXtfvWPtNUw9_xG1GZFoxW4AzgU4PFAxNRONcME_M7ZJJ0sONTJK0YiPYf_Er8mMX8HEI5X4PlzDMqzxOUE_umbkxbebPgQJmLObQKG9Q4YIflp34_P4lzlAi7SqCiHA0pouP1c8UbFcb9FdNjo-Gx7IicCl-oUIcrf9f3oMzZBNRBgFc5sf4="],"x-request-id":["35e73634-ef51-4601-9f1d-5178be9b2e02"],"x-timestamp":["1740972811.564"],"x-tt-logid":["20250303113331C86E0D54B1CFBAE7B885"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be679b8c5ae543d90a530217a02c12e3ceeea6a38b48246d55f9aeb7911d5048927ac856084ef49cda498f15183a974b6f2648625646891e01b7dd1cc03789396d465247fb67f7c484e2546bde53d4bb1b"],"x-tt-trace-id":["00-250303113331C86E0D54B1CFBAE7B885-4DF8CA1A254AD8D1-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303113331C86E0D54B1CFBAE7B885","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303113331C86E0D54B1CFBAE7B885"}
2025-03-03 11:33:33.408  INFO 26688 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:33:33.948  INFO 26688 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:33:33.973 DEBUG 26688 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:33:33.973 DEBUG 26688 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:33:33.996 DEBUG 26688 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:33:34.243 ERROR 26688 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:33:34.243  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:33:34.244  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:33:34.245 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:33:34.247 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:33:34.546  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d07b80dc-508a-4d84-bfd0-e3dee1a93e81
2025-03-03 11:33:34.546 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"d07b80dc-508a-4d84-bfd0-e3dee1a93e81"}},"response_mode":"blocking","conversation_id":"bca67fb3-56bc-42a1-9e02-0c2d1516f663","user":"fyjw"}
2025-03-03 11:33:34.648  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf, text=
2025-03-03 11:33:34.648 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"81a84dd6-4062-4072-b251-2b3748b9d921","workflow_run_id":"192cab47-bfca-4601-88c0-95e1e1d7afc5","data":{"id":"192cab47-bfca-4601-88c0-95e1e1d7afc5","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.04032557993195951,"total_tokens":0,"total_steps":4,"created_at":1740972812,"finished_at":1740972812}}
2025-03-03 11:33:34.648  INFO 26688 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:33:34.737 DEBUG 26688 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:33:34.738 DEBUG 26688 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:33:34.852 DEBUG 26688 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:33:35.054 ERROR 26688 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:33:36.197  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:33:36.197  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:33:36.197 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:33:36.197 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:33:36.413  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=5df9fdf7-5e6e-44d0-b522-8f31fc5a6883
2025-03-03 11:33:36.413 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"5df9fdf7-5e6e-44d0-b522-8f31fc5a6883"}},"response_mode":"blocking","conversation_id":"fef252ac-01f7-4cee-a5e5-c21eab5fa1af","user":"fyjw"}
2025-03-03 11:34:02.824  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制制
```
2025-03-03 11:34:02.825 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"8e5b9d5a-575f-42d7-a177-578a7734584f","workflow_run_id":"1df2c0e8-01cb-4e9e-84dd-0134c4237f73","data":{"id":"1df2c0e8-01cb-4e9e-84dd-0134c4237f73","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":26.36465209396556,"total_tokens":649,"total_steps":4,"created_at":1740972814,"finished_at":1740972841}}
2025-03-03 11:34:02.874 ERROR 26688 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:34:02.874  INFO 26688 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477419574190587906&access_key=083ebf0fe0801933d5b315eb513008cf&service_id=33554678&ticket=0bd5ef4d-54d5-4b94-ae2c-7a625e40d7f6 [conn_id=7477419574190587906]
2025-03-03 11:34:02.874  INFO 26688 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:34:03.923  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:34:03.923  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:34:03.923 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:34:03.923 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:34:04.917  INFO 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=27c3b9ed-79e4-4e73-9a7d-4ce097781630
2025-03-03 11:34:04.917 DEBUG 26688 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"27c3b9ed-79e4-4e73-9a7d-4ce097781630"}},"response_mode":"blocking","conversation_id":"80085ede-cb79-4e2f-bcd2-971d55e261ee","user":"fyjw"}
2025-03-03 11:34:29.364  INFO 26688 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:34:29.677  INFO 26688 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477419425565294620&access_key=fee38cde015ea7b9fdfd9f1b70c540ed&service_id=33554678&ticket=d271034b-d97d-402c-adae-380313a5b360 [conn_id=7477419425565294620]
2025-03-03 11:36:11.157  INFO 26688 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:36:11.159  INFO 26688 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:36:14.575  INFO 20132 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 20132 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:36:14.576 DEBUG 20132 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:36:14.577  INFO 20132 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:36:14.822  INFO 20132 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:36:14.823  INFO 20132 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:36:14.835  INFO 20132 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 11:36:15.100  INFO 20132 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:36:15.104  INFO 20132 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:36:15.105  INFO 20132 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:36:15.188  INFO 20132 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:36:15.188  INFO 20132 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 593 ms
2025-03-03 11:36:15.366  INFO 20132 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:36:15.367  INFO 20132 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:36:15.904  INFO 20132 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:36:16.226  INFO 20132 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:36:16.232  INFO 20132 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.815 seconds (JVM running for 2.154)
2025-03-03 11:36:16.692  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477419425565753372&access_key=73c24f2f254955d71816ca8e3739f13e&service_id=33554678&ticket=2479589d-e96c-4484-8bf5-1354789e3a96 [conn_id=7477419425565753372]
2025-03-03 11:36:18.932  INFO 20132 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740972977}
2025-03-03 11:36:18.959  WARN 20132 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 11:36:18.971  INFO 20132 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:36:19.431  INFO 20132 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:36:19.434 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:36:19.446 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:36:19.480 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:36:19.483 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:36:19.483 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:36:19.504 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:36:19.504 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:36:19.505 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:36:19.537 DEBUG 20132 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:36:19.537  INFO 20132 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:36:20.383  INFO 20132 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:36:20.385  INFO 20132 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:36:20.872  INFO 20132 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:36:19 GMT"],"eagleid":["74c48f9f17409729786431330e"],"request-id":["8afc8c63-ba2d-4f85-9a14-51f0ba3c04e6"],"server":["Tengine"],"server-timing":["inner; dur=374","cdn-cache;desc=MISS,edge;dur=0,origin;dur=391"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache11.cn7149[391,0]"],"x-lgw-dst-svc":["GLi2G6gi6TF8zP1AtNLdK15Rh6gCDvmFnK9cb3NP_OmIyDE5t4RQ3r6yeLfHy1OmB-ach3QU1LTdJP7E8vLUrsB4cOH4ZDUmChmk3_aSzjIhgVXNo9tDmtKbsEAo4RH8rmvhVM4DYPgiOnTvFnBb7t5MgNn21X4cMiIudX5xy1Uy4o5Hw1aGqYBi8oWd-v3UFxaoGo0hx18Iw18Pg_IXQLa45JNuu3HNqkTbTp-jMfc8kqXXgdboeZnn_FM5uVUMx5SlRRyqRUFgl-nfzHXJmwKQVrGQFkCDkJazd5BKy4RcUpH1SFRbSX0="],"x-request-id":["8afc8c63-ba2d-4f85-9a14-51f0ba3c04e6"],"x-timestamp":["1740972979.030"],"x-tt-logid":["2025030311361802606CAA5B9681EE918B"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be180ef08b02ae6893e08d831caf170bb3047fc5d0e5764b9397d986a3f2142586bccd8a8ca5f3fbd14d69b0f3f9473d2d1ee1bbce62c2bc9b20d7b5377e6dfe40f1efd82748db64a6ba7d2fc9f35789d9"],"x-tt-trace-id":["00-25030311361802606CAA5B9681EE918B-6B44889720A6723A-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030311361802606CAA5B9681EE918B","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030311361802606CAA5B9681EE918B"}
2025-03-03 11:36:20.873  INFO 20132 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:36:21.362  INFO 20132 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:36:21.382 DEBUG 20132 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:36:21.382 DEBUG 20132 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:36:21.404 DEBUG 20132 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:36:21.580 ERROR 20132 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:36:21.580  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:36:21.580  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:36:21.582 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:36:21.582 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:36:22.413  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f3f1d9d0-d47c-403d-9fd9-a241a5ef4e6f
2025-03-03 11:36:22.413 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"f3f1d9d0-d47c-403d-9fd9-a241a5ef4e6f"}},"response_mode":"blocking","conversation_id":"5330b897-e324-4d0b-a38f-0bdc88e20182","user":"fyjw"}
2025-03-03 11:36:22.514  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf, text=
2025-03-03 11:36:22.514 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"17dea298-bd2f-40a4-ac13-c50bdd9aeca1","workflow_run_id":"78e89496-8f6e-4f49-9a00-c0ea538d1bb4","data":{"id":"78e89496-8f6e-4f49-9a00-c0ea538d1bb4","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.03349200915545225,"total_tokens":0,"total_steps":4,"created_at":1740972980,"finished_at":1740972980}}
2025-03-03 11:36:22.514  INFO 20132 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:36:22.537 DEBUG 20132 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:36:22.537 DEBUG 20132 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:36:22.559 DEBUG 20132 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:36:22.824 ERROR 20132 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:36:23.906  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:36:23.906  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:36:23.907 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:36:23.907 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:36:24.842  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=0696d2b7-4bf0-4bae-a623-2a306ac25ec3
2025-03-03 11:36:24.842 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"0696d2b7-4bf0-4bae-a623-2a306ac25ec3"}},"response_mode":"blocking","conversation_id":"afe446de-17ab-49f2-b585-3adb300cc03d","user":"fyjw"}
2025-03-03 11:36:42.690  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制制
```
2025-03-03 11:36:42.691 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"7fb5768a-ace3-4af0-b244-ff7d4ba13d0a","workflow_run_id":"652944eb-e716-4f55-b06b-69f9812d2563","data":{"id":"652944eb-e716-4f55-b06b-69f9812d2563","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":17.790559933986515,"total_tokens":649,"total_steps":4,"created_at":1740972983,"finished_at":1740973000}}
2025-03-03 11:36:43.808  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:36:43.808  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:36:43.808 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:36:43.808 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:36:44.822  INFO 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=fd7e0144-c804-40a0-9779-e6a6765faba8
2025-03-03 11:36:44.822 DEBUG 20132 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"fd7e0144-c804-40a0-9779-e6a6765faba8"}},"response_mode":"blocking","conversation_id":"b7059847-e66d-48e3-80b9-ef48ac9379e0","user":"fyjw"}
2025-03-03 11:37:19.877 ERROR 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:37:19.877  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477419425565753372&access_key=73c24f2f254955d71816ca8e3739f13e&service_id=33554678&ticket=2479589d-e96c-4484-8bf5-1354789e3a96 [conn_id=7477419425565753372]
2025-03-03 11:37:19.877  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:37:36.611  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:37:36.893  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477420592590028801&access_key=d50f3a381cc95827bd71e003cf02ecc1&service_id=33554678&ticket=4a06ce57-d51c-4776-8242-9fa294c1c650 [conn_id=7477420592590028801]
2025-03-03 11:38:06.870 ERROR 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:38:06.870  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477420592590028801&access_key=d50f3a381cc95827bd71e003cf02ecc1&service_id=33554678&ticket=4a06ce57-d51c-4776-8242-9fa294c1c650 [conn_id=7477420592590028801]
2025-03-03 11:38:06.871  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:38:32.085  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:38:32.391  INFO 20132 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477420592590503937&access_key=f500e98dfe7c535429560b8a653a0b9d&service_id=33554678&ticket=629f32ab-2570-4e06-a601-332db4798ee6 [conn_id=7477420592590503937]
2025-03-03 11:38:54.994  INFO 20132 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:38:54.998  INFO 20132 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:38:57.011  INFO 13772 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 13772 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:38:57.012 DEBUG 13772 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:38:57.012  INFO 13772 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:38:57.256  INFO 13772 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:38:57.257  INFO 13772 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:38:57.271  INFO 13772 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 11:38:57.507  INFO 13772 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:38:57.511  INFO 13772 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:38:57.511  INFO 13772 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:38:57.588  INFO 13772 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:38:57.588  INFO 13772 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 559 ms
2025-03-03 11:38:57.746  INFO 13772 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:38:57.746  INFO 13772 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:38:58.240  INFO 13772 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:38:58.395  INFO 13772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477420819804504066&access_key=cee042f972a94859c4c3728c6a66b37e&service_id=33554678&ticket=3bd7f2dd-bd35-4554-ae76-3952147445eb [conn_id=7477420819804504066]
2025-03-03 11:38:58.534  INFO 13772 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:38:58.538  INFO 13772 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.7 seconds (JVM running for 2.057)
2025-03-03 11:39:01.611  INFO 13772 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740973139}
2025-03-03 11:39:01.638  WARN 13772 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 11:39:01.644  INFO 13772 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:39:02.030  INFO 13772 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:39:02.036 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:39:02.047 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:39:02.082 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:39:02.085 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:39:02.085 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:39:02.111 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:39:02.112 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:39:02.112 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:39:02.141 DEBUG 13772 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:39:02.141  INFO 13772 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:39:02.908  INFO 13772 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:39:02.909  INFO 13772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:39:03.551  INFO 13772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:39:01 GMT"],"eagleid":["74c48fb417409731411677454e"],"request-id":["9a74b711-284d-4374-9466-5b21e7653ffa"],"server":["Tengine"],"server-timing":["inner; dur=524","cdn-cache;desc=MISS,edge;dur=0,origin;dur=540"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache32.cn7149[540,0]"],"x-lgw-dst-svc":["OT7qUFtEMunW5Bfkb0umM0w5v5qX3d-_vSUg0n4MmGZl3L-Cb8vAk7ugc6pgN4X3uyleJmN42_wV8un0rZmFYP9SCDFpSUkDISndr7slX1gYScGVxIXR88fGTnCUnHAgkYBu-rwYjpjvsONBXVDFKP1Ni7vvvCbOnWzEWl35IpHTe-OByzPOd-IwdhuxA3hXAQXmZEWGeYNR-SYQdSe0gvmfkvj7dfdLcVa3o36d9j_5hiLUg70-i3s3Fa2eW_D0SgrvroKAlT1gLWZ2kpHCjb75XkBwtTqXCOBsqyKn3e3e8HztzDwM_rM="],"x-request-id":["9a74b711-284d-4374-9466-5b21e7653ffa"],"x-timestamp":["1740973141.701"],"x-tt-logid":["20250303113901DED24CA143A140F87163"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be9f3ef5545e6d049d8bd27fd1aa69f325d4d36c543ddd017ecabb37770b5abf46da93a6d364c65332c02d02f954b823169218b4d4a224eff586f653a9578c5f99f80aa2b5a3a218eb03bf9d99984a200c"],"x-tt-trace-id":["00-250303113901DED24CA143A140F87163-772FD5FE13586AFD-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303113901DED24CA143A140F87163","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303113901DED24CA143A140F87163"}
2025-03-03 11:39:03.551  INFO 13772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:39:04.059  INFO 13772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:39:04.097 DEBUG 13772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:39:04.098 DEBUG 13772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:39:04.127 DEBUG 13772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:39:04.312 ERROR 13772 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:39:04.313  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:39:04.313  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:39:04.315 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:39:04.315 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:39:04.567  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8361070e-b377-4e41-ab1c-50b932541845
2025-03-03 11:39:04.568 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"8361070e-b377-4e41-ab1c-50b932541845"}},"response_mode":"blocking","conversation_id":"66a3ac71-6209-488a-a193-d1db1e810122","user":"fyjw"}
2025-03-03 11:39:04.643  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf, text=
2025-03-03 11:39:04.644 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d8cddab5-df7f-4c3c-980f-61929b01e66e","workflow_run_id":"2513bf73-42ad-44b3-a036-9651a9f12cba","data":{"id":"2513bf73-42ad-44b3-a036-9651a9f12cba","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.03466889285482466,"total_tokens":0,"total_steps":4,"created_at":1740973142,"finished_at":1740973142}}
2025-03-03 11:39:04.644  INFO 13772 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:39:04.669 DEBUG 13772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:39:04.670 DEBUG 13772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:39:04.701 DEBUG 13772 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:39:04.890 ERROR 13772 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:39:06.010  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:39:06.010  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:39:06.010 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:39:06.010 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:39:06.350  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=e930db7e-37c7-425a-aa97-33664b4db397
2025-03-03 11:39:06.351 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"e930db7e-37c7-425a-aa97-33664b4db397"}},"response_mode":"blocking","conversation_id":"18b70c5d-7797-403a-b751-c86bef99d63a","user":"fyjw"}
2025-03-03 11:39:29.567  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

### 上海市房屋管理局 制印
```
2025-03-03 11:39:29.567 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"58cbefaf-32d4-458e-8e64-020652810ed3","workflow_run_id":"98efd281-9c56-4456-a132-1029ab29c783","data":{"id":"98efd281-9c56-4456-a132-1029ab29c783","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n### 上海市房屋管理局 制印\n```"},"elapsed_time":23.15164901688695,"total_tokens":427,"total_steps":4,"created_at":1740973144,"finished_at":1740973167}}
2025-03-03 11:39:30.707  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:39:30.708  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:39:30.708 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:39:30.708 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:39:31.820  INFO 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=0843c512-49a6-4e71-9a5f-8df8275b67d9
2025-03-03 11:39:31.821 DEBUG 13772 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"0843c512-49a6-4e71-9a5f-8df8275b67d9"}},"response_mode":"blocking","conversation_id":"407fd916-4fd7-4367-b489-19ee62568819","user":"fyjw"}
2025-03-03 11:40:02.823 ERROR 13772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:40:02.823  INFO 13772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477420819804504066&access_key=cee042f972a94859c4c3728c6a66b37e&service_id=33554678&ticket=3bd7f2dd-bd35-4554-ae76-3952147445eb [conn_id=7477420819804504066]
2025-03-03 11:40:02.823  INFO 13772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:40:03.073  INFO 13772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:40:03.462  INFO 13772 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477420592591060993&access_key=7a7c71b0e578cd84088253802e995378&service_id=33554678&ticket=0e498532-31fb-49d7-b0ac-c710cc117f93 [conn_id=7477420592591060993]
2025-03-03 11:40:31.670  INFO 13772 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:40:31.673  INFO 13772 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:40:33.398  INFO 32140 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 32140 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:40:33.398 DEBUG 32140 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:40:33.398  INFO 32140 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:40:33.654  INFO 32140 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:40:33.655  INFO 32140 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:40:33.667  INFO 32140 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 11:40:33.910  INFO 32140 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:40:33.914  INFO 32140 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:40:33.914  INFO 32140 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:40:33.998  INFO 32140 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:40:33.999  INFO 32140 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 581 ms
2025-03-03 11:40:34.155  INFO 32140 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:40:34.155  INFO 32140 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:40:34.770  INFO 32140 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:40:35.047  INFO 32140 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:40:35.047  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477421271128555522&access_key=bb7b9baf52cfb3ea6870a3f168e7f8e2&service_id=33554678&ticket=2549bff4-b29e-48a7-9828-929a7af1ed4c [conn_id=7477421271128555522]
2025-03-03 11:40:35.052  INFO 32140 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.821 seconds (JVM running for 2.148)
2025-03-03 11:40:36.813  INFO 32140 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740973234}
2025-03-03 11:40:36.843  WARN 32140 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @1623b78d
2025-03-03 11:40:36.849  INFO 32140 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:40:37.149  INFO 32140 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:40:37.152 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:40:37.164 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:40:37.215 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:40:37.218 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:40:37.218 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:40:37.242 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:40:37.242 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:40:37.242 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:40:37.309 DEBUG 32140 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:40:37.310  INFO 32140 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:40:38.168  INFO 32140 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:40:38.170  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:40:38.732  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:40:36 GMT"],"eagleid":["1bde140917409732364302687e"],"request-id":["4a965a6d-8110-447a-80c1-83ff0f5bcf53"],"server":["Tengine"],"server-timing":["inner; dur=452","cdn-cache;desc=MISS,edge;dur=0,origin;dur=472"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache5.cn6725[472,0]"],"x-lgw-dst-svc":["E72pCmRPVydh3L960w_q0UtH9JGxsudFLsl7zpdL3FtMgtUH_J41dlullPRZUQOK0Qu1PqjhiOr4QGKly3iFKfuTVfEOw3O-fzjuDWWclD-C-ALYJeUehGk7CqPxeBM-8KOTNXYkWL3Ez5QfdldkFp1zLPXAcSvUecHHfq7pjp7kRuMohlSWv_s7henrLF1_Bwnyh_rhwvXQBNOf-MzIfH1LHyRP-W5K0W91FoU-1BjIgPT8jU9jfw-AXy6fUqq-jgvP0xn4T9DfvJyOxfGpM8ABPeZCd-dBVhFjlIf0mHHBmsv_DujOv7w="],"x-request-id":["4a965a6d-8110-447a-80c1-83ff0f5bcf53"],"x-timestamp":["1740973236.893"],"x-tt-logid":["20250303114036459B31F0DED95EE948C9"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e980bbed694a39c968556458fe139b17570a835ff7fe037e4b5587d9cc9da55c9ea5e9047e8d186dc58210beb1635c237c2cdbb3fe876815829066d732f371c54251d152b90f19babfa5545e89afbd8d206"],"x-tt-trace-id":["00-250303114036459B31F0DED95EE948C9-46566A442735B266-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303114036459B31F0DED95EE948C9","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303114036459B31F0DED95EE948C9"}
2025-03-03 11:40:38.733  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:40:39.206  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:40:39.238 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:40:39.239 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:40:39.263 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:40:39.444 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:40:39.445  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:40:39.445  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:40:39.447 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:40:39.447 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:40:39.637  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f7bf7d46-6973-45aa-8c1d-709500801199
2025-03-03 11:40:39.637 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"f7bf7d46-6973-45aa-8c1d-709500801199"}},"response_mode":"blocking","conversation_id":"2491fc43-2167-492b-8868-13e2a16e6d6e","user":"fyjw"}
2025-03-03 11:40:39.723  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf, text=
2025-03-03 11:40:39.724 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"91c157bb-77b2-4cbe-a9ae-aeaec37c4e51","workflow_run_id":"4aae8d56-9d60-4df0-a077-563660278ce8","data":{"id":"4aae8d56-9d60-4df0-a077-563660278ce8","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.039718658197671175,"total_tokens":0,"total_steps":4,"created_at":1740973237,"finished_at":1740973237}}
2025-03-03 11:40:39.724  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:40:39.724 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:40:39.725 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:40:39.754 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:40:39.929 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:40:41.014  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:40:41.015  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:40:41.015 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:40:41.015 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:40:41.525  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=5dc9dcc2-2d55-499d-9b9e-81134f042504
2025-03-03 11:40:41.525 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"5dc9dcc2-2d55-499d-9b9e-81134f042504"}},"response_mode":"blocking","conversation_id":"430e8256-dac4-4245-823f-1cfbc6708be9","user":"fyjw"}
2025-03-03 11:41:03.409  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制制
```
2025-03-03 11:41:03.409 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"950f0bb7-38d5-4f1e-a8f2-fc3c9c7c3f80","workflow_run_id":"e3dbc97b-1c48-4c68-acff-557a85af7ada","data":{"id":"e3dbc97b-1c48-4c68-acff-557a85af7ada","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":21.839647992979735,"total_tokens":649,"total_steps":4,"created_at":1740973239,"finished_at":1740973261}}
2025-03-03 11:41:04.575  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:41:04.575  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:41:04.575 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:41:04.575 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:41:05.581  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=71ab48d2-a7e3-4bca-9f9d-8c99a5e03c11
2025-03-03 11:41:05.581 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"71ab48d2-a7e3-4bca-9f9d-8c99a5e03c11"}},"response_mode":"blocking","conversation_id":"7fcfc73e-2049-4fc1-b2a6-546677ddb21c","user":"fyjw"}
2025-03-03 11:42:54.794 ERROR 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:260) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:282) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:42:54.796 DEBUG 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 11:42:54.796  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=99
2025-03-03 11:42:54.796 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:42:54.923  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"ad0d9fd5-171a-4898-8a9d-1012f479bbb3"},"data_source_detail_dict":{"upload_file":{"id":"ad0d9fd5-171a-4898-8a9d-1012f479bbb3","name":"东九交付许可证.md","size":99,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740973373.085068}},"dataset_process_rule_id":"620b5b02-9eb8-4993-8ac6-026dc1294799","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":31,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":43,"hit_count":0,"doc_form":"text_model"},"batch":"20250303034253914028"}
2025-03-03 11:42:54.924  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 11:42:54.951 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:42:54.952 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:42:54.977 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:42:55.271 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:42:55.273 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:42:55.274 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:42:55.304 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:42:55.500 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:42:55.989  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:42:56.072 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:42:56.072 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:42:56.098 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:42:56.255 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:42:56.256  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:42:56.256  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 11:42:56.256 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:42:56.256 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:42:56.313  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=47354562-2fa8-4dff-9783-ac7872e6c27d
2025-03-03 11:42:56.314 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"47354562-2fa8-4dff-9783-ac7872e6c27d"}},"response_mode":"blocking","conversation_id":"7e9d2ca1-3bcd-4521-ab5c-439eec0fcbc5","user":"fyjw"}
2025-03-03 11:42:56.438  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf, text=2024 届湖北专升本英语真题
一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分
1. I have confidence _________ (in/on) my future.
2. _______ (What/How) beautiful the East Lake is!
3. John _______ (is/are) familiar with Chinese culture.
4. There are ________ (much/many) ways to help others.
5. It is _______ (a/the) first time that I have seen the sea.
6. I’m sure you can solve the problem by ___________ (your/yourself).
7. I can lend my bike to you ________ (if/or) you return in on time.
8. The internet has _______ (great/greatly) changed the way we live.
9. When I was young, Dad often _________ (took/take) me to the museum.
10. I’m happy that the summer holiday ______ (will/would) begin next month.
二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分
11. the source of / is / Water / life __________________________________________________________________
12. My family / reading books / enjoy
__________________________________________________________________
13. the beauty around you / to discover / It is a joy
__________________________________________________________________
14. try our best / should / to realize our dreams / We __________________________________________________________________
15. was translated into / His book / last year / French__________________________________________________________________
16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分
Passage 1
...one of the most important gifts we can give our kids.【原文略】
Kids Need Free Play
Who：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and
youth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with
no cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2
（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are
very important for keeping Nubian giraffes safe.【原文略】
Keep an Eye on Giraffes
What: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS
collars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't
26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3
（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】
27. When did the story happen? ________________________________________________________________
28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________
29. Who gave up the seat to the old lady? ________________________________________________________________
30. Why did other passengers also get up? ________________________________________________________________
31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4
In my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a
trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an
article about a baseball game. I arrive at the stadium two hours before the game starts. I have got
heady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I
manage to get a short interview with the home team’s star player. I have limited time, so I only ask
a few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home
team wins! As the fans leave, I go to the press conference with other journalists. We listen to both
team coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and
the public will be reading my article over breakfast in the morning. I love sharing my love for
sport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________
33. Why does the writer ask only a few important questions? ________________________________________________________________
34. Who wins the baseball game in the end? ________________________________________________________________
35. How many hours does the writer have to write up his article? ________________________________________________________________
36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分
37. _______________ were you when you went to college? (old)
你多大上的大学？
38. Sorry, but I don’t know where ____________. (live)
抱歉，我不知道他住的地方。
39. Only by ____________ can you change your life. (work)
只有努力工作才能改变你的生活。
40. Please _____________ that you have enough rest. (sure)
请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)
旅行能让我们有机会认识来自不同文化背景的人。
42. The snow is ____________ that the whole world is covered in silver. (heavy)
雪下得如此之大，整个世界都银装素裹。
六．写作，共 10 分
根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：
1. 请他帮忙买一本关于阅读的英文书；
2. 书名为 On Reading；
3. 请他购买该书的原因；
4. 请他购买后尽快寄出；
5. 向他表示感谢。
注意：
1. 无需写标题；
2. 文章中不能出现个人姓名与学校名称；
3. 词数不少于 40。
2025-03-03 11:42:56.439 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"3bebefad-b7d4-44ee-b39e-6e8120e93401","workflow_run_id":"4a3b09ad-c519-4d68-9725-5d706a33a368","data":{"id":"4a3b09ad-c519-4d68-9725-5d706a33a368","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":"2024 届湖北专升本英语真题\r\n一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分\r\n1. I have confidence _________ (in/on) my future.\r\n2. _______ (What/How) beautiful the East Lake is!\r\n3. John _______ (is/are) familiar with Chinese culture.\r\n4. There are ________ (much/many) ways to help others.\r\n5. It is _______ (a/the) first time that I have seen the sea.\r\n6. I’m sure you can solve the problem by ___________ (your/yourself).\r\n7. I can lend my bike to you ________ (if/or) you return in on time.\r\n8. The internet has _______ (great/greatly) changed the way we live.\r\n9. When I was young, Dad often _________ (took/take) me to the museum.\r\n10. I’m happy that the summer holiday ______ (will/would) begin next month.\r\n二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分\r\n11. the source of / is / Water / life __________________________________________________________________\r\n12. My family / reading books / enjoy\r\n__________________________________________________________________\r\n13. the beauty around you / to discover / It is a joy\r\n__________________________________________________________________\r\n14. try our best / should / to realize our dreams / We __________________________________________________________________\r\n15. was translated into / His book / last year / French__________________________________________________________________\r\n16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分\r\nPassage 1\r\n...one of the most important gifts we can give our kids.【原文略】\r\nKids Need Free Play\r\nWho：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and\r\nyouth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with\r\nno cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2\r\n（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are\r\nvery important for keeping Nubian giraffes safe.【原文略】\r\nKeep an Eye on Giraffes\r\nWhat: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS\r\ncollars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't\r\n26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3\r\n（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】\r\n27. When did the story happen? ________________________________________________________________\r\n28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________\r\n29. Who gave up the seat to the old lady? ________________________________________________________________\r\n30. Why did other passengers also get up? ________________________________________________________________\r\n31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4\r\nIn my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a\r\ntrainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an\r\narticle about a baseball game. I arrive at the stadium two hours before the game starts. I have got\r\nheady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I\r\nmanage to get a short interview with the home team’s star player. I have limited time, so I only ask\r\na few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home\r\nteam wins! As the fans leave, I go to the press conference with other journalists. We listen to both\r\nteam coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and\r\nthe public will be reading my article over breakfast in the morning. I love sharing my love for\r\nsport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________\r\n33. Why does the writer ask only a few important questions? ________________________________________________________________\r\n34. Who wins the baseball game in the end? ________________________________________________________________\r\n35. How many hours does the writer have to write up his article? ________________________________________________________________\r\n36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分\r\n37. _______________ were you when you went to college? (old)\r\n你多大上的大学？\r\n38. Sorry, but I don’t know where ____________. (live)\r\n抱歉，我不知道他住的地方。\r\n39. Only by ____________ can you change your life. (work)\r\n只有努力工作才能改变你的生活。\r\n40. Please _____________ that you have enough rest. (sure)\r\n请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)\r\n旅行能让我们有机会认识来自不同文化背景的人。\r\n42. The snow is ____________ that the whole world is covered in silver. (heavy)\r\n雪下得如此之大，整个世界都银装素裹。\r\n六．写作，共 10 分\r\n根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：\r\n1. 请他帮忙买一本关于阅读的英文书；\r\n2. 书名为 On Reading；\r\n3. 请他购买该书的原因；\r\n4. 请他购买后尽快寄出；\r\n5. 向他表示感谢。\r\n注意：\r\n1. 无需写标题；\r\n2. 文章中不能出现个人姓名与学校名称；\r\n3. 词数不少于 40。"},"elapsed_time":0.07452770508825779,"total_tokens":0,"total_steps":4,"created_at":1740973374,"finished_at":1740973374}}
2025-03-03 11:42:56.439 DEBUG 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 11:42:56.439  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=6555
2025-03-03 11:42:56.439 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:42:56.534  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"5b168e02-b1f9-41a4-b9d8-af25c72af706"},"data_source_detail_dict":{"upload_file":{"id":"5b168e02-b1f9-41a4-b9d8-af25c72af706","name":"2024届湖北专升本英语真题_20240517141034.md","size":6555,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740973374.724391}},"dataset_process_rule_id":"df026429-e53b-42b3-b8e7-2335842d7853","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":165,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":194,"hit_count":0,"doc_form":"text_model"},"batch":"20250303034254268469"}
2025-03-03 11:42:56.534  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:42:56.535 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:42:56.536 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:42:56.561 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:42:56.712 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:42:56.715 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:42:56.716 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:42:56.742 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:42:56.929 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:42:57.504  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 11:42:57.528 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:42:57.529 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:42:57.582 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:42:57.774 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:42:57.776  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 11:42:57.776  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 11:42:57.776 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:42:57.776 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:42:57.845  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=bf7eb7c9-9954-4354-820a-e6380c429d17
2025-03-03 11:42:57.846 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"bf7eb7c9-9954-4354-820a-e6380c429d17"}},"response_mode":"blocking","conversation_id":"1a9846bd-f568-4ad3-9f78-e757e440372d","user":"fyjw"}
2025-03-03 11:43:04.793 ERROR 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:43:04.793  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477421271128555522&access_key=bb7b9baf52cfb3ea6870a3f168e7f8e2&service_id=33554678&ticket=2549bff4-b29e-48a7-9828-929a7af1ed4c [conn_id=7477421271128555522]
2025-03-03 11:43:04.794  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:43:13.111  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:43:13.540  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477421271129440258&access_key=aa18d5531c114ecc91efa7d6352bea6b&service_id=33554678&ticket=743522e7-f550-48b8-b3d6-1567dc647993 [conn_id=7477421271129440258]
2025-03-03 11:43:19.050  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知

上海浩港新村区鑫姚升元置业有限公司：

2022年9月1日与贵司签订的“上海市存量房租赁合同”（合同编号：202200176383），约定租赁期限至2023年8月31日止。

本小区因涉及旧改基地项目，正在开展意愿征询表决，该房屋的出租及使用现已涉及旧改项目政策要求。根据《上海市国有土地上房屋征收与补偿实施细则》（沪府令第113号）的相关规定，现通知如下：

在正式签订国有土地上房屋征收补偿协议之前，请贵司及承租户务必配合完成房屋的腾退工作，并将房屋交还原房屋所有权人。房屋腾退期间，承租户应按照合同约定支付租赁费用至房屋交还之日。合同期满后，如房屋未交还，相关租赁费用按总租金的4.75%月租金标准执行。

在收到本通知后，请贵司按上述要求积极配合完成房屋腾退工作。

在此通知下达后，房屋腾退工作应正式完成时限：即2023年12月8日之前。

联系人：程国全  
联系电话：13262792367  
杨晓强  
联系电话：15821244788  

2023年11月28日
```
2025-03-03 11:43:19.050 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"9bfe9560-59fd-4738-924a-f46f138ec107","workflow_run_id":"987a57ba-6680-4855-a442-135bcefa9fcd","data":{"id":"987a57ba-6680-4855-a442-135bcefa9fcd","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知\n\n上海浩港新村区鑫姚升元置业有限公司：\n\n2022年9月1日与贵司签订的“上海市存量房租赁合同”（合同编号：202200176383），约定租赁期限至2023年8月31日止。\n\n本小区因涉及旧改基地项目，正在开展意愿征询表决，该房屋的出租及使用现已涉及旧改项目政策要求。根据《上海市国有土地上房屋征收与补偿实施细则》（沪府令第113号）的相关规定，现通知如下：\n\n在正式签订国有土地上房屋征收补偿协议之前，请贵司及承租户务必配合完成房屋的腾退工作，并将房屋交还原房屋所有权人。房屋腾退期间，承租户应按照合同约定支付租赁费用至房屋交还之日。合同期满后，如房屋未交还，相关租赁费用按总租金的4.75%月租金标准执行。\n\n在收到本通知后，请贵司按上述要求积极配合完成房屋腾退工作。\n\n在此通知下达后，房屋腾退工作应正式完成时限：即2023年12月8日之前。\n\n联系人：程国全  \n联系电话：13262792367  \n杨晓强  \n联系电话：15821244788  \n\n2023年11月28日\n```"},"elapsed_time":21.13656078488566,"total_tokens":942,"total_steps":4,"created_at":1740973376,"finished_at":1740973397}}
2025-03-03 11:43:19.050  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1163
2025-03-03 11:43:19.051 DEBUG 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:43:19.452  INFO 32140 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"2457f635-fe9c-49af-9018-fa71180385ac"},"data_source_detail_dict":{"upload_file":{"id":"2457f635-fe9c-49af-9018-fa71180385ac","name":"程阿金和解通知.md","size":1163,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740973397.330015}},"dataset_process_rule_id":"25a032f8-a597-4ef7-ab47-fc769c82dfae","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":509,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":504,"hit_count":0,"doc_form":"text_model"},"batch":"20250303034317219220"}
2025-03-03 11:43:19.453  INFO 32140 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 11:43:19.628 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:43:19.629 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:43:19.654 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:43:19.806 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:43:19.807 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:43:19.807 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:43:19.833 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:43:20.008 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:43:20.013 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:43:20.013 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:43:20.038 DEBUG 32140 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:43:20.207 ERROR 32140 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:45:04.802 ERROR 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:45:04.803  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477421271129440258&access_key=aa18d5531c114ecc91efa7d6352bea6b&service_id=33554678&ticket=743522e7-f550-48b8-b3d6-1567dc647993 [conn_id=7477421271129440258]
2025-03-03 11:45:04.803  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:45:14.098  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:45:14.552  INFO 32140 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477422255422816284&access_key=63e0849e09ec8f33a12623da3af5ca60&service_id=33554678&ticket=05dd9a82-15bf-419a-9171-85bb3cdf2c95 [conn_id=7477422255422816284]
2025-03-03 11:45:46.727  INFO 32140 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:45:46.731  INFO 32140 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:45:48.210  INFO 19736 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 19736 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:45:48.211 DEBUG 19736 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:45:48.212  INFO 19736 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:45:48.480  INFO 19736 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:45:48.481  INFO 19736 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:45:48.493  INFO 19736 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 11:45:48.748  INFO 19736 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:45:48.751  INFO 19736 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:45:48.752  INFO 19736 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:45:48.823  INFO 19736 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:45:48.824  INFO 19736 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 591 ms
2025-03-03 11:45:48.977  INFO 19736 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:45:48.977  INFO 19736 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:45:49.578  INFO 19736 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:45:49.872  INFO 19736 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477422255422980124&access_key=feb54fdf21a3751d008fb31b1703eab8&service_id=33554678&ticket=9a7f6d80-dc1b-48e7-8332-39d24146a5de [conn_id=7477422255422980124]
2025-03-03 11:45:49.875  INFO 19736 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:45:49.881  INFO 19736 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.962 seconds (JVM running for 2.318)
2025-03-03 11:46:49.817 ERROR 19736 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 11:46:49.817  INFO 19736 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477422255422980124&access_key=feb54fdf21a3751d008fb31b1703eab8&service_id=33554678&ticket=9a7f6d80-dc1b-48e7-8332-39d24146a5de [conn_id=7477422255422980124]
2025-03-03 11:46:49.817  INFO 19736 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 11:47:17.769  INFO 19736 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 11:47:18.123  INFO 19736 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477422590392696833&access_key=3c79e861bd8d821fc03499d7c7753d56&service_id=33554678&ticket=93614b21-971c-4fc6-9345-b26f8cf94189 [conn_id=7477422590392696833]
2025-03-03 11:49:55.804  INFO 29472 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 29472 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:49:55.805 DEBUG 29472 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:49:55.805  INFO 29472 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:49:56.202  INFO 29472 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:49:56.204  INFO 29472 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:49:56.222  INFO 29472 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 11:49:56.561  INFO 29472 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:49:56.574  INFO 29472 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:49:56.574  INFO 29472 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:49:56.667  INFO 29472 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:49:56.667  INFO 29472 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 838 ms
2025-03-03 11:49:56.856  INFO 29472 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:49:56.857  INFO 29472 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:49:57.461  INFO 29472 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:49:57.746  INFO 29472 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477423856337321985&access_key=08efd07ebe1055879f24a3f689e21fed&service_id=33554678&ticket=3f77aa85-6828-480f-b3b4-8c695649ce6b [conn_id=7477423856337321985]
2025-03-03 11:49:57.811  INFO 29472 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:49:57.815  INFO 29472 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.252 seconds (JVM running for 2.661)
2025-03-03 11:50:00.686  INFO 29472 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740973798}
2025-03-03 11:50:00.715  WARN 29472 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @6adbc9d
2025-03-03 11:50:00.721  INFO 29472 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:50:01.120  INFO 29472 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:50:01.123 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:50:01.134 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:50:01.169 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:50:01.172 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:50:01.172 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:50:01.210 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:50:01.210 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:50:01.210 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:50:01.236 DEBUG 29472 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:50:01.236  INFO 29472 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:50:02.071  INFO 29472 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:50:02.072  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:50:02.710  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:50:00 GMT"],"eagleid":["74c4871717409738003396101e"],"request-id":["7d19d296-5d53-4fa8-ac82-93846dd1426f"],"server":["Tengine"],"server-timing":["inner; dur=503","cdn-cache;desc=MISS,edge;dur=0,origin;dur=530"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache18.cn7535[530,0]"],"x-lgw-dst-svc":["faBXyD_Q4s49Cl-ZxcSWmBR2Mf3sJZmdLykbfQFxTXppI-GNzpVfXWP88Q5ws9FdD6LCa2GWcjm-zEXKLPnGMBm3Teig9RkR3y57TGMvTGaGFa27HXFXfsXxQptgk4UrDYJEVMM-FcfU7bOntLko68dmCgTSkIIOBlTov3kgF3_6lt6iX7f_cyZqj0xY5mV7RMVPbaYz3MSDLCpcs4VDYtKxuQfSxO6BzNaRpXo5qzm47B6eQfYCysnyQt4-mb0gqBn2lebLeaY4HFvVFoCQxsc2sFfSzx974Jo9kDZgJNBu68L3Rry0-2A="],"x-request-id":["7d19d296-5d53-4fa8-ac82-93846dd1426f"],"x-timestamp":["1740973800.859"],"x-tt-logid":["20250303115000A062F50D68B1CCDB170A"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be2b694b5d909535a9937a8e8963df36374bd09f4e67fc1d093aa6c3635ce0e5651b43e156e98a1da65306642cfe9e275041278775a2cd8b8ebc33f02c3626384e5231a6dff7e7b508f88e707839141bee"],"x-tt-trace-id":["00-250303115000A062F50D68B1CCDB170A-5CF45B3165506FBE-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303115000A062F50D68B1CCDB170A","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303115000A062F50D68B1CCDB170A"}
2025-03-03 11:50:02.711  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:50:03.409  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:50:03.446 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:50:03.447 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:50:03.472 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:50:03.616 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:50:03.616  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=东九交付许可证.pdf
2025-03-03 11:50:03.616  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:50:03.617 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:50:03.619 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:50:03.819  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2ce6bc45-697c-45a3-9c21-1a50a9256c65
2025-03-03 11:50:03.820 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"2ce6bc45-697c-45a3-9c21-1a50a9256c65"}},"response_mode":"blocking","conversation_id":"265a8b94-ede2-4f8c-bc88-f79b58583001","user":"fyjw"}
2025-03-03 11:50:03.908  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=东九交付许可证.pdf, text=
2025-03-03 11:50:03.909 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"987f7f17-6fb1-441e-8b7a-b9a205e838e2","workflow_run_id":"b46a1d05-14ef-462d-b1ae-cdb15e605978","data":{"id":"b46a1d05-14ef-462d-b1ae-cdb15e605978","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.03805965604260564,"total_tokens":0,"total_steps":4,"created_at":1740973802,"finished_at":1740973802}}
2025-03-03 11:50:03.909  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:50:03.909 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:50:03.910 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:50:03.935 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:50:04.115 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:50:05.184  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:50:05.185  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:50:05.185 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:50:05.185 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:50:05.404  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8ae2ce86-d5a4-4d31-ae7c-e6d2bbf49da0
2025-03-03 11:50:05.404 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"8ae2ce86-d5a4-4d31-ae7c-e6d2bbf49da0"}},"response_mode":"blocking","conversation_id":"9ac484a4-44ba-4486-b72f-5472944a9838","user":"fyjw"}
2025-03-03 11:51:04.600  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

### 上海市房屋管理局 制制
```
2025-03-03 11:51:04.601 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"89739ba3-18ea-4ca2-970f-13cb6d8229c3","workflow_run_id":"104a4813-a56d-4583-a35c-7b7eaf200334","data":{"id":"104a4813-a56d-4583-a35c-7b7eaf200334","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n### 上海市房屋管理局 制制\n```"},"elapsed_time":59.14456387795508,"total_tokens":427,"total_steps":4,"created_at":1740973803,"finished_at":1740973862}}
2025-03-03 11:51:06.456  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:51:06.457  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:51:06.457 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:51:06.457 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:51:07.431  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=df6cb190-68e2-4895-8678-345291831230
2025-03-03 11:51:07.431 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"df6cb190-68e2-4895-8678-345291831230"}},"response_mode":"blocking","conversation_id":"757c922f-91de-4000-bb8e-bc592b151ea5","user":"fyjw"}
2025-03-03 11:53:07.579 ERROR 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:260) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:282) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:53:07.581 DEBUG 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 11:53:07.581  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=103
2025-03-03 11:53:07.581 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:53:07.692  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"7cb477a4-bcd2-4ece-9ca3-d1ff55104cdb"},"data_source_detail_dict":{"upload_file":{"id":"7cb477a4-bcd2-4ece-9ca3-d1ff55104cdb","name":"东九交付许可证.md","size":103,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740973985.866539}},"dataset_process_rule_id":"2e2c0f49-6f09-4486-8296-19ffa1d7637c","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":32,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":44,"hit_count":0,"doc_form":"text_model"},"batch":"20250303035305557180"}
2025-03-03 11:53:07.692  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 11:53:07.721 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:07.722 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:07.749 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:08.029 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:08.031 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:08.031 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:08.057 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:08.235 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:08.689  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:53:08.717 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:08.717 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:08.748 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:08.896 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:08.898  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:53:08.898  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 11:53:08.899 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:53:08.899 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:53:08.956  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d2e64ac2-087b-44c8-8dfd-7554cf725128
2025-03-03 11:53:08.957 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"d2e64ac2-087b-44c8-8dfd-7554cf725128"}},"response_mode":"blocking","conversation_id":"3af86d59-74fa-4dc6-bc09-734807487567","user":"fyjw"}
2025-03-03 11:53:09.069  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf, text=2024 届湖北专升本英语真题
一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分
1. I have confidence _________ (in/on) my future.
2. _______ (What/How) beautiful the East Lake is!
3. John _______ (is/are) familiar with Chinese culture.
4. There are ________ (much/many) ways to help others.
5. It is _______ (a/the) first time that I have seen the sea.
6. I’m sure you can solve the problem by ___________ (your/yourself).
7. I can lend my bike to you ________ (if/or) you return in on time.
8. The internet has _______ (great/greatly) changed the way we live.
9. When I was young, Dad often _________ (took/take) me to the museum.
10. I’m happy that the summer holiday ______ (will/would) begin next month.
二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分
11. the source of / is / Water / life __________________________________________________________________
12. My family / reading books / enjoy
__________________________________________________________________
13. the beauty around you / to discover / It is a joy
__________________________________________________________________
14. try our best / should / to realize our dreams / We __________________________________________________________________
15. was translated into / His book / last year / French__________________________________________________________________
16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分
Passage 1
...one of the most important gifts we can give our kids.【原文略】
Kids Need Free Play
Who：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and
youth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with
no cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2
（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are
very important for keeping Nubian giraffes safe.【原文略】
Keep an Eye on Giraffes
What: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS
collars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't
26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3
（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】
27. When did the story happen? ________________________________________________________________
28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________
29. Who gave up the seat to the old lady? ________________________________________________________________
30. Why did other passengers also get up? ________________________________________________________________
31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4
In my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a
trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an
article about a baseball game. I arrive at the stadium two hours before the game starts. I have got
heady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I
manage to get a short interview with the home team’s star player. I have limited time, so I only ask
a few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home
team wins! As the fans leave, I go to the press conference with other journalists. We listen to both
team coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and
the public will be reading my article over breakfast in the morning. I love sharing my love for
sport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________
33. Why does the writer ask only a few important questions? ________________________________________________________________
34. Who wins the baseball game in the end? ________________________________________________________________
35. How many hours does the writer have to write up his article? ________________________________________________________________
36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分
37. _______________ were you when you went to college? (old)
你多大上的大学？
38. Sorry, but I don’t know where ____________. (live)
抱歉，我不知道他住的地方。
39. Only by ____________ can you change your life. (work)
只有努力工作才能改变你的生活。
40. Please _____________ that you have enough rest. (sure)
请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)
旅行能让我们有机会认识来自不同文化背景的人。
42. The snow is ____________ that the whole world is covered in silver. (heavy)
雪下得如此之大，整个世界都银装素裹。
六．写作，共 10 分
根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：
1. 请他帮忙买一本关于阅读的英文书；
2. 书名为 On Reading；
3. 请他购买该书的原因；
4. 请他购买后尽快寄出；
5. 向他表示感谢。
注意：
1. 无需写标题；
2. 文章中不能出现个人姓名与学校名称；
3. 词数不少于 40。
2025-03-03 11:53:09.071 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"593463da-1af4-4604-9ac1-5de2cc07884d","workflow_run_id":"1f464297-87e5-4fb5-804a-3dde4de4b809","data":{"id":"1f464297-87e5-4fb5-804a-3dde4de4b809","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":"2024 届湖北专升本英语真题\r\n一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分\r\n1. I have confidence _________ (in/on) my future.\r\n2. _______ (What/How) beautiful the East Lake is!\r\n3. John _______ (is/are) familiar with Chinese culture.\r\n4. There are ________ (much/many) ways to help others.\r\n5. It is _______ (a/the) first time that I have seen the sea.\r\n6. I’m sure you can solve the problem by ___________ (your/yourself).\r\n7. I can lend my bike to you ________ (if/or) you return in on time.\r\n8. The internet has _______ (great/greatly) changed the way we live.\r\n9. When I was young, Dad often _________ (took/take) me to the museum.\r\n10. I’m happy that the summer holiday ______ (will/would) begin next month.\r\n二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分\r\n11. the source of / is / Water / life __________________________________________________________________\r\n12. My family / reading books / enjoy\r\n__________________________________________________________________\r\n13. the beauty around you / to discover / It is a joy\r\n__________________________________________________________________\r\n14. try our best / should / to realize our dreams / We __________________________________________________________________\r\n15. was translated into / His book / last year / French__________________________________________________________________\r\n16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分\r\nPassage 1\r\n...one of the most important gifts we can give our kids.【原文略】\r\nKids Need Free Play\r\nWho：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and\r\nyouth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with\r\nno cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2\r\n（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are\r\nvery important for keeping Nubian giraffes safe.【原文略】\r\nKeep an Eye on Giraffes\r\nWhat: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS\r\ncollars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't\r\n26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3\r\n（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】\r\n27. When did the story happen? ________________________________________________________________\r\n28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________\r\n29. Who gave up the seat to the old lady? ________________________________________________________________\r\n30. Why did other passengers also get up? ________________________________________________________________\r\n31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4\r\nIn my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a\r\ntrainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an\r\narticle about a baseball game. I arrive at the stadium two hours before the game starts. I have got\r\nheady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I\r\nmanage to get a short interview with the home team’s star player. I have limited time, so I only ask\r\na few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home\r\nteam wins! As the fans leave, I go to the press conference with other journalists. We listen to both\r\nteam coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and\r\nthe public will be reading my article over breakfast in the morning. I love sharing my love for\r\nsport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________\r\n33. Why does the writer ask only a few important questions? ________________________________________________________________\r\n34. Who wins the baseball game in the end? ________________________________________________________________\r\n35. How many hours does the writer have to write up his article? ________________________________________________________________\r\n36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分\r\n37. _______________ were you when you went to college? (old)\r\n你多大上的大学？\r\n38. Sorry, but I don’t know where ____________. (live)\r\n抱歉，我不知道他住的地方。\r\n39. Only by ____________ can you change your life. (work)\r\n只有努力工作才能改变你的生活。\r\n40. Please _____________ that you have enough rest. (sure)\r\n请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)\r\n旅行能让我们有机会认识来自不同文化背景的人。\r\n42. The snow is ____________ that the whole world is covered in silver. (heavy)\r\n雪下得如此之大，整个世界都银装素裹。\r\n六．写作，共 10 分\r\n根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：\r\n1. 请他帮忙买一本关于阅读的英文书；\r\n2. 书名为 On Reading；\r\n3. 请他购买该书的原因；\r\n4. 请他购买后尽快寄出；\r\n5. 向他表示感谢。\r\n注意：\r\n1. 无需写标题；\r\n2. 文章中不能出现个人姓名与学校名称；\r\n3. 词数不少于 40。"},"elapsed_time":0.06041196803562343,"total_tokens":0,"total_steps":4,"created_at":1740973987,"finished_at":1740973987}}
2025-03-03 11:53:09.071 DEBUG 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 11:53:09.071  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=6555
2025-03-03 11:53:09.071 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:53:09.212  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"a0b0080d-34e7-4ce8-97a0-3481f4e60575"},"data_source_detail_dict":{"upload_file":{"id":"a0b0080d-34e7-4ce8-97a0-3481f4e60575","name":"2024届湖北专升本英语真题_20240517141034.md","size":6555,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740973987.407867}},"dataset_process_rule_id":"67e34ee1-e979-4cc0-9807-7b88be1f9c92","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":1564,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":5581,"hit_count":0,"doc_form":"text_model"},"batch":"20250303035307942759"}
2025-03-03 11:53:09.213  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:53:09.214 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:09.214 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:09.308 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:09.460 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:09.461 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:09.461 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:09.490 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:09.627 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:10.057  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 11:53:10.084 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:10.084 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:10.126 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:10.277 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:10.278  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=程阿金和解通知.jpg
2025-03-03 11:53:10.278  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 11:53:10.278 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:53:10.278 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:53:10.349  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=895af990-ae99-4ee2-a5fc-a8c911b7cac8
2025-03-03 11:53:10.349 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"895af990-ae99-4ee2-a5fc-a8c911b7cac8"}},"response_mode":"blocking","conversation_id":"1efa6a04-1103-4fa2-a8b9-ebc363e8b6e8","user":"fyjw"}
2025-03-03 11:53:17.895  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩港新区金港先升实业有限公司：

2022年9月15日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵司尚未按合同约定支付购房款。

本小区系政府指定的动迁安置房，因贵司未及时支付房款，危房中的又无安置房可居住的动迁居民无法按期入住，导致社会矛盾日益激化。

在此事宜已多次催告无果的情况下，我司将于2023年12月8日向人民法院申请解除《上海市商品房预售合同》并追究贵司的违约责任。为避免因合同解除而产生诉讼费用和违约金、律师费、利息等损失（其中按合同约定需向我司支付的违约金为购房款总额的4.75%再扣减已付房款），请贵司于2023年12月8日前偿还拖欠款项。

在该日期后，如未收到贵司书面还款正式回复，我司将依法提起诉讼。

联系人：
程四合（签字）：  
电话：13262792367  
杨晓琴（签字）：  
电话：15821244703  

2023年11月28日
```
2025-03-03 11:53:17.896 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"5a40d8da-bfb6-4969-8e52-0840c5497230","workflow_run_id":"518e33ea-fd76-4052-8e59-757702ef030a","data":{"id":"518e33ea-fd76-4052-8e59-757702ef030a","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩港新区金港先升实业有限公司：\n\n2022年9月15日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵司尚未按合同约定支付购房款。\n\n本小区系政府指定的动迁安置房，因贵司未及时支付房款，危房中的又无安置房可居住的动迁居民无法按期入住，导致社会矛盾日益激化。\n\n在此事宜已多次催告无果的情况下，我司将于2023年12月8日向人民法院申请解除《上海市商品房预售合同》并追究贵司的违约责任。为避免因合同解除而产生诉讼费用和违约金、律师费、利息等损失（其中按合同约定需向我司支付的违约金为购房款总额的4.75%再扣减已付房款），请贵司于2023年12月8日前偿还拖欠款项。\n\n在该日期后，如未收到贵司书面还款正式回复，我司将依法提起诉讼。\n\n联系人：\n程四合（签字）：  \n电话：13262792367  \n杨晓琴（签字）：  \n电话：15821244703  \n\n2023年11月28日\n```"},"elapsed_time":7.486696982989088,"total_tokens":930,"total_steps":4,"created_at":1740973988,"finished_at":1740973996}}
2025-03-03 11:53:17.896  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1071
2025-03-03 11:53:17.896 DEBUG 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:53:17.988  INFO 29472 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"81eca4f6-9b1c-4fff-92ec-1d8500dc3bb3"},"data_source_detail_dict":{"upload_file":{"id":"81eca4f6-9b1c-4fff-92ec-1d8500dc3bb3","name":"程阿金和解通知.md","size":1071,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740973996.188991}},"dataset_process_rule_id":"d422357a-2720-4547-933a-45e892b7cb5b","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":458,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":444,"hit_count":0,"doc_form":"text_model"},"batch":"20250303035316587716"}
2025-03-03 11:53:17.989  INFO 29472 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 11:53:18.057 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:18.057 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:18.088 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:18.433 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:18.434 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:18.434 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:18.461 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:18.701 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:53:18.704 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:53:18.705 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:53:18.733 DEBUG 29472 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:53:19.033 ERROR 29472 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:54:01.523  INFO 29472 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:54:01.526  INFO 29472 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:54:03.485  INFO 30696 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 30696 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:54:03.486 DEBUG 30696 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:54:03.486  INFO 30696 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:54:03.755  INFO 30696 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:54:03.756  INFO 30696 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:54:03.768  INFO 30696 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 11:54:04.023  INFO 30696 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:54:04.027  INFO 30696 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:54:04.027  INFO 30696 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:54:04.095  INFO 30696 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:54:04.095  INFO 30696 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 589 ms
2025-03-03 11:54:04.254  INFO 30696 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:54:04.255  INFO 30696 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:54:04.783  INFO 30696 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:54:05.045  INFO 30696 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477424559059681281&access_key=fc821771d8525fac83315ef55f911b46&service_id=33554678&ticket=65547503-02a0-41d6-b990-a44a1ac0148b [conn_id=7477424559059681281]
2025-03-03 11:54:05.065  INFO 30696 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:54:05.069  INFO 30696 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.781 seconds (JVM running for 2.113)
2025-03-03 11:54:35.145  INFO 30696 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740974073}
2025-03-03 11:54:35.172  WARN 30696 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 11:54:35.178  INFO 30696 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:54:35.447  INFO 30696 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:54:35.452 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:54:35.463 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:54:35.496 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:54:35.499 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:54:35.500 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:54:35.522 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:54:35.522 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:54:35.522 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:54:35.543 DEBUG 30696 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:54:35.543  INFO 30696 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:54:36.398  INFO 30696 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:54:36.404  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:54:36.970  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:54:35 GMT"],"eagleid":["1bdd61a617409740746725875e"],"request-id":["de91cfe5-0b8f-462b-ad7d-eab2f6d12ae6"],"server":["Tengine"],"server-timing":["inner; dur=452","cdn-cache;desc=MISS,edge;dur=0,origin;dur=472"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache18.cn7150[472,0]"],"x-lgw-dst-svc":["R7OSTtOfJx3HVFSHXi6lZeTuI4GtCxmFmT7ZkeFWbBHADToYVxaTWVrFqUhNazgDSlRzFfFodn12W5RWTmjdSyqCZX0a_uj0xmXmfqz4R0G4ElqcM4uYR3MKK5_P8j8LGYP_Ss9deMBMWdQqJHO6luj3c6nPLEoZAn7-csaC4ibS0qsPgiB_BjwrI1ZYFlAJ0J-HCGGo7fqdzsBnQa2O_MNEJwKTv5EII6ji2EUApMFLjTqfjvXkubcihKD29_hLt-tPw8afq6htMyni2lOUoKHDRJFlBnFR0nZlD3SivyXjzFfDgEaTnw=="],"x-request-id":["de91cfe5-0b8f-462b-ad7d-eab2f6d12ae6"],"x-timestamp":["1740974075.136"],"x-tt-logid":["202503031154341316440C5A6FB6E74115"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e983bdd14d2279c69eccfd28b7f2b61ac4ab07c6b0250c59a830530f1b95a9d608766ef37df2e257aa7b09792f4780dd7a0019cb75fa8c2ec13290a8fe4786ce519bbf8271ac92d3adc5145d5980735ac71"],"x-tt-trace-id":["00-2503031154341316440C5A6FB6E74115-1B65865C23A29B7B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031154341316440C5A6FB6E74115","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503031154341316440C5A6FB6E74115"}
2025-03-03 11:54:36.971  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:54:37.585  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:54:37.608 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:54:37.609 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:54:37.631 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:54:37.802 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:54:37.802  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=东九交付许可证.pdf
2025-03-03 11:54:37.802  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:54:37.804 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:54:37.804 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:54:38.032  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=3b3172d9-df2e-4a12-bff9-54525ba1e45c
2025-03-03 11:54:38.033 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"3b3172d9-df2e-4a12-bff9-54525ba1e45c"}},"response_mode":"blocking","conversation_id":"b5ca0f95-5732-45a9-8d2d-617e42fe12f8","user":"fyjw"}
2025-03-03 11:54:38.186 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"093e0291-bcd4-416d-bfdd-5158da6f7679","workflow_run_id":"1dbb2426-dcf9-487a-a61b-ec887c61fcdc","data":{"id":"1dbb2426-dcf9-487a-a61b-ec887c61fcdc","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.08582752989605069,"total_tokens":0,"total_steps":4,"created_at":1740974076,"finished_at":1740974076}}
2025-03-03 11:54:38.186  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=东九交付许可证.pdf, text=
2025-03-03 11:54:38.187 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"093e0291-bcd4-416d-bfdd-5158da6f7679","workflow_run_id":"1dbb2426-dcf9-487a-a61b-ec887c61fcdc","data":{"id":"1dbb2426-dcf9-487a-a61b-ec887c61fcdc","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":""},"elapsed_time":0.08582752989605069,"total_tokens":0,"total_steps":4,"created_at":1740974076,"finished_at":1740974076}}
2025-03-03 11:54:38.187  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:54:38.208 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:54:38.209 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:54:38.230 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:54:38.415 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:54:39.517  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:54:39.517  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:54:39.517 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:54:39.517 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:54:39.689  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=af812783-5ea6-4f19-b864-97b86352316d
2025-03-03 11:54:39.689 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"af812783-5ea6-4f19-b864-97b86352316d"}},"response_mode":"blocking","conversation_id":"52af0e8a-00cc-48e9-ba7c-a1e12464f470","user":"fyjw"}
2025-03-03 11:55:46.832 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c84b2fd6-a9e1-4acd-b891-2a2761407015","workflow_run_id":"67386909-d838-4ee2-a33f-f6ce6911ff8d","data":{"id":"67386909-d838-4ee2-a33f-f6ce6911ff8d","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":67.09690943895839,"total_tokens":649,"total_steps":4,"created_at":1740974077,"finished_at":1740974145}}
2025-03-03 11:55:46.832  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制制
```
2025-03-03 11:55:46.833 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c84b2fd6-a9e1-4acd-b891-2a2761407015","workflow_run_id":"67386909-d838-4ee2-a33f-f6ce6911ff8d","data":{"id":"67386909-d838-4ee2-a33f-f6ce6911ff8d","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":67.09690943895839,"total_tokens":649,"total_steps":4,"created_at":1740974077,"finished_at":1740974145}}
2025-03-03 11:55:47.917  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:55:47.917  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:55:47.918 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:55:47.918 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:55:48.908  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=fe9b7b7c-88ce-4546-97bc-67850ee5fdac
2025-03-03 11:55:48.909 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"fe9b7b7c-88ce-4546-97bc-67850ee5fdac"}},"response_mode":"blocking","conversation_id":"ff711951-7d2d-4f1a-b35b-380d93413819","user":"fyjw"}
2025-03-03 11:57:11.958 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d86fafa6-531c-4c58-81f0-3c52d343e54f","workflow_run_id":"f681e2a6-3849-4ab3-8556-3cc6cd03d6ca","data":{"id":"f681e2a6-3849-4ab3-8556-3cc6cd03d6ca","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"failed","error":"[models] Server Unavailable Error, Error code: 504 - {'error': {'message': '请求上游服务器超时，请稍后重试  (request id: B202503031156535692973862QPLdnia)', 'type': 'new_api_error', 'param': '', 'code': 'request_timeout'}}","elapsed_time":83.00722368783318,"total_tokens":0,"total_steps":3,"created_at":1740974147,"finished_at":1740974230}}
2025-03-03 11:57:11.963 ERROR 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:261) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:283) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:57:11.964 DEBUG 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 11:57:11.964  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=99
2025-03-03 11:57:11.964 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:57:12.068  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"2f4efffd-9b1a-42a7-8073-2aeaeb35aeab"},"data_source_detail_dict":{"upload_file":{"id":"2f4efffd-9b1a-42a7-8073-2aeaeb35aeab","name":"东九交付许可证.md","size":99,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974230.260404}},"dataset_process_rule_id":"76845990-1048-4611-bd38-1df4c9c66340","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":32,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":48,"hit_count":0,"doc_form":"text_model"},"batch":"20250303035710722969"}
2025-03-03 11:57:12.068  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 11:57:12.091 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:12.092 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:12.123 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:12.379 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:12.381 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:12.382 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:12.402 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:12.580 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:13.135  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:57:13.157 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:13.158 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:13.181 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:13.324 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:13.325  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:57:13.326  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 11:57:13.326 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:57:13.327 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:57:13.377  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=6c83ba23-6bd4-41da-b9f6-934e3c40320f
2025-03-03 11:57:13.378 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"document","transfer_method":"local_file","upload_file_id":"6c83ba23-6bd4-41da-b9f6-934e3c40320f"}},"response_mode":"blocking","conversation_id":"6e0ebdbe-9df9-46df-81e7-be707fbf9ded","user":"fyjw"}
2025-03-03 11:57:13.491 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"3d8522e6-ebfe-4d0c-b7cd-28b017322a4f","workflow_run_id":"43d485d3-2215-458c-a512-7e0a5e22fb15","data":{"id":"43d485d3-2215-458c-a512-7e0a5e22fb15","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":"2024 届湖北专升本英语真题\r\n一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分\r\n1. I have confidence _________ (in/on) my future.\r\n2. _______ (What/How) beautiful the East Lake is!\r\n3. John _______ (is/are) familiar with Chinese culture.\r\n4. There are ________ (much/many) ways to help others.\r\n5. It is _______ (a/the) first time that I have seen the sea.\r\n6. I’m sure you can solve the problem by ___________ (your/yourself).\r\n7. I can lend my bike to you ________ (if/or) you return in on time.\r\n8. The internet has _______ (great/greatly) changed the way we live.\r\n9. When I was young, Dad often _________ (took/take) me to the museum.\r\n10. I’m happy that the summer holiday ______ (will/would) begin next month.\r\n二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分\r\n11. the source of / is / Water / life __________________________________________________________________\r\n12. My family / reading books / enjoy\r\n__________________________________________________________________\r\n13. the beauty around you / to discover / It is a joy\r\n__________________________________________________________________\r\n14. try our best / should / to realize our dreams / We __________________________________________________________________\r\n15. was translated into / His book / last year / French__________________________________________________________________\r\n16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分\r\nPassage 1\r\n...one of the most important gifts we can give our kids.【原文略】\r\nKids Need Free Play\r\nWho：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and\r\nyouth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with\r\nno cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2\r\n（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are\r\nvery important for keeping Nubian giraffes safe.【原文略】\r\nKeep an Eye on Giraffes\r\nWhat: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS\r\ncollars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't\r\n26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3\r\n（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】\r\n27. When did the story happen? ________________________________________________________________\r\n28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________\r\n29. Who gave up the seat to the old lady? ________________________________________________________________\r\n30. Why did other passengers also get up? ________________________________________________________________\r\n31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4\r\nIn my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a\r\ntrainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an\r\narticle about a baseball game. I arrive at the stadium two hours before the game starts. I have got\r\nheady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I\r\nmanage to get a short interview with the home team’s star player. I have limited time, so I only ask\r\na few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home\r\nteam wins! As the fans leave, I go to the press conference with other journalists. We listen to both\r\nteam coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and\r\nthe public will be reading my article over breakfast in the morning. I love sharing my love for\r\nsport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________\r\n33. Why does the writer ask only a few important questions? ________________________________________________________________\r\n34. Who wins the baseball game in the end? ________________________________________________________________\r\n35. How many hours does the writer have to write up his article? ________________________________________________________________\r\n36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分\r\n37. _______________ were you when you went to college? (old)\r\n你多大上的大学？\r\n38. Sorry, but I don’t know where ____________. (live)\r\n抱歉，我不知道他住的地方。\r\n39. Only by ____________ can you change your life. (work)\r\n只有努力工作才能改变你的生活。\r\n40. Please _____________ that you have enough rest. (sure)\r\n请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)\r\n旅行能让我们有机会认识来自不同文化背景的人。\r\n42. The snow is ____________ that the whole world is covered in silver. (heavy)\r\n雪下得如此之大，整个世界都银装素裹。\r\n六．写作，共 10 分\r\n根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：\r\n1. 请他帮忙买一本关于阅读的英文书；\r\n2. 书名为 On Reading；\r\n3. 请他购买该书的原因；\r\n4. 请他购买后尽快寄出；\r\n5. 向他表示感谢。\r\n注意：\r\n1. 无需写标题；\r\n2. 文章中不能出现个人姓名与学校名称；\r\n3. 词数不少于 40。"},"elapsed_time":0.06355610489845276,"total_tokens":0,"total_steps":4,"created_at":1740974231,"finished_at":1740974231}}
2025-03-03 11:57:13.492  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf, text=2024 届湖北专升本英语真题
一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分
1. I have confidence _________ (in/on) my future.
2. _______ (What/How) beautiful the East Lake is!
3. John _______ (is/are) familiar with Chinese culture.
4. There are ________ (much/many) ways to help others.
5. It is _______ (a/the) first time that I have seen the sea.
6. I’m sure you can solve the problem by ___________ (your/yourself).
7. I can lend my bike to you ________ (if/or) you return in on time.
8. The internet has _______ (great/greatly) changed the way we live.
9. When I was young, Dad often _________ (took/take) me to the museum.
10. I’m happy that the summer holiday ______ (will/would) begin next month.
二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分
11. the source of / is / Water / life __________________________________________________________________
12. My family / reading books / enjoy
__________________________________________________________________
13. the beauty around you / to discover / It is a joy
__________________________________________________________________
14. try our best / should / to realize our dreams / We __________________________________________________________________
15. was translated into / His book / last year / French__________________________________________________________________
16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分
Passage 1
...one of the most important gifts we can give our kids.【原文略】
Kids Need Free Play
Who：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and
youth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with
no cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2
（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are
very important for keeping Nubian giraffes safe.【原文略】
Keep an Eye on Giraffes
What: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS
collars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't
26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3
（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】
27. When did the story happen? ________________________________________________________________
28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________
29. Who gave up the seat to the old lady? ________________________________________________________________
30. Why did other passengers also get up? ________________________________________________________________
31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4
In my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a
trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an
article about a baseball game. I arrive at the stadium two hours before the game starts. I have got
heady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I
manage to get a short interview with the home team’s star player. I have limited time, so I only ask
a few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home
team wins! As the fans leave, I go to the press conference with other journalists. We listen to both
team coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and
the public will be reading my article over breakfast in the morning. I love sharing my love for
sport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________
33. Why does the writer ask only a few important questions? ________________________________________________________________
34. Who wins the baseball game in the end? ________________________________________________________________
35. How many hours does the writer have to write up his article? ________________________________________________________________
36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分
37. _______________ were you when you went to college? (old)
你多大上的大学？
38. Sorry, but I don’t know where ____________. (live)
抱歉，我不知道他住的地方。
39. Only by ____________ can you change your life. (work)
只有努力工作才能改变你的生活。
40. Please _____________ that you have enough rest. (sure)
请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)
旅行能让我们有机会认识来自不同文化背景的人。
42. The snow is ____________ that the whole world is covered in silver. (heavy)
雪下得如此之大，整个世界都银装素裹。
六．写作，共 10 分
根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：
1. 请他帮忙买一本关于阅读的英文书；
2. 书名为 On Reading；
3. 请他购买该书的原因；
4. 请他购买后尽快寄出；
5. 向他表示感谢。
注意：
1. 无需写标题；
2. 文章中不能出现个人姓名与学校名称；
3. 词数不少于 40。
2025-03-03 11:57:13.494 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"3d8522e6-ebfe-4d0c-b7cd-28b017322a4f","workflow_run_id":"43d485d3-2215-458c-a512-7e0a5e22fb15","data":{"id":"43d485d3-2215-458c-a512-7e0a5e22fb15","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"document":"2024 届湖北专升本英语真题\r\n一．填空题（从括号里给出的词选择一个完成句子填空），共 10 题，每题 2 分\r\n1. I have confidence _________ (in/on) my future.\r\n2. _______ (What/How) beautiful the East Lake is!\r\n3. John _______ (is/are) familiar with Chinese culture.\r\n4. There are ________ (much/many) ways to help others.\r\n5. It is _______ (a/the) first time that I have seen the sea.\r\n6. I’m sure you can solve the problem by ___________ (your/yourself).\r\n7. I can lend my bike to you ________ (if/or) you return in on time.\r\n8. The internet has _______ (great/greatly) changed the way we live.\r\n9. When I was young, Dad often _________ (took/take) me to the museum.\r\n10. I’m happy that the summer holiday ______ (will/would) begin next month.\r\n二．连词成句（将所给词正确排列顺序连成一个句子），共 6 题，每题 2 分\r\n11. the source of / is / Water / life __________________________________________________________________\r\n12. My family / reading books / enjoy\r\n__________________________________________________________________\r\n13. the beauty around you / to discover / It is a joy\r\n__________________________________________________________________\r\n14. try our best / should / to realize our dreams / We __________________________________________________________________\r\n15. was translated into / His book / last year / French__________________________________________________________________\r\n16. has attracted / more and more people / Life in the countryside __________________________________________________________________ 三．阅读填词（根据文章内容完成填空，每空填 1 个词），共 2 篇 10 题，每题 2 分\r\nPassage 1\r\n...one of the most important gifts we can give our kids.【原文略】\r\nKids Need Free Play\r\nWho：Giving our kids time to play is not a choice but a 17 . Why: Play is important to the 18 , social, and emotional well-being of children and\r\nyouth. What: Parents should 19 free play. The word “free” means both “ 20 ” and “with\r\nno cost”. Why: Free play enables kids to 21 with others and learn important social skills. Passage 2\r\n（第二段部分）Because of this, the GCF decided to work with African Parks. These parks are\r\nvery important for keeping Nubian giraffes safe.【原文略】\r\nKeep an Eye on Giraffes\r\nWhat: Giraffes are quietly 22 because their favourite 23 is difficult to find. GPS\r\ncollars were used to keep an eye on giraffes but they didn't 24 on for long. How: New tracking devices, which are as 25 as a chocolate bar, solar-powered, and don't\r\n26 giraffes much, are used to stop illegal hunting to keep giraffes safe. 四．阅读理解（根据文章内容完成问答），共 2 篇 10 题， 每题 2 分Passage 3\r\n（第一段部分）It was on Sunday morning, when Sam went to see his grandfather alone【. 原文略】\r\n27. When did the story happen? ________________________________________________________________\r\n28. How did Sam go to see his grandfather, by bike or by bus? ________________________________________________________________\r\n29. Who gave up the seat to the old lady? ________________________________________________________________\r\n30. Why did other passengers also get up? ________________________________________________________________\r\n31. Translate the sentence “what a lovely little girl” into Chinese. ________________________________________________________________ Passage 4\r\nIn my job, I get to combine my two passion: sport and writing. I write newspaper articles about sport while studying for my journalism degree. I worked as a\r\ntrainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an\r\narticle about a baseball game. I arrive at the stadium two hours before the game starts. I have got\r\nheady for my work. By now the players are arriving, so I hurry down to wait outside the changing area when I\r\nmanage to get a short interview with the home team’s star player. I have limited time, so I only ask\r\na few important questions, such as how his feeling and what the expect actions are. Once the game starts, I take note on the action as it happens. It is an exciting game. The home\r\nteam wins! As the fans leave, I go to the press conference with other journalists. We listen to both\r\nteam coaches’ thoughts on the game and I get some good quotes. Finally, it is time for me to pull all my notes together into the finished article to send to thenewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and\r\nthe public will be reading my article over breakfast in the morning. I love sharing my love for\r\nsport through words. 32. What newspaper articles does the writer write about? ________________________________________________________________\r\n33. Why does the writer ask only a few important questions? ________________________________________________________________\r\n34. Who wins the baseball game in the end? ________________________________________________________________\r\n35. How many hours does the writer have to write up his article? ________________________________________________________________\r\n36. Translate the sentence “I love sharing my love for sport through words” into Chinese. ________________________________________________________________ 五．翻译填空（使用括号单词根据汉语提示完成句子），共 6 题，每题 3 分\r\n37. _______________ were you when you went to college? (old)\r\n你多大上的大学？\r\n38. Sorry, but I don’t know where ____________. (live)\r\n抱歉，我不知道他住的地方。\r\n39. Only by ____________ can you change your life. (work)\r\n只有努力工作才能改变你的生活。\r\n40. Please _____________ that you have enough rest. (sure)\r\n请确保你有足够的休息。41. Travel can give us a chance __________ people from different cultures. (meet)\r\n旅行能让我们有机会认识来自不同文化背景的人。\r\n42. The snow is ____________ that the whole world is covered in silver. (heavy)\r\n雪下得如此之大，整个世界都银装素裹。\r\n六．写作，共 10 分\r\n根据所给信息，编辑一条英语手机短信发送给你的好朋友 Tom，主要内容包括：\r\n1. 请他帮忙买一本关于阅读的英文书；\r\n2. 书名为 On Reading；\r\n3. 请他购买该书的原因；\r\n4. 请他购买后尽快寄出；\r\n5. 向他表示感谢。\r\n注意：\r\n1. 无需写标题；\r\n2. 文章中不能出现个人姓名与学校名称；\r\n3. 词数不少于 40。"},"elapsed_time":0.06355610489845276,"total_tokens":0,"total_steps":4,"created_at":1740974231,"finished_at":1740974231}}
2025-03-03 11:57:13.494 DEBUG 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 11:57:13.494  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=6555
2025-03-03 11:57:13.494 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:57:13.575  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"fde1e31b-93f8-4427-b204-f5f8d1bb5d8a"},"data_source_detail_dict":{"upload_file":{"id":"fde1e31b-93f8-4427-b204-f5f8d1bb5d8a","name":"2024届湖北专升本英语真题_20240517141034.md","size":6555,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974231.775503}},"dataset_process_rule_id":"6f2ecba8-a8a8-493a-9361-136795616fc6","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":1564,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":5581,"hit_count":0,"doc_form":"text_model"},"batch":"20250303035711432670"}
2025-03-03 11:57:13.575  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 11:57:13.576 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:13.576 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:13.600 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:13.738 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:13.740 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:13.741 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:13.761 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:13.922 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:14.407  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 11:57:14.428 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:14.428 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:14.449 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:14.598 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:14.600  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析文件: fileName=程阿金和解通知.jpg
2025-03-03 11:57:14.601  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 11:57:14.601 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:57:14.601 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:57:14.667  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ffe95abe-909f-4896-aa65-2a37264fe09e
2025-03-03 11:57:14.667 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送文件分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"ffe95abe-909f-4896-aa65-2a37264fe09e"}},"response_mode":"blocking","conversation_id":"eb3d5447-fda2-4ff3-a15b-b216e6ce89a3","user":"fyjw"}
2025-03-03 11:57:28.452 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d7c93a00-a7d7-4d6b-a0c7-2a162419cf7c","workflow_run_id":"b3553487-82f8-4cdf-aedf-085789015d53","data":{"id":"b3553487-82f8-4cdf-aedf-085789015d53","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩湃新区金姚东方置业有限公司：\n\n2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵公司尚未支付房屋尾款，现本司郑重通知如下：\n\n本小区业主委员会为维护业主的合法权益，保障业主的房产物权不受侵害，故决定于2023年12月8日对贵公司所有房屋的门锁进行更换，届时将对房屋进行强制清退。\n\n在正式更换门锁之前，请贵公司及时缴纳房屋尾款，并领取所购房屋的钥匙。若贵公司在通知期限内仍未缴纳尾款，我们将视为贵公司放弃所购房屋的权利。特此声明，贵公司需按照合同约定支付自2022年9月1日至今的房屋滞纳金，滞纳金标准为4.75%/天起。\n\n在送达本通知函后，本通知将正式生效。时间：2023年12月8日早上8:00，请知悉并按时整改。\n\n联系人：程四合  电话：13262792367  \n杨晓强  电话：15821244780\n\n2023年11月28日\n```"},"elapsed_time":13.73337645502761,"total_tokens":700,"total_steps":4,"created_at":1740974232,"finished_at":1740974246}}
2025-03-03 11:57:28.453  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函

上海浩湃新区金姚东方置业有限公司：

2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵公司尚未支付房屋尾款，现本司郑重通知如下：

本小区业主委员会为维护业主的合法权益，保障业主的房产物权不受侵害，故决定于2023年12月8日对贵公司所有房屋的门锁进行更换，届时将对房屋进行强制清退。

在正式更换门锁之前，请贵公司及时缴纳房屋尾款，并领取所购房屋的钥匙。若贵公司在通知期限内仍未缴纳尾款，我们将视为贵公司放弃所购房屋的权利。特此声明，贵公司需按照合同约定支付自2022年9月1日至今的房屋滞纳金，滞纳金标准为4.75%/天起。

在送达本通知函后，本通知将正式生效。时间：2023年12月8日早上8:00，请知悉并按时整改。

联系人：程四合  电话：13262792367  
杨晓强  电话：15821244780

2023年11月28日
```
2025-03-03 11:57:28.453 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d7c93a00-a7d7-4d6b-a0c7-2a162419cf7c","workflow_run_id":"b3553487-82f8-4cdf-aedf-085789015d53","data":{"id":"b3553487-82f8-4cdf-aedf-085789015d53","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函\n\n上海浩湃新区金姚东方置业有限公司：\n\n2022年9月1日与贵公司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵公司尚未支付房屋尾款，现本司郑重通知如下：\n\n本小区业主委员会为维护业主的合法权益，保障业主的房产物权不受侵害，故决定于2023年12月8日对贵公司所有房屋的门锁进行更换，届时将对房屋进行强制清退。\n\n在正式更换门锁之前，请贵公司及时缴纳房屋尾款，并领取所购房屋的钥匙。若贵公司在通知期限内仍未缴纳尾款，我们将视为贵公司放弃所购房屋的权利。特此声明，贵公司需按照合同约定支付自2022年9月1日至今的房屋滞纳金，滞纳金标准为4.75%/天起。\n\n在送达本通知函后，本通知将正式生效。时间：2023年12月8日早上8:00，请知悉并按时整改。\n\n联系人：程四合  电话：13262792367  \n杨晓强  电话：15821244780\n\n2023年11月28日\n```"},"elapsed_time":13.73337645502761,"total_tokens":700,"total_steps":4,"created_at":1740974232,"finished_at":1740974246}}
2025-03-03 11:57:28.453  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1034
2025-03-03 11:57:28.453 DEBUG 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 11:57:28.543  INFO 30696 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"eab1e688-066d-475b-8806-6c1c93273bdf"},"data_source_detail_dict":{"upload_file":{"id":"eab1e688-066d-475b-8806-6c1c93273bdf","name":"程阿金和解通知.md","size":1034,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974246.746734}},"dataset_process_rule_id":"ce6cb17e-b172-41fe-aff9-870362fb6821","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":412,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":413,"hit_count":0,"doc_form":"text_model"},"batch":"20250303035726459860"}
2025-03-03 11:57:28.544  INFO 30696 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 11:57:28.577 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:28.578 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:28.600 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:28.734 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:28.735 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:28.735 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:28.756 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:28.935 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:57:28.941 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:57:28.941 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:57:28.963 DEBUG 30696 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:57:29.108 ERROR 30696 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:58:45.138  INFO 30696 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:58:45.141  INFO 30696 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:58:48.079  INFO 1956 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 1956 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:58:48.080 DEBUG 1956 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:58:48.081  INFO 1956 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:58:48.369  INFO 1956 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:58:48.370  INFO 1956 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:58:48.384  INFO 1956 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 11:58:48.675  INFO 1956 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:58:48.681  INFO 1956 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:58:48.681  INFO 1956 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:58:48.765  INFO 1956 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:58:48.765  INFO 1956 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 665 ms
2025-03-03 11:58:48.947  INFO 1956 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:58:48.947  INFO 1956 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:58:49.473  INFO 1956 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:58:49.719  INFO 1956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477425259864293404&access_key=dd911ef534084d8d34a5f2c54a3ec8c9&service_id=33554678&ticket=46ac7c40-b159-4243-8339-6eadc0123dac [conn_id=7477425259864293404]
2025-03-03 11:58:49.777  INFO 1956 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:58:49.782  INFO 1956 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.876 seconds (JVM running for 2.223)
2025-03-03 11:58:51.058  INFO 1956 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740974329}
2025-03-03 11:58:51.085  WARN 1956 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @6adbc9d
2025-03-03 11:58:51.091  INFO 1956 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:58:51.443  INFO 1956 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:58:51.447 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:58:51.457 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:58:51.489 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:58:51.492 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:58:51.492 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:58:51.515 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:58:51.516 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:58:51.516 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:58:51.539 DEBUG 1956 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:58:51.540  INFO 1956 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:58:52.365  INFO 1956 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:58:52.366  INFO 1956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:58:52.908  INFO 1956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:58:51 GMT"],"eagleid":["74c48fb617409743306336154e"],"request-id":["7f62c865-d790-4064-8e4a-3408a567bc65"],"server":["Tengine"],"server-timing":["inner; dur=421","cdn-cache;desc=MISS,edge;dur=0,origin;dur=446"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache34.cn7149[446,0]"],"x-lgw-dst-svc":["5VfeE6C7DnGBxny6UdAcPKBi-k6l9_eBrWSIuaSAj953jUWVQdV512SK_nhSekDsDp7SxW6nEoJStlksn8K4g4s9e8CJrc6xD20j7Vz6vzbPetqKXT_9eY8ldW26z9pEd82xeEEwsz1dors2fcV8GYWH-ktpnzVM4m3HkB6pHU78fdwoM3kCd_mIo2VbluGhD3WUpev9mvwXKwokgTwl7k_Ze0UiTNKg2CVyfTM6VGqfo1y60gpK99Y5z5SspxqTw_nCEq1jgkUt4nULchIjgI5pfkw-W2nGMVK8FWbo67fm-uYN7V39aWk="],"x-request-id":["7f62c865-d790-4064-8e4a-3408a567bc65"],"x-timestamp":["1740974331.074"],"x-tt-logid":["20250303115850C57E2948A1A890E6E924"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1bed2d51085c84630fca81594c662b2401875cd7313776ad849bee6ad5df8524cb9d5091338248a49d33e19d6a0f159e93c4f1fe600a806be72503f5aee27b854e4b0bcc26088cab98319c7946bebeccdbd"],"x-tt-trace-id":["00-250303115850C57E2948A1A890E6E924-6C608E24356D15C7-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303115850C57E2948A1A890E6E924","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303115850C57E2948A1A890E6E924"}
2025-03-03 11:58:52.909  INFO 1956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:58:53.477  INFO 1956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:58:53.501 DEBUG 1956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:58:53.502 DEBUG 1956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:58:53.525 DEBUG 1956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:58:53.692 ERROR 1956 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:58:53.693  INFO 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:58:53.693  INFO 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:58:53.694 DEBUG 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:58:53.695 DEBUG 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:58:53.926  INFO 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=e2f102c3-0c1e-423d-84b9-05d939bfe4fd
2025-03-03 11:58:53.926 DEBUG 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"e2f102c3-0c1e-423d-84b9-05d939bfe4fd"}},"response_mode":"blocking","conversation_id":"60d5540c-dd8c-4890-a099-e49807f562fd","user":"fyjw"}
2025-03-03 11:58:53.959 ERROR 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:287) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:58:53.959  INFO 1956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:58:53.960 DEBUG 1956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:58:53.960 DEBUG 1956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:58:53.993 DEBUG 1956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:58:54.183 ERROR 1956 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:58:55.247  INFO 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:58:55.247  INFO 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:58:55.247 DEBUG 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:58:55.247 DEBUG 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:58:55.466  INFO 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=21847efd-1b03-4dba-84c6-b8c14e1505cb
2025-03-03 11:58:55.466 DEBUG 1956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"21847efd-1b03-4dba-84c6-b8c14e1505cb"}},"response_mode":"blocking","conversation_id":"0cafc8c5-c8f2-4ebb-a2e5-6ffd9b656474","user":"fyjw"}
2025-03-03 11:59:20.023 ERROR 1956 --- [pool-2-thread-3] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 71a83684-2536-4378-9435-953b61d437b5, trace_id: 1f974e5b51e9d071933197a3f6796940, [conn_id=7477425259864293404]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:59:34.062  INFO 1956 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 11:59:34.065  INFO 1956 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 11:59:35.741  INFO 9672 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 9672 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 11:59:35.742 DEBUG 9672 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 11:59:35.742  INFO 9672 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 11:59:36.001  INFO 9672 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 11:59:36.002  INFO 9672 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 11:59:36.014  INFO 9672 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 11:59:36.273  INFO 9672 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 11:59:36.279  INFO 9672 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 11:59:36.280  INFO 9672 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 11:59:36.355  INFO 9672 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 11:59:36.356  INFO 9672 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 593 ms
2025-03-03 11:59:36.524  INFO 9672 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 11:59:36.525  INFO 9672 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 11:59:37.069  INFO 9672 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 11:59:37.279  INFO 9672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477424716286836737&access_key=fc10dd5a209dd183921ed5e02429ab37&service_id=33554678&ticket=c79f3f6c-8d46-4e41-bcf5-9d270163b42b [conn_id=7477424716286836737]
2025-03-03 11:59:37.360  INFO 9672 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 11:59:37.365  INFO 9672 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.854 seconds (JVM running for 2.202)
2025-03-03 11:59:37.747  INFO 9672 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740974375}
2025-03-03 11:59:37.774  WARN 9672 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 11:59:37.780  INFO 9672 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 11:59:38.080  INFO 9672 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 11:59:38.084 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:59:38.095 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:59:38.133 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:59:38.137 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:59:38.137 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:59:38.160 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:59:38.160 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 11:59:38.161 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 11:59:38.184 DEBUG 9672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 11:59:38.184  INFO 9672 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 11:59:39.046  INFO 9672 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:59:39.048  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 11:59:39.566  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 03:59:37 GMT"],"eagleid":["74c4871917409743773278530e"],"request-id":["67425755-8e90-4817-a23e-f00a2c55f391"],"server":["Tengine"],"server-timing":["inner; dur=393","cdn-cache;desc=MISS,edge;dur=0,origin;dur=410"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn7535[410,0]"],"x-lgw-dst-svc":["4zjm_NCeqS-qmZEjCauwsd2lAYl88BysjShyR_BLqz-UHHhnliXnJ8U7-5o4WfCNs48-yFkJgDBPQ8Lst5G-VN8etT3rlFyCj-Z2yhLPx-Qw177H6IAeCm9pNJ44ATJhFwsmdLxrHf88nu94b3l1SYazfgxha2074G32Jk_c3zZHXbv9pbq7x4UlA5T_5TZ5_JcOaO6BhfGxSJhT6IU1FnXi2s9tMTlxJW213fhTTkFygwPZ6xRdV5CF5GCsmHtdfdR3m-j7TYJYppC31oB1-4Q3j1-ZfTWzzI_7KUhXeapmUo-NYUSFVzc="],"x-request-id":["67425755-8e90-4817-a23e-f00a2c55f391"],"x-timestamp":["1740974377.727"],"x-tt-logid":["202503031159375E4F20F0F6D58CE8EFBA"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be7f606a5fbffcd1e67d12dbf406bdde1765508b9c27e2e239e677beb660538e2cf3b546780bea6d8209db767f57c9825bbcb86519a2557e4863d9bcfa57d9a91fd84a0860ef2079478809387af435f242"],"x-tt-trace-id":["00-2503031159375E4F20F0F6D58CE8EFBA-090ABE6279F1C917-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031159375E4F20F0F6D58CE8EFBA","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503031159375E4F20F0F6D58CE8EFBA"}
2025-03-03 11:59:39.567  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 11:59:40.294  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 11:59:40.319 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:59:40.319 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:59:40.344 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:59:40.506 ERROR 9672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:59:40.507  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 11:59:40.507  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 11:59:40.508 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:59:40.509 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:59:40.775  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a38cd007-a4ac-4a01-9ea1-a7bce980a216
2025-03-03 11:59:40.775 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"a38cd007-a4ac-4a01-9ea1-a7bce980a216"}},"response_mode":"blocking","conversation_id":"86e623ac-74fa-4498-ac7e-07470ec7e6db","user":"fyjw"}
2025-03-03 11:59:40.814 ERROR 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:287) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 11:59:40.814  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 11:59:40.815 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 11:59:40.815 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 11:59:40.838 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 11:59:41.012 ERROR 9672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 11:59:42.105  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 11:59:42.105  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 11:59:42.105 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:59:42.105 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:59:42.290  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b4bdc4ca-1d7e-49de-b47c-1acdebf58413
2025-03-03 11:59:42.290 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"b4bdc4ca-1d7e-49de-b47c-1acdebf58413"}},"response_mode":"blocking","conversation_id":"14216cdd-05f4-4c15-82a4-8eb44e08fb9d","user":"fyjw"}
2025-03-03 11:59:53.918  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制制
```
2025-03-03 11:59:53.919 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"813feb85-0e11-44cb-b30b-fbf6d2becdcb","workflow_run_id":"8a037628-05b2-48eb-8c84-89b0d647a6c6","data":{"id":"8a037628-05b2-48eb-8c84-89b0d647a6c6","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":11.592057147994637,"total_tokens":649,"total_steps":4,"created_at":1740974380,"finished_at":1740974392}}
2025-03-03 11:59:55.055  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 11:59:55.056  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 11:59:55.056 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 11:59:55.056 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 11:59:56.052  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=cf276ded-1ff9-4ec7-b5a1-e893dabe293c
2025-03-03 11:59:56.052 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"cf276ded-1ff9-4ec7-b5a1-e893dabe293c"}},"response_mode":"blocking","conversation_id":"ceab6c94-2f9f-4f6e-aecb-8aeef13800a1","user":"fyjw"}
2025-03-03 12:00:38.795 ERROR 9672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:00:38.796  INFO 9672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477424716286836737&access_key=fc10dd5a209dd183921ed5e02429ab37&service_id=33554678&ticket=c79f3f6c-8d46-4e41-bcf5-9d270163b42b [conn_id=7477424716286836737]
2025-03-03 12:00:38.796  INFO 9672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:00:52.655  INFO 9672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:00:52.997  INFO 9672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426443606867970&access_key=1f5a26786ab1537ddd4131b8a8230727&service_id=33554678&ticket=4050efaa-ae75-4a35-b2f4-3ac6b8d722b2 [conn_id=7477426443606867970]
2025-03-03 12:01:38.494 ERROR 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:265) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:287) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:01:38.498 DEBUG 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:01:38.498  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=99
2025-03-03 12:01:38.498 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:01:38.591  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"55346e90-36f5-4331-a7b5-0c35a0289c71"},"data_source_detail_dict":{"upload_file":{"id":"55346e90-36f5-4331-a7b5-0c35a0289c71","name":"东九交付许可证.md","size":99,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974496.787598}},"dataset_process_rule_id":"3a785f65-ada4-471e-b3ff-6316347f4a85","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":32,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":44,"hit_count":0,"doc_form":"text_model"},"batch":"20250303040136722963"}
2025-03-03 12:01:38.592  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 12:01:38.617 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:01:38.617 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:01:38.643 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:01:38.839 ERROR 9672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:01:38.840 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:01:38.841 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:01:38.870 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:01:39.033 ERROR 9672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:01:39.514  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:01:39.538 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:01:39.538 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:01:39.564 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:01:39.721 ERROR 9672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:01:39.722  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:01:39.722  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 12:01:39.722 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:01:39.722 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:01:39.795  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=26f00080-09d4-4957-bafe-842ded82673a
2025-03-03 12:01:39.795 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"26f00080-09d4-4957-bafe-842ded82673a"}},"response_mode":"blocking","conversation_id":"1ca1017f-42ac-4da2-8cbb-9d35587432c5","user":"fyjw"}
2025-03-03 12:01:39.837 ERROR 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:287) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:01:39.837  INFO 9672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:01:39.838 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:01:39.838 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:01:39.901 DEBUG 9672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:01:40.082 ERROR 9672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:01:40.325  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png
2025-03-03 12:01:40.325  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, userId=system
2025-03-03 12:01:40.326 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:01:40.326 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:01:40.440  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=fd5370a8-d762-44f0-b405-5b20b7001331
2025-03-03 12:01:40.440 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"fd5370a8-d762-44f0-b405-5b20b7001331"}},"response_mode":"blocking","conversation_id":"f6c13e25-fc53-470c-bc7b-857de119eaf5","user":"fyjw"}
2025-03-03 12:01:50.734  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, text=```markdown
# 2024届英语十月份月考试题

## 一、完型填空（从括号里选择的词填到每个空处完成句子，共10题，每题2分）

1. I have **confidence** (in/on) myself.  
2. She is **(are/is)** familiar with Chinese culture.  
3. There are **(much/many)** ways to help others.  
4. I saw the sea before I **(have/has)** seen the sea.  
5. How **(What/How)** beautiful the East Lake is!  
6. If you lend me your bike, I’ll **(borrow/return)** on time.  
7. He grows **(great/greatly)** changed these days.  
8. In those years, Dad often **(took/take)** me to the museum.  
9. My brother and I will **(begin/begun)** next month.  
10. She is **(an/a)** honest girl.  

---

## 二、根据提示完成句子，每空一词，共5题，每题2分

11. The source of air is **Water / Life**.  
12. My family **(reading books / enjoy)**.  
13. The beauty around you to feel / it is a joy **(to realize)**.  
14. Try our best / should / to realize our dreams / We.  
15. **Was translated into / His book / last year / French**.  
```
2025-03-03 12:01:50.734 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"ca58c4de-b18b-461f-a8d7-67377696bc12","workflow_run_id":"f2ea2b3a-2fb8-42fe-a649-84acab3a2a10","data":{"id":"f2ea2b3a-2fb8-42fe-a649-84acab3a2a10","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 2024届英语十月份月考试题\n\n## 一、完型填空（从括号里选择的词填到每个空处完成句子，共10题，每题2分）\n\n1. I have **confidence** (in/on) myself.  \n2. She is **(are/is)** familiar with Chinese culture.  \n3. There are **(much/many)** ways to help others.  \n4. I saw the sea before I **(have/has)** seen the sea.  \n5. How **(What/How)** beautiful the East Lake is!  \n6. If you lend me your bike, I’ll **(borrow/return)** on time.  \n7. He grows **(great/greatly)** changed these days.  \n8. In those years, Dad often **(took/take)** me to the museum.  \n9. My brother and I will **(begin/begun)** next month.  \n10. She is **(an/a)** honest girl.  \n\n---\n\n## 二、根据提示完成句子，每空一词，共5题，每题2分\n\n11. The source of air is **Water / Life**.  \n12. My family **(reading books / enjoy)**.  \n13. The beauty around you to feel / it is a joy **(to realize)**.  \n14. Try our best / should / to realize our dreams / We.  \n15. **Was translated into / His book / last year / French**.  \n```"},"elapsed_time":10.2521370369941,"total_tokens":717,"total_steps":4,"created_at":1740974498,"finished_at":1740974508}}
2025-03-03 12:01:50.975  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png
2025-03-03 12:01:50.976  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, userId=system
2025-03-03 12:01:50.976 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:01:50.976 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:01:51.049  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=e20c3683-b79a-48dc-9358-c1f35b9364e4
2025-03-03 12:01:51.050 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"e20c3683-b79a-48dc-9358-c1f35b9364e4"}},"response_mode":"blocking","conversation_id":"145a8fac-47c8-4632-bbd9-32d6b00c9580","user":"fyjw"}
2025-03-03 12:02:03.978  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, text=```markdown
16. has attracted / more and more people / Life in the countryside

---

## 三、阅读短文（根据文章内容完成表格，每空不超过一个词），共 2 篇 10 题，每题 2 分

### Passage 1

...one of the most important gifts we can give to kids. 【答案】

### Kids Need Free Play

- **Who**: Giving our kids time to play is not a choice but a ______.  
- **Why**: It helps to improve the ______, social, and emotional well-being of children and youth.  
- **What**: Parents should ______ 19 ______ free play. The word "free" means "both ______ 20 ______ and 'with no costs'."  
- **Why**: Free play enables kids to ______ with others and learn important social rules.

---

### Passage 2

### Keep an Eye on Giraffes

- **What**: Giraffes are quietly ______ 22 ______ because of the GCF decided to work with African Parks. Their goal is to find. GPS collars were put on giraffes to keep an eye on giraffes but they only ______ 23 ______ on for long.  
- **How**: New tracking devices, which are also ______ 24 ______ solar-powered, and don't ______ 25 ______ noise, are used to stop illegal hunting to keep giraffes safe.

---

## 四、阅读短文（根据文章内容回答问题，共 2 篇 10 题，每题 2 分）
```
2025-03-03 12:02:03.978 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"a783a76f-d6a1-4e26-8ded-e6599b82e171","workflow_run_id":"30471340-bd0b-4ba1-aa34-3a93974a238e","data":{"id":"30471340-bd0b-4ba1-aa34-3a93974a238e","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n16. has attracted / more and more people / Life in the countryside\n\n---\n\n## 三、阅读短文（根据文章内容完成表格，每空不超过一个词），共 2 篇 10 题，每题 2 分\n\n### Passage 1\n\n...one of the most important gifts we can give to kids. 【答案】\n\n### Kids Need Free Play\n\n- **Who**: Giving our kids time to play is not a choice but a ______.  \n- **Why**: It helps to improve the ______, social, and emotional well-being of children and youth.  \n- **What**: Parents should ______ 19 ______ free play. The word \"free\" means \"both ______ 20 ______ and 'with no costs'.\"  \n- **Why**: Free play enables kids to ______ with others and learn important social rules.\n\n---\n\n### Passage 2\n\n### Keep an Eye on Giraffes\n\n- **What**: Giraffes are quietly ______ 22 ______ because of the GCF decided to work with African Parks. Their goal is to find. GPS collars were put on giraffes to keep an eye on giraffes but they only ______ 23 ______ on for long.  \n- **How**: New tracking devices, which are also ______ 24 ______ solar-powered, and don't ______ 25 ______ noise, are used to stop illegal hunting to keep giraffes safe.\n\n---\n\n## 四、阅读短文（根据文章内容回答问题，共 2 篇 10 题，每题 2 分）\n```"},"elapsed_time":12.885766854975373,"total_tokens":941,"total_steps":4,"created_at":1740974509,"finished_at":1740974522}}
2025-03-03 12:02:04.172  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png
2025-03-03 12:02:04.172  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, userId=system
2025-03-03 12:02:04.172 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:02:04.172 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:02:04.240  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=c04260f6-c169-49ed-9539-05ce2f35c2dc
2025-03-03 12:02:04.240 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"c04260f6-c169-49ed-9539-05ce2f35c2dc"}},"response_mode":"blocking","conversation_id":"dfbd8be0-7436-4c1c-81ec-1b803719a364","user":"fyjw"}
2025-03-03 12:02:16.839  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, text=```markdown
### Passage 3

(第一段内容) It was on Sunday morning, when Sam went to see his grandfather alone.【原文略】

27. When did the story happen?

28. How did Sam go to see his grandfather, by bike or by bus?

29. Who gave up the seat to the old lady?

30. Why did other passengers also get up?

31. Translate the sentence "what a lovely little girl" into Chinese.

---

### Passage 4

In my job, I get to come to many exciting sports events.

When I was a teenager, I was quite good at writing stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game begins to prepare myself.

The players are warming up, so I hurry down to wait outside the changing area when I manage to get a short interview with a star player. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects from the game.

Then I take some notes while the action at it happens. The game is exciting. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.

Finally, it is time for me to pull all my notes together into the finished article to send to the editor.
```
2025-03-03 12:02:16.839 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d947fb92-4e54-4670-b4c1-b679ff68d58f","workflow_run_id":"3f4494c4-4a4a-4f14-879f-d992dd959561","data":{"id":"3f4494c4-4a4a-4f14-879f-d992dd959561","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n### Passage 3\n\n(第一段内容) It was on Sunday morning, when Sam went to see his grandfather alone.【原文略】\n\n27. When did the story happen?\n\n28. How did Sam go to see his grandfather, by bike or by bus?\n\n29. Who gave up the seat to the old lady?\n\n30. Why did other passengers also get up?\n\n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n---\n\n### Passage 4\n\nIn my job, I get to come to many exciting sports events.\n\nWhen I was a teenager, I was quite good at writing stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game begins to prepare myself.\n\nThe players are warming up, so I hurry down to wait outside the changing area when I manage to get a short interview with a star player. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects from the game.\n\nThen I take some notes while the action at it happens. The game is exciting. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.\n\nFinally, it is time for me to pull all my notes together into the finished article to send to the editor.\n```"},"elapsed_time":12.552550703985617,"total_tokens":936,"total_steps":4,"created_at":1740974522,"finished_at":1740974535}}
2025-03-03 12:02:17.063  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png
2025-03-03 12:02:17.063  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, userId=system
2025-03-03 12:02:17.063 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:02:17.063 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:02:17.136  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=89818ac9-e57d-4a8e-a949-b1a5e6021a89
2025-03-03 12:02:17.136 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"89818ac9-e57d-4a8e-a949-b1a5e6021a89"}},"response_mode":"blocking","conversation_id":"4f2e9fef-55bb-44d3-b668-ce2f66be4985","user":"fyjw"}
2025-03-03 12:02:25.555  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, text=```markdown
newspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning.  
*I love sharing my love for sport through words.*

32. What newspaper articles does the writer write about?  
_________________________________________________________________________________________

33. Why does the writer ask only a few important questions?  
_________________________________________________________________________________________

34. Who wins the baseball game in the end?  
_________________________________________________________________________________________

35. How many hours does the writer have to write up his article?  
_________________________________________________________________________________________

36. Translate the sentence "I love sharing my love for sport through words" into Chinese.  
_________________________________________________________________________________________

---

五、翻译下列句子（每题1分，共15分）。注意语法、时态和句型结构。

37. 你不是上大学时认识他的吗？(old)  
_________________________________________________________________________________________

38. 我可以借你的笔吗？(borrow)  
_________________________________________________________________________________________

39. 你够自信吗？(sure)  
_________________________________________________________________________________________

40. Please ______________ that you have enough rest. (sure)  
请确保你休息得足够。
```

2025-03-03 12:02:25.555 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"4709ab16-ee0d-4d33-a73d-bb57ed18719c","workflow_run_id":"1d066d67-89a0-421f-afbf-6a7a8dcc195c","data":{"id":"1d066d67-89a0-421f-afbf-6a7a8dcc195c","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning.  \n*I love sharing my love for sport through words.*\n\n32. What newspaper articles does the writer write about?  \n_________________________________________________________________________________________\n\n33. Why does the writer ask only a few important questions?  \n_________________________________________________________________________________________\n\n34. Who wins the baseball game in the end?  \n_________________________________________________________________________________________\n\n35. How many hours does the writer have to write up his article?  \n_________________________________________________________________________________________\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.  \n_________________________________________________________________________________________\n\n---\n\n五、翻译下列句子（每题1分，共15分）。注意语法、时态和句型结构。\n\n37. 你不是上大学时认识他的吗？(old)  \n_________________________________________________________________________________________\n\n38. 我可以借你的笔吗？(borrow)  \n_________________________________________________________________________________________\n\n39. 你够自信吗？(sure)  \n_________________________________________________________________________________________\n\n40. Please ______________ that you have enough rest. (sure)  \n请确保你休息得足够。\n```\n"},"elapsed_time":8.365866289008409,"total_tokens":877,"total_steps":4,"created_at":1740974535,"finished_at":1740974543}}
2025-03-03 12:02:25.795  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png
2025-03-03 12:02:25.795  INFO 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, userId=system
2025-03-03 12:02:25.795 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:02:25.795 DEBUG 9672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:02:25.837  INFO 9672 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 12:02:25.840  INFO 9672 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 12:02:28.786  INFO 8612 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 8612 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 12:02:28.787 DEBUG 8612 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 12:02:28.787  INFO 8612 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 12:02:29.046  INFO 8612 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 12:02:29.047  INFO 8612 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 12:02:29.061  INFO 8612 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 12:02:29.347  INFO 8612 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 12:02:29.352  INFO 8612 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 12:02:29.353  INFO 8612 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 12:02:29.432  INFO 8612 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 12:02:29.432  INFO 8612 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 626 ms
2025-03-03 12:02:29.597  INFO 8612 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 12:02:29.598  INFO 8612 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 12:02:30.124  INFO 8612 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 12:02:30.381  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426443607130114&access_key=b894c026bed315103ecf05567ce7af5d&service_id=33554678&ticket=9a8abfa4-6296-49e5-8ba7-35ee3583fce9 [conn_id=7477426443607130114]
2025-03-03 12:02:30.434  INFO 8612 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 12:02:30.440  INFO 8612 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.814 seconds (JVM running for 2.135)
2025-03-03 12:02:31.335  INFO 8612 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740974549}
2025-03-03 12:02:31.367  WARN 8612 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 12:02:31.374  INFO 8612 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 12:02:31.635  INFO 8612 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 12:02:31.639 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:02:31.650 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:02:31.689 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:02:31.692 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:02:31.692 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:02:31.712 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:02:31.713 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:02:31.713 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:02:31.732 DEBUG 8612 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:02:31.733  INFO 8612 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 12:02:32.718  INFO 8612 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:02:32.719  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:02:33.231  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:02:31 GMT"],"eagleid":["74c4871817409745509944727e"],"request-id":["d5c6ff9a-c1fc-40eb-9b58-39ce6b4d9cf5"],"server":["Tengine"],"server-timing":["inner; dur=392","cdn-cache;desc=MISS,edge;dur=0,origin;dur=417"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache19.cn7535[417,0]"],"x-lgw-dst-svc":["AuS-OdGhP4XRhDUvIZQJp-uh0O76gXWPQpbj9p-7cDQe2MqTF-b3EC1t2IdgTF9pNwreA3Wp2Rt5BEUW_YDQ7LXINFMQkhHRHgFsvcawvvfguEwICWxgEzNr0TXo9BopDd36L65I8AJN6nrc6ZBmLwypVewfjh-MO3RtkwYu8IpSzMp4PjKjsUHF2nM1YMhnUtEKHctTGKP25s7lDhhoWWqbkIpOxC8-Ne6W4x2Xd-JKeDdH7qn3_rXswd9pefSg9xCm7pNbudR17iNFsw1kYf_iJ41w1_C5gPUUsHmkx7NnGFsvJc66"],"x-request-id":["d5c6ff9a-c1fc-40eb-9b58-39ce6b4d9cf5"],"x-timestamp":["1740974551.400"],"x-tt-logid":["202503031202311C2148ECA21E43E52451"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be2236ae61fb6bafb136d41fd3b7547bf5798adfec295c3f0bed38377f3f1d261adb683b8815508075447873b9f1095f649c37f52a124b960da3d833742b0e106799d708f429a9e6107befce9d5dab588b"],"x-tt-trace-id":["00-2503031202311C2148ECA21E43E52451-721BFA346AC6100B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031202311C2148ECA21E43E52451","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"202503031202311C2148ECA21E43E52451"}
2025-03-03 12:02:33.231  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 12:02:33.800  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 12:02:33.824 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:02:33.824 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:02:33.847 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:02:34.011 ERROR 8612 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:02:34.012  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 12:02:34.012  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 12:02:34.014 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:02:34.014 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:02:34.203  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2d29fc71-0b02-42e3-9316-06a51f686007
2025-03-03 12:02:34.203 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"2d29fc71-0b02-42e3-9316-06a51f686007"}},"response_mode":"blocking","conversation_id":"dbe1c73d-cd23-40d1-b5d1-9cf2d914e159","user":"fyjw"}
2025-03-03 12:02:34.242 ERROR 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:02:34.242  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 12:02:34.242 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:02:34.243 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:02:34.263 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:02:34.390 ERROR 8612 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:02:35.460  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 12:02:35.460  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 12:02:35.460 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:02:35.461 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:02:35.648  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a5ee646b-cd12-4819-ab40-353a6cb436ae
2025-03-03 12:02:35.648 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"a5ee646b-cd12-4819-ab40-353a6cb436ae"}},"response_mode":"blocking","conversation_id":"f253acff-93c7-41f2-8d7b-2b7ae2ab92d9","user":"fyjw"}
2025-03-03 12:02:54.457 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"bb54f8ef-6151-4ddc-a2df-19b0c96ba94e","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":18.768083528848365,"total_tokens":649,"total_steps":4,"created_at":1740974553,"finished_at":1740974572}
2025-03-03 12:02:54.458  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 制制
```
2025-03-03 12:02:54.458 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"92c329a7-830c-4d8f-bd10-76fdaeea42cc","workflow_run_id":"bb54f8ef-6151-4ddc-a2df-19b0c96ba94e","data":{"id":"bb54f8ef-6151-4ddc-a2df-19b0c96ba94e","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 制制\n```"},"elapsed_time":18.768083528848365,"total_tokens":649,"total_steps":4,"created_at":1740974553,"finished_at":1740974572}}
2025-03-03 12:02:55.546  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 12:02:55.546  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 12:02:55.546 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:02:55.546 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:02:56.552  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=98405a92-0da1-46b8-ac60-010caac1c632
2025-03-03 12:02:56.552 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"98405a92-0da1-46b8-ac60-010caac1c632"}},"response_mode":"blocking","conversation_id":"2090a387-41dc-483b-a7d8-4ff57eb89e9a","user":"fyjw"}
2025-03-03 12:03:02.750 ERROR 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:03:02.751  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426443607130114&access_key=b894c026bed315103ecf05567ce7af5d&service_id=33554678&ticket=9a8abfa4-6296-49e5-8ba7-35ee3583fce9 [conn_id=7477426443607130114]
2025-03-03 12:03:02.751  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:03:27.775  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:03:28.090  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426075531853825&access_key=5ab20ab52a90f06401ce31a0734996a1&service_id=33554678&ticket=dc8fa617-76a0-4f3a-bac0-0def56ef2ebd [conn_id=7477426075531853825]
2025-03-03 12:04:27.822 ERROR 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:04:27.822  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426075531853825&access_key=5ab20ab52a90f06401ce31a0734996a1&service_id=33554678&ticket=dc8fa617-76a0-4f3a-bac0-0def56ef2ebd [conn_id=7477426075531853825]
2025-03-03 12:04:27.822  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:04:33.471  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:04:33.737  INFO 8612 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426796500353025&access_key=6f551f1ad8cbbb8f0e634f9867c34649&service_id=33554678&ticket=c0ef080d-032a-40d2-9ef4-beb349744d3a [conn_id=7477426796500353025]
2025-03-03 12:04:57.450 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"4b05113e-6c4a-45cc-97fb-86d0be6f6bfd","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"failed","error":"[models] Server Unavailable Error, Error code: 504 - {'error': {'message': '请求上游服务器超时，请稍后重试  (request id: B20250303120438989459510h98mLROt)', 'type': 'new_api_error', 'param': '', 'code': 'request_timeout'}}","elapsed_time":120.84993041004054,"total_tokens":0,"total_steps":3,"created_at":1740974574,"finished_at":1740974695}
2025-03-03 12:04:57.451 ERROR 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:266) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:04:57.454 DEBUG 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:04:57.454  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=99
2025-03-03 12:04:57.454 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:04:57.545  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"4cc69c49-fb52-4d25-a3f2-ff130579ea80"},"data_source_detail_dict":{"upload_file":{"id":"4cc69c49-fb52-4d25-a3f2-ff130579ea80","name":"东九交付许可证.md","size":99,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974695.742883}},"dataset_process_rule_id":"1a82d4ce-059a-4ed2-ad0d-3dae50e24173","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":32,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":44,"hit_count":0,"doc_form":"text_model"},"batch":"20250303040455944090"}
2025-03-03 12:04:57.546  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 12:04:57.572 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:04:57.572 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:04:57.592 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:04:57.823 ERROR 8612 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:04:57.827 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:04:57.827 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:04:57.850 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:04:57.995 ERROR 8612 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:04:58.424  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:04:58.444 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:04:58.444 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:04:58.464 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:04:58.605 ERROR 8612 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:04:58.605  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:04:58.606  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 12:04:58.606 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:04:58.606 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:04:58.650  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=59cbe54f-5635-4d3d-b127-20afdc5c3a0c
2025-03-03 12:04:58.650 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"59cbe54f-5635-4d3d-b127-20afdc5c3a0c"}},"response_mode":"blocking","conversation_id":"c3a71b63-7394-4a36-ac1f-ede1eae72343","user":"fyjw"}
2025-03-03 12:04:58.681 ERROR 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:04:58.682  INFO 8612 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:04:58.684 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:04:58.685 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:04:58.706 DEBUG 8612 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:04:58.860 ERROR 8612 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:04:59.198  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png
2025-03-03 12:04:59.198  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, userId=system
2025-03-03 12:04:59.198 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:04:59.198 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:04:59.260  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=df05f73c-d07c-41fe-a7da-5e01c6923125
2025-03-03 12:04:59.261 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"df05f73c-d07c-41fe-a7da-5e01c6923125"}},"response_mode":"blocking","conversation_id":"d64ede24-9966-469e-96d2-f1ea3132c1c5","user":"fyjw"}
2025-03-03 12:05:07.207 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"b39af8cc-0d5c-41b0-af78-3aecc5f7ca27","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 2024届高三学生考试试题\n\n## 一、完句题（从括号里抽出的词语选择一个完成句子，每题2分，共10题，每题2分）\n\n1. I have confidence (in / on) my future.  \n2. She (is / are) familiar with Chinese culture.  \n3. There are ________ (much/many) ways to help others.  \n4. I (have / has) never seen the sea before.  \n5. ________ (What/How) beautiful the East Lake is!  \n6. If you lend me your bike, I’ll (return / returns) it on time.  \n7. The greens (are greatly / greatly are) changed the way they live.  \n8. When I was young, Dad often took (take) me to the museum.  \n9. I’m too tired to take part in the meeting, which (will / would) begin next month.  \n10. The source of air is (Water / Fire).  \n\n---\n\n## 二、句子改错题（每题2分，共15题）\n\n11. My family / reading books / enjoy  \n12. the beauty around you / to enjoy it / it is a joy  \n13. try our best / should / to realize our dreams / We  \n14. was translated into / His book / last year / French\n```"},"elapsed_time":7.907238070154563,"total_tokens":914,"total_steps":4,"created_at":1740974697,"finished_at":1740974705}
2025-03-03 12:05:07.207  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, text=```markdown
# 2024届高三学生考试试题

## 一、完句题（从括号里抽出的词语选择一个完成句子，每题2分，共10题，每题2分）

1. I have confidence (in / on) my future.  
2. She (is / are) familiar with Chinese culture.  
3. There are ________ (much/many) ways to help others.  
4. I (have / has) never seen the sea before.  
5. ________ (What/How) beautiful the East Lake is!  
6. If you lend me your bike, I’ll (return / returns) it on time.  
7. The greens (are greatly / greatly are) changed the way they live.  
8. When I was young, Dad often took (take) me to the museum.  
9. I’m too tired to take part in the meeting, which (will / would) begin next month.  
10. The source of air is (Water / Fire).  

---

## 二、句子改错题（每题2分，共15题）

11. My family / reading books / enjoy  
12. the beauty around you / to enjoy it / it is a joy  
13. try our best / should / to realize our dreams / We  
14. was translated into / His book / last year / French
```
2025-03-03 12:05:07.207 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"70ead0a8-7caa-4fc9-a11d-d43149b38e97","workflow_run_id":"b39af8cc-0d5c-41b0-af78-3aecc5f7ca27","data":{"id":"b39af8cc-0d5c-41b0-af78-3aecc5f7ca27","workflow_id":"6964a422-f907-4140-a813-5a02deb06554","status":"succeeded","outputs":{"image":"```markdown\n# 2024届高三学生考试试题\n\n## 一、完句题（从括号里抽出的词语选择一个完成句子，每题2分，共10题，每题2分）\n\n1. I have confidence (in / on) my future.  \n2. She (is / are) familiar with Chinese culture.  \n3. There are ________ (much/many) ways to help others.  \n4. I (have / has) never seen the sea before.  \n5. ________ (What/How) beautiful the East Lake is!  \n6. If you lend me your bike, I’ll (return / returns) it on time.  \n7. The greens (are greatly / greatly are) changed the way they live.  \n8. When I was young, Dad often took (take) me to the museum.  \n9. I’m too tired to take part in the meeting, which (will / would) begin next month.  \n10. The source of air is (Water / Fire).  \n\n---\n\n## 二、句子改错题（每题2分，共15题）\n\n11. My family / reading books / enjoy  \n12. the beauty around you / to enjoy it / it is a joy  \n13. try our best / should / to realize our dreams / We  \n14. was translated into / His book / last year / French\n```"},"elapsed_time":7.907238070154563,"total_tokens":914,"total_steps":4,"created_at":1740974697,"finished_at":1740974705}}
2025-03-03 12:05:07.542  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png
2025-03-03 12:05:07.542  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, userId=system
2025-03-03 12:05:07.542 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:05:07.542 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:05:07.656  INFO 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=055b4372-d24e-4f38-9872-e66d35bfd7cc
2025-03-03 12:05:07.656 DEBUG 8612 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"055b4372-d24e-4f38-9872-e66d35bfd7cc"}},"response_mode":"blocking","conversation_id":"62ae3f80-6da8-44b6-bad6-cebeba005297","user":"fyjw"}
2025-03-03 12:05:25.106  INFO 8612 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 12:05:25.111  INFO 8612 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 12:05:26.458  INFO 7672 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 7672 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 12:05:26.459 DEBUG 7672 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 12:05:26.460  INFO 7672 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 12:05:26.758  INFO 7672 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 12:05:26.759  INFO 7672 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 12:05:26.772  INFO 7672 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 12:05:27.034  INFO 7672 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 12:05:27.039  INFO 7672 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 12:05:27.040  INFO 7672 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 12:05:27.109  INFO 7672 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 12:05:27.109  INFO 7672 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 619 ms
2025-03-03 12:05:27.270  INFO 7672 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 12:05:27.271  INFO 7672 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 12:05:27.742  INFO 7672 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 12:05:27.912  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426796500582401&access_key=560a325cf2c1dc5543f81c49c76ff871&service_id=33554678&ticket=5d848ae3-a5ec-4aa8-be5a-c1f997d542f7 [conn_id=7477426796500582401]
2025-03-03 12:05:28.030  INFO 7672 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 12:05:28.035  INFO 7672 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.76 seconds (JVM running for 2.094)
2025-03-03 12:05:35.265  INFO 7672 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740974733}
2025-03-03 12:05:35.296  WARN 7672 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 12:05:35.302  INFO 7672 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 12:05:35.573  INFO 7672 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 12:05:35.579 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:05:35.589 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:05:35.620 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:05:35.623 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:05:35.623 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:05:35.644 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:05:35.645 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:05:35.645 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:05:35.664 DEBUG 7672 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:05:35.665  INFO 7672 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 12:05:36.479  INFO 7672 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:05:36.480  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:05:37.016  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:05:35 GMT"],"eagleid":["74c48fa317409747347482871e"],"request-id":["a7ce9310-d2a1-401c-940b-89d28fb32809"],"server":["Tengine"],"server-timing":["inner; dur=419","cdn-cache;desc=MISS,edge;dur=0,origin;dur=443"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache15.cn7149[443,0]"],"x-lgw-dst-svc":["0OhYC2mJcwYwcZDUQHVzzFkXS2-VomMbFz0C7hAa8wGD2mD72r59x31b-SJmsAik1lpgjikD76Y6ViLwMkinnXCRtKcq64TE10lSsqy2tMnaiEMjiHr7nJsYtJBGsNldYqj9MYaPOJ_Eoj5saYV8eOOAviNj2QLbkYgO00o5GS-QT3PhfY-S8hW6fpLryFMHsNOc7Pet6diYgPERlsTjm43sMHjOTQ84qZhQp79LTW-PUxf8tJlaCLVvwkgizCX080tHsRP7OIN1D81T6S7bqisn816WLmH4NI7rXBn3SJwtA2tyInqk3d8="],"x-request-id":["a7ce9310-d2a1-401c-940b-89d28fb32809"],"x-timestamp":["1740974735.183"],"x-tt-logid":["20250303120534192EF56D3BCA7CE561B1"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be23be891a864292bc1d2c6d5af26ad7c2a62f857fb7df17f9b1f59f9544ee9e627e48e8a5ad480f00f642ed6a0b06e08f7a1ecfa7aac13990e96a853337c18532aed8ac69675eb324a21334f02ba5d012"],"x-tt-trace-id":["00-250303120534192EF56D3BCA7CE561B1-51B72DF715E55310-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303120534192EF56D3BCA7CE561B1","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303120534192EF56D3BCA7CE561B1"}
2025-03-03 12:05:37.016  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 12:05:37.580  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 12:05:37.601 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:05:37.602 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:05:37.624 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:05:37.783 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:05:37.784  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 12:05:37.784  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 12:05:37.786 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:05:37.787 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:05:37.966  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=76a31b36-ad77-42fa-9ec4-9cfb969ed9cc
2025-03-03 12:05:37.966 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"76a31b36-ad77-42fa-9ec4-9cfb969ed9cc"}},"response_mode":"blocking","conversation_id":"341d9fe8-c418-4119-b5b1-cea95326c68f","user":"fyjw"}
2025-03-03 12:05:37.999 ERROR 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:05:38.000  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 12:05:38.001 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:05:38.001 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:05:38.023 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:05:38.152 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:05:39.290  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 12:05:39.291  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 12:05:39.291 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:05:39.291 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:05:39.466  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=163833aa-f938-4cbe-b586-98b073281309
2025-03-03 12:05:39.466 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"163833aa-f938-4cbe-b586-98b073281309"}},"response_mode":"blocking","conversation_id":"13f3aa97-c236-4e74-b2a2-c92c7f55d9fe","user":"fyjw"}
2025-03-03 12:05:47.709 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"f7154417-e4b7-4a7e-b4f0-6953adde25fd","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"succeeded","outputs":{"image":"很抱歉，根据我所了解的政策和法规，我不能为您提供此类服务。我建议您咨询专业的法律机构或者当地的政府机构，以获取更准确和权威的信息。"},"elapsed_time":8.197345274034888,"total_tokens":592,"total_steps":4,"created_at":1740974737,"finished_at":1740974745}
2025-03-03 12:05:47.710  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=很抱歉，根据我所了解的政策和法规，我不能为您提供此类服务。我建议您咨询专业的法律机构或者当地的政府机构，以获取更准确和权威的信息。
2025-03-03 12:05:47.710 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"1834d79c-1b5c-483c-bb40-1c57507ba0e5","workflow_run_id":"f7154417-e4b7-4a7e-b4f0-6953adde25fd","data":{"id":"f7154417-e4b7-4a7e-b4f0-6953adde25fd","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"succeeded","outputs":{"image":"很抱歉，根据我所了解的政策和法规，我不能为您提供此类服务。我建议您咨询专业的法律机构或者当地的政府机构，以获取更准确和权威的信息。"},"elapsed_time":8.197345274034888,"total_tokens":592,"total_steps":4,"created_at":1740974737,"finished_at":1740974745}}
2025-03-03 12:05:48.813  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 12:05:48.813  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 12:05:48.813 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:05:48.813 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:05:49.791  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=835d221f-4339-4ebc-9a6c-41afcbc26b2f
2025-03-03 12:05:49.792 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"835d221f-4339-4ebc-9a6c-41afcbc26b2f"}},"response_mode":"blocking","conversation_id":"c1b58b9d-c509-43df-b865-8fb68af4acd5","user":"fyjw"}
2025-03-03 12:06:06.509 ERROR 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:06:06.509  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426796500582401&access_key=560a325cf2c1dc5543f81c49c76ff871&service_id=33554678&ticket=5d848ae3-a5ec-4aa8-be5a-c1f997d542f7 [conn_id=7477426796500582401]
2025-03-03 12:06:06.509  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:06:13.215  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:06:13.468  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426075532410881&access_key=8e670f56340e6f1daa92020631ab9a7d&service_id=33554678&ticket=80cc117b-4fe0-4334-92d1-1ee097ef13c0 [conn_id=7477426075532410881]
2025-03-03 12:06:36.071 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"9cf750be-f50c-4c50-bf59-fd021b72d332","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"failed","error":"[siliconflow] Error: PluginInvokeError: {\"args\":{\"description\":\"[models] Error: API request failed with status code 413: {\\\"code\\\":20043,\\\"message\\\":\\\"Too large images. Total size should less than 5MB.\\\",\\\"data\\\":null}\"},\"error_type\":\"InvokeError\",\"message\":\"[models] Error: API request failed with status code 413: {\\\"code\\\":20043,\\\"message\\\":\\\"Too large images. Total size should less than 5MB.\\\",\\\"data\\\":null}\"}","elapsed_time":46.235024401918054,"total_tokens":0,"total_steps":3,"created_at":1740974748,"finished_at":1740974794}
2025-03-03 12:06:36.071 ERROR 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:266) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:06:36.073 DEBUG 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:06:36.073  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=196
2025-03-03 12:06:36.073 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:06:36.149  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"093be520-508f-425c-9a54-caea5a769ab3"},"data_source_detail_dict":{"upload_file":{"id":"093be520-508f-425c-9a54-caea5a769ab3","name":"东九交付许可证.md","size":196,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974794.357563}},"dataset_process_rule_id":"47aae94d-c085-47bc-97fd-a1807c53b76e","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":32,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":44,"hit_count":0,"doc_form":"text_model"},"batch":"20250303040634350048"}
2025-03-03 12:06:36.150  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 12:06:36.170 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:06:36.171 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:06:36.193 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:06:36.360 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:06:36.362 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:06:36.362 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:06:36.384 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:06:36.540 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:06:36.888  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:06:36.908 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:06:36.909 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:06:36.930 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:06:37.074 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:06:37.074  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:06:37.074  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 12:06:37.074 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:06:37.074 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:06:37.132  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8ff29704-9b53-478f-a6b2-6ef9600cda0e
2025-03-03 12:06:37.133 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"8ff29704-9b53-478f-a6b2-6ef9600cda0e"}},"response_mode":"blocking","conversation_id":"3d109948-6a8f-42ec-90f7-a1a39a723f3f","user":"fyjw"}
2025-03-03 12:06:37.162 ERROR 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:06:37.162  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:06:37.163 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:06:37.163 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:06:37.184 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:06:37.316 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:06:37.575  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png
2025-03-03 12:06:37.575  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, userId=system
2025-03-03 12:06:37.575 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:06:37.575 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:06:37.650  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2ffd78ef-c71f-42ed-a735-3ebdadbf2d5e
2025-03-03 12:06:37.650 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"2ffd78ef-c71f-42ed-a735-3ebdadbf2d5e"}},"response_mode":"blocking","conversation_id":"28d32d53-4226-462d-855c-07856b1e3839","user":"fyjw"}
2025-03-03 12:06:49.286 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"0a48cd0c-64f4-434e-b0c2-382476226e64","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"succeeded","outputs":{"image":"2024 届湖北专升本英语真题\n\n一、填空题（从括号里给出的词语中选择一个填入空缺处），共 10 题，每题 2 分\n\n1. I have confidence _________ (in/on) my future.\n\n2. ________ (What/How) beautiful the East Lake is!\n\n3. John ________ (is/are) familiar with Chinese culture.\n\n4. There are ________ (much/many) ways to help others.\n\n5. It is ________ (a/the) first time that I have seen the sea.\n\n6. I'm sure you can solve the problem by __________ (you/yourself).\n\n7. I can lend my bike to you ________ (if/or) you return it on time.\n\n8. The internet has ________ (great/greatly) changed the way we live.\n\n9. When I was young, Dad often ________ (took/take) me to the museum.\n\n10. I'm happy that the summer holiday ________ (will/would) begin next month.\n\n二、连词成句（用所给词语正确排列顺序组成一个句子），共 6 题，每题 2 分\n\n11. the source of / is / water / life\n\n12. my family / reading books / enjoy\n\n13. the beauty around you / to discover / it is a joy\n\n14. try our best / should / to realize our dreams / we\n\n15. was translated into / his book / last year / French"},"elapsed_time":11.587457452202216,"total_tokens":885,"total_steps":4,"created_at":1740974795,"finished_at":1740974807}
2025-03-03 12:06:49.287  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, text=2024 届湖北专升本英语真题

一、填空题（从括号里给出的词语中选择一个填入空缺处），共 10 题，每题 2 分

1. I have confidence _________ (in/on) my future.

2. ________ (What/How) beautiful the East Lake is!

3. John ________ (is/are) familiar with Chinese culture.

4. There are ________ (much/many) ways to help others.

5. It is ________ (a/the) first time that I have seen the sea.

6. I'm sure you can solve the problem by __________ (you/yourself).

7. I can lend my bike to you ________ (if/or) you return it on time.

8. The internet has ________ (great/greatly) changed the way we live.

9. When I was young, Dad often ________ (took/take) me to the museum.

10. I'm happy that the summer holiday ________ (will/would) begin next month.

二、连词成句（用所给词语正确排列顺序组成一个句子），共 6 题，每题 2 分

11. the source of / is / water / life

12. my family / reading books / enjoy

13. the beauty around you / to discover / it is a joy

14. try our best / should / to realize our dreams / we

15. was translated into / his book / last year / French
2025-03-03 12:06:49.287 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"49cb7650-39e8-43eb-bcd9-c66ed74a6340","workflow_run_id":"0a48cd0c-64f4-434e-b0c2-382476226e64","data":{"id":"0a48cd0c-64f4-434e-b0c2-382476226e64","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"succeeded","outputs":{"image":"2024 届湖北专升本英语真题\n\n一、填空题（从括号里给出的词语中选择一个填入空缺处），共 10 题，每题 2 分\n\n1. I have confidence _________ (in/on) my future.\n\n2. ________ (What/How) beautiful the East Lake is!\n\n3. John ________ (is/are) familiar with Chinese culture.\n\n4. There are ________ (much/many) ways to help others.\n\n5. It is ________ (a/the) first time that I have seen the sea.\n\n6. I'm sure you can solve the problem by __________ (you/yourself).\n\n7. I can lend my bike to you ________ (if/or) you return it on time.\n\n8. The internet has ________ (great/greatly) changed the way we live.\n\n9. When I was young, Dad often ________ (took/take) me to the museum.\n\n10. I'm happy that the summer holiday ________ (will/would) begin next month.\n\n二、连词成句（用所给词语正确排列顺序组成一个句子），共 6 题，每题 2 分\n\n11. the source of / is / water / life\n\n12. my family / reading books / enjoy\n\n13. the beauty around you / to discover / it is a joy\n\n14. try our best / should / to realize our dreams / we\n\n15. was translated into / his book / last year / French"},"elapsed_time":11.587457452202216,"total_tokens":885,"total_steps":4,"created_at":1740974795,"finished_at":1740974807}}
2025-03-03 12:06:49.632  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png
2025-03-03 12:06:49.632  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, userId=system
2025-03-03 12:06:49.632 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:06:49.632 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:06:49.698  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b7c20d8e-1937-44a6-9b7f-dadd4e1d397e
2025-03-03 12:06:49.698 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"b7c20d8e-1937-44a6-9b7f-dadd4e1d397e"}},"response_mode":"blocking","conversation_id":"f918dc4b-e1d1-4b0b-bcbc-c03b0de07d32","user":"fyjw"}
2025-03-03 12:07:18.748 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"4c8ce2d1-58d3-48df-b5c6-a9a15d999a3c","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"succeeded","outputs":{"image":"你有这个文件吗？我需要你帮我填空。这是关于孩子需要自由玩耍和保护长颈鹿的两个段落，有些词需要填空。我得好好想想。\n\n首先，第一个段落是关于孩子需要自由玩耍的。题目说“Kids Need Free Play”，意思是孩子们需要自由玩耍。然后下面有几个空，需要根据文章内容填上合适的单词。\n\n第一个空是“Giving our kids time to play is not a choice but a ___17___”。意思是“给孩子玩耍的时间不是一种选择，而是一种___17___”。这里可能需要填入一个名词，表示玩耍时间的重要性。可能是一个义务、必需品或者权利之类的词。我得想想，也许填“necessity”？因为说玩耍时间不是可选的，而是必需的。\n\n第二个空是“Play is important to the ___18___, social, and emotional well-being of children and youth”。意思是“玩耍对儿童和青少年的___18___、社交和情感健康很重要”。这里需要填入一个形容词，可能描述的是个人发展的某个方面。可能填“cognitive”？因为玩耍对认知发展有帮助。\n\n第三个空是“Parents should ___19___ free play”。意思是“父母应该___19___ 自由玩耍”。这里需要填入一个动词，表示父母在自由玩耍中的角色。可能是“encourage”？因为父母应该鼓励孩子自由玩耍。\n\n第四个空是“The word ‘free’ means both ‘___20___’ and ‘with no cost’”。意思是“‘自由’这个词既意味着‘___20___’，也意味着‘没有成本’”。这里需要填入一个形容词，来解释“自由”的含义。可能填“unrestricted”？因为自由玩耍应该是没有限制的。\n\n第五个空是“Free play enables kids to ___21___ with others and learn important social skills”。意思是“自由玩耍使孩子们能够___21___ 与他人，并学习重要的社交技能”。这里需要填入一个动词，表示通过自由玩耍与他人互动的方式。可能填“interact”？因为玩耍可以帮助孩子们与他人互动。\n\n好，第一个段落的空填完了。接下来是第二个段落，关于保护长颈鹿的。\n\n第二个段落的标题是“Keep an Eye on Giraffes”，意思是“关注长颈鹿”。然后下面有几个空需要填。\n\n第一个空是“What: Giraffes are quietly ___22___ because their favourite ___23___ is difficult to find”。意思是“什么：长颈鹿正在安静地 ___22___，因为它们最喜欢的 ___23___ 很难找到”。这里需要填入两个名词。第一个空可能填“disappearing”？表示长颈鹿正在安静地消失。第二个空可能填“food source”？因为它们最喜欢的食物来源很难找到。\n\n第二个空是“GPS collars were used to keep an eye on giraffes but they didn't ___24___ for long”。意思是“使用GPS项圈来监视长颈鹿，但它们没有___24___很长时间”。这里需要填入一个动词，表示GPS项圈的局限性。可能填“last”？因为项圈不能持久使用。\n\n第三个空是“New tracking devices, which are as ___25___ as a chocolate bar, solar-powered, and don't ___26___ giraffes much, are used to stop illegal hunting to keep giraffes safe”。意思是“新的追踪设备，像巧克力棒一样 ___25___，太阳能供电，并且不会___26___ 长颈鹿太多，被用来阻止非法狩猎，以保护长颈鹿的安全”。这里需要填入两个形容词。\n\n第一个形容词是描述追踪设备的大小，可能填“small”？因为说像巧克力棒一样小。\n\n第二个形容词是描述追踪设备对长颈鹿的影响，可能填“bother”？因为设备不会太打扰长颈鹿。\n\n好了，我填完了所有的空。希望这些答案是对的。我得再检查一下，确保每个空都填了合适的词。\n\n第一个段落：\n\n17. necessity\n\n18. cognitive\n\n19. encourage\n\n20. unrestricted\n\n21. interact\n\n第二个段落：\n\n22. disappearing\n\n23. food source\n\n24. last\n\n25. small\n\n26. bother\n\n看起来都挺合理的。我感觉这些答案应该符合文章的意思。"},"elapsed_time":28.999570266110823,"total_tokens":1483,"total_steps":4,"created_at":1740974807,"finished_at":1740974836}
2025-03-03 12:07:18.749  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, text=你有这个文件吗？我需要你帮我填空。这是关于孩子需要自由玩耍和保护长颈鹿的两个段落，有些词需要填空。我得好好想想。

首先，第一个段落是关于孩子需要自由玩耍的。题目说“Kids Need Free Play”，意思是孩子们需要自由玩耍。然后下面有几个空，需要根据文章内容填上合适的单词。

第一个空是“Giving our kids time to play is not a choice but a ___17___”。意思是“给孩子玩耍的时间不是一种选择，而是一种___17___”。这里可能需要填入一个名词，表示玩耍时间的重要性。可能是一个义务、必需品或者权利之类的词。我得想想，也许填“necessity”？因为说玩耍时间不是可选的，而是必需的。

第二个空是“Play is important to the ___18___, social, and emotional well-being of children and youth”。意思是“玩耍对儿童和青少年的___18___、社交和情感健康很重要”。这里需要填入一个形容词，可能描述的是个人发展的某个方面。可能填“cognitive”？因为玩耍对认知发展有帮助。

第三个空是“Parents should ___19___ free play”。意思是“父母应该___19___ 自由玩耍”。这里需要填入一个动词，表示父母在自由玩耍中的角色。可能是“encourage”？因为父母应该鼓励孩子自由玩耍。

第四个空是“The word ‘free’ means both ‘___20___’ and ‘with no cost’”。意思是“‘自由’这个词既意味着‘___20___’，也意味着‘没有成本’”。这里需要填入一个形容词，来解释“自由”的含义。可能填“unrestricted”？因为自由玩耍应该是没有限制的。

第五个空是“Free play enables kids to ___21___ with others and learn important social skills”。意思是“自由玩耍使孩子们能够___21___ 与他人，并学习重要的社交技能”。这里需要填入一个动词，表示通过自由玩耍与他人互动的方式。可能填“interact”？因为玩耍可以帮助孩子们与他人互动。

好，第一个段落的空填完了。接下来是第二个段落，关于保护长颈鹿的。

第二个段落的标题是“Keep an Eye on Giraffes”，意思是“关注长颈鹿”。然后下面有几个空需要填。

第一个空是“What: Giraffes are quietly ___22___ because their favourite ___23___ is difficult to find”。意思是“什么：长颈鹿正在安静地 ___22___，因为它们最喜欢的 ___23___ 很难找到”。这里需要填入两个名词。第一个空可能填“disappearing”？表示长颈鹿正在安静地消失。第二个空可能填“food source”？因为它们最喜欢的食物来源很难找到。

第二个空是“GPS collars were used to keep an eye on giraffes but they didn't ___24___ for long”。意思是“使用GPS项圈来监视长颈鹿，但它们没有___24___很长时间”。这里需要填入一个动词，表示GPS项圈的局限性。可能填“last”？因为项圈不能持久使用。

第三个空是“New tracking devices, which are as ___25___ as a chocolate bar, solar-powered, and don't ___26___ giraffes much, are used to stop illegal hunting to keep giraffes safe”。意思是“新的追踪设备，像巧克力棒一样 ___25___，太阳能供电，并且不会___26___ 长颈鹿太多，被用来阻止非法狩猎，以保护长颈鹿的安全”。这里需要填入两个形容词。

第一个形容词是描述追踪设备的大小，可能填“small”？因为说像巧克力棒一样小。

第二个形容词是描述追踪设备对长颈鹿的影响，可能填“bother”？因为设备不会太打扰长颈鹿。

好了，我填完了所有的空。希望这些答案是对的。我得再检查一下，确保每个空都填了合适的词。

第一个段落：

17. necessity

18. cognitive

19. encourage

20. unrestricted

21. interact

第二个段落：

22. disappearing

23. food source

24. last

25. small

26. bother

看起来都挺合理的。我感觉这些答案应该符合文章的意思。
2025-03-03 12:07:18.749 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"e817c12c-df15-46b1-b495-c36c1d0c7d6a","workflow_run_id":"4c8ce2d1-58d3-48df-b5c6-a9a15d999a3c","data":{"id":"4c8ce2d1-58d3-48df-b5c6-a9a15d999a3c","workflow_id":"9cf0d208-f2e1-482a-b246-c0b53a48f3c9","status":"succeeded","outputs":{"image":"你有这个文件吗？我需要你帮我填空。这是关于孩子需要自由玩耍和保护长颈鹿的两个段落，有些词需要填空。我得好好想想。\n\n首先，第一个段落是关于孩子需要自由玩耍的。题目说“Kids Need Free Play”，意思是孩子们需要自由玩耍。然后下面有几个空，需要根据文章内容填上合适的单词。\n\n第一个空是“Giving our kids time to play is not a choice but a ___17___”。意思是“给孩子玩耍的时间不是一种选择，而是一种___17___”。这里可能需要填入一个名词，表示玩耍时间的重要性。可能是一个义务、必需品或者权利之类的词。我得想想，也许填“necessity”？因为说玩耍时间不是可选的，而是必需的。\n\n第二个空是“Play is important to the ___18___, social, and emotional well-being of children and youth”。意思是“玩耍对儿童和青少年的___18___、社交和情感健康很重要”。这里需要填入一个形容词，可能描述的是个人发展的某个方面。可能填“cognitive”？因为玩耍对认知发展有帮助。\n\n第三个空是“Parents should ___19___ free play”。意思是“父母应该___19___ 自由玩耍”。这里需要填入一个动词，表示父母在自由玩耍中的角色。可能是“encourage”？因为父母应该鼓励孩子自由玩耍。\n\n第四个空是“The word ‘free’ means both ‘___20___’ and ‘with no cost’”。意思是“‘自由’这个词既意味着‘___20___’，也意味着‘没有成本’”。这里需要填入一个形容词，来解释“自由”的含义。可能填“unrestricted”？因为自由玩耍应该是没有限制的。\n\n第五个空是“Free play enables kids to ___21___ with others and learn important social skills”。意思是“自由玩耍使孩子们能够___21___ 与他人，并学习重要的社交技能”。这里需要填入一个动词，表示通过自由玩耍与他人互动的方式。可能填“interact”？因为玩耍可以帮助孩子们与他人互动。\n\n好，第一个段落的空填完了。接下来是第二个段落，关于保护长颈鹿的。\n\n第二个段落的标题是“Keep an Eye on Giraffes”，意思是“关注长颈鹿”。然后下面有几个空需要填。\n\n第一个空是“What: Giraffes are quietly ___22___ because their favourite ___23___ is difficult to find”。意思是“什么：长颈鹿正在安静地 ___22___，因为它们最喜欢的 ___23___ 很难找到”。这里需要填入两个名词。第一个空可能填“disappearing”？表示长颈鹿正在安静地消失。第二个空可能填“food source”？因为它们最喜欢的食物来源很难找到。\n\n第二个空是“GPS collars were used to keep an eye on giraffes but they didn't ___24___ for long”。意思是“使用GPS项圈来监视长颈鹿，但它们没有___24___很长时间”。这里需要填入一个动词，表示GPS项圈的局限性。可能填“last”？因为项圈不能持久使用。\n\n第三个空是“New tracking devices, which are as ___25___ as a chocolate bar, solar-powered, and don't ___26___ giraffes much, are used to stop illegal hunting to keep giraffes safe”。意思是“新的追踪设备，像巧克力棒一样 ___25___，太阳能供电，并且不会___26___ 长颈鹿太多，被用来阻止非法狩猎，以保护长颈鹿的安全”。这里需要填入两个形容词。\n\n第一个形容词是描述追踪设备的大小，可能填“small”？因为说像巧克力棒一样小。\n\n第二个形容词是描述追踪设备对长颈鹿的影响，可能填“bother”？因为设备不会太打扰长颈鹿。\n\n好了，我填完了所有的空。希望这些答案是对的。我得再检查一下，确保每个空都填了合适的词。\n\n第一个段落：\n\n17. necessity\n\n18. cognitive\n\n19. encourage\n\n20. unrestricted\n\n21. interact\n\n第二个段落：\n\n22. disappearing\n\n23. food source\n\n24. last\n\n25. small\n\n26. bother\n\n看起来都挺合理的。我感觉这些答案应该符合文章的意思。"},"elapsed_time":28.999570266110823,"total_tokens":1483,"total_steps":4,"created_at":1740974807,"finished_at":1740974836}}
2025-03-03 12:07:18.942  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png
2025-03-03 12:07:18.942  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, userId=system
2025-03-03 12:07:18.942 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:07:18.942 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:07:19.016  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=06347527-1f34-486c-8124-605702e6401b
2025-03-03 12:07:19.016 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"06347527-1f34-486c-8124-605702e6401b"}},"response_mode":"blocking","conversation_id":"96b543b7-828a-4c27-8572-5a78a90b989a","user":"fyjw"}
2025-03-03 12:08:27.756 ERROR 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:08:27.757  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477426075532410881&access_key=8e670f56340e6f1daa92020631ab9a7d&service_id=33554678&ticket=80cc117b-4fe0-4334-92d1-1ee097ef13c0 [conn_id=7477426075532410881]
2025-03-03 12:08:27.757  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:08:36.337 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"e5d8fb43-b16c-4011-a4ff-45511453ee87","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n## Passage 3\n\n(第一段落) It was on Sunday morning, when Sam went to see his grandfather alone.【原文】\n\n27. When did the story happen?\n\n28. How did Sam go to see his grandfather, by bike or by bus?\n\n29. Who gave up the seat to the old lady?\n\n30. Why did other passengers also get up?\n\n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n## Passage 4\n\nIn my job, I get to meet many people and see many places.\n\nWhen I finished university, I got a job writing short stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game starts.\n\nThe players are warming up, so I hurry down to wait outside the changing area when I manage to get a short interview with one of the players. I have limited time, so I only ask a few important questions, such as how his feeling and what he expects the game.\n\nWhen the game starts, I take note on the action as it happens. I have a great vantage point. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.\n\nFinally, it is time for me to pull all my notes together into the finished article to send to the \n```\n"},"elapsed_time":77.27303302194923,"total_tokens":935,"total_steps":4,"created_at":1740974837,"finished_at":1740974914}
2025-03-03 12:08:36.338  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, text=```markdown
## Passage 3

(第一段落) It was on Sunday morning, when Sam went to see his grandfather alone.【原文】

27. When did the story happen?

28. How did Sam go to see his grandfather, by bike or by bus?

29. Who gave up the seat to the old lady?

30. Why did other passengers also get up?

31. Translate the sentence "what a lovely little girl" into Chinese.

## Passage 4

In my job, I get to meet many people and see many places.

When I finished university, I got a job writing short stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game starts.

The players are warming up, so I hurry down to wait outside the changing area when I manage to get a short interview with one of the players. I have limited time, so I only ask a few important questions, such as how his feeling and what he expects the game.

When the game starts, I take note on the action as it happens. I have a great vantage point. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.

Finally, it is time for me to pull all my notes together into the finished article to send to the 
```

2025-03-03 12:08:36.338 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"a87f750a-1794-4fec-94ac-5048f3c3b397","workflow_run_id":"e5d8fb43-b16c-4011-a4ff-45511453ee87","data":{"id":"e5d8fb43-b16c-4011-a4ff-45511453ee87","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n## Passage 3\n\n(第一段落) It was on Sunday morning, when Sam went to see his grandfather alone.【原文】\n\n27. When did the story happen?\n\n28. How did Sam go to see his grandfather, by bike or by bus?\n\n29. Who gave up the seat to the old lady?\n\n30. Why did other passengers also get up?\n\n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n## Passage 4\n\nIn my job, I get to meet many people and see many places.\n\nWhen I finished university, I got a job writing short stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game starts.\n\nThe players are warming up, so I hurry down to wait outside the changing area when I manage to get a short interview with one of the players. I have limited time, so I only ask a few important questions, such as how his feeling and what he expects the game.\n\nWhen the game starts, I take note on the action as it happens. I have a great vantage point. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches talk about the game and I get some good quotes.\n\nFinally, it is time for me to pull all my notes together into the finished article to send to the \n```\n"},"elapsed_time":77.27303302194923,"total_tokens":935,"total_steps":4,"created_at":1740974837,"finished_at":1740974914}}
2025-03-03 12:08:36.671  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png
2025-03-03 12:08:36.671  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, userId=system
2025-03-03 12:08:36.671 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:08:36.671 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:08:36.741  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ff542545-cb78-4316-8443-9c987c4d04b6
2025-03-03 12:08:36.741 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"ff542545-cb78-4316-8443-9c987c4d04b6"}},"response_mode":"blocking","conversation_id":"b16f7d9b-9020-4395-ac19-aac2f4c9f994","user":"fyjw"}
2025-03-03 12:08:36.846  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:08:37.352  INFO 7672 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477429757388783644&access_key=aa2bd8977e5c7ae880f1dc83abc90da8&service_id=33554678&ticket=489325a4-561e-44e6-9cf4-132ae60ed387 [conn_id=7477429757388783644]
2025-03-03 12:08:43.576 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"bb72a1f7-c493-4e4a-8730-4bb0461df597","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. I love sharing my love for sport through words.\n\n32. What newspaper articles does the writer write about?\n\n33. Why does the writer ask only a few important questions?\n\n34. Who wins the baseball game in the end?\n\n35. How many hours does the writer have to write up his article?\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.\n\n五、根据提示（括号内是关键词）将下列句子译成英语。（每题 0.5 分）\n\n37. 你上大学的时候多大了？(old)\n\n38. 你有足够的钱买这辆车吗？(enough)\n\n39. 请确保你有足够的钱。(sure)\n```"},"elapsed_time":6.791952853091061,"total_tokens":814,"total_steps":4,"created_at":1740974915,"finished_at":1740974921}
2025-03-03 12:08:43.576  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, text=```markdown
newspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. I love sharing my love for sport through words.

32. What newspaper articles does the writer write about?

33. Why does the writer ask only a few important questions?

34. Who wins the baseball game in the end?

35. How many hours does the writer have to write up his article?

36. Translate the sentence "I love sharing my love for sport through words" into Chinese.

五、根据提示（括号内是关键词）将下列句子译成英语。（每题 0.5 分）

37. 你上大学的时候多大了？(old)

38. 你有足够的钱买这辆车吗？(enough)

39. 请确保你有足够的钱。(sure)
```
2025-03-03 12:08:43.576 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"8021c859-bf30-4de4-b8fe-b81b75ba5c51","workflow_run_id":"bb72a1f7-c493-4e4a-8730-4bb0461df597","data":{"id":"bb72a1f7-c493-4e4a-8730-4bb0461df597","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. I love sharing my love for sport through words.\n\n32. What newspaper articles does the writer write about?\n\n33. Why does the writer ask only a few important questions?\n\n34. Who wins the baseball game in the end?\n\n35. How many hours does the writer have to write up his article?\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.\n\n五、根据提示（括号内是关键词）将下列句子译成英语。（每题 0.5 分）\n\n37. 你上大学的时候多大了？(old)\n\n38. 你有足够的钱买这辆车吗？(enough)\n\n39. 请确保你有足够的钱。(sure)\n```"},"elapsed_time":6.791952853091061,"total_tokens":814,"total_steps":4,"created_at":1740974915,"finished_at":1740974921}}
2025-03-03 12:08:43.814  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png
2025-03-03 12:08:43.814  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, userId=system
2025-03-03 12:08:43.815 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:08:43.815 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:08:43.916  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f38714e4-2fad-418d-934f-454ba143a35e
2025-03-03 12:08:43.916 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f38714e4-2fad-418d-934f-454ba143a35e"}},"response_mode":"blocking","conversation_id":"dce136da-d3a9-4572-be73-e6a285c33895","user":"fyjw"}
2025-03-03 12:08:50.637 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"c5808521-eedf-483e-9ccb-937f623f8fba","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n41. Travel can give us a chance ______ people from different cultures. (meet)\n\n    旅行能让我们有机会认识来自不同文化背景的人。\n\n42. The snow is so ______ that the whole world is covered in silver. (heavy)\n\n    雪下得如此之大，整个世界都覆盖在银色之中。\n\n六、写作（共10分）\n\n假如你是Tom，编辑一条关于假期出游经历的短信发给Tom。主要内容包括：\n\n1. 你是如何度过快乐时光的。\n\n2. 你去了哪些地方。\n\n3. 你是和谁一起去的。\n\n要求：\n\n1. 字数不少于80词。\n\n2. 文中不得出现你个人信息及真实校名。\n```"},"elapsed_time":6.67778127011843,"total_tokens":564,"total_steps":4,"created_at":1740974922,"finished_at":1740974928}
2025-03-03 12:08:50.637  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, text=```markdown
41. Travel can give us a chance ______ people from different cultures. (meet)

    旅行能让我们有机会认识来自不同文化背景的人。

42. The snow is so ______ that the whole world is covered in silver. (heavy)

    雪下得如此之大，整个世界都覆盖在银色之中。

六、写作（共10分）

假如你是Tom，编辑一条关于假期出游经历的短信发给Tom。主要内容包括：

1. 你是如何度过快乐时光的。

2. 你去了哪些地方。

3. 你是和谁一起去的。

要求：

1. 字数不少于80词。

2. 文中不得出现你个人信息及真实校名。
```
2025-03-03 12:08:50.637 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6bdbb682-869c-415b-a0bf-e27553dda6ae","workflow_run_id":"c5808521-eedf-483e-9ccb-937f623f8fba","data":{"id":"c5808521-eedf-483e-9ccb-937f623f8fba","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n41. Travel can give us a chance ______ people from different cultures. (meet)\n\n    旅行能让我们有机会认识来自不同文化背景的人。\n\n42. The snow is so ______ that the whole world is covered in silver. (heavy)\n\n    雪下得如此之大，整个世界都覆盖在银色之中。\n\n六、写作（共10分）\n\n假如你是Tom，编辑一条关于假期出游经历的短信发给Tom。主要内容包括：\n\n1. 你是如何度过快乐时光的。\n\n2. 你去了哪些地方。\n\n3. 你是和谁一起去的。\n\n要求：\n\n1. 字数不少于80词。\n\n2. 文中不得出现你个人信息及真实校名。\n```"},"elapsed_time":6.67778127011843,"total_tokens":564,"total_steps":4,"created_at":1740974922,"finished_at":1740974928}}
2025-03-03 12:08:50.639 DEBUG 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:08:50.639  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=8043
2025-03-03 12:08:50.640 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:08:50.720  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"49f41939-9898-4b3b-9c04-ea25be72d49c"},"data_source_detail_dict":{"upload_file":{"id":"49f41939-9898-4b3b-9c04-ea25be72d49c","name":"2024届湖北专升本英语真题_20240517141034.md","size":8043,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974928.926659}},"dataset_process_rule_id":"7a6bad76-240f-4738-8a5d-82ac2208ec93","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":1564,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":5581,"hit_count":0,"doc_form":"text_model"},"batch":"20250303040848962869"}
2025-03-03 12:08:50.720  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:08:50.742 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:08:50.743 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:08:50.766 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:08:50.988 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:08:50.992 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:08:50.993 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:08:51.014 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:08:51.184 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:08:51.769  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 12:08:51.795 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:08:51.795 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:08:51.818 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:08:51.948 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:08:51.949  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 12:08:51.949  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 12:08:51.949 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:08:51.949 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:08:51.999  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=9de379d8-5599-4b1f-aa14-fbffb54bf46a
2025-03-03 12:08:51.999 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"9de379d8-5599-4b1f-aa14-fbffb54bf46a"}},"response_mode":"blocking","conversation_id":"4329af56-0129-4aec-9c8d-285864ec20dd","user":"fyjw"}
2025-03-03 12:09:06.399 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"2332d7c5-51b2-4347-b479-1c593ce28d4b","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浦海新区金港房地产发展有限公司\n\n2022年9月1日与贵公司签订的“上海市商品房预售合同”（合同编号：202200176383），约定于2023年10月31日前交付房屋。\n\n本小区因不可预见因素影响，导致工程进度严重滞后，竣工时间又被冬季施工影响，无法按时交付房屋。经我司与贵司协商，拟定于2023年12月8日交付房屋，具体交付时间以我司书面通知为准。\n\n在此过程中，由我司承担违约责任并向贵司支付违约金，违约金支付金额为已付房款的0.05%/天，支付时间自2023年11月1日起至实际交付日止。但因承建单位施工期间部分影响因素不可抗力导致的延迟，违约金支付金额自2023年11月1日起至实际交付日止，最高不超过4.75%累计。\n\n在该延期交付日期，我司将按时正式交付房屋，即：2023年12月8日，确保贵司享有的合法权益不受影响。感谢贵司的理解与支持！\n\n联系人：程甲    电话：13262792367   \n杨晓翌    电话：15821244730   \n\n2023年11月28日\n```"},"elapsed_time":14.353957725921646,"total_tokens":715,"total_steps":4,"created_at":1740974930,"finished_at":1740974944}
2025-03-03 12:09:06.399  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海浦海新区金港房地产发展有限公司

2022年9月1日与贵公司签订的“上海市商品房预售合同”（合同编号：202200176383），约定于2023年10月31日前交付房屋。

本小区因不可预见因素影响，导致工程进度严重滞后，竣工时间又被冬季施工影响，无法按时交付房屋。经我司与贵司协商，拟定于2023年12月8日交付房屋，具体交付时间以我司书面通知为准。

在此过程中，由我司承担违约责任并向贵司支付违约金，违约金支付金额为已付房款的0.05%/天，支付时间自2023年11月1日起至实际交付日止。但因承建单位施工期间部分影响因素不可抗力导致的延迟，违约金支付金额自2023年11月1日起至实际交付日止，最高不超过4.75%累计。

在该延期交付日期，我司将按时正式交付房屋，即：2023年12月8日，确保贵司享有的合法权益不受影响。感谢贵司的理解与支持！

联系人：程甲    电话：13262792367   
杨晓翌    电话：15821244730   

2023年11月28日
```
2025-03-03 12:09:06.399 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6ead653f-bd4b-4b6e-a0f1-5eae0179d2ea","workflow_run_id":"2332d7c5-51b2-4347-b479-1c593ce28d4b","data":{"id":"2332d7c5-51b2-4347-b479-1c593ce28d4b","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海浦海新区金港房地产发展有限公司\n\n2022年9月1日与贵公司签订的“上海市商品房预售合同”（合同编号：202200176383），约定于2023年10月31日前交付房屋。\n\n本小区因不可预见因素影响，导致工程进度严重滞后，竣工时间又被冬季施工影响，无法按时交付房屋。经我司与贵司协商，拟定于2023年12月8日交付房屋，具体交付时间以我司书面通知为准。\n\n在此过程中，由我司承担违约责任并向贵司支付违约金，违约金支付金额为已付房款的0.05%/天，支付时间自2023年11月1日起至实际交付日止。但因承建单位施工期间部分影响因素不可抗力导致的延迟，违约金支付金额自2023年11月1日起至实际交付日止，最高不超过4.75%累计。\n\n在该延期交付日期，我司将按时正式交付房屋，即：2023年12月8日，确保贵司享有的合法权益不受影响。感谢贵司的理解与支持！\n\n联系人：程甲    电话：13262792367   \n杨晓翌    电话：15821244730   \n\n2023年11月28日\n```"},"elapsed_time":14.353957725921646,"total_tokens":715,"total_steps":4,"created_at":1740974930,"finished_at":1740974944}}
2025-03-03 12:09:06.399  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1123
2025-03-03 12:09:06.399 DEBUG 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:09:06.483  INFO 7672 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"0c949cc4-e2ac-4a2c-8846-4b51b20c680c"},"data_source_detail_dict":{"upload_file":{"id":"0c949cc4-e2ac-4a2c-8846-4b51b20c680c","name":"程阿金和解通知.md","size":1123,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740974944.69032}},"dataset_process_rule_id":"35158eb9-099b-4133-b6d6-7c3c8a28fdd2","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":396,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":407,"hit_count":0,"doc_form":"text_model"},"batch":"20250303040904164669"}
2025-03-03 12:09:06.483  INFO 7672 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 12:09:06.505 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:09:06.505 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:09:06.526 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:09:06.689 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:09:06.690 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:09:06.690 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:09:06.710 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:09:06.875 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:09:06.885 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:09:06.885 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:09:06.908 DEBUG 7672 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:09:07.031 ERROR 7672 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:10:49.696  INFO 7672 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 12:10:49.699  INFO 7672 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 12:10:52.740  INFO 29040 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 29040 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 12:10:52.741 DEBUG 29040 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 12:10:52.742  INFO 29040 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 12:10:53.021  INFO 29040 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 12:10:53.022  INFO 29040 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 12:10:53.038  INFO 29040 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 12:10:53.305  INFO 29040 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 12:10:53.308  INFO 29040 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 12:10:53.308  INFO 29040 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 12:10:53.381  INFO 29040 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 12:10:53.381  INFO 29040 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 619 ms
2025-03-03 12:10:53.531  INFO 29040 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 12:10:53.532  INFO 29040 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 12:10:54.060  INFO 29040 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 12:10:54.268  INFO 29040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477430098115788802&access_key=d6fbef64ceb0f8581b88825e65cf3284&service_id=33554678&ticket=9ddc4306-3f80-4e8c-8002-cf9df78ca321 [conn_id=7477430098115788802]
2025-03-03 12:10:54.360  INFO 29040 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 12:10:54.366  INFO 29040 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.855 seconds (JVM running for 2.181)
2025-03-03 12:11:00.200  INFO 29040 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740975058}
2025-03-03 12:11:00.228  WARN 29040 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 12:11:00.234  INFO 29040 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 12:11:00.473  INFO 29040 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 12:11:00.479 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:00.490 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:00.525 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:00.528 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:11:00.528 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:11:00.549 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:11:00.549 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:11:00.549 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:11:00.569 DEBUG 29040 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:11:00.569  INFO 29040 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 12:11:01.313  INFO 29040 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:11:01.314  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:11:01.854  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:11:00 GMT"],"eagleid":["74c4870c17409750595911628e"],"request-id":["52ce9e3a-b6b9-40a7-8cf9-771609331783"],"server":["Tengine"],"server-timing":["inner; dur=429","cdn-cache;desc=MISS,edge;dur=0,origin;dur=450"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache7.cn7535[450,0]"],"x-lgw-dst-svc":["ucCvQeitXz_Xng2zH07kysBd53K3g47m3e-CZilxBy4xoWpROo9QTLIZ8CErBsh2IoIojjxJzhCg-QX9QOW5S5cFgDayEFHcpvZu9-QRgMD22G7Z1tS3Qg0lGyuooYHBMYGH4GN5sXgR-oKny1f4z0vJ3X-hVySMv56-hAVrPnA5TY5_x-21OVsHTVrxBd20qee-EIAaBc2PFkISkxV8-qNFt7RTP8KwUlIMKaNnhvmiyG182Tam6NTMtZGFsCX4vhUrCktzW3rcMaNkPFMg4f_kNnbYjanYr9xiC-R_H_Cj8T9tFspNY98="],"x-request-id":["52ce9e3a-b6b9-40a7-8cf9-771609331783"],"x-timestamp":["1740975060.029"],"x-tt-logid":["2025030312105959570793113036F7A79A"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1bedcc781771f0e23dc3afe189b45be48c9fe17e9af66edf4a33816dd30540dfe8c975f64b052513a6ee1b6ba094ff4913cc42172dc4419e9a93b3ba4b977c976175b54812579162cbee0b2fcb3367b2235"],"x-tt-trace-id":["00-25030312105959570793113036F7A79A-369E2537434CED44-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030312105959570793113036F7A79A","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030312105959570793113036F7A79A"}
2025-03-03 12:11:01.855  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 12:11:02.260  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 12:11:02.280 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:02.280 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:02.300 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:02.465 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:11:02.466  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 12:11:02.466  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 12:11:02.467 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:11:02.468 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:11:02.639  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=507ac7d3-3fb6-47e5-bf51-b25903f8327c
2025-03-03 12:11:02.639 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"507ac7d3-3fb6-47e5-bf51-b25903f8327c"}},"response_mode":"blocking","conversation_id":"78ec073c-9425-463b-9355-0a1db815cae8","user":"fyjw"}
2025-03-03 12:11:02.672 ERROR 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:293) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:329) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:11:02.672  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 12:11:02.673 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:02.673 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:02.693 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:02.862 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:11:03.943  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 12:11:03.943  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 12:11:03.943 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:11:03.943 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:11:04.119  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=86bb6f65-4a06-4917-8133-76f62df84085
2025-03-03 12:11:04.119 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"86bb6f65-4a06-4917-8133-76f62df84085"}},"response_mode":"blocking","conversation_id":"345101ec-fcb0-4415-88ce-6b6c96cf173f","user":"fyjw"}
2025-03-03 12:11:25.414 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"8eacb8fb-68a9-454c-9205-2fb9b84122b5","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 监制\n```"},"elapsed_time":21.25264697498642,"total_tokens":408,"total_steps":4,"created_at":1740975062,"finished_at":1740975083}
2025-03-03 12:11:25.414  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=```markdown
# 上海市新建住宅交付使用

## 许可证

上海市房屋管理局 监制
```
2025-03-03 12:11:25.414 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"00286019-19cb-4c4d-95f0-e593fc6a8017","workflow_run_id":"8eacb8fb-68a9-454c-9205-2fb9b84122b5","data":{"id":"8eacb8fb-68a9-454c-9205-2fb9b84122b5","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 上海市新建住宅交付使用\n\n## 许可证\n\n上海市房屋管理局 监制\n```"},"elapsed_time":21.25264697498642,"total_tokens":408,"total_steps":4,"created_at":1740975062,"finished_at":1740975083}}
2025-03-03 12:11:26.671  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片已压缩: fileName=东九交付许可证.pdf_page_1.png, 原始大小=0bytes, 压缩后大小=0bytes
2025-03-03 12:11:26.671  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 12:11:26.671  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 12:11:26.671 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:11:26.671 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:11:26.714  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=10dfa9a9-c4dd-4fa9-934c-aeb65879b1a0
2025-03-03 12:11:26.714 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"10dfa9a9-c4dd-4fa9-934c-aeb65879b1a0"}},"response_mode":"blocking","conversation_id":"7c20c5cc-e92d-4455-8b6c-5cc6133afa89","user":"fyjw"}
2025-03-03 12:11:36.041 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d58aa2d0-c332-4381-a781-60416ad1fa8d","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"failed","error":"[models] Bad Request Error, Error code: 400 - {'error': {'message': 'Invalid image data.   (request id: B20250303121125608128987ieqkrLP2)', 'type': 'new_api_error', 'param': '', 'code': 'BadRequest'}}","elapsed_time":9.273644725093618,"total_tokens":0,"total_steps":3,"created_at":1740975085,"finished_at":1740975094}
2025-03-03 12:11:36.043 ERROR 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

java.lang.NullPointerException: Cannot invoke "com.alibaba.fastjson2.JSONObject.getString(String)" because "outputs" is null
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:307) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:329) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:485) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:11:36.046 DEBUG 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:11:36.046  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=99
2025-03-03 12:11:36.046 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:11:36.136  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"452a8b66-27bb-4328-be60-4cf98b5eea63"},"data_source_detail_dict":{"upload_file":{"id":"452a8b66-27bb-4328-be60-4cf98b5eea63","name":"东九交付许可证.md","size":99,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740975094.341991}},"dataset_process_rule_id":"00e3eb0c-2b36-4559-821c-c31d8d973c2e","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":73,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":65,"hit_count":0,"doc_form":"text_model"},"batch":"20250303041134946781"}
2025-03-03 12:11:36.137  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 12:11:36.157 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:36.157 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:36.176 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:36.323 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:11:36.325 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:36.325 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:36.348 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:36.495 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:11:36.886  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:11:36.913 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:36.913 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:36.933 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:37.100 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:11:37.101  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:11:37.101  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 12:11:37.101 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:11:37.101 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:11:37.145  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a926bb12-f9d3-4ef3-9b64-d846548874c0
2025-03-03 12:11:37.146 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"a926bb12-f9d3-4ef3-9b64-d846548874c0"}},"response_mode":"blocking","conversation_id":"0dbb2b99-8a9d-42e2-bb57-3e7538981a42","user":"fyjw"}
2025-03-03 12:11:37.191 ERROR 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:293) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:329) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:11:37.191  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:11:37.191 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:11:37.191 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:11:37.212 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:11:37.346 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:11:37.600  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png
2025-03-03 12:11:37.601  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, userId=system
2025-03-03 12:11:37.601 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:11:37.601 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:11:37.673  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=e3a29b33-83df-4000-bf99-61ac057cf622
2025-03-03 12:11:37.673 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"e3a29b33-83df-4000-bf99-61ac057cf622"}},"response_mode":"blocking","conversation_id":"9d7b2bcd-a044-4dca-9384-ac169b854d0d","user":"fyjw"}
2025-03-03 12:12:02.853 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"3680ed2e-5c19-4728-b836-4af84057b0c3","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 2024 届高三学生英语月考试题\n\n## 一、完型题（从A项与B项的内容中选择一个填入空中句子内）。共 10 题。每题 2 分\n\n1. I have confidence _______ (see) my future.\n\n2. _______ (What/how) beautiful the East Lake is!\n\n3. John _______ (is/are) familiar with Chinese culture.\n\n4. There are _______ (much/many) ways to help others.\n\n5. I _______ (have/has) lived here since the sea.\n\n6. I’m sure that he _______ (great/greatly) changed the way of learning.\n\n7. Team lend my bike to you _______ (before) you return it on time.\n\n8. When you grow up, Dad often _______ (took/take) me to the museum.\n\n9. In two months, the new school term _______ (would/will) begin next month.\n\n10. The source of life is _______ (Water / Fire)\n\n1. My family is reading books / enjoy\n\n2. the beauty around you / to enjoy / is\n\n3. what / should / do / to realize our dreams / we\n\n4. was translated into / his book / last year / French\n```"},"elapsed_time":25.141262128949165,"total_tokens":677,"total_steps":4,"created_at":1740975095,"finished_at":1740975121}
2025-03-03 12:12:02.853  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, text=```markdown
# 2024 届高三学生英语月考试题

## 一、完型题（从A项与B项的内容中选择一个填入空中句子内）。共 10 题。每题 2 分

1. I have confidence _______ (see) my future.

2. _______ (What/how) beautiful the East Lake is!

3. John _______ (is/are) familiar with Chinese culture.

4. There are _______ (much/many) ways to help others.

5. I _______ (have/has) lived here since the sea.

6. I’m sure that he _______ (great/greatly) changed the way of learning.

7. Team lend my bike to you _______ (before) you return it on time.

8. When you grow up, Dad often _______ (took/take) me to the museum.

9. In two months, the new school term _______ (would/will) begin next month.

10. The source of life is _______ (Water / Fire)

1. My family is reading books / enjoy

2. the beauty around you / to enjoy / is

3. what / should / do / to realize our dreams / we

4. was translated into / his book / last year / French
```
2025-03-03 12:12:02.853 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"40b01d79-53ff-4121-919c-3815873538c0","workflow_run_id":"3680ed2e-5c19-4728-b836-4af84057b0c3","data":{"id":"3680ed2e-5c19-4728-b836-4af84057b0c3","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 2024 届高三学生英语月考试题\n\n## 一、完型题（从A项与B项的内容中选择一个填入空中句子内）。共 10 题。每题 2 分\n\n1. I have confidence _______ (see) my future.\n\n2. _______ (What/how) beautiful the East Lake is!\n\n3. John _______ (is/are) familiar with Chinese culture.\n\n4. There are _______ (much/many) ways to help others.\n\n5. I _______ (have/has) lived here since the sea.\n\n6. I’m sure that he _______ (great/greatly) changed the way of learning.\n\n7. Team lend my bike to you _______ (before) you return it on time.\n\n8. When you grow up, Dad often _______ (took/take) me to the museum.\n\n9. In two months, the new school term _______ (would/will) begin next month.\n\n10. The source of life is _______ (Water / Fire)\n\n1. My family is reading books / enjoy\n\n2. the beauty around you / to enjoy / is\n\n3. what / should / do / to realize our dreams / we\n\n4. was translated into / his book / last year / French\n```"},"elapsed_time":25.141262128949165,"total_tokens":677,"total_steps":4,"created_at":1740975095,"finished_at":1740975121}}
2025-03-03 12:12:03.100  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png
2025-03-03 12:12:03.100  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, userId=system
2025-03-03 12:12:03.100 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:12:03.100 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:12:03.169  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=029318e8-16f1-4f15-8709-9e6199ea5a4f
2025-03-03 12:12:03.170 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"029318e8-16f1-4f15-8709-9e6199ea5a4f"}},"response_mode":"blocking","conversation_id":"cec3f608-c106-4860-a6c8-28ff577f71c3","user":"fyjw"}
2025-03-03 12:12:11.335 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d9ebe460-4376-42f8-99ea-c30b23a361b3","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"16. has attracted / more and more people / Life in the countryside\n\n---\n\n三、阅读短文（根据文章内容完成句子，每空词数不限），共 2 道题，每题 2 分\n\n### Passage 1\n\n#### Kids Need Free Play\n\n**Who:** Giving our kids time to play is not a choice but a ________.\n\n**Why:** Free play is important to the ________ social, emotional and well-being of children and youth.\n\n**What:** Parents should ________ 19 ________ the play. The word \"free\" means both \"with\" 20 ________ \"and with no cost\".\n\n**Why:** Free play enables kids to ________ with others and learn important social skills.\n\n### Passage 2\n\n#### Keep an Eye on Giraffes\n\n**What:** Giraffes are quietly ________ 22 ________ because of the loss of habitat to find. GPS collars were put to keep an eye on giraffes but they only ________ 23 ________ on for long.\n\n**How:** Now tracking devices, which are also a colored solar, are put on giraffes' horns, and don't 24 ________ 25 ________ to stop illegal hunting to keep giraffes safe.\n\n---\n\n四、阅读短文（根据文章内容完成句子），共 2 道题，每题 2 分"},"elapsed_time":8.112945294007659,"total_tokens":899,"total_steps":4,"created_at":1740975121,"finished_at":1740975129}
2025-03-03 12:12:11.335  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, text=16. has attracted / more and more people / Life in the countryside

---

三、阅读短文（根据文章内容完成句子，每空词数不限），共 2 道题，每题 2 分

### Passage 1

#### Kids Need Free Play

**Who:** Giving our kids time to play is not a choice but a ________.

**Why:** Free play is important to the ________ social, emotional and well-being of children and youth.

**What:** Parents should ________ 19 ________ the play. The word "free" means both "with" 20 ________ "and with no cost".

**Why:** Free play enables kids to ________ with others and learn important social skills.

### Passage 2

#### Keep an Eye on Giraffes

**What:** Giraffes are quietly ________ 22 ________ because of the loss of habitat to find. GPS collars were put to keep an eye on giraffes but they only ________ 23 ________ on for long.

**How:** Now tracking devices, which are also a colored solar, are put on giraffes' horns, and don't 24 ________ 25 ________ to stop illegal hunting to keep giraffes safe.

---

四、阅读短文（根据文章内容完成句子），共 2 道题，每题 2 分
2025-03-03 12:12:11.335 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"09eb634d-cfad-4fb5-8e86-aefb99dfea48","workflow_run_id":"d9ebe460-4376-42f8-99ea-c30b23a361b3","data":{"id":"d9ebe460-4376-42f8-99ea-c30b23a361b3","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"16. has attracted / more and more people / Life in the countryside\n\n---\n\n三、阅读短文（根据文章内容完成句子，每空词数不限），共 2 道题，每题 2 分\n\n### Passage 1\n\n#### Kids Need Free Play\n\n**Who:** Giving our kids time to play is not a choice but a ________.\n\n**Why:** Free play is important to the ________ social, emotional and well-being of children and youth.\n\n**What:** Parents should ________ 19 ________ the play. The word \"free\" means both \"with\" 20 ________ \"and with no cost\".\n\n**Why:** Free play enables kids to ________ with others and learn important social skills.\n\n### Passage 2\n\n#### Keep an Eye on Giraffes\n\n**What:** Giraffes are quietly ________ 22 ________ because of the loss of habitat to find. GPS collars were put to keep an eye on giraffes but they only ________ 23 ________ on for long.\n\n**How:** Now tracking devices, which are also a colored solar, are put on giraffes' horns, and don't 24 ________ 25 ________ to stop illegal hunting to keep giraffes safe.\n\n---\n\n四、阅读短文（根据文章内容完成句子），共 2 道题，每题 2 分"},"elapsed_time":8.112945294007659,"total_tokens":899,"total_steps":4,"created_at":1740975121,"finished_at":1740975129}}
2025-03-03 12:12:11.547  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png
2025-03-03 12:12:11.547  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, userId=system
2025-03-03 12:12:11.547 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:12:11.547 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:12:11.613  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=9777b896-c79a-4f98-a896-043a20e5a768
2025-03-03 12:12:11.613 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"9777b896-c79a-4f98-a896-043a20e5a768"}},"response_mode":"blocking","conversation_id":"61adac9f-c5a6-4590-b96c-355925d37159","user":"fyjw"}
2025-03-03 12:12:29.551 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"3094f875-c2ff-436e-92f5-3da7dc5d8aa5","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n## Passage 3\n\n（独一段落）It was on Sunday morning, when Sam went to see his grandfather alone. [段落1]\n\n27. When did the story happen?\n\n28. How did Sam go to see his grandfather, by bike or by bus?\n\n29. Who gave up the seat to the old lady?\n\n30. Why did other passengers also get up?\n\n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n---\n\n## Passage 4\n\nIn my job, I get to combine my two passions: sport and writing.\n\nI wrote newspaper articles about sport while studying for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a football game. I arrive at the stadium two hours before the game begins. I see the team warming up.\n\nBy now, the players are arriving, so I hurry down to wait outside the changing rooms. I am waiting to get a short interview with the home team's star player. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects from the game.\n\nThen, the game starts. I take notes as the game progresses. I observe how each team works. I hear the team fans! At the same time, I keep in contact with other journalists. We listen to each other's opinions on how the game goes.\n\nFinally, it is time for me to pull all my notes together into the finished article to send to the editor.\n```"},"elapsed_time":17.887559375027195,"total_tokens":719,"total_steps":4,"created_at":1740975129,"finished_at":1740975147}
2025-03-03 12:12:29.552  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, text=```markdown
## Passage 3

（独一段落）It was on Sunday morning, when Sam went to see his grandfather alone. [段落1]

27. When did the story happen?

28. How did Sam go to see his grandfather, by bike or by bus?

29. Who gave up the seat to the old lady?

30. Why did other passengers also get up?

31. Translate the sentence "what a lovely little girl" into Chinese.

---

## Passage 4

In my job, I get to combine my two passions: sport and writing.

I wrote newspaper articles about sport while studying for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a football game. I arrive at the stadium two hours before the game begins. I see the team warming up.

By now, the players are arriving, so I hurry down to wait outside the changing rooms. I am waiting to get a short interview with the home team's star player. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects from the game.

Then, the game starts. I take notes as the game progresses. I observe how each team works. I hear the team fans! At the same time, I keep in contact with other journalists. We listen to each other's opinions on how the game goes.

Finally, it is time for me to pull all my notes together into the finished article to send to the editor.
```
2025-03-03 12:12:29.553 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"f8830068-0baf-48df-af60-d3c39483ccea","workflow_run_id":"3094f875-c2ff-436e-92f5-3da7dc5d8aa5","data":{"id":"3094f875-c2ff-436e-92f5-3da7dc5d8aa5","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n## Passage 3\n\n（独一段落）It was on Sunday morning, when Sam went to see his grandfather alone. [段落1]\n\n27. When did the story happen?\n\n28. How did Sam go to see his grandfather, by bike or by bus?\n\n29. Who gave up the seat to the old lady?\n\n30. Why did other passengers also get up?\n\n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n---\n\n## Passage 4\n\nIn my job, I get to combine my two passions: sport and writing.\n\nI wrote newspaper articles about sport while studying for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a football game. I arrive at the stadium two hours before the game begins. I see the team warming up.\n\nBy now, the players are arriving, so I hurry down to wait outside the changing rooms. I am waiting to get a short interview with the home team's star player. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects from the game.\n\nThen, the game starts. I take notes as the game progresses. I observe how each team works. I hear the team fans! At the same time, I keep in contact with other journalists. We listen to each other's opinions on how the game goes.\n\nFinally, it is time for me to pull all my notes together into the finished article to send to the editor.\n```"},"elapsed_time":17.887559375027195,"total_tokens":719,"total_steps":4,"created_at":1740975129,"finished_at":1740975147}}
2025-03-03 12:12:29.873  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png
2025-03-03 12:12:29.873  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, userId=system
2025-03-03 12:12:29.873 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:12:29.873 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:12:29.953  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=1d5db49c-1101-4fba-a42b-d2582f6d2018
2025-03-03 12:12:29.954 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"1d5db49c-1101-4fba-a42b-d2582f6d2018"}},"response_mode":"blocking","conversation_id":"877ceb2e-eb69-4155-9343-ffdb8292e3e3","user":"fyjw"}
2025-03-03 12:12:46.324 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"8cd32324-15a7-4ac7-9775-2faaa6b91c53","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. I love sharing my love for sport through words.\n\n32. What newspaper articles does the writer write about?\n\n33. Why does the writer ask only a few important questions?\n\n34. Who wins the baseball game in the end?\n\n35. How many hours does the writer have to write up his article?\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.\n\n五、填词补全句（每空一词，每题 1 分，共 6 分）\n\n37. _______ _______ weren't you when you went to college? (old)\n\n你多大时上大学？\n\n38. If I _______ _______ where _______ (live)\n\n如果我知道你住在哪里，我一定会去看你。\n\n39. Our library is _______ _______ than the one in your college. (modern)\n\n我们的图书馆比你们学校的更现代化。\n\n40. Please _______ _______ that you have enough rest. (sure)\n\n请确保你休息得够充分。\n```"},"elapsed_time":16.32600093097426,"total_tokens":872,"total_steps":4,"created_at":1740975148,"finished_at":1740975164}
2025-03-03 12:12:46.325  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, text=```markdown
newspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. I love sharing my love for sport through words.

32. What newspaper articles does the writer write about?

33. Why does the writer ask only a few important questions?

34. Who wins the baseball game in the end?

35. How many hours does the writer have to write up his article?

36. Translate the sentence "I love sharing my love for sport through words" into Chinese.

五、填词补全句（每空一词，每题 1 分，共 6 分）

37. _______ _______ weren't you when you went to college? (old)

你多大时上大学？

38. If I _______ _______ where _______ (live)

如果我知道你住在哪里，我一定会去看你。

39. Our library is _______ _______ than the one in your college. (modern)

我们的图书馆比你们学校的更现代化。

40. Please _______ _______ that you have enough rest. (sure)

请确保你休息得够充分。
```
2025-03-03 12:12:46.325 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c63f1524-c2bb-45d5-b0f7-47e2ab067e36","workflow_run_id":"8cd32324-15a7-4ac7-9775-2faaa6b91c53","data":{"id":"8cd32324-15a7-4ac7-9775-2faaa6b91c53","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. I love sharing my love for sport through words.\n\n32. What newspaper articles does the writer write about?\n\n33. Why does the writer ask only a few important questions?\n\n34. Who wins the baseball game in the end?\n\n35. How many hours does the writer have to write up his article?\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.\n\n五、填词补全句（每空一词，每题 1 分，共 6 分）\n\n37. _______ _______ weren't you when you went to college? (old)\n\n你多大时上大学？\n\n38. If I _______ _______ where _______ (live)\n\n如果我知道你住在哪里，我一定会去看你。\n\n39. Our library is _______ _______ than the one in your college. (modern)\n\n我们的图书馆比你们学校的更现代化。\n\n40. Please _______ _______ that you have enough rest. (sure)\n\n请确保你休息得够充分。\n```"},"elapsed_time":16.32600093097426,"total_tokens":872,"total_steps":4,"created_at":1740975148,"finished_at":1740975164}}
2025-03-03 12:12:46.670  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png
2025-03-03 12:12:46.670  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, userId=system
2025-03-03 12:12:46.670 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:12:46.670 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:12:46.821  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8c89cfe9-3e9f-4e0e-808f-c20f45681be4
2025-03-03 12:12:46.822 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"8c89cfe9-3e9f-4e0e-808f-c20f45681be4"}},"response_mode":"blocking","conversation_id":"9c44f4b4-4029-45dc-b52f-899fe9e829d2","user":"fyjw"}
2025-03-03 12:12:53.365 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"ab34bb6a-d026-4f6b-bdd6-c9f5e5dad305","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n41. Travel can give us a chance ______ people from different cultures. (meet)\n\n旅行能让我们有机会认识来自不同文化的的人。\n\n42. The snow is so ______ that the whole world is covered in silver. (heavy)\n\n雪下得如此之大，整个世界都披上了银装。\n\n六、写作。共10分\n\n假如你是露露，邀请一位新朋友彼得参加你组织的英语角活动。请按照提示写信。\n\n1. 时间：本周三下午4点到5点\n\n2. 地点：302 Reading\n\n3. 主题：如何提高英语水平\n\n4. 要求：\n\n   1) 语句通顺，书写规范；\n\n   2) 不得出现任何个人信息及真实校名。\n\n注意：字数60-80词。\n\n中考冲刺补习帮\n```"},"elapsed_time":6.480115856043994,"total_tokens":811,"total_steps":4,"created_at":1740975165,"finished_at":1740975171}
2025-03-03 12:12:53.366  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, text=```markdown
41. Travel can give us a chance ______ people from different cultures. (meet)

旅行能让我们有机会认识来自不同文化的的人。

42. The snow is so ______ that the whole world is covered in silver. (heavy)

雪下得如此之大，整个世界都披上了银装。

六、写作。共10分

假如你是露露，邀请一位新朋友彼得参加你组织的英语角活动。请按照提示写信。

1. 时间：本周三下午4点到5点

2. 地点：302 Reading

3. 主题：如何提高英语水平

4. 要求：

   1) 语句通顺，书写规范；

   2) 不得出现任何个人信息及真实校名。

注意：字数60-80词。

中考冲刺补习帮
```
2025-03-03 12:12:53.366 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6038d9f1-0e65-48d5-912b-c8f6eda6ae42","workflow_run_id":"ab34bb6a-d026-4f6b-bdd6-c9f5e5dad305","data":{"id":"ab34bb6a-d026-4f6b-bdd6-c9f5e5dad305","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n41. Travel can give us a chance ______ people from different cultures. (meet)\n\n旅行能让我们有机会认识来自不同文化的的人。\n\n42. The snow is so ______ that the whole world is covered in silver. (heavy)\n\n雪下得如此之大，整个世界都披上了银装。\n\n六、写作。共10分\n\n假如你是露露，邀请一位新朋友彼得参加你组织的英语角活动。请按照提示写信。\n\n1. 时间：本周三下午4点到5点\n\n2. 地点：302 Reading\n\n3. 主题：如何提高英语水平\n\n4. 要求：\n\n   1) 语句通顺，书写规范；\n\n   2) 不得出现任何个人信息及真实校名。\n\n注意：字数60-80词。\n\n中考冲刺补习帮\n```"},"elapsed_time":6.480115856043994,"total_tokens":811,"total_steps":4,"created_at":1740975165,"finished_at":1740975171}}
2025-03-03 12:12:53.366 DEBUG 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:12:53.366  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=5197
2025-03-03 12:12:53.366 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:12:53.449  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"d64b0ee0-9da1-4551-8767-31e35ed4ac0f"},"data_source_detail_dict":{"upload_file":{"id":"d64b0ee0-9da1-4551-8767-31e35ed4ac0f","name":"2024届湖北专升本英语真题_20240517141034.md","size":5197,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740975171.651653}},"dataset_process_rule_id":"8e609fbe-95ce-488d-ad45-351c2d2cdca6","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":2437,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":5265,"hit_count":0,"doc_form":"text_model"},"batch":"20250303041251477505"}
2025-03-03 12:12:53.449  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:12:53.469 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:12:53.469 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:12:53.489 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:12:53.676 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:12:53.679 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:12:53.680 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:12:53.700 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:12:53.871 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:12:54.387  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 12:12:54.408 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:12:54.409 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:12:54.431 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:12:54.591 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:12:54.592  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 12:12:54.592  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 12:12:54.592 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:12:54.592 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:12:54.646  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2565c06e-3708-49cd-858b-5956cd434922
2025-03-03 12:12:54.646 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"2565c06e-3708-49cd-858b-5956cd434922"}},"response_mode":"blocking","conversation_id":"7837a14d-74ae-4507-8392-a221142805e4","user":"fyjw"}
2025-03-03 12:13:01.422 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"0244abca-2e28-4ae5-b0aa-57cf76cd51f2","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海临港新片区鑫港先开实业有限公司\n\n2022年9月向我司申请办理“上海市商品房预售合同”(合同编号：202200176383)，因您公司未及时支付全额房款。\n\n本小区现有房屋销售火爆，因限价房源紧张，您原申请的又享上海市首套房税收优惠政策。\n\n在汇丰银行利率上调的情况下，为维护双方的合法权益及公司品牌声誉，我司特决定给您公司原申请的房源延长付款有效期限至2023年12月8日，原价格不变，即在此期间您若支付剩余房款，仍可以原价格购买原申请的房源。\n\n逾期未付款，我司将根据合同约定按当前市场价4.75%予以调整房款并办理手续。\n\n在该房源付款有效期内我司将正式受理。时间：2023年12月8日之前。\n\n联系人：程四合 电话：13262792367\n\n杨晓理 电话：15821427034\n\n2023年11月28日\n```"},"elapsed_time":6.7292684270069,"total_tokens":877,"total_steps":4,"created_at":1740975172,"finished_at":1740975179}
2025-03-03 12:13:01.422  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通知函

上海临港新片区鑫港先开实业有限公司

2022年9月向我司申请办理“上海市商品房预售合同”(合同编号：202200176383)，因您公司未及时支付全额房款。

本小区现有房屋销售火爆，因限价房源紧张，您原申请的又享上海市首套房税收优惠政策。

在汇丰银行利率上调的情况下，为维护双方的合法权益及公司品牌声誉，我司特决定给您公司原申请的房源延长付款有效期限至2023年12月8日，原价格不变，即在此期间您若支付剩余房款，仍可以原价格购买原申请的房源。

逾期未付款，我司将根据合同约定按当前市场价4.75%予以调整房款并办理手续。

在该房源付款有效期内我司将正式受理。时间：2023年12月8日之前。

联系人：程四合 电话：13262792367

杨晓理 电话：15821427034

2023年11月28日
```
2025-03-03 12:13:01.422 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"dcf002c9-16da-4342-adb3-e2a078556494","workflow_run_id":"0244abca-2e28-4ae5-b0aa-57cf76cd51f2","data":{"id":"0244abca-2e28-4ae5-b0aa-57cf76cd51f2","workflow_id":"9706cf13-113f-4afa-8741-b8bb6f8952a5","status":"succeeded","outputs":{"image":"```markdown\n# 通知函\n\n上海临港新片区鑫港先开实业有限公司\n\n2022年9月向我司申请办理“上海市商品房预售合同”(合同编号：202200176383)，因您公司未及时支付全额房款。\n\n本小区现有房屋销售火爆，因限价房源紧张，您原申请的又享上海市首套房税收优惠政策。\n\n在汇丰银行利率上调的情况下，为维护双方的合法权益及公司品牌声誉，我司特决定给您公司原申请的房源延长付款有效期限至2023年12月8日，原价格不变，即在此期间您若支付剩余房款，仍可以原价格购买原申请的房源。\n\n逾期未付款，我司将根据合同约定按当前市场价4.75%予以调整房款并办理手续。\n\n在该房源付款有效期内我司将正式受理。时间：2023年12月8日之前。\n\n联系人：程四合 电话：13262792367\n\n杨晓理 电话：15821427034\n\n2023年11月28日\n```"},"elapsed_time":6.7292684270069,"total_tokens":877,"total_steps":4,"created_at":1740975172,"finished_at":1740975179}}
2025-03-03 12:13:01.422  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=931
2025-03-03 12:13:01.422 DEBUG 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:13:01.517  INFO 29040 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"f3817168-dd81-4983-9e55-0fc49472a8ec"},"data_source_detail_dict":{"upload_file":{"id":"f3817168-dd81-4983-9e55-0fc49472a8ec","name":"程阿金和解通知.md","size":931,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740975179.716313}},"dataset_process_rule_id":"be7a5f3d-4c03-4844-8acd-700f3e6bff98","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":424,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":452,"hit_count":0,"doc_form":"text_model"},"batch":"20250303041259515169"}
2025-03-03 12:13:01.517  INFO 29040 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 12:13:01.536 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:13:01.536 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:13:01.556 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:13:01.712 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:13:01.714 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:13:01.714 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:13:01.734 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:13:01.932 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:13:01.935 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:13:01.935 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:13:01.955 DEBUG 29040 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:13:02.104 ERROR 29040 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:19:18.140  INFO 29040 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 12:19:18.143  INFO 29040 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 12:19:20.104  INFO 6372 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 6372 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 12:19:20.105 DEBUG 6372 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 12:19:20.106  INFO 6372 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 12:19:20.400  INFO 6372 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 12:19:20.402  INFO 6372 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 12:19:20.416  INFO 6372 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 12:19:20.706  INFO 6372 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 12:19:20.712  INFO 6372 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 12:19:20.712  INFO 6372 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 12:19:20.785  INFO 6372 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 12:19:20.785  INFO 6372 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 658 ms
2025-03-03 12:19:20.956  INFO 6372 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 12:19:20.957  INFO 6372 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 12:19:21.478  INFO 6372 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 12:19:21.719  INFO 6372 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477430750498816028&access_key=7b6e77ac2fa17e83f47f0cc98570445a&service_id=33554678&ticket=a0636c9f-49b4-4d5f-b543-19b0bf80c66f [conn_id=7477430750498816028]
2025-03-03 12:19:21.785  INFO 6372 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 12:19:21.791  INFO 6372 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.895 seconds (JVM running for 2.297)
2025-03-03 12:19:27.431  INFO 6372 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740975565}
2025-03-03 12:19:31.545  INFO 6372 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740975569}
2025-03-03 12:19:31.567  WARN 6372 --- [pool-2-thread-3] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 12:19:31.574  INFO 6372 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 12:19:31.832  INFO 6372 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 12:19:31.836 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:19:31.852 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:19:31.884 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:19:31.886 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:19:31.887 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:19:31.906 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:19:31.906 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:19:31.906 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:19:31.926 DEBUG 6372 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:19:31.926  INFO 6372 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 12:19:32.482  INFO 6372 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:19:32.484  INFO 6372 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:19:33.029  INFO 6372 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:19:31 GMT"],"eagleid":["74c4871617409755707655577e"],"request-id":["17ad5d67-06b4-40b2-b5bb-64b9bf0c4e96"],"server":["Tengine"],"server-timing":["inner; dur=431","cdn-cache;desc=MISS,edge;dur=0,origin;dur=447"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache17.cn7535[447,0]"],"x-lgw-dst-svc":["IZQz8OoB0A6z1naW9_5AhXtnqVErl7D8J_3Y8E3XXCb6h98IEP2toglPpx1hZk2LvAOTN0AZHjRPSaUbLQkyKa06DafJXQM63Vz7NUGPMWuxRLkW8pMNN2QQg0woV1zK90I0dbEIqEeDjXy-ypJypydc_nXwH3TfExNKNk6e86B21BBFf0tE5i-UQjp7apQi8v7jj3VNheao3-1bDs8WhwSSoDZeeLxPERH8DZR4S4_vw69A4mkMDc50ORnelnZ2lZESCuSKyjxd4CoTPo3YliX-beE88poy54CAq70DSwdKQX2G9HmrWg=="],"x-request-id":["17ad5d67-06b4-40b2-b5bb-64b9bf0c4e96"],"x-timestamp":["1740975571.202"],"x-tt-logid":["20250303121930F3F61115B766D7E79A46"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1bea55d1efc2386d72770d7e154330ac8e1dfbf2e180bfb2814de4b5ed0fbfb6ddc675183f067a7a1859f817baf5470d0aecdb53ea2bfbaadc4f5b54739227f09f56a94d5e7919a4cdc4294ecb1b029391c"],"x-tt-trace-id":["00-250303121930F3F61115B766D7E79A46-235138CE81AB4131-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303121930F3F61115B766D7E79A46","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"20250303121930F3F61115B766D7E79A46"}
2025-03-03 12:19:33.029  INFO 6372 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 12:19:33.422  INFO 6372 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 12:19:33.443 DEBUG 6372 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:19:33.444 DEBUG 6372 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:19:33.465 DEBUG 6372 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:19:33.626 ERROR 6372 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:19:33.626  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 12:19:33.626  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 12:19:33.628 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:19:33.628 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:19:44.469  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ba100d9a-e4c4-4479-b2fa-4b6839351803
2025-03-03 12:19:44.469 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"ba100d9a-e4c4-4479-b2fa-4b6839351803"}},"response_mode":"blocking","conversation_id":"1e3cac05-ccbb-4b1e-9acd-4e102f7771e7","user":"fyjw"}
2025-03-03 12:19:44.538 ERROR 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:19:44.539  INFO 6372 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 12:19:44.562 DEBUG 6372 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:19:44.562 DEBUG 6372 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:19:44.584 DEBUG 6372 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:19:44.749 ERROR 6372 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:19:45.794  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 12:19:45.794  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 12:19:45.794 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:19:45.794 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:19:45.975  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=41fbc85b-36fa-4931-8bf6-8a7e3f12584b
2025-03-03 12:19:45.976 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"41fbc85b-36fa-4931-8bf6-8a7e3f12584b"}},"response_mode":"blocking","conversation_id":"676eaa5d-ca84-4be3-abe1-df0798d4fc5d","user":"fyjw"}
2025-03-03 12:20:01.648 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"dac8b535-0d39-497b-8a6e-031c57a8a1d5","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是上海市新建住宅交付使用的《许可证》。文本内容如下：\n\n```\n上海市新建住宅交付使用\n\n许 可 证\n\n上海市房屋管理局 监制\n```\n\n这表明该证书是由上海市房屋管理局监制的，用于新建住宅交付使用的许可文件。"},"elapsed_time":15.605288587044924,"total_tokens":473,"total_steps":4,"created_at":1740975584,"finished_at":1740975599}
2025-03-03 12:20:01.649  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=这是上海市新建住宅交付使用的《许可证》。文本内容如下：

```
上海市新建住宅交付使用

许 可 证

上海市房屋管理局 监制
```

这表明该证书是由上海市房屋管理局监制的，用于新建住宅交付使用的许可文件。
2025-03-03 12:20:01.650 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"0429ac04-6482-465f-8471-2688549948e3","workflow_run_id":"dac8b535-0d39-497b-8a6e-031c57a8a1d5","data":{"id":"dac8b535-0d39-497b-8a6e-031c57a8a1d5","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是上海市新建住宅交付使用的《许可证》。文本内容如下：\n\n```\n上海市新建住宅交付使用\n\n许 可 证\n\n上海市房屋管理局 监制\n```\n\n这表明该证书是由上海市房屋管理局监制的，用于新建住宅交付使用的许可文件。"},"elapsed_time":15.605288587044924,"total_tokens":473,"total_steps":4,"created_at":1740975584,"finished_at":1740975599}}
2025-03-03 12:20:02.806  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 12:20:02.806  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 12:20:02.806 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:20:02.806 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:20:03.790  INFO 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=3242422c-799c-4088-99ac-06106f507981
2025-03-03 12:20:03.791 DEBUG 6372 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"3242422c-799c-4088-99ac-06106f507981"}},"response_mode":"blocking","conversation_id":"b94c730f-8a77-4d0e-923e-388724c064ab","user":"fyjw"}
2025-03-03 12:27:14.374  INFO 6372 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 12:27:14.378  INFO 6372 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 12:27:16.232  INFO 32320 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 32320 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 12:27:16.233 DEBUG 32320 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 12:27:16.233  INFO 32320 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 12:27:16.486  INFO 32320 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 12:27:16.486  INFO 32320 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 12:27:16.501  INFO 32320 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 12:27:16.747  INFO 32320 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 12:27:16.751  INFO 32320 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 12:27:16.751  INFO 32320 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 12:27:16.827  INFO 32320 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 12:27:16.827  INFO 32320 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 574 ms
2025-03-03 12:27:16.977  INFO 32320 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 12:27:16.978  INFO 32320 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 12:27:17.475  INFO 32320 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 12:27:17.650  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477430900548550658&access_key=ca98780343faebba5343967c33d63795&service_id=33554678&ticket=4c2175ab-c92e-4137-a528-cb6ca17f03fa [conn_id=7477430900548550658]
2025-03-03 12:27:17.782  INFO 32320 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 12:27:17.787  INFO 32320 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.72 seconds (JVM running for 2.049)
2025-03-03 12:27:24.785  INFO 32320 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740976042}
2025-03-03 12:27:24.814  WARN 32320 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 12:27:24.821  INFO 32320 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 12:27:25.111  INFO 32320 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 12:27:25.116 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:27:25.127 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:27:25.173 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:27:25.176 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:27:25.176 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:27:25.198 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:27:25.199 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:27:25.199 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 19(String)
2025-03-03 12:27:25.222 DEBUG 32320 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:27:25.222  INFO 32320 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: IyQpfrSMLlWJUAdlKw3cmcb3njf
2025-03-03 12:27:26.022  INFO 32320 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:27:26.023  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=IyQpfrSMLlWJUAdlKw3cmcb3njf, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=19
2025-03-03 12:27:26.571  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740972340","modified_time":"1740972340","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"UOmSbcqrMoXjsrxbD65c3nOwnxg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/UOmSbcqrMoXjsrxbD65c3nOwnxg"},{"created_time":"1740972311","modified_time":"1740972312","name":"2024届湖北专升本英语真题_20240517141034.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"E1T5blbFgoIA9dxJ5kmcMuA1ngh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/E1T5blbFgoIA9dxJ5kmcMuA1ngh"},{"created_time":"1740908237","modified_time":"1740908237","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf","token":"I3Rlb09TSo6gUIxGXsucF7WQnOg","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/I3Rlb09TSo6gUIxGXsucF7WQnOg"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,52,48,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,85,79,109,83,98,99,113,114,77,111,88,106,115,114,120,98,68,54,53,99,51,110,79,119,110,120,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,50,51,49,50,34,44,34,110,97,109,101,34,58,34,50,48,50,52,-27,-79,-118,-26,-71,-106,-27,-116,-105,-28,-72,-109,-27,-115,-121,-26,-100,-84,-24,-117,-79,-24,-81,-83,-25,-100,-97,-23,-94,-104,95,50,48,50,52,48,53,49,55,49,52,49,48,51,52,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,69,49,84,53,98,108,98,70,103,111,73,65,57,100,120,74,53,107,109,99,77,117,65,49,110,103,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,48,56,50,51,55,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,121,81,112,102,114,83,77,76,108,87,74,85,65,100,108,75,119,51,99,109,99,98,51,110,106,102,34,44,34,116,111,107,101,110,34,58,34,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,51,82,108,98,48,57,84,83,111,54,103,85,73,120,71,88,115,117,99,70,55,87,81,110,79,103,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:27:24 GMT"],"eagleid":["74c48fae17409760443028270e"],"request-id":["af32d763-335e-467c-80c8-9ed9ed084ef3"],"server":["Tengine"],"server-timing":["inner; dur=432","cdn-cache;desc=MISS,edge;dur=0,origin;dur=450"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache26.cn7149[450,0]"],"x-lgw-dst-svc":["iPdWC80Ce_tFnZis9EhZlUyxP1hElw2TnFpNAU3tsH7QVqi_CfzeFYuDo4-AnFvpsaDthjnU0a0bQSBiqVpDYTY1Qrl6nmCJCJMV_F4w5-wz3Hq07LUXZ8Z_MZ90eOFRvUg9n26BMQS96VegKk4HR96VGnKqhZ_UOdAVptKnPrMjmaODj9lOF2H0NWQVifOtdEIk6f7Pg7r94TGcJy3leFywdrz7g7K8Mbs9QJieb5IoRiECc_3xpcjYzHnxYozUxMDt1fBd13IJYLWweLXBi1K6-TtPc7S9j8tYp3n9m0eiYrggP1RW7_0="],"x-request-id":["af32d763-335e-467c-80c8-9ed9ed084ef3"],"x-timestamp":["1740976044.746"],"x-tt-logid":["2025030312272448F85C94CF472AE63002"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be8eb28f54c086042e0119e37056f778335fd937a071a4dbcc6473ba29dd3a9029556a0de7d4619f941c265879f126b2d4b8fca13fa33d26fea03d08d864c16aa33af64177055af4cb7cbc039c8a5bfbb6"],"x-tt-trace-id":["00-25030312272448F85C94CF472AE63002-53C2CB1571FEE7C4-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030312272448F85C94CF472AE63002","statusCode":200},"request":{"folder_token":"IyQpfrSMLlWJUAdlKw3cmcb3njf"},"requestId":"2025030312272448F85C94CF472AE63002"}
2025-03-03 12:27:26.572  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=UOmSbcqrMoXjsrxbD65c3nOwnxg, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740972340, updateTime=1740972340), IFeishuFolderService.FileInfo(fileToken=E1T5blbFgoIA9dxJ5kmcMuA1ngh, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileType=file, fileSize=null, createTime=1740972311, updateTime=1740972312), IFeishuFolderService.FileInfo(fileToken=I3Rlb09TSo6gUIxGXsucF7WQnOg, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740908237, updateTime=1740908237)]
2025-03-03 12:27:27.004  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 东九交付许可证.pdf
2025-03-03 12:27:27.028 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:27:27.029 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:27:27.053 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:27:27.187 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:27:27.188  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf
2025-03-03 12:27:27.189  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf, userId=system
2025-03-03 12:27:27.191 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:27:27.192 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:27:27.405  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=25049692-c896-4a55-ad65-68ee2df2e55e
2025-03-03 12:27:27.406 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"25049692-c896-4a55-ad65-68ee2df2e55e"}},"response_mode":"blocking","conversation_id":"39e21197-e7a1-4f74-8805-6ca37c6ed8f4","user":"fyjw"}
2025-03-03 12:27:27.448 ERROR 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:27:27.448  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 东九交付许可证.pdf
2025-03-03 12:27:27.449 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:27:27.449 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:27:27.472 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:27:27.638 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:27:28.728  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_0.png
2025-03-03 12:27:28.728  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_0.png, userId=system
2025-03-03 12:27:28.728 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:27:28.729 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:27:28.937  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2525d426-c2b4-46cc-8219-ce2b2ceee3b9
2025-03-03 12:27:28.937 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"2525d426-c2b4-46cc-8219-ce2b2ceee3b9"}},"response_mode":"blocking","conversation_id":"b08092d3-d614-48df-8afe-a66627bf910f","user":"fyjw"}
2025-03-03 12:27:53.069 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"b435b4b3-5107-4fe7-8ae7-b31d3a60bc6d","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一本《上海市新建住宅交付使用许可证》。  \n封面上写有以下文字：\n\n```\n上海市新建住宅交付使用  \n许 可 证  \n上海市房屋管理局 制\n```\n\n这本许可证由上海市房屋管理局编制和颁发，通常用于证明新建住宅符合相关标准并允许交付使用。"},"elapsed_time":24.086336811073124,"total_tokens":479,"total_steps":4,"created_at":1740976047,"finished_at":1740976071}
2025-03-03 12:27:53.070  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_0.png, text=这是一本《上海市新建住宅交付使用许可证》。  
封面上写有以下文字：

```
上海市新建住宅交付使用  
许 可 证  
上海市房屋管理局 制
```

这本许可证由上海市房屋管理局编制和颁发，通常用于证明新建住宅符合相关标准并允许交付使用。
2025-03-03 12:27:53.071 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"9e21cdd7-03a3-432c-818b-af771e0f5e14","workflow_run_id":"b435b4b3-5107-4fe7-8ae7-b31d3a60bc6d","data":{"id":"b435b4b3-5107-4fe7-8ae7-b31d3a60bc6d","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一本《上海市新建住宅交付使用许可证》。  \n封面上写有以下文字：\n\n```\n上海市新建住宅交付使用  \n许 可 证  \n上海市房屋管理局 制\n```\n\n这本许可证由上海市房屋管理局编制和颁发，通常用于证明新建住宅符合相关标准并允许交付使用。"},"elapsed_time":24.086336811073124,"total_tokens":479,"total_steps":4,"created_at":1740976047,"finished_at":1740976071}}
2025-03-03 12:27:54.206  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=东九交付许可证.pdf_page_1.png
2025-03-03 12:27:54.206  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=东九交付许可证.pdf_page_1.png, userId=system
2025-03-03 12:27:54.206 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:27:54.206 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:27:55.185  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d4b038a4-0bbc-4c5b-a48e-2371a0d7763f
2025-03-03 12:27:55.185 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"d4b038a4-0bbc-4c5b-a48e-2371a0d7763f"}},"response_mode":"blocking","conversation_id":"86dc9150-977a-4b59-bfbc-d7eb2e13e82a","user":"fyjw"}
2025-03-03 12:28:48.507 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"cd62b5ef-a549-4200-af6e-d61c6d95323b","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 上海市新建住宅交付使用许可证\n\n**许可证编号**：沪房管(竣)字第【2023】***号  \n\n根据《上海市新建住宅交付使用许可证管理规定》，经审定，准予该项目符合交付使用标准，准予交付。  \n\n特发此证。  \n\n**项目名称**：***************************  \n**建设单位**：***************************  \n**项目地址**：***************************  \n**交付使用许可时间**：2023年**月**日  \n\n**发证机关**：上海市住房和城乡建设管理委员会（盖章）  \n**发证日期**：2023年**月**日  \n\n（此证书仅用于新建住宅交付使用）  \n\n---\n\n## 附件  \n\n| 序号 | 栋号 | 预售证号 | 交付时间 |\n| ---- | ---- | -------- | -------- |\n| 1    | **号 | **       | **-**-** |\n| 2    | **号 | **       | **-**-** |\n| 3    | **号 | **       | **-**-** |\n| 4    | **号 | **       | **-**-** |\n| 5    | **号 | **       | **-**-** |\n| 6    | **号 | **       | **-**-** |\n| 7    | **号 | **       | **-**-** |\n| 8    | **号 | **       | **-**-** |\n\n**（盖章）**  \n\n---\n\n该证书为上海市住房和城乡建设管理委员会发放的新建住宅交付使用许可证，表明该住宅符合交付使用标准并允许交付。"},"elapsed_time":53.28307177009992,"total_tokens":785,"total_steps":4,"created_at":1740976073,"finished_at":1740976126}
2025-03-03 12:28:48.508  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=东九交付许可证.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

# 上海市新建住宅交付使用许可证

**许可证编号**：沪房管(竣)字第【2023】***号  

根据《上海市新建住宅交付使用许可证管理规定》，经审定，准予该项目符合交付使用标准，准予交付。  

特发此证。  

**项目名称**：***************************  
**建设单位**：***************************  
**项目地址**：***************************  
**交付使用许可时间**：2023年**月**日  

**发证机关**：上海市住房和城乡建设管理委员会（盖章）  
**发证日期**：2023年**月**日  

（此证书仅用于新建住宅交付使用）  

---

## 附件  

| 序号 | 栋号 | 预售证号 | 交付时间 |
| ---- | ---- | -------- | -------- |
| 1    | **号 | **       | **-**-** |
| 2    | **号 | **       | **-**-** |
| 3    | **号 | **       | **-**-** |
| 4    | **号 | **       | **-**-** |
| 5    | **号 | **       | **-**-** |
| 6    | **号 | **       | **-**-** |
| 7    | **号 | **       | **-**-** |
| 8    | **号 | **       | **-**-** |

**（盖章）**  

---

该证书为上海市住房和城乡建设管理委员会发放的新建住宅交付使用许可证，表明该住宅符合交付使用标准并允许交付。
2025-03-03 12:28:48.509 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"aa02e5c2-4668-4c65-8638-b0ce4dc17b13","workflow_run_id":"cd62b5ef-a549-4200-af6e-d61c6d95323b","data":{"id":"cd62b5ef-a549-4200-af6e-d61c6d95323b","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 上海市新建住宅交付使用许可证\n\n**许可证编号**：沪房管(竣)字第【2023】***号  \n\n根据《上海市新建住宅交付使用许可证管理规定》，经审定，准予该项目符合交付使用标准，准予交付。  \n\n特发此证。  \n\n**项目名称**：***************************  \n**建设单位**：***************************  \n**项目地址**：***************************  \n**交付使用许可时间**：2023年**月**日  \n\n**发证机关**：上海市住房和城乡建设管理委员会（盖章）  \n**发证日期**：2023年**月**日  \n\n（此证书仅用于新建住宅交付使用）  \n\n---\n\n## 附件  \n\n| 序号 | 栋号 | 预售证号 | 交付时间 |\n| ---- | ---- | -------- | -------- |\n| 1    | **号 | **       | **-**-** |\n| 2    | **号 | **       | **-**-** |\n| 3    | **号 | **       | **-**-** |\n| 4    | **号 | **       | **-**-** |\n| 5    | **号 | **       | **-**-** |\n| 6    | **号 | **       | **-**-** |\n| 7    | **号 | **       | **-**-** |\n| 8    | **号 | **       | **-**-** |\n\n**（盖章）**  \n\n---\n\n该证书为上海市住房和城乡建设管理委员会发放的新建住宅交付使用许可证，表明该住宅符合交付使用标准并允许交付。"},"elapsed_time":53.28307177009992,"total_tokens":785,"total_steps":4,"created_at":1740976073,"finished_at":1740976126}}
2025-03-03 12:28:48.513 DEBUG 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:28:48.514  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=东九交付许可证.pdf, fileSize=1628
2025-03-03 12:28:48.514 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=东九交付许可证.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:28:48.756  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"98fddd36-7702-440e-be5f-a7897facb5db","position":4,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"00f3149a-b0ea-43d4-890a-1894ca374972"},"data_source_detail_dict":{"upload_file":{"id":"00f3149a-b0ea-43d4-890a-1894ca374972","name":"东九交付许可证.md","size":1628,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740976126.817888}},"dataset_process_rule_id":"57e0c7c6-e1a7-4155-8b33-bc30e4fe0d47","name":"东九交付许可证.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972487,"tokens":32,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":44,"hit_count":0,"doc_form":"text_model"},"batch":"20250303042846548991"}
2025-03-03 12:28:48.756  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 东九交付许可证.pdf
2025-03-03 12:28:48.783 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:28:48.784 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:28:48.808 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:28:48.971 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:28:48.973 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:28:48.974 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:28:48.998 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:28:49.177 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:28:49.532  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:28:49.555 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:28:49.555 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:28:49.579 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:28:49.715 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:28:49.716  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:28:49.716  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf, userId=system
2025-03-03 12:28:49.716 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:28:49.716 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:28:49.773  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ac6a23d7-9506-46c0-b2ed-fe954cdca252
2025-03-03 12:28:49.773 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"ac6a23d7-9506-46c0-b2ed-fe954cdca252"}},"response_mode":"blocking","conversation_id":"2263fda7-493f-466c-8acc-666ef53671b1","user":"fyjw"}
2025-03-03 12:28:49.811 ERROR 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:28:49.812  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:28:49.813 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:28:49.813 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:28:49.836 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:28:49.983 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:28:50.376  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png
2025-03-03 12:28:50.376  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, userId=system
2025-03-03 12:28:50.376 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:28:50.376 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:28:50.459  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=67a80dee-f7f0-4873-9ab2-90c8b566288b
2025-03-03 12:28:50.459 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"67a80dee-f7f0-4873-9ab2-90c8b566288b"}},"response_mode":"blocking","conversation_id":"469ef4fb-ec27-4fab-8ebe-2e42c193acf1","user":"fyjw"}
2025-03-03 12:28:55.854 ERROR 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:28:55.854  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477430900548550658&access_key=ca98780343faebba5343967c33d63795&service_id=33554678&ticket=4c2175ab-c92e-4137-a528-cb6ca17f03fa [conn_id=7477430900548550658]
2025-03-03 12:28:55.854  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:28:57.203  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:28:57.462  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477432123462320129&access_key=c37ea8269a35d3060e05d28ea3d00b83&service_id=33554678&ticket=a5b7cb0d-9596-4ad3-b734-40c50aa452b6 [conn_id=7477432123462320129]
2025-03-03 12:29:03.634 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"b8fe023a-1603-46c4-ad86-f3f75b056f56","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n```markdown\n# 2024届高三英语复习查漏补题\n\n## 一、完成句（从括号里选出的词或短语中选出一个或选句子填空）。共10题，每题2分。\n\n1. I have confidence (in) ______.  \n\n2. She ______ (is/are) familiar with Chinese culture.  \n\n3. There are ______ (much/many) ways to help others.  \n\n4. I will never forget the day when I ______ (see) the sea.  \n\n5. It is ______ (How/How beautiful) the East Lake is!  \n\n6. You will be punished if you don’t ______ (follow) the school rules.  \n\n7. I can lend my bike to you ______ (after) you return it on time.  \n\n8. The service is ______ (great/greatly) changed by the new manager.  \n\n9. When I was young, Dad often ______ (took/take) me to the museum.  \n\n10. I’m looking forward to the holiday which ______ (would/will) begin next month.  \n\n---\n\n## 二、根据汉语意思完成句子，每空一词。共5题，每题2分。\n\n11. The source of air is ______ / Water / life  \n\n12. My family / reading books / enjoy  \n\n13. The beauty around you / to feel / It is a joy  \n\n14. try our best / should / to realize our dreams / We  \n\n15. was translated into / His book / last year / French  \n```\n\n请按照此格式进行练习和填写答案。"},"elapsed_time":13.124313944019377,"total_tokens":745,"total_steps":4,"created_at":1740976128,"finished_at":1740976141}
2025-03-03 12:29:03.635  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_0.png, text=以下是图片中的文字内容转换为Markdown格式：

```markdown
# 2024届高三英语复习查漏补题

## 一、完成句（从括号里选出的词或短语中选出一个或选句子填空）。共10题，每题2分。

1. I have confidence (in) ______.  

2. She ______ (is/are) familiar with Chinese culture.  

3. There are ______ (much/many) ways to help others.  

4. I will never forget the day when I ______ (see) the sea.  

5. It is ______ (How/How beautiful) the East Lake is!  

6. You will be punished if you don’t ______ (follow) the school rules.  

7. I can lend my bike to you ______ (after) you return it on time.  

8. The service is ______ (great/greatly) changed by the new manager.  

9. When I was young, Dad often ______ (took/take) me to the museum.  

10. I’m looking forward to the holiday which ______ (would/will) begin next month.  

---

## 二、根据汉语意思完成句子，每空一词。共5题，每题2分。

11. The source of air is ______ / Water / life  

12. My family / reading books / enjoy  

13. The beauty around you / to feel / It is a joy  

14. try our best / should / to realize our dreams / We  

15. was translated into / His book / last year / French  
```

请按照此格式进行练习和填写答案。
2025-03-03 12:29:03.635 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c7199595-019c-401e-86b0-1b26e97f8798","workflow_run_id":"b8fe023a-1603-46c4-ad86-f3f75b056f56","data":{"id":"b8fe023a-1603-46c4-ad86-f3f75b056f56","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n```markdown\n# 2024届高三英语复习查漏补题\n\n## 一、完成句（从括号里选出的词或短语中选出一个或选句子填空）。共10题，每题2分。\n\n1. I have confidence (in) ______.  \n\n2. She ______ (is/are) familiar with Chinese culture.  \n\n3. There are ______ (much/many) ways to help others.  \n\n4. I will never forget the day when I ______ (see) the sea.  \n\n5. It is ______ (How/How beautiful) the East Lake is!  \n\n6. You will be punished if you don’t ______ (follow) the school rules.  \n\n7. I can lend my bike to you ______ (after) you return it on time.  \n\n8. The service is ______ (great/greatly) changed by the new manager.  \n\n9. When I was young, Dad often ______ (took/take) me to the museum.  \n\n10. I’m looking forward to the holiday which ______ (would/will) begin next month.  \n\n---\n\n## 二、根据汉语意思完成句子，每空一词。共5题，每题2分。\n\n11. The source of air is ______ / Water / life  \n\n12. My family / reading books / enjoy  \n\n13. The beauty around you / to feel / It is a joy  \n\n14. try our best / should / to realize our dreams / We  \n\n15. was translated into / His book / last year / French  \n```\n\n请按照此格式进行练习和填写答案。"},"elapsed_time":13.124313944019377,"total_tokens":745,"total_steps":4,"created_at":1740976128,"finished_at":1740976141}}
2025-03-03 12:29:03.953  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png
2025-03-03 12:29:03.953  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, userId=system
2025-03-03 12:29:03.953 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:29:03.953 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:29:04.024  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=73f66baa-7fb6-47bd-82fa-962cc8318dde
2025-03-03 12:29:04.026 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"73f66baa-7fb6-47bd-82fa-962cc8318dde"}},"response_mode":"blocking","conversation_id":"41756bd8-e15d-4c4e-8ed3-a06329ff434e","user":"fyjw"}
2025-03-03 12:29:11.886 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d930fda9-d668-431f-8869-4902d345944c","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 16. has attracted / more and more people / Life in the countryside  \n\n## 三、阅读短文（根据文章内容完成句子，每空填一词）。共2道10题，每题2分  \n\n### Passage 1  \n\n#### Kids Need Free Play  \n\n- **Who**: Giving our kids time to play is not a choice but a ______.  \n- **Why**: It helps to improve the 18 ______, social and emotional well-being of children and youth.  \n- **What**: Parents should 19 ______ free play. The word \"free\" means both \"20 ______\" and \"with no cost\".  \n- **Why**: Free play enables kids to 21 ______ with others and learn important social skills.  \n\n### Passage 2  \n\n#### Keep an Eye on Giraffes  \n\n- **What**: Giraffes are quietly 22 ______. Because of this, the GCF decided to work with African Parks. Their purpose was to make it easier to keep an eye on giraffes but they didn’t 23 ______ on for long.  \n- **How**: New tracking devices, which are solar-powered and don't 24 ______ giraffes, were used to stop illegal hunting to keep giraffes safe.  \n\n## 四、阅读短文（根据文章内容回答问题）。共2道10题，每题2分  \n\n---\n\n请检查并填写缺失的单词。"},"elapsed_time":7.811134190065786,"total_tokens":702,"total_steps":4,"created_at":1740976142,"finished_at":1740976150}
2025-03-03 12:29:11.886  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

### 16. has attracted / more and more people / Life in the countryside  

## 三、阅读短文（根据文章内容完成句子，每空填一词）。共2道10题，每题2分  

### Passage 1  

#### Kids Need Free Play  

- **Who**: Giving our kids time to play is not a choice but a ______.  
- **Why**: It helps to improve the 18 ______, social and emotional well-being of children and youth.  
- **What**: Parents should 19 ______ free play. The word "free" means both "20 ______" and "with no cost".  
- **Why**: Free play enables kids to 21 ______ with others and learn important social skills.  

### Passage 2  

#### Keep an Eye on Giraffes  

- **What**: Giraffes are quietly 22 ______. Because of this, the GCF decided to work with African Parks. Their purpose was to make it easier to keep an eye on giraffes but they didn’t 23 ______ on for long.  
- **How**: New tracking devices, which are solar-powered and don't 24 ______ giraffes, were used to stop illegal hunting to keep giraffes safe.  

## 四、阅读短文（根据文章内容回答问题）。共2道10题，每题2分  

---

请检查并填写缺失的单词。
2025-03-03 12:29:11.887 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"3bedddc2-e7a7-45ad-9221-ca420d79b3f5","workflow_run_id":"d930fda9-d668-431f-8869-4902d345944c","data":{"id":"d930fda9-d668-431f-8869-4902d345944c","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 16. has attracted / more and more people / Life in the countryside  \n\n## 三、阅读短文（根据文章内容完成句子，每空填一词）。共2道10题，每题2分  \n\n### Passage 1  \n\n#### Kids Need Free Play  \n\n- **Who**: Giving our kids time to play is not a choice but a ______.  \n- **Why**: It helps to improve the 18 ______, social and emotional well-being of children and youth.  \n- **What**: Parents should 19 ______ free play. The word \"free\" means both \"20 ______\" and \"with no cost\".  \n- **Why**: Free play enables kids to 21 ______ with others and learn important social skills.  \n\n### Passage 2  \n\n#### Keep an Eye on Giraffes  \n\n- **What**: Giraffes are quietly 22 ______. Because of this, the GCF decided to work with African Parks. Their purpose was to make it easier to keep an eye on giraffes but they didn’t 23 ______ on for long.  \n- **How**: New tracking devices, which are solar-powered and don't 24 ______ giraffes, were used to stop illegal hunting to keep giraffes safe.  \n\n## 四、阅读短文（根据文章内容回答问题）。共2道10题，每题2分  \n\n---\n\n请检查并填写缺失的单词。"},"elapsed_time":7.811134190065786,"total_tokens":702,"total_steps":4,"created_at":1740976142,"finished_at":1740976150}}
2025-03-03 12:29:12.137  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png
2025-03-03 12:29:12.137  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, userId=system
2025-03-03 12:29:12.137 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:29:12.137 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:29:12.196  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=8e5d466e-cc36-4921-b339-dbfe451edd1b
2025-03-03 12:29:12.196 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"8e5d466e-cc36-4921-b339-dbfe451edd1b"}},"response_mode":"blocking","conversation_id":"0417a0b6-0f59-4340-a121-e66e3f410e65","user":"fyjw"}
2025-03-03 12:29:21.492 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d1c1fc53-ae65-4d5c-8577-3f7cfff299e4","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"```markdown\n### Passage 3\n\n(第一次独自) It was on Sunday morning, when Sam went to see his grandfather alone.【1 词略】\n\n27. When did the story happen?  \n28. How did Sam go to see his grandfather, by bike or by bus?  \n29. Who gave up the seat to the old lady?  \n30. Why did other passengers also get up?  \n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n---\n\n### Passage 4\n\nIn my job, I get to explore new things and meet new people.  \n\nI am a newspaper reporter and my responsibility is writing stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game begins to do some research.  \n\nThe game is extremely exciting, so I hurry down to wait outside the changing area when I manage to get a short interview with one of the basketball players. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects of the game.  \n\nAfter the interview, I take more note on the action as it happens. The game reaches its game. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches' thoughts on the game and I get some good quotes.  \n\nFinally, it is time for me to pull all my notes together into the finished article to send to the editor.\n```"},"elapsed_time":9.254145052982494,"total_tokens":729,"total_steps":4,"created_at":1740976150,"finished_at":1740976159}
2025-03-03 12:29:21.492  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_2.png, text=```markdown
### Passage 3

(第一次独自) It was on Sunday morning, when Sam went to see his grandfather alone.【1 词略】

27. When did the story happen?  
28. How did Sam go to see his grandfather, by bike or by bus?  
29. Who gave up the seat to the old lady?  
30. Why did other passengers also get up?  
31. Translate the sentence "what a lovely little girl" into Chinese.

---

### Passage 4

In my job, I get to explore new things and meet new people.  

I am a newspaper reporter and my responsibility is writing stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game begins to do some research.  

The game is extremely exciting, so I hurry down to wait outside the changing area when I manage to get a short interview with one of the basketball players. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects of the game.  

After the interview, I take more note on the action as it happens. The game reaches its game. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches' thoughts on the game and I get some good quotes.  

Finally, it is time for me to pull all my notes together into the finished article to send to the editor.
```
2025-03-03 12:29:21.492 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"0f379321-679c-405d-b465-dd531677d1db","workflow_run_id":"d1c1fc53-ae65-4d5c-8577-3f7cfff299e4","data":{"id":"d1c1fc53-ae65-4d5c-8577-3f7cfff299e4","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"```markdown\n### Passage 3\n\n(第一次独自) It was on Sunday morning, when Sam went to see his grandfather alone.【1 词略】\n\n27. When did the story happen?  \n28. How did Sam go to see his grandfather, by bike or by bus?  \n29. Who gave up the seat to the old lady?  \n30. Why did other passengers also get up?  \n31. Translate the sentence \"what a lovely little girl\" into Chinese.\n\n---\n\n### Passage 4\n\nIn my job, I get to explore new things and meet new people.  \n\nI am a newspaper reporter and my responsibility is writing stories for my journalism degree. I worked as a trainee writer for a local newspaper. Now, I write for a top newspaper. Today, I am writing an article about a basketball game. I arrive at the stadium two hours before the game begins to do some research.  \n\nThe game is extremely exciting, so I hurry down to wait outside the changing area when I manage to get a short interview with one of the basketball players. I have limited time, so I only ask a few important questions, such as how he is feeling and what he expects of the game.  \n\nAfter the interview, I take more note on the action as it happens. The game reaches its game. The home team wins! As the fans leave, I go to the press conference with other journalists. We listen to both team coaches' thoughts on the game and I get some good quotes.  \n\nFinally, it is time for me to pull all my notes together into the finished article to send to the editor.\n```"},"elapsed_time":9.254145052982494,"total_tokens":729,"total_steps":4,"created_at":1740976150,"finished_at":1740976159}}
2025-03-03 12:29:21.809  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png
2025-03-03 12:29:21.809  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, userId=system
2025-03-03 12:29:21.809 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:29:21.809 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:29:21.893  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b0b01c87-50d0-45d6-b0fb-aa04cf360d91
2025-03-03 12:29:21.894 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"b0b01c87-50d0-45d6-b0fb-aa04cf360d91"}},"response_mode":"blocking","conversation_id":"e8bc321a-cfba-4125-96b8-17e072912f9f","user":"fyjw"}
2025-03-03 12:29:47.862 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"1af4777e-e02c-4e4f-96f6-e8a6c15ef68a","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"Here is the extracted text from the image in Markdown format:\n\n```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. **I love sharing my love for sport through words.**\n\n32. What newspaper articles does the writer write about?\n\n33. Why does the writer ask only a few important questions?\n\n34. Who wins the baseball game in the end?\n\n35. How many hours does the writer have to write up his article?\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.\n\n---\n\n五、单项选择（请将正确答案的序号填入题前括号内，每题 1 分，共 8 分）\n\n37. _______ you at home when your mom went to college? (old)  \n你妈妈上大学时，你在家吗？\n\n38. I don't know where _______. (live)  \n我不知道他住在哪里。\n\n39. Only _______ can you achieve your dreams. (work)  \n只有努力工作才能实现你的梦想。\n\n40. Please _______ that you have enough rest. (sure)  \n请确保你休息得够充分。\n```"},"elapsed_time":25.928020300110802,"total_tokens":657,"total_steps":4,"created_at":1740976160,"finished_at":1740976186}
2025-03-03 12:29:47.863  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_3.png, text=Here is the extracted text from the image in Markdown format:

```markdown
newspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. **I love sharing my love for sport through words.**

32. What newspaper articles does the writer write about?

33. Why does the writer ask only a few important questions?

34. Who wins the baseball game in the end?

35. How many hours does the writer have to write up his article?

36. Translate the sentence "I love sharing my love for sport through words" into Chinese.

---

五、单项选择（请将正确答案的序号填入题前括号内，每题 1 分，共 8 分）

37. _______ you at home when your mom went to college? (old)  
你妈妈上大学时，你在家吗？

38. I don't know where _______. (live)  
我不知道他住在哪里。

39. Only _______ can you achieve your dreams. (work)  
只有努力工作才能实现你的梦想。

40. Please _______ that you have enough rest. (sure)  
请确保你休息得够充分。
```
2025-03-03 12:29:47.863 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"4ffe3473-03db-4892-8831-c6eb0d8f0398","workflow_run_id":"1af4777e-e02c-4e4f-96f6-e8a6c15ef68a","data":{"id":"1af4777e-e02c-4e4f-96f6-e8a6c15ef68a","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"Here is the extracted text from the image in Markdown format:\n\n```markdown\nnewspaper. I only have a couple of hours to write it all up. The paper will be printed tonight, and the public will be reading my article over breakfast in the morning. **I love sharing my love for sport through words.**\n\n32. What newspaper articles does the writer write about?\n\n33. Why does the writer ask only a few important questions?\n\n34. Who wins the baseball game in the end?\n\n35. How many hours does the writer have to write up his article?\n\n36. Translate the sentence \"I love sharing my love for sport through words\" into Chinese.\n\n---\n\n五、单项选择（请将正确答案的序号填入题前括号内，每题 1 分，共 8 分）\n\n37. _______ you at home when your mom went to college? (old)  \n你妈妈上大学时，你在家吗？\n\n38. I don't know where _______. (live)  \n我不知道他住在哪里。\n\n39. Only _______ can you achieve your dreams. (work)  \n只有努力工作才能实现你的梦想。\n\n40. Please _______ that you have enough rest. (sure)  \n请确保你休息得够充分。\n```"},"elapsed_time":25.928020300110802,"total_tokens":657,"total_steps":4,"created_at":1740976160,"finished_at":1740976186}}
2025-03-03 12:29:48.105  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png
2025-03-03 12:29:48.105  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, userId=system
2025-03-03 12:29:48.105 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:29:48.105 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:29:48.163  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d7a0fdf4-c440-4104-abe8-1b2a85bb8a7d
2025-03-03 12:29:48.163 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"d7a0fdf4-c440-4104-abe8-1b2a85bb8a7d"}},"response_mode":"blocking","conversation_id":"94ccc9b6-db52-459d-94d9-c45fb8bb9339","user":"fyjw"}
2025-03-03 12:29:55.782 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"ef47efc0-94ff-484d-800c-2b1dbc154492","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n41. Travel can give us a chance __________ people from different cultures. (meet)  \n\n   旅行能让我们有机会认识来自不同文化的的人。  \n\n42. The snow is __________ that the whole world is covered in silver. (heavy)  \n\n   雪下得如此之大，整个世界都覆盖着银装。  \n\n---\n\n## 六、写作（10 分）  \n\n请根据提示，编写一篇介绍课外阅读经验的短文以与 Tom 交流。  \n\n**主要内容包括：**  \n1. 你喜欢的阅读种类及其对你的意义；  \n2. 你每天的阅读时间；  \n3. 你的阅读习惯。  \n\n**要求：**  \n1. 词数不少于80；  \n2. 文中不得出现个人姓名和学校名称；  \n3. 语句通顺，语法正确。  \n\n---\n\n希望这能帮助你！ 😊"},"elapsed_time":7.57489154394716,"total_tokens":607,"total_steps":4,"created_at":1740976186,"finished_at":1740976194}
2025-03-03 12:29:55.782  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=2024届湖北专升本英语真题_20240517141034.pdf_page_4.png, text=以下是图片中的文字内容转换为Markdown格式：

---

41. Travel can give us a chance __________ people from different cultures. (meet)  

   旅行能让我们有机会认识来自不同文化的的人。  

42. The snow is __________ that the whole world is covered in silver. (heavy)  

   雪下得如此之大，整个世界都覆盖着银装。  

---

## 六、写作（10 分）  

请根据提示，编写一篇介绍课外阅读经验的短文以与 Tom 交流。  

**主要内容包括：**  
1. 你喜欢的阅读种类及其对你的意义；  
2. 你每天的阅读时间；  
3. 你的阅读习惯。  

**要求：**  
1. 词数不少于80；  
2. 文中不得出现个人姓名和学校名称；  
3. 语句通顺，语法正确。  

---

希望这能帮助你！ 😊
2025-03-03 12:29:55.783 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"ed0303b2-8281-4905-8190-84ee90f505a3","workflow_run_id":"ef47efc0-94ff-484d-800c-2b1dbc154492","data":{"id":"ef47efc0-94ff-484d-800c-2b1dbc154492","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n41. Travel can give us a chance __________ people from different cultures. (meet)  \n\n   旅行能让我们有机会认识来自不同文化的的人。  \n\n42. The snow is __________ that the whole world is covered in silver. (heavy)  \n\n   雪下得如此之大，整个世界都覆盖着银装。  \n\n---\n\n## 六、写作（10 分）  \n\n请根据提示，编写一篇介绍课外阅读经验的短文以与 Tom 交流。  \n\n**主要内容包括：**  \n1. 你喜欢的阅读种类及其对你的意义；  \n2. 你每天的阅读时间；  \n3. 你的阅读习惯。  \n\n**要求：**  \n1. 词数不少于80；  \n2. 文中不得出现个人姓名和学校名称；  \n3. 语句通顺，语法正确。  \n\n---\n\n希望这能帮助你！ 😊"},"elapsed_time":7.57489154394716,"total_tokens":607,"total_steps":4,"created_at":1740976186,"finished_at":1740976194}}
2025-03-03 12:29:55.784 DEBUG 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:29:55.784  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=2024届湖北专升本英语真题_20240517141034.pdf, fileSize=5832
2025-03-03 12:29:55.785 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=2024届湖北专升本英语真题_20240517141034.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:29:55.875  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6dfaf28f-8532-4cde-b333-e06c8e06eebf","position":5,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"dfcf08fa-977e-47c6-aa2f-7988cbc3f06a"},"data_source_detail_dict":{"upload_file":{"id":"dfcf08fa-977e-47c6-aa2f-7988cbc3f06a","name":"2024届湖北专升本英语真题_20240517141034.md","size":5832,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740976194.084744}},"dataset_process_rule_id":"a9be7b17-d651-446a-acef-65010dbcf76c","name":"2024届湖北专升本英语真题_20240517141034.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740972575,"tokens":1090,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":3517,"hit_count":0,"doc_form":"text_model"},"batch":"20250303042954955520"}
2025-03-03 12:29:55.875  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 2024届湖北专升本英语真题_20240517141034.pdf
2025-03-03 12:29:55.899 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:29:55.900 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:29:55.922 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:29:56.106 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:29:56.109 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:29:56.109 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:29:56.131 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:29:56.288 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:29:56.665  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 程阿金和解通知.jpg
2025-03-03 12:29:56.689 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:29:56.689 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:29:56.711 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:29:56.871 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:29:56.871  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=程阿金和解通知.jpg
2025-03-03 12:29:56.871  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=程阿金和解通知.jpg, userId=system
2025-03-03 12:29:56.872 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:29:56.872 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:29:56.942  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a8599d2f-49d6-48ed-acde-2eb77185492f
2025-03-03 12:29:56.942 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"a8599d2f-49d6-48ed-acde-2eb77185492f"}},"response_mode":"blocking","conversation_id":"fbbaa65d-c5d8-4547-9061-68dd83beb9b1","user":"fyjw"}
2025-03-03 12:30:13.901 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"5a6fb3b1-40a2-4d2e-98e3-c1d678b69897","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函  \n\n上海临港新片区鑫烨升元置业有限公司  \n\n2022年9月7日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵司未能按照合同约定的时间交付房屋，  \n本小区业主因延迟交房导致装修时间更紧张，电网的申报又受到影响，业主的损失不断扩大，贵司理应承担违约责任。  \n\n在正式收房入住前，贵司应对小区的水、电、煤等进行调试并向居民讲解使用方法，避免因使用不当造成安全隐患。  \n同时，根据合同约定，房屋交付时应满足装修施工条件，确保施工用水、用电等的正常供应。此外，贵司应按照合同约定支付4.75%款项作为延期交房的违约赔偿金。  \n\n在没有正式交房前，我们业主将正式发起维权，时间：2023年12月8日  \n在没有解决问题前，我们业主将持续维权。  \n\n**业主群：程四合** 签字：  \n电话：13262792367  \n\n**杨晓斌** 签字：  \n电话：15821427364  \n\n2023年11月28日  \n```"},"elapsed_time":16.908597978996113,"total_tokens":700,"total_steps":4,"created_at":1740976195,"finished_at":1740976212}
2025-03-03 12:30:13.902  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=程阿金和解通知.jpg, text=```markdown
# 通 知 函  

上海临港新片区鑫烨升元置业有限公司  

2022年9月7日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵司未能按照合同约定的时间交付房屋，  
本小区业主因延迟交房导致装修时间更紧张，电网的申报又受到影响，业主的损失不断扩大，贵司理应承担违约责任。  

在正式收房入住前，贵司应对小区的水、电、煤等进行调试并向居民讲解使用方法，避免因使用不当造成安全隐患。  
同时，根据合同约定，房屋交付时应满足装修施工条件，确保施工用水、用电等的正常供应。此外，贵司应按照合同约定支付4.75%款项作为延期交房的违约赔偿金。  

在没有正式交房前，我们业主将正式发起维权，时间：2023年12月8日  
在没有解决问题前，我们业主将持续维权。  

**业主群：程四合** 签字：  
电话：13262792367  

**杨晓斌** 签字：  
电话：15821427364  

2023年11月28日  
```
2025-03-03 12:30:13.902 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c184c2e5-5eb1-47e7-9530-8e877165a2fc","workflow_run_id":"5a6fb3b1-40a2-4d2e-98e3-c1d678b69897","data":{"id":"5a6fb3b1-40a2-4d2e-98e3-c1d678b69897","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"```markdown\n# 通 知 函  \n\n上海临港新片区鑫烨升元置业有限公司  \n\n2022年9月7日与贵司签订的《上海市商品房预售合同》（合同编号：202200176383），因贵司未能按照合同约定的时间交付房屋，  \n本小区业主因延迟交房导致装修时间更紧张，电网的申报又受到影响，业主的损失不断扩大，贵司理应承担违约责任。  \n\n在正式收房入住前，贵司应对小区的水、电、煤等进行调试并向居民讲解使用方法，避免因使用不当造成安全隐患。  \n同时，根据合同约定，房屋交付时应满足装修施工条件，确保施工用水、用电等的正常供应。此外，贵司应按照合同约定支付4.75%款项作为延期交房的违约赔偿金。  \n\n在没有正式交房前，我们业主将正式发起维权，时间：2023年12月8日  \n在没有解决问题前，我们业主将持续维权。  \n\n**业主群：程四合** 签字：  \n电话：13262792367  \n\n**杨晓斌** 签字：  \n电话：15821427364  \n\n2023年11月28日  \n```"},"elapsed_time":16.908597978996113,"total_tokens":700,"total_steps":4,"created_at":1740976195,"finished_at":1740976212}}
2025-03-03 12:30:13.902  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=程阿金和解通知.jpg, fileSize=1071
2025-03-03 12:30:13.902 DEBUG 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=程阿金和解通知.jpg, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:30:13.997  INFO 32320 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"9d794080-134a-4c9d-9281-70b8ed1dd4b3","position":3,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"0f648d9d-7f44-41c4-9852-ca870947de37"},"data_source_detail_dict":{"upload_file":{"id":"0f648d9d-7f44-41c4-9852-ca870947de37","name":"程阿金和解通知.md","size":1071,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740976212.21277}},"dataset_process_rule_id":"a4021e40-89f9-4fc7-bbae-50d13563ae23","name":"程阿金和解通知.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740970462,"tokens":348,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":361,"hit_count":0,"doc_form":"text_model"},"batch":"20250303043012388416"}
2025-03-03 12:30:13.997  INFO 32320 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 程阿金和解通知.jpg
2025-03-03 12:30:14.021 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:30:14.021 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:30:14.045 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:30:14.186 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:30:14.187 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:30:14.187 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:30:14.212 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:30:14.349 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:30:14.352 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:30:14.353 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:30:14.376 DEBUG 32320 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:30:14.563 ERROR 32320 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:31:16.783 ERROR 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 12:31:16.783  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477432123462320129&access_key=c37ea8269a35d3060e05d28ea3d00b83&service_id=33554678&ticket=a5b7cb0d-9596-4ad3-b734-40c50aa452b6 [conn_id=7477432123462320129]
2025-03-03 12:31:16.783  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 12:31:38.765  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 12:31:39.223  INFO 32320 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477432123462696961&access_key=9859ded19dd12e70fe36799b79015cb1&service_id=33554678&ticket=6fc50244-6c50-4dcb-8dab-4e4a2a5c30f4 [conn_id=7477432123462696961]
2025-03-03 12:31:40.752  INFO 32320 --- [pool-2-thread-4] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740976282}
2025-03-03 12:31:40.779 DEBUG 32320 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:31:40.780 DEBUG 32320 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:40.804 DEBUG 32320 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:31:40.805 DEBUG 32320 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:31:40.805 DEBUG 32320 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:40.828 DEBUG 32320 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:31:46.999  INFO 32320 --- [pool-2-thread-5] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740976289}
2025-03-03 12:31:48.768  INFO 32320 --- [pool-2-thread-6] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740976290}
2025-03-03 12:31:48.768  INFO 32320 --- [pool-2-thread-7] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"case_overview","timestamp":1740976291}
2025-03-03 12:31:48.791 DEBUG 32320 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:31:48.792 DEBUG 32320 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:48.793 DEBUG 32320 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:31:48.793 DEBUG 32320 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:48.813 DEBUG 32320 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:31:48.813 DEBUG 32320 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:31:48.814 DEBUG 32320 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:48.816 DEBUG 32320 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:31:48.817 DEBUG 32320 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:31:48.817 DEBUG 32320 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:48.834 DEBUG 32320 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:31:48.841 DEBUG 32320 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:31:49.096  INFO 32320 --- [pool-2-thread-8] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740976292}
2025-03-03 12:31:49.097 DEBUG 32320 --- [pool-2-thread-8] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:31:49.097 DEBUG 32320 --- [pool-2-thread-8] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:49.122 DEBUG 32320 --- [pool-2-thread-8] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:31:49.123 DEBUG 32320 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:31:49.123 DEBUG 32320 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:49.146 DEBUG 32320 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:31:49.818  INFO 32320 --- [pool-2-thread-9] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740976292}
2025-03-03 12:31:49.840 DEBUG 32320 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:31:49.840 DEBUG 32320 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:49.863 DEBUG 32320 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:31:49.863 DEBUG 32320 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:31:49.863 DEBUG 32320 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:49.886 DEBUG 32320 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:31:51.602  INFO 32320 --- [pool-2-thread-10] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740976293}
2025-03-03 12:31:52.247  INFO 32320 --- [pool-2-thread-11] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"case_overview","timestamp":1740976310}
2025-03-03 12:31:52.270 DEBUG 32320 --- [pool-2-thread-11] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:31:52.271 DEBUG 32320 --- [pool-2-thread-11] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:52.294 DEBUG 32320 --- [pool-2-thread-11] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:31:52.295 DEBUG 32320 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:31:52.295 DEBUG 32320 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:52.317 DEBUG 32320 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:31:57.370  INFO 32320 --- [pool-2-thread-12] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14191646f559d758","user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"},"token":"c-a83ec3d1c61a8ca9bf22af241ba60897dab7079c","action":{"tag":"button","timezone":"Asia/Shanghai","name":"case_overview_callback","form_value":{"Select_case":"18"}},"host":"im_message","context":{"open_message_id":"om_81a89e3efde63fa578c4b27ce7896db1","open_chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac"}},"schema":"2.0","header":{"event_id":"1a95739ffa5a87d34fb3cbe64d88c160","event_type":"card.action.trigger","app_id":"cli_a73c62ce90b0d013","tenant_key":"14191646f559d758","create_time":"1740976315610375","token":"za3iBwmP42XM4YMo9z0tq1OgMlRAG7tc"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,49,97,57,53,55,51,57,102,102,97,53,97,56,55,100,51,52,102,98,51,99,98,101,54,52,100,56,56,99,49,54,48,34,44,34,116,111,107,101,110,34,58,34,122,97,51,105,66,119,109,80,52,50,88,77,52,89,77,111,57,122,48,116,113,49,79,103,77,108,82,65,71,55,116,99,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,54,51,49,53,54,49,48,51,55,53,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,125,44,34,116,111,107,101,110,34,58,34,99,45,97,56,51,101,99,51,100,49,99,54,49,97,56,99,97,57,98,102,50,50,97,102,50,52,49,98,97,54,48,56,57,55,100,97,98,55,48,55,57,99,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,49,56,34,125,44,34,110,97,109,101,34,58,34,99,97,115,101,95,111,118,101,114,118,105,101,119,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,56,49,97,56,57,101,51,101,102,100,101,54,51,102,97,53,55,56,99,52,98,50,55,99,101,55,56,57,54,100,98,49,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,125,125,125],"headers":{}}}
2025-03-03 12:31:57.370  INFO 32320 --- [pool-2-thread-12] em.backend.handler.CardEventHandler      : 案件总览选择的案件ID: 18
2025-03-03 12:31:57.393 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:31:57.393 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 18(String)
2025-03-03 12:31:57.416 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:31:57.443 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-03-03 12:31:57.443 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:57.466 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-03-03 12:31:57.467 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-03-03 12:31:57.468 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 18(Long), 文件分析test(String), ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:31:57.513 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-03-03 12:31:57.563 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:31:57.563 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 18(String)
2025-03-03 12:31:57.586 DEBUG 32320 --- [pool-2-thread-12] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:32:05.772  INFO 32320 --- [pool-2-thread-13] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740976323}
2025-03-03 12:32:05.795 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:32:05.795 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:32:05.819 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:32:05.819 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:32:05.819 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 18(String)
2025-03-03 12:32:05.841 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:32:05.841 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 12:32:05.841 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 18(String)
2025-03-03 12:32:05.863 DEBUG 32320 --- [pool-2-thread-13] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 12:32:05.863  INFO 32320 --- [pool-2-thread-13] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: Inw5ftqF2li3Yqd5Ih6c0alyntb
2025-03-03 12:32:06.410  INFO 32320 --- [pool-2-thread-13] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 12:32:06.411  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=Inw5ftqF2li3Yqd5Ih6c0alyntb, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 12:32:06.882  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897736","modified_time":"1740897738","name":"金港东九提供材料2(3)","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"AjDpfNJillTBtUdfJG2csHein6g","type":"folder","url":"https://vcnjyexq8awr.feishu.cn/drive/folder/AjDpfNJillTBtUdfJG2csHein6g"},{"created_time":"1740897731","modified_time":"1740897732","name":"金港东九提供材料2(2)","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"VyUqfdiAQluC2hdYzDPcAwHFnKh","type":"folder","url":"https://vcnjyexq8awr.feishu.cn/drive/folder/VyUqfdiAQluC2hdYzDPcAwHFnKh"},{"created_time":"1740897719","modified_time":"1740897720","name":"金港东九提供材料2","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"Lz5nfmsp1l69DsdvznwcnMcOnbb","type":"folder","url":"https://vcnjyexq8awr.feishu.cn/drive/folder/Lz5nfmsp1l69DsdvznwcnMcOnbb"},{"created_time":"1740897458","modified_time":"1740897458","name":"银行情况说明.docx","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"AyPDbd6zVoxK3uxoA8PcUuhcnxc","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/AyPDbd6zVoxK3uxoA8PcUuhcnxc"},{"created_time":"1740897446","modified_time":"1740897458","name":"金港东九提供材料2.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"X8jnbYQOyoeyzgxTniPcLJnyntb","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/X8jnbYQOyoeyzgxTniPcLJnyntb"},{"created_time":"1740897439","modified_time":"1740897446","name":"金港东九提供材料1.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"SlMcbRvOyoFD1XxwsR5cLCK0nLb","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/SlMcbRvOyoFD1XxwsR5cLCK0nLb"},{"created_time":"1740897437","modified_time":"1740897439","name":"东九预看房陪看记录单.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"SMRtbfNgyopjqnxGHi2cw62dnMh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/SMRtbfNgyopjqnxGHi2cw62dnMh"},{"created_time":"1740897436","modified_time":"1740897437","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"ADX4baexwoHaycxsREAc9McPn7s","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/ADX4baexwoHaycxsREAc9McPn7s"},{"created_time":"1740897435","modified_time":"1740897436","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"Th1JbVpOToMDgBxjtrCc1H5LnPd","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/Th1JbVpOToMDgBxjtrCc1H5LnPd"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,56,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,40,51,41,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,44,34,116,121,112,101,34,58,34,102,111,108,100,101,114,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,100,114,105,118,101,47,102,111,108,100,101,114,47,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,50,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,40,50,41,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,86,121,85,113,102,100,105,65,81,108,117,67,50,104,100,89,122,68,80,99,65,119,72,70,110,75,104,34,44,34,116,121,112,101,34,58,34,102,111,108,100,101,114,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,100,114,105,118,101,47,102,111,108,100,101,114,47,86,121,85,113,102,100,105,65,81,108,117,67,50,104,100,89,122,68,80,99,65,119,72,70,110,75,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,49,57,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,50,48,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,76,122,53,110,102,109,115,112,49,108,54,57,68,115,100,118,122,110,119,99,110,77,99,79,110,98,98,34,44,34,116,121,112,101,34,58,34,102,111,108,100,101,114,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,100,114,105,118,101,47,102,111,108,100,101,114,47,76,122,53,110,102,109,115,112,49,108,54,57,68,115,100,118,122,110,119,99,110,77,99,79,110,98,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,53,56,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,53,56,34,44,34,110,97,109,101,34,58,34,-23,-109,-74,-24,-95,-116,-26,-125,-123,-27,-122,-75,-24,-81,-76,-26,-104,-114,46,100,111,99,120,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,65,121,80,68,98,100,54,122,86,111,120,75,51,117,120,111,65,56,80,99,85,117,104,99,110,120,99,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,65,121,80,68,98,100,54,122,86,111,120,75,51,117,120,111,65,56,80,99,85,117,104,99,110,120,99,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,52,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,53,56,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,88,56,106,110,98,89,81,79,121,111,101,121,122,103,120,84,110,105,80,99,76,74,110,121,110,116,98,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,88,56,106,110,98,89,81,79,121,111,101,121,122,103,120,84,110,105,80,99,76,74,110,121,110,116,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,57,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,52,54,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,49,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,83,108,77,99,98,82,118,79,121,111,70,68,49,88,120,119,115,82,53,99,76,67,75,48,110,76,98,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,83,108,77,99,98,82,118,79,121,111,70,68,49,88,120,119,115,82,53,99,76,67,75,48,110,76,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,57,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-23,-94,-124,-25,-100,-117,-26,-120,-65,-23,-103,-86,-25,-100,-117,-24,-82,-80,-27,-67,-107,-27,-115,-107,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,83,77,82,116,98,102,78,103,121,111,112,106,113,110,120,71,72,105,50,99,119,54,50,100,110,77,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,83,77,82,116,98,102,78,103,121,111,112,106,113,110,120,71,72,105,50,99,119,54,50,100,110,77,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,55,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,65,68,88,52,98,97,101,120,119,111,72,97,121,99,120,115,82,69,65,99,57,77,99,80,110,55,115,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,65,68,88,52,98,97,101,120,119,111,72,97,121,99,120,115,82,69,65,99,57,77,99,80,110,55,115,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,53,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,54,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,84,104,49,74,98,86,112,79,84,111,77,68,103,66,120,106,116,114,67,99,49,72,53,76,110,80,100,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,84,104,49,74,98,86,112,79,84,111,77,68,103,66,120,106,116,114,67,99,49,72,53,76,110,80,100,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:32:05 GMT"],"eagleid":["74c48fae17409763246886333e"],"request-id":["3f191bf2-3bbf-46c0-855b-0d92406cb4bc"],"server":["Tengine"],"server-timing":["inner; dur=419","cdn-cache;desc=MISS,edge;dur=0,origin;dur=448"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache26.cn7149[448,0]"],"x-lgw-dst-svc":["F5T4XESUvdgRfBx8pZ1hbpTT3TcMSjvliZM-K38zjDqt-AQejBMOO6UtueY3I-AuxJxZO-og3Q0XX0AFzetCvySW3YbsoXUaX5I9bci8IijpzVA6N4Jexv6b8Qhy1vYOXUkCyjZ6z18279gRxSd-urF0zxdFxCdKMnPJ9PVkcWx2grmJOdaqHqGDM_4eqeP_RMco_QFDysUIo7z4IsFj_kaJuqkBr-2QRQ_l2hvQmzmsOUHNdXJLOaHNO095LFB0EU-ZwKQyDNbJzFujDclCOHgpglLHygKJwFbasuYk1lkNqm2J4Yb9uDw="],"x-request-id":["3f191bf2-3bbf-46c0-855b-0d92406cb4bc"],"x-timestamp":["1740976325.126"],"x-tt-logid":["20250303123204A0F850DF081FF7E3F307"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be9585a59defc2d6a9402c1170b29e0ec3684500566c347f778d6c1bb09ac29b888028c2500b4466ef32eddcbff03c2f95d0c4e299f3942f14c0f493da67e0459a48ddb8ab99944ec2a53a6276f0430ef9"],"x-tt-trace-id":["00-250303123204A0F850DF081FF7E3F307-407DA21F04C3BA6F-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303123204A0F850DF081FF7E3F307","statusCode":200},"request":{"folder_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb"},"requestId":"20250303123204A0F850DF081FF7E3F307"}
2025-03-03 12:32:06.882  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=AjDpfNJillTBtUdfJG2csHein6g, fileName=金港东九提供材料2(3), fileType=folder, fileSize=null, createTime=1740897736, updateTime=1740897738), IFeishuFolderService.FileInfo(fileToken=VyUqfdiAQluC2hdYzDPcAwHFnKh, fileName=金港东九提供材料2(2), fileType=folder, fileSize=null, createTime=1740897731, updateTime=1740897732), IFeishuFolderService.FileInfo(fileToken=Lz5nfmsp1l69DsdvznwcnMcOnbb, fileName=金港东九提供材料2, fileType=folder, fileSize=null, createTime=1740897719, updateTime=1740897720), IFeishuFolderService.FileInfo(fileToken=AyPDbd6zVoxK3uxoA8PcUuhcnxc, fileName=银行情况说明.docx, fileType=file, fileSize=null, createTime=1740897458, updateTime=1740897458), IFeishuFolderService.FileInfo(fileToken=X8jnbYQOyoeyzgxTniPcLJnyntb, fileName=金港东九提供材料2.pdf, fileType=file, fileSize=null, createTime=1740897446, updateTime=1740897458), IFeishuFolderService.FileInfo(fileToken=SlMcbRvOyoFD1XxwsR5cLCK0nLb, fileName=金港东九提供材料1.pdf, fileType=file, fileSize=null, createTime=1740897439, updateTime=1740897446), IFeishuFolderService.FileInfo(fileToken=SMRtbfNgyopjqnxGHi2cw62dnMh, fileName=东九预看房陪看记录单.pdf, fileType=file, fileSize=null, createTime=1740897437, updateTime=1740897439), IFeishuFolderService.FileInfo(fileToken=ADX4baexwoHaycxsREAc9McPn7s, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740897436, updateTime=1740897437), IFeishuFolderService.FileInfo(fileToken=Th1JbVpOToMDgBxjtrCc1H5LnPd, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740897435, updateTime=1740897436)]
2025-03-03 12:32:06.883  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=AjDpfNJillTBtUdfJG2csHein6g, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 12:32:07.327  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897736","modified_time":"1740897737","name":"7-《臻心公告 项目红线内不利因素提示》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"AjDpfNJillTBtUdfJG2csHein6g","token":"Gb38bcBpdoF6IfxmZOIcdVHBnDb","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/Gb38bcBpdoF6IfxmZOIcdVHBnDb"},{"created_time":"1740897735","modified_time":"1740897736","name":"6-《臻心公告 特别告知书》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"AjDpfNJillTBtUdfJG2csHein6g","token":"C3MqbydkIo1oWgxC6i8c8258ncd","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/C3MqbydkIo1oWgxC6i8c8258ncd"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,55,34,44,34,110,97,109,101,34,58,34,55,45,-29,-128,-118,-24,-121,-69,-27,-65,-125,-27,-123,-84,-27,-111,-118,32,-23,-95,-71,-25,-101,-82,-25,-70,-94,-25,-70,-65,-27,-122,-123,-28,-72,-115,-27,-120,-87,-27,-101,-96,-25,-76,-96,-26,-113,-112,-25,-92,-70,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,44,34,116,111,107,101,110,34,58,34,71,98,51,56,98,99,66,112,100,111,70,54,73,102,120,109,90,79,73,99,100,86,72,66,110,68,98,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,71,98,51,56,98,99,66,112,100,111,70,54,73,102,120,109,90,79,73,99,100,86,72,66,110,68,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,53,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,54,34,44,34,110,97,109,101,34,58,34,54,45,-29,-128,-118,-24,-121,-69,-27,-65,-125,-27,-123,-84,-27,-111,-118,32,-25,-119,-71,-27,-120,-85,-27,-111,-118,-25,-97,-91,-28,-71,-90,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,44,34,116,111,107,101,110,34,58,34,67,51,77,113,98,121,100,107,73,111,49,111,87,103,120,67,54,105,56,99,56,50,53,56,110,99,100,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,67,51,77,113,98,121,100,107,73,111,49,111,87,103,120,67,54,105,56,99,56,50,53,56,110,99,100,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:32:05 GMT"],"eagleid":["74c48fae17409763251608023e"],"request-id":["0981349a-f8dc-4d51-980f-010f23e928c0"],"server":["Tengine"],"server-timing":["inner; dur=387","cdn-cache;desc=MISS,edge;dur=0,origin;dur=421"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache26.cn7149[421,0]"],"x-lgw-dst-svc":["yj9sucUb1RZCFvtHUhB1rjkqoEu3I3zHwEBkRobC1MUvQ5SE3nZGO-W-EJ75xYz0JEpvgcn433_iLJ42btR5v9GakKALbJMgPCMB6hetmh6MIrcltIl9hlESxLSS8ybWAtTixXUI-cdca2KzG_tvTEwr50a9mlHoQorZyN-8bbGQLlBWjX5hTmeCAaiTS6xMgkXXnTlMoLvJLqkytMIe3bDicwUsBkgjtiZrpdeF7zp_AqlG10klA55fOOSzJ9_YVNnLljMcnjLxRXg_E0UElPEFlks3LSnFOrVS-tDuFMPlC4YHDZeoE_8="],"x-request-id":["0981349a-f8dc-4d51-980f-010f23e928c0"],"x-timestamp":["1740976325.570"],"x-tt-logid":["20250303123205A0F850DF081FF7E3F336"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be9585a59defc2d6a9402c1170b29e0ec3684500566c347f778d6c1bb09ac29b888028c2500b4466ef32eddcbff03c2f95d0c4e299f3942f14c0f493da67e0459a48ddb8ab99944ec2a53a6276f0430ef9"],"x-tt-trace-id":["00-250303123205A0F850DF081FF7E3F336-407DA21F04C3BAD8-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303123205A0F850DF081FF7E3F336","statusCode":200},"request":{"folder_token":"AjDpfNJillTBtUdfJG2csHein6g"},"requestId":"20250303123205A0F850DF081FF7E3F336"}
2025-03-03 12:32:07.328  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=Gb38bcBpdoF6IfxmZOIcdVHBnDb, fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, fileType=file, fileSize=null, createTime=1740897736, updateTime=1740897737), IFeishuFolderService.FileInfo(fileToken=C3MqbydkIo1oWgxC6i8c8258ncd, fileName=6-《臻心公告 特别告知书》.pdf, fileType=file, fileSize=null, createTime=1740897735, updateTime=1740897736)]
2025-03-03 12:32:07.784  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 12:32:07.806 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:32:07.806 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:32:07.828 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:32:08.000 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:32:08.001  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 12:32:08.001  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, userId=system
2025-03-03 12:32:08.001 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:32:08.001 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:32:08.240  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=6adddca2-c016-4747-bb7f-dfe3ac9ae7c0
2025-03-03 12:32:08.240 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"6adddca2-c016-4747-bb7f-dfe3ac9ae7c0"}},"response_mode":"blocking","conversation_id":"a7513ea4-a3fd-4d5f-b637-7f7e4fd4ba0d","user":"fyjw"}
2025-03-03 12:32:08.282 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:32:08.282  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 12:32:08.283 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:32:08.283 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:32:08.305 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:32:08.435 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:32:09.114  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_0.png
2025-03-03 12:32:09.114  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_0.png, userId=system
2025-03-03 12:32:09.114 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:32:09.114 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:32:09.346  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=cbab5071-f55c-4787-9fbb-28befeaf8a96
2025-03-03 12:32:09.346 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"cbab5071-f55c-4787-9fbb-28befeaf8a96"}},"response_mode":"blocking","conversation_id":"ebd34ef2-eb7e-4f83-983a-4f1799d4d3d1","user":"fyjw"}
2025-03-03 12:32:31.269 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d84f19dc-e0b6-4d20-9ada-f35f3b1f50b5","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片内容的Markdown格式转换：\n\n---\n\n# 竣工公告  \n**项目红线内不利因素提示**  \n\n**海欢水晶澜湾** 天赋湾苑项目（Ⅲ期*名为海德湾*），以下简称“本项目”  \n\n---\n\n## 不利因素示意图  \n（包含项目平面图，标注了相关入口、设施及其影响范围）\n\n---\n\n## 主要不利因素说明  \n\n| 序号 | 主要不利因素类型 | 红线内不利因素说明 | 影响范围 | 备注 |\n|------|----------------|----------------------|----------|------|\n| 1    | 消防登高操作场地 | 住宅出入口（1）     | 1栋1-3号、2栋1-3号 | |\n| 2    |               | 住宅出入口（2）     | 1栋1-3号、2栋1-3号 | |\n| 3    | 变电房        | 住宅出入口（1）     | 1栋1-3号、2栋1-3号 | |\n| 4    |               | 住宅出入口（2）     | 1栋1-3号、2栋1-3号 | |\n| 5    | 社区门岗      | 住宅出入口（3）     | 1栋1-3号、2栋1-3号 | |\n| 6    |               | 住宅出入口（4）     | 1栋1-3号、2栋1-3号 | |\n\n---\n\n## 说明  \n本表仅列示项目红线范围内的不利因素，敬请知悉。  \n\n（图片底部包含公章和签署日期）\n\n---\n\n以上是图片内容的完整转换，包括表格、标题及相关说明。"},"elapsed_time":21.873393456917256,"total_tokens":796,"total_steps":4,"created_at":1740976327,"finished_at":1740976349}
2025-03-03 12:32:31.270  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_0.png, text=以下是该图片内容的Markdown格式转换：

---

# 竣工公告  
**项目红线内不利因素提示**  

**海欢水晶澜湾** 天赋湾苑项目（Ⅲ期*名为海德湾*），以下简称“本项目”  

---

## 不利因素示意图  
（包含项目平面图，标注了相关入口、设施及其影响范围）

---

## 主要不利因素说明  

| 序号 | 主要不利因素类型 | 红线内不利因素说明 | 影响范围 | 备注 |
|------|----------------|----------------------|----------|------|
| 1    | 消防登高操作场地 | 住宅出入口（1）     | 1栋1-3号、2栋1-3号 | |
| 2    |               | 住宅出入口（2）     | 1栋1-3号、2栋1-3号 | |
| 3    | 变电房        | 住宅出入口（1）     | 1栋1-3号、2栋1-3号 | |
| 4    |               | 住宅出入口（2）     | 1栋1-3号、2栋1-3号 | |
| 5    | 社区门岗      | 住宅出入口（3）     | 1栋1-3号、2栋1-3号 | |
| 6    |               | 住宅出入口（4）     | 1栋1-3号、2栋1-3号 | |

---

## 说明  
本表仅列示项目红线范围内的不利因素，敬请知悉。  

（图片底部包含公章和签署日期）

---

以上是图片内容的完整转换，包括表格、标题及相关说明。
2025-03-03 12:32:31.270 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"944f16d9-fc70-4c7f-b479-ed1c3cad69f7","workflow_run_id":"d84f19dc-e0b6-4d20-9ada-f35f3b1f50b5","data":{"id":"d84f19dc-e0b6-4d20-9ada-f35f3b1f50b5","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片内容的Markdown格式转换：\n\n---\n\n# 竣工公告  \n**项目红线内不利因素提示**  \n\n**海欢水晶澜湾** 天赋湾苑项目（Ⅲ期*名为海德湾*），以下简称“本项目”  \n\n---\n\n## 不利因素示意图  \n（包含项目平面图，标注了相关入口、设施及其影响范围）\n\n---\n\n## 主要不利因素说明  \n\n| 序号 | 主要不利因素类型 | 红线内不利因素说明 | 影响范围 | 备注 |\n|------|----------------|----------------------|----------|------|\n| 1    | 消防登高操作场地 | 住宅出入口（1）     | 1栋1-3号、2栋1-3号 | |\n| 2    |               | 住宅出入口（2）     | 1栋1-3号、2栋1-3号 | |\n| 3    | 变电房        | 住宅出入口（1）     | 1栋1-3号、2栋1-3号 | |\n| 4    |               | 住宅出入口（2）     | 1栋1-3号、2栋1-3号 | |\n| 5    | 社区门岗      | 住宅出入口（3）     | 1栋1-3号、2栋1-3号 | |\n| 6    |               | 住宅出入口（4）     | 1栋1-3号、2栋1-3号 | |\n\n---\n\n## 说明  \n本表仅列示项目红线范围内的不利因素，敬请知悉。  \n\n（图片底部包含公章和签署日期）\n\n---\n\n以上是图片内容的完整转换，包括表格、标题及相关说明。"},"elapsed_time":21.873393456917256,"total_tokens":796,"total_steps":4,"created_at":1740976327,"finished_at":1740976349}}
2025-03-03 12:32:31.937  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_1.png
2025-03-03 12:32:31.937  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_1.png, userId=system
2025-03-03 12:32:31.937 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:32:31.937 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:32:32.129  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=fc7f3358-bac0-42b5-8aad-b429996e032e
2025-03-03 12:32:32.129 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"fc7f3358-bac0-42b5-8aad-b429996e032e"}},"response_mode":"blocking","conversation_id":"7ecc3213-3a21-4ec2-911f-75e89d9209ce","user":"fyjw"}
2025-03-03 12:32:49.697 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"088cac56-845d-496e-94ed-9763cdc68bf1","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 表格内容\n\n| 序号 | 设备 | 位置 |\n|------|------|------|\n| 8 | 地下消防水泵房 | 1栋1-3号 |\n| 9 | 地下生活水泵房 | 1栋1-3号 |\n| 10 | 屋面消防水箱 | 1栋1-3号 |\n| 11 | 设备 | 1栋1-3号 |\n| 12 | 设备 | 1栋1-3号 |\n| 13 | 公共厨房 | 1栋1-3号 |\n| 14 | 燃气调压站 | 2栋1-3号 |\n| 15 | 其他（办公、办公管理、物业管理、商铺等） | 1栋1-3号 1栋5-7号 |\n\n---\n\n### 其他信息\n\n- **附带建筑平面图**\n- **客户处签名盖章**\n\n"},"elapsed_time":17.520729186944664,"total_tokens":618,"total_steps":4,"created_at":1740976350,"finished_at":1740976367}
2025-03-03 12:32:49.697  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

### 表格内容

| 序号 | 设备 | 位置 |
|------|------|------|
| 8 | 地下消防水泵房 | 1栋1-3号 |
| 9 | 地下生活水泵房 | 1栋1-3号 |
| 10 | 屋面消防水箱 | 1栋1-3号 |
| 11 | 设备 | 1栋1-3号 |
| 12 | 设备 | 1栋1-3号 |
| 13 | 公共厨房 | 1栋1-3号 |
| 14 | 燃气调压站 | 2栋1-3号 |
| 15 | 其他（办公、办公管理、物业管理、商铺等） | 1栋1-3号 1栋5-7号 |

---

### 其他信息

- **附带建筑平面图**
- **客户处签名盖章**


2025-03-03 12:32:49.697 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6f0310ec-ba4e-4604-89b6-877696297416","workflow_run_id":"088cac56-845d-496e-94ed-9763cdc68bf1","data":{"id":"088cac56-845d-496e-94ed-9763cdc68bf1","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 表格内容\n\n| 序号 | 设备 | 位置 |\n|------|------|------|\n| 8 | 地下消防水泵房 | 1栋1-3号 |\n| 9 | 地下生活水泵房 | 1栋1-3号 |\n| 10 | 屋面消防水箱 | 1栋1-3号 |\n| 11 | 设备 | 1栋1-3号 |\n| 12 | 设备 | 1栋1-3号 |\n| 13 | 公共厨房 | 1栋1-3号 |\n| 14 | 燃气调压站 | 2栋1-3号 |\n| 15 | 其他（办公、办公管理、物业管理、商铺等） | 1栋1-3号 1栋5-7号 |\n\n---\n\n### 其他信息\n\n- **附带建筑平面图**\n- **客户处签名盖章**\n\n"},"elapsed_time":17.520729186944664,"total_tokens":618,"total_steps":4,"created_at":1740976350,"finished_at":1740976367}}
2025-03-03 12:32:50.414  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_2.png
2025-03-03 12:32:50.414  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_2.png, userId=system
2025-03-03 12:32:50.414 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:32:50.414 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:32:50.630  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=382527e7-e0f5-41b7-a556-e6096ee71a14
2025-03-03 12:32:50.630 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"382527e7-e0f5-41b7-a556-e6096ee71a14"}},"response_mode":"blocking","conversation_id":"256bcd70-ca4d-4e3a-8e58-6044e9983edc","user":"fyjw"}
2025-03-03 12:33:12.950 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"1111c24b-f1ce-4cb1-ac5f-ce107c28c593","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n```markdown\n# 红线外不平顺问题与领桩高程修正表\n\n| 序号（单位） | 主要部位 | 典型案例 | 红线外不平顺问题 | 领桩高程修正 | 影响 |\n|-------------|----------|----------|------------------|--------------|------|\n| 1           | 机动车出入口（2个） | - | 4~8 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 2           | 非机动车出入口（1个） | - | 4~8 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 3           | 小区出入口（3个） | - | 4~9 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 4           | 人行道 | - | 1~5 cm | 3~6 cm，建议3~5 cm | 影响通行舒适性 |\n| 5           | 人行道（盲道） | - | 1~5 cm | 3~6 cm，建议3~5 cm | 影响通行舒适性 |\n| 6           | 盲道坡口 | - | 1~4 cm | 2~5 cm，建议2~4 cm | 影响通行舒适性 |\n| 7           | 绿化带 | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 8           | 绿化带（树池） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 9           | 绿化带（灌木） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 10          | 绿化带（草坪） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 11          | 公交站台 | - | 4~9 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 12          | 公共建筑 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |\n| 13          | 市政设施 | - | 2~8 cm | 5~10 cm，建议5~8 cm | 影响使用便利性 |\n| 14          | 下沉广场 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |\n| 15          | 配套用房 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |\n\n---\n\n该表格详细列出了不同地点的红线外不平顺问题及相应的领桩高程修正建议，同时说明了其对通行、景观及使用的影响。\n``` \n\n如果需要进一步优化格式或内容，请告诉我！"},"elapsed_time":22.28383663110435,"total_tokens":1129,"total_steps":4,"created_at":1740976368,"finished_at":1740976391}
2025-03-03 12:33:12.950  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_2.png, text=以下是该图片中的文字内容转换为Markdown格式：

```markdown
# 红线外不平顺问题与领桩高程修正表

| 序号（单位） | 主要部位 | 典型案例 | 红线外不平顺问题 | 领桩高程修正 | 影响 |
|-------------|----------|----------|------------------|--------------|------|
| 1           | 机动车出入口（2个） | - | 4~8 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |
| 2           | 非机动车出入口（1个） | - | 4~8 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |
| 3           | 小区出入口（3个） | - | 4~9 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |
| 4           | 人行道 | - | 1~5 cm | 3~6 cm，建议3~5 cm | 影响通行舒适性 |
| 5           | 人行道（盲道） | - | 1~5 cm | 3~6 cm，建议3~5 cm | 影响通行舒适性 |
| 6           | 盲道坡口 | - | 1~4 cm | 2~5 cm，建议2~4 cm | 影响通行舒适性 |
| 7           | 绿化带 | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |
| 8           | 绿化带（树池） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |
| 9           | 绿化带（灌木） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |
| 10          | 绿化带（草坪） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |
| 11          | 公交站台 | - | 4~9 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |
| 12          | 公共建筑 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |
| 13          | 市政设施 | - | 2~8 cm | 5~10 cm，建议5~8 cm | 影响使用便利性 |
| 14          | 下沉广场 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |
| 15          | 配套用房 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |

---

该表格详细列出了不同地点的红线外不平顺问题及相应的领桩高程修正建议，同时说明了其对通行、景观及使用的影响。
``` 

如果需要进一步优化格式或内容，请告诉我！
2025-03-03 12:33:12.950 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"529be0fe-b350-4f32-9ab8-b4b8a05f979f","workflow_run_id":"1111c24b-f1ce-4cb1-ac5f-ce107c28c593","data":{"id":"1111c24b-f1ce-4cb1-ac5f-ce107c28c593","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n```markdown\n# 红线外不平顺问题与领桩高程修正表\n\n| 序号（单位） | 主要部位 | 典型案例 | 红线外不平顺问题 | 领桩高程修正 | 影响 |\n|-------------|----------|----------|------------------|--------------|------|\n| 1           | 机动车出入口（2个） | - | 4~8 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 2           | 非机动车出入口（1个） | - | 4~8 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 3           | 小区出入口（3个） | - | 4~9 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 4           | 人行道 | - | 1~5 cm | 3~6 cm，建议3~5 cm | 影响通行舒适性 |\n| 5           | 人行道（盲道） | - | 1~5 cm | 3~6 cm，建议3~5 cm | 影响通行舒适性 |\n| 6           | 盲道坡口 | - | 1~4 cm | 2~5 cm，建议2~4 cm | 影响通行舒适性 |\n| 7           | 绿化带 | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 8           | 绿化带（树池） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 9           | 绿化带（灌木） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 10          | 绿化带（草坪） | - | 1~7 cm | 3~8 cm，建议3~6 cm | 影响景观效果 |\n| 11          | 公交站台 | - | 4~9 cm | 7~12 cm，建议7~9 cm | 影响行驶舒适性 |\n| 12          | 公共建筑 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |\n| 13          | 市政设施 | - | 2~8 cm | 5~10 cm，建议5~8 cm | 影响使用便利性 |\n| 14          | 下沉广场 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |\n| 15          | 配套用房 | - | 3~9 cm | 6~12 cm，建议6~9 cm | 影响通行舒适性 |\n\n---\n\n该表格详细列出了不同地点的红线外不平顺问题及相应的领桩高程修正建议，同时说明了其对通行、景观及使用的影响。\n``` \n\n如果需要进一步优化格式或内容，请告诉我！"},"elapsed_time":22.28383663110435,"total_tokens":1129,"total_steps":4,"created_at":1740976368,"finished_at":1740976391}}
2025-03-03 12:33:13.587  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_3.png
2025-03-03 12:33:13.587  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_3.png, userId=system
2025-03-03 12:33:13.587 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:33:13.587 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:33:13.752  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=c199a3a4-0b5a-4e1c-8331-36b221077018
2025-03-03 12:33:13.753 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"c199a3a4-0b5a-4e1c-8331-36b221077018"}},"response_mode":"blocking","conversation_id":"e50c8217-d863-46ff-b7b4-08f6104ba489","user":"fyjw"}
2025-03-03 12:33:39.004 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"c4b05f05-e021-45d0-862b-3c8f756d86a7","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 特别说明：\n\n1. 上述房屋均为办公类物业。  \n2. 上述房屋的土地用途均为商业用途，土地使用年限自土地出让合同约定的起始日起计算。  \n3. 上述房屋的计价建筑面积包含套内建筑面积及分摊的共有建筑面积。  \n4. 上述房屋的套内建筑面积以房屋测绘机构依据现行测绘规范测定并出具的测绘报告为准。  \n5. 上述房屋的分摊共有建筑面积以该房屋所在楼栋的竣工测绘报告为准。  \n6. 本确认书所列的上述房屋的建筑面积、套内建筑面积及分摊共有建筑面积仅供参考，最终数据以房屋测绘机构出具的测绘报告为准。  \n7. 上述房屋的交付标准以买卖双方签订的《上海市商品房预售合同》（或《上海市商品房出售合同》）及其附件为准。  \n8. 以上所列房屋的相关信息，买受人已知悉并认可。  \n\n---\n\n## 声明：\n\n买受人：在签订《上海市商品房预售合同》（或《上海市商品房出售合同》）及补充协议前，买受人已详细阅读本《房屋确认书》内容，并已充分知悉和理解。  \n\n买受人对所购房屋的计价建筑面积、套内建筑面积及分摊共有建筑面积的计算方法、数据来源及法律效力均已理解，并对此无任何异议。  \n\n买受人签字：  \n**（签名）**  \n\n签订日期：**2022年8月22日**  \n\n---\n\n以上内容完整还原了图片中的文字信息。"},"elapsed_time":25.20901714102365,"total_tokens":814,"total_steps":4,"created_at":1740976392,"finished_at":1740976417}
2025-03-03 12:33:39.004  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_3.png, text=以下是图片中的文字内容转换为Markdown格式：

---

## 特别说明：

1. 上述房屋均为办公类物业。  
2. 上述房屋的土地用途均为商业用途，土地使用年限自土地出让合同约定的起始日起计算。  
3. 上述房屋的计价建筑面积包含套内建筑面积及分摊的共有建筑面积。  
4. 上述房屋的套内建筑面积以房屋测绘机构依据现行测绘规范测定并出具的测绘报告为准。  
5. 上述房屋的分摊共有建筑面积以该房屋所在楼栋的竣工测绘报告为准。  
6. 本确认书所列的上述房屋的建筑面积、套内建筑面积及分摊共有建筑面积仅供参考，最终数据以房屋测绘机构出具的测绘报告为准。  
7. 上述房屋的交付标准以买卖双方签订的《上海市商品房预售合同》（或《上海市商品房出售合同》）及其附件为准。  
8. 以上所列房屋的相关信息，买受人已知悉并认可。  

---

## 声明：

买受人：在签订《上海市商品房预售合同》（或《上海市商品房出售合同》）及补充协议前，买受人已详细阅读本《房屋确认书》内容，并已充分知悉和理解。  

买受人对所购房屋的计价建筑面积、套内建筑面积及分摊共有建筑面积的计算方法、数据来源及法律效力均已理解，并对此无任何异议。  

买受人签字：  
**（签名）**  

签订日期：**2022年8月22日**  

---

以上内容完整还原了图片中的文字信息。
2025-03-03 12:33:39.005 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"efb32ff4-e70a-4f09-b5f2-3c3d315d0391","workflow_run_id":"c4b05f05-e021-45d0-862b-3c8f756d86a7","data":{"id":"c4b05f05-e021-45d0-862b-3c8f756d86a7","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 特别说明：\n\n1. 上述房屋均为办公类物业。  \n2. 上述房屋的土地用途均为商业用途，土地使用年限自土地出让合同约定的起始日起计算。  \n3. 上述房屋的计价建筑面积包含套内建筑面积及分摊的共有建筑面积。  \n4. 上述房屋的套内建筑面积以房屋测绘机构依据现行测绘规范测定并出具的测绘报告为准。  \n5. 上述房屋的分摊共有建筑面积以该房屋所在楼栋的竣工测绘报告为准。  \n6. 本确认书所列的上述房屋的建筑面积、套内建筑面积及分摊共有建筑面积仅供参考，最终数据以房屋测绘机构出具的测绘报告为准。  \n7. 上述房屋的交付标准以买卖双方签订的《上海市商品房预售合同》（或《上海市商品房出售合同》）及其附件为准。  \n8. 以上所列房屋的相关信息，买受人已知悉并认可。  \n\n---\n\n## 声明：\n\n买受人：在签订《上海市商品房预售合同》（或《上海市商品房出售合同》）及补充协议前，买受人已详细阅读本《房屋确认书》内容，并已充分知悉和理解。  \n\n买受人对所购房屋的计价建筑面积、套内建筑面积及分摊共有建筑面积的计算方法、数据来源及法律效力均已理解，并对此无任何异议。  \n\n买受人签字：  \n**（签名）**  \n\n签订日期：**2022年8月22日**  \n\n---\n\n以上内容完整还原了图片中的文字信息。"},"elapsed_time":25.20901714102365,"total_tokens":814,"total_steps":4,"created_at":1740976392,"finished_at":1740976417}}
2025-03-03 12:33:39.006 DEBUG 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:33:39.006  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=null, fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, fileSize=5370
2025-03-03 12:33:39.006 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/null/document/create-by-file, fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:33:39.035 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:135) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:512) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:33:39.035 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 12:33:39.059 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:33:39.060 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:33:39.084 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:33:39.239 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:33:39.240 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:33:39.240 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:33:39.279 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:33:39.456 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:33:40.115  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 6-《臻心公告 特别告知书》.pdf
2025-03-03 12:33:40.137 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:33:40.137 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:33:40.161 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:33:40.309 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:33:40.316  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf
2025-03-03 12:33:40.316  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf, userId=system
2025-03-03 12:33:40.316 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:33:40.316 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:33:40.569  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=cf853447-999f-463d-95b1-50b2bb4c9fea
2025-03-03 12:33:40.571 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"cf853447-999f-463d-95b1-50b2bb4c9fea"}},"response_mode":"blocking","conversation_id":"bd7fc986-923d-4e3e-b7f0-d240f80c7912","user":"fyjw"}
2025-03-03 12:33:40.603 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:33:40.603  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 6-《臻心公告 特别告知书》.pdf
2025-03-03 12:33:40.605 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:33:40.607 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:33:40.635 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:33:40.765 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:33:41.397  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_0.png
2025-03-03 12:33:41.397  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_0.png, userId=system
2025-03-03 12:33:41.397 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:33:41.397 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:33:41.547  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=58e6f2fb-8a6b-4668-976f-3e293bb4db12
2025-03-03 12:33:41.547 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"58e6f2fb-8a6b-4668-976f-3e293bb4db12"}},"response_mode":"blocking","conversation_id":"eb96448a-8f17-403c-8d8d-f29290b01e53","user":"fyjw"}
2025-03-03 12:34:06.810 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"74e6cd0a-5dd7-4564-b4d6-4d3f0ef321ff","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"# 致心公告  特别告知书\n\n为帮助用户慎重做出购买决策，现就涉及受众人群特定性文件特别告知如下事项：\n\n### 一、受众人群特定性的特别提示：\n1. 受众人群特定性指该商品或服务的使用以及参与仅适用于特定对象的情形，包括下列情形在内但不限于：\n   - 依据法律、法规、部门规章、行业规范、交易习惯等相关规定，仅特定对象可购买或使用的；\n   - 因商品或服务的特殊性，仅特定对象可购买或使用的。\n\n2. 若购买人的受众人群不符合商品或服务的适用人群范围的，不作为构成购买或交易行为的障碍，因购买人不符合适用人群范围导致的商品或服务无法使用的，购买人应当自行承担相应的责任。\n\n3. 受众人群特定性可能基于（包括但不限于）：\n   - 年龄、性别、职业、行业、身份、资质、地域、健康状况、法律法规要求等；\n   - 其他具有合理性、正当性的特定性要求。\n\n### 二、特别告知：\n1. 购买人应当认真阅读商品或服务页面的相关信息，充分理解商品或服务的受众人群特定性要求，并根据自身情况谨慎做出购买决策。\n\n2. 购买人应当保证自身符合商品或服务的适用人群要求，否则可能会导致商品或服务无法使用或享受。\n\n3. 若购买人不符合商品或服务的适用人群要求，仍选择购买的，购买人应当自行承担可能产生的损失，包括但不限于：\n   - 商品或服务无法使用或享受；\n   - 由于不符合适用人群要求而导致的其他损失。\n\n4. 购买人如对商品或服务的受众人群特定性存在疑问的，应在购买前咨询商家或相关服务提供方，并结合自身情况谨慎决策。\n\n5. 购买人一旦做出购买决策，即视为已充分理解并接受商品或服务的受众人群特定性要求，不得以不了解、不清楚、不符合适用人群范围为由要求退货、退款或者索赔。\n\n本特别告知书自发布之日起生效。\n\n**特此告知！**\n\n**（盖章）**  \n**日期：**"},"elapsed_time":25.221651809988543,"total_tokens":949,"total_steps":4,"created_at":1740976419,"finished_at":1740976445}
2025-03-03 12:34:06.811  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_0.png, text=# 致心公告  特别告知书

为帮助用户慎重做出购买决策，现就涉及受众人群特定性文件特别告知如下事项：

### 一、受众人群特定性的特别提示：
1. 受众人群特定性指该商品或服务的使用以及参与仅适用于特定对象的情形，包括下列情形在内但不限于：
   - 依据法律、法规、部门规章、行业规范、交易习惯等相关规定，仅特定对象可购买或使用的；
   - 因商品或服务的特殊性，仅特定对象可购买或使用的。

2. 若购买人的受众人群不符合商品或服务的适用人群范围的，不作为构成购买或交易行为的障碍，因购买人不符合适用人群范围导致的商品或服务无法使用的，购买人应当自行承担相应的责任。

3. 受众人群特定性可能基于（包括但不限于）：
   - 年龄、性别、职业、行业、身份、资质、地域、健康状况、法律法规要求等；
   - 其他具有合理性、正当性的特定性要求。

### 二、特别告知：
1. 购买人应当认真阅读商品或服务页面的相关信息，充分理解商品或服务的受众人群特定性要求，并根据自身情况谨慎做出购买决策。

2. 购买人应当保证自身符合商品或服务的适用人群要求，否则可能会导致商品或服务无法使用或享受。

3. 若购买人不符合商品或服务的适用人群要求，仍选择购买的，购买人应当自行承担可能产生的损失，包括但不限于：
   - 商品或服务无法使用或享受；
   - 由于不符合适用人群要求而导致的其他损失。

4. 购买人如对商品或服务的受众人群特定性存在疑问的，应在购买前咨询商家或相关服务提供方，并结合自身情况谨慎决策。

5. 购买人一旦做出购买决策，即视为已充分理解并接受商品或服务的受众人群特定性要求，不得以不了解、不清楚、不符合适用人群范围为由要求退货、退款或者索赔。

本特别告知书自发布之日起生效。

**特此告知！**

**（盖章）**  
**日期：**
2025-03-03 12:34:06.811 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"4d0dda81-e713-4d73-a8f8-29ce462bf926","workflow_run_id":"74e6cd0a-5dd7-4564-b4d6-4d3f0ef321ff","data":{"id":"74e6cd0a-5dd7-4564-b4d6-4d3f0ef321ff","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"# 致心公告  特别告知书\n\n为帮助用户慎重做出购买决策，现就涉及受众人群特定性文件特别告知如下事项：\n\n### 一、受众人群特定性的特别提示：\n1. 受众人群特定性指该商品或服务的使用以及参与仅适用于特定对象的情形，包括下列情形在内但不限于：\n   - 依据法律、法规、部门规章、行业规范、交易习惯等相关规定，仅特定对象可购买或使用的；\n   - 因商品或服务的特殊性，仅特定对象可购买或使用的。\n\n2. 若购买人的受众人群不符合商品或服务的适用人群范围的，不作为构成购买或交易行为的障碍，因购买人不符合适用人群范围导致的商品或服务无法使用的，购买人应当自行承担相应的责任。\n\n3. 受众人群特定性可能基于（包括但不限于）：\n   - 年龄、性别、职业、行业、身份、资质、地域、健康状况、法律法规要求等；\n   - 其他具有合理性、正当性的特定性要求。\n\n### 二、特别告知：\n1. 购买人应当认真阅读商品或服务页面的相关信息，充分理解商品或服务的受众人群特定性要求，并根据自身情况谨慎做出购买决策。\n\n2. 购买人应当保证自身符合商品或服务的适用人群要求，否则可能会导致商品或服务无法使用或享受。\n\n3. 若购买人不符合商品或服务的适用人群要求，仍选择购买的，购买人应当自行承担可能产生的损失，包括但不限于：\n   - 商品或服务无法使用或享受；\n   - 由于不符合适用人群要求而导致的其他损失。\n\n4. 购买人如对商品或服务的受众人群特定性存在疑问的，应在购买前咨询商家或相关服务提供方，并结合自身情况谨慎决策。\n\n5. 购买人一旦做出购买决策，即视为已充分理解并接受商品或服务的受众人群特定性要求，不得以不了解、不清楚、不符合适用人群范围为由要求退货、退款或者索赔。\n\n本特别告知书自发布之日起生效。\n\n**特此告知！**\n\n**（盖章）**  \n**日期：**"},"elapsed_time":25.221651809988543,"total_tokens":949,"total_steps":4,"created_at":1740976419,"finished_at":1740976445}}
2025-03-03 12:34:07.472  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_1.png
2025-03-03 12:34:07.472  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_1.png, userId=system
2025-03-03 12:34:07.472 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:34:07.472 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:34:07.678  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=563fb2bf-a1d7-4242-8d67-1574f263dedd
2025-03-03 12:34:07.678 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"563fb2bf-a1d7-4242-8d67-1574f263dedd"}},"response_mode":"blocking","conversation_id":"b4e6a51b-c547-470c-a820-5626da0beadd","user":"fyjw"}
2025-03-03 12:34:28.435 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"e9ae0a1f-facc-490f-a4f2-85cf3bd31270","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 7. 若买卖合同有效成立，则应当严格按照合同约定履行\n\n买卖、租赁等市场交易中，买受人和承租人均应严格遵守合同约定，按照合同的内容履行义务（如缴纳购房款、支付租金等）。如果出现违约行为，如买受人未按合同约定付款、租户未按合同约定支付租金等，出卖人、出租人可以依法追究违约责任。\n\n---\n\n### 二、联合炒作、签虚假合同，规避市场调控措施\n\n部分购房者、房地产中介机构、开发企业等市场主体为逃避市场调控政策，采取规避或变相规避限购、限贷等政策的方式，扰乱市场秩序，影响市场公平，侵害其他购房人的合法权益。主要表现包括但不限于：\n\n1. **签订虚假买卖合同，规避限购、限贷政策**  \n   购房者与他人签订虚假购房合同并进行网签备案，以获取购房资格或提高贷款额度，或规避限购政策。此种行为一旦被监管部门查实，可能面临合同无效、行政处罚等法律后果。\n\n2. **利用虚假购房合同获取贷款**  \n   购房者与他人串通，签订虚假购房合同，以骗取银行贷款。此类行为不仅违反市场调控政策，还可能涉嫌贷款诈骗罪，依法需要承担刑事责任。\n\n3. **投机炒房，扰乱市场秩序**  \n   通过签订虚假合同、囤积房源、制造“房源紧张”假象等方式，哄抬房价，扰乱市场秩序，损害正常购房者的权益。相关部门将加强监管，对违法违规行为依法查处。\n\n4. **违规“更名”转让房屋**  \n   部分购房者在新房限售期内，采取“更名”方式变相转让房屋，规避限售政策。若被查实，可能会被认定为无效交易，并承担相应法律责任。\n\n---\n\n### 三、房地产市场监管部门的监管措施\n\n1. **加强市场秩序监管**  \n   市场监管部门将加大对房地产市场违法违规行为的监管力度，严厉打击虚假交易、恶意炒作、扰乱市场秩序等行为，依法查处违法违规主体。\n\n2. **建立联合惩戒机制**  \n   对于存在严重违法违规行为的个人或企业，将纳入信用监管体系，实施联合惩戒，限制相关市场行为，防止违规主体通过不正当手段获取不当利益。\n\n3. **加强信息共享，提高监管效能**  \n   住房和城乡建设部门、市场监管部门、金融监管机构等多部门将加强信息共享，形成监管合力，提高市场监管效能，确保房地产市场平稳健康发展。\n\n---\n\n### **签署单位及日期**\n**（盖章）**  \n**（相关单位名称）**  \n**日期：**  \n\n---\n\n### **结论**\n本文件强调了房地产市场交易中合同履行的重要性，同时指出了市场上的违法违规行为及其法律后果，并提出了相关监管措施，以维护房地产市场的公平、公正和稳定。"},"elapsed_time":20.708525138907135,"total_tokens":1156,"total_steps":4,"created_at":1740976445,"finished_at":1740976466}
2025-03-03 12:34:28.435  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

### 7. 若买卖合同有效成立，则应当严格按照合同约定履行

买卖、租赁等市场交易中，买受人和承租人均应严格遵守合同约定，按照合同的内容履行义务（如缴纳购房款、支付租金等）。如果出现违约行为，如买受人未按合同约定付款、租户未按合同约定支付租金等，出卖人、出租人可以依法追究违约责任。

---

### 二、联合炒作、签虚假合同，规避市场调控措施

部分购房者、房地产中介机构、开发企业等市场主体为逃避市场调控政策，采取规避或变相规避限购、限贷等政策的方式，扰乱市场秩序，影响市场公平，侵害其他购房人的合法权益。主要表现包括但不限于：

1. **签订虚假买卖合同，规避限购、限贷政策**  
   购房者与他人签订虚假购房合同并进行网签备案，以获取购房资格或提高贷款额度，或规避限购政策。此种行为一旦被监管部门查实，可能面临合同无效、行政处罚等法律后果。

2. **利用虚假购房合同获取贷款**  
   购房者与他人串通，签订虚假购房合同，以骗取银行贷款。此类行为不仅违反市场调控政策，还可能涉嫌贷款诈骗罪，依法需要承担刑事责任。

3. **投机炒房，扰乱市场秩序**  
   通过签订虚假合同、囤积房源、制造“房源紧张”假象等方式，哄抬房价，扰乱市场秩序，损害正常购房者的权益。相关部门将加强监管，对违法违规行为依法查处。

4. **违规“更名”转让房屋**  
   部分购房者在新房限售期内，采取“更名”方式变相转让房屋，规避限售政策。若被查实，可能会被认定为无效交易，并承担相应法律责任。

---

### 三、房地产市场监管部门的监管措施

1. **加强市场秩序监管**  
   市场监管部门将加大对房地产市场违法违规行为的监管力度，严厉打击虚假交易、恶意炒作、扰乱市场秩序等行为，依法查处违法违规主体。

2. **建立联合惩戒机制**  
   对于存在严重违法违规行为的个人或企业，将纳入信用监管体系，实施联合惩戒，限制相关市场行为，防止违规主体通过不正当手段获取不当利益。

3. **加强信息共享，提高监管效能**  
   住房和城乡建设部门、市场监管部门、金融监管机构等多部门将加强信息共享，形成监管合力，提高市场监管效能，确保房地产市场平稳健康发展。

---

### **签署单位及日期**
**（盖章）**  
**（相关单位名称）**  
**日期：**  

---

### **结论**
本文件强调了房地产市场交易中合同履行的重要性，同时指出了市场上的违法违规行为及其法律后果，并提出了相关监管措施，以维护房地产市场的公平、公正和稳定。
2025-03-03 12:34:28.435 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"609f6e4d-9411-481d-b3a9-5a45233d1bec","workflow_run_id":"e9ae0a1f-facc-490f-a4f2-85cf3bd31270","data":{"id":"e9ae0a1f-facc-490f-a4f2-85cf3bd31270","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 7. 若买卖合同有效成立，则应当严格按照合同约定履行\n\n买卖、租赁等市场交易中，买受人和承租人均应严格遵守合同约定，按照合同的内容履行义务（如缴纳购房款、支付租金等）。如果出现违约行为，如买受人未按合同约定付款、租户未按合同约定支付租金等，出卖人、出租人可以依法追究违约责任。\n\n---\n\n### 二、联合炒作、签虚假合同，规避市场调控措施\n\n部分购房者、房地产中介机构、开发企业等市场主体为逃避市场调控政策，采取规避或变相规避限购、限贷等政策的方式，扰乱市场秩序，影响市场公平，侵害其他购房人的合法权益。主要表现包括但不限于：\n\n1. **签订虚假买卖合同，规避限购、限贷政策**  \n   购房者与他人签订虚假购房合同并进行网签备案，以获取购房资格或提高贷款额度，或规避限购政策。此种行为一旦被监管部门查实，可能面临合同无效、行政处罚等法律后果。\n\n2. **利用虚假购房合同获取贷款**  \n   购房者与他人串通，签订虚假购房合同，以骗取银行贷款。此类行为不仅违反市场调控政策，还可能涉嫌贷款诈骗罪，依法需要承担刑事责任。\n\n3. **投机炒房，扰乱市场秩序**  \n   通过签订虚假合同、囤积房源、制造“房源紧张”假象等方式，哄抬房价，扰乱市场秩序，损害正常购房者的权益。相关部门将加强监管，对违法违规行为依法查处。\n\n4. **违规“更名”转让房屋**  \n   部分购房者在新房限售期内，采取“更名”方式变相转让房屋，规避限售政策。若被查实，可能会被认定为无效交易，并承担相应法律责任。\n\n---\n\n### 三、房地产市场监管部门的监管措施\n\n1. **加强市场秩序监管**  \n   市场监管部门将加大对房地产市场违法违规行为的监管力度，严厉打击虚假交易、恶意炒作、扰乱市场秩序等行为，依法查处违法违规主体。\n\n2. **建立联合惩戒机制**  \n   对于存在严重违法违规行为的个人或企业，将纳入信用监管体系，实施联合惩戒，限制相关市场行为，防止违规主体通过不正当手段获取不当利益。\n\n3. **加强信息共享，提高监管效能**  \n   住房和城乡建设部门、市场监管部门、金融监管机构等多部门将加强信息共享，形成监管合力，提高市场监管效能，确保房地产市场平稳健康发展。\n\n---\n\n### **签署单位及日期**\n**（盖章）**  \n**（相关单位名称）**  \n**日期：**  \n\n---\n\n### **结论**\n本文件强调了房地产市场交易中合同履行的重要性，同时指出了市场上的违法违规行为及其法律后果，并提出了相关监管措施，以维护房地产市场的公平、公正和稳定。"},"elapsed_time":20.708525138907135,"total_tokens":1156,"total_steps":4,"created_at":1740976445,"finished_at":1740976466}}
2025-03-03 12:34:29.040  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_2.png
2025-03-03 12:34:29.040  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_2.png, userId=system
2025-03-03 12:34:29.040 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:34:29.040 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:34:29.170  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a4416053-74e7-4c61-ab7c-0d4a7a7486b8
2025-03-03 12:34:29.170 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"a4416053-74e7-4c61-ab7c-0d4a7a7486b8"}},"response_mode":"blocking","conversation_id":"c9a82f76-b48a-4d27-950a-024ce56af523","user":"fyjw"}
2025-03-03 12:34:51.002 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"2f95699a-4dc5-46db-a79e-35e5bf802b68","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n对上述全部内容均为本人作出了充分的知悉与理解，本人知晓上述信息仅为提供款项的提示，未来可能会有所变更，以实际情况为准。因资金占用费等事宜影响购房结果，无法主张交易不成立或撤销合同，本人愿意承担因知悉上述内容的相关事宜所带来的后果，并承诺不因此主张任何权利。\n\n本人同意并确认，本人已充分知悉“商品房买卖合同”或相关补充协议关于“商品房买卖合同”约定的全部条款，并“商品房买卖合同”及相关补充协议内容均为本人真实意思表示。\n\n特此确认。\n\n---\n\n**买受人签名：**  \n✍️（签名）\n\n**日期：** 2024年 8 月 30 日\n\n---\n\n## 诚心公告  \n### 项目重要信息提示  \n\n**南兴城投·君悦东境项目**（以下简称“本项目”）"},"elapsed_time":21.790115603012964,"total_tokens":633,"total_steps":4,"created_at":1740976467,"finished_at":1740976489}
2025-03-03 12:34:51.002  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_2.png, text=以下是该图片中的文字内容转换为Markdown格式：

---

对上述全部内容均为本人作出了充分的知悉与理解，本人知晓上述信息仅为提供款项的提示，未来可能会有所变更，以实际情况为准。因资金占用费等事宜影响购房结果，无法主张交易不成立或撤销合同，本人愿意承担因知悉上述内容的相关事宜所带来的后果，并承诺不因此主张任何权利。

本人同意并确认，本人已充分知悉“商品房买卖合同”或相关补充协议关于“商品房买卖合同”约定的全部条款，并“商品房买卖合同”及相关补充协议内容均为本人真实意思表示。

特此确认。

---

**买受人签名：**  
✍️（签名）

**日期：** 2024年 8 月 30 日

---

## 诚心公告  
### 项目重要信息提示  

**南兴城投·君悦东境项目**（以下简称“本项目”）
2025-03-03 12:34:51.002 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"71551e9e-de78-474c-8cfd-1ce28add953d","workflow_run_id":"2f95699a-4dc5-46db-a79e-35e5bf802b68","data":{"id":"2f95699a-4dc5-46db-a79e-35e5bf802b68","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n对上述全部内容均为本人作出了充分的知悉与理解，本人知晓上述信息仅为提供款项的提示，未来可能会有所变更，以实际情况为准。因资金占用费等事宜影响购房结果，无法主张交易不成立或撤销合同，本人愿意承担因知悉上述内容的相关事宜所带来的后果，并承诺不因此主张任何权利。\n\n本人同意并确认，本人已充分知悉“商品房买卖合同”或相关补充协议关于“商品房买卖合同”约定的全部条款，并“商品房买卖合同”及相关补充协议内容均为本人真实意思表示。\n\n特此确认。\n\n---\n\n**买受人签名：**  \n✍️（签名）\n\n**日期：** 2024年 8 月 30 日\n\n---\n\n## 诚心公告  \n### 项目重要信息提示  \n\n**南兴城投·君悦东境项目**（以下简称“本项目”）"},"elapsed_time":21.790115603012964,"total_tokens":633,"total_steps":4,"created_at":1740976467,"finished_at":1740976489}}
2025-03-03 12:34:51.695  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_3.png
2025-03-03 12:34:51.695  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_3.png, userId=system
2025-03-03 12:34:51.695 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:34:51.695 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:34:51.908  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=36c823bf-c1e8-46e8-905a-1198575101c1
2025-03-03 12:34:51.908 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"36c823bf-c1e8-46e8-905a-1198575101c1"}},"response_mode":"blocking","conversation_id":"c22a35e1-311b-4240-8f1b-27001c126077","user":"fyjw"}
2025-03-03 12:35:19.205 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"b137c5ea-9078-4522-b943-cf82c703c1b9","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是对图片中表格内容的Markdown格式转换：\n\n```markdown\n# 结构分部验收单\n\n| 质量验收项目 | 主要检验内容 | 检验方法 |\n|-------------|------------|---------|\n| **土建** | | |\n| **结构构件的尺寸** | 轴线尺寸 | 轴线尺寸的允许偏差为7mm(门洞为13mm)。检查数量:全数检查。 | 用经纬仪、尺量检查。 |\n| | 截面尺寸 | 截面尺寸的允许偏差为6mm（墙、柱为8mm）。检查数量:全数检查。 | 用尺量检查。 |\n| **楼层标高** | 层高极限偏差 | 层高极限偏差±10mm，结构层间高度累计极限偏差±30mm，±50mm（高层）。 | 用水准仪检查。 |\n| **楼梯** | 楼梯踏步 | 踏步高低差≤10mm，相邻踏步高低差≤5mm。 | 用尺量检查。 |\n| **墙体** | 垂直度 | 允许偏差5mm。 | 用2m托线板检查。 |\n| | 平整度 | 允许偏差8mm。 | 用2m靠尺和塞尺检查。 |\n| | 阴阳角方正 | 允许偏差8mm。 | 用直角检测尺检查。 |\n| | 墙面裂缝 | 结构墙面不得有裂缝，砌体墙面不得有通缝。 | 观察检查。 |\n| **高层** | 2-5-7-13号 | | |\n| **混凝土强度** | 混凝土强度 | 结构混凝土强度必须符合设计要求，不得出现露筋、蜂窝、麻面等缺陷。 | 结构实体检测。 |\n| **楼板厚度** | 楼板厚度 | 现浇楼板厚度允许偏差-5mm。 | 用尺量检查。 |\n| **电梯井** | 轴线尺寸 | 电梯井道内净尺寸允许偏差为+10mm~-0mm，电梯导轨预埋件中心线允许偏差±10mm。 | 经纬仪、尺量检查。 |\n| **外立面** | 外立面垂直度与平整度 | 外立面垂直度允许偏差±10mm，平整度允许偏差±8mm。 | 用经纬仪、2m靠尺和塞尺检查。 |\n| **外立面装饰** | 外立面装饰 | 颜色一致、无污染、无明显色差、无空鼓、无裂缝、无缺棱掉角。 | 观察、检查。 |\n\n**验收人签字：**  \n**日期：**\n```\n\n该表格主要记录了结构分部验收的各项标准、主要检验内容和检验方法，确保施工质量符合规范要求。"},"elapsed_time":27.251498766010627,"total_tokens":1072,"total_steps":4,"created_at":1740976490,"finished_at":1740976517}
2025-03-03 12:35:19.206  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_3.png, text=以下是对图片中表格内容的Markdown格式转换：

```markdown
# 结构分部验收单

| 质量验收项目 | 主要检验内容 | 检验方法 |
|-------------|------------|---------|
| **土建** | | |
| **结构构件的尺寸** | 轴线尺寸 | 轴线尺寸的允许偏差为7mm(门洞为13mm)。检查数量:全数检查。 | 用经纬仪、尺量检查。 |
| | 截面尺寸 | 截面尺寸的允许偏差为6mm（墙、柱为8mm）。检查数量:全数检查。 | 用尺量检查。 |
| **楼层标高** | 层高极限偏差 | 层高极限偏差±10mm，结构层间高度累计极限偏差±30mm，±50mm（高层）。 | 用水准仪检查。 |
| **楼梯** | 楼梯踏步 | 踏步高低差≤10mm，相邻踏步高低差≤5mm。 | 用尺量检查。 |
| **墙体** | 垂直度 | 允许偏差5mm。 | 用2m托线板检查。 |
| | 平整度 | 允许偏差8mm。 | 用2m靠尺和塞尺检查。 |
| | 阴阳角方正 | 允许偏差8mm。 | 用直角检测尺检查。 |
| | 墙面裂缝 | 结构墙面不得有裂缝，砌体墙面不得有通缝。 | 观察检查。 |
| **高层** | 2-5-7-13号 | | |
| **混凝土强度** | 混凝土强度 | 结构混凝土强度必须符合设计要求，不得出现露筋、蜂窝、麻面等缺陷。 | 结构实体检测。 |
| **楼板厚度** | 楼板厚度 | 现浇楼板厚度允许偏差-5mm。 | 用尺量检查。 |
| **电梯井** | 轴线尺寸 | 电梯井道内净尺寸允许偏差为+10mm~-0mm，电梯导轨预埋件中心线允许偏差±10mm。 | 经纬仪、尺量检查。 |
| **外立面** | 外立面垂直度与平整度 | 外立面垂直度允许偏差±10mm，平整度允许偏差±8mm。 | 用经纬仪、2m靠尺和塞尺检查。 |
| **外立面装饰** | 外立面装饰 | 颜色一致、无污染、无明显色差、无空鼓、无裂缝、无缺棱掉角。 | 观察、检查。 |

**验收人签字：**  
**日期：**
```

该表格主要记录了结构分部验收的各项标准、主要检验内容和检验方法，确保施工质量符合规范要求。
2025-03-03 12:35:19.206 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"28cf460d-ab81-405d-8013-9630e37c8707","workflow_run_id":"b137c5ea-9078-4522-b943-cf82c703c1b9","data":{"id":"b137c5ea-9078-4522-b943-cf82c703c1b9","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是对图片中表格内容的Markdown格式转换：\n\n```markdown\n# 结构分部验收单\n\n| 质量验收项目 | 主要检验内容 | 检验方法 |\n|-------------|------------|---------|\n| **土建** | | |\n| **结构构件的尺寸** | 轴线尺寸 | 轴线尺寸的允许偏差为7mm(门洞为13mm)。检查数量:全数检查。 | 用经纬仪、尺量检查。 |\n| | 截面尺寸 | 截面尺寸的允许偏差为6mm（墙、柱为8mm）。检查数量:全数检查。 | 用尺量检查。 |\n| **楼层标高** | 层高极限偏差 | 层高极限偏差±10mm，结构层间高度累计极限偏差±30mm，±50mm（高层）。 | 用水准仪检查。 |\n| **楼梯** | 楼梯踏步 | 踏步高低差≤10mm，相邻踏步高低差≤5mm。 | 用尺量检查。 |\n| **墙体** | 垂直度 | 允许偏差5mm。 | 用2m托线板检查。 |\n| | 平整度 | 允许偏差8mm。 | 用2m靠尺和塞尺检查。 |\n| | 阴阳角方正 | 允许偏差8mm。 | 用直角检测尺检查。 |\n| | 墙面裂缝 | 结构墙面不得有裂缝，砌体墙面不得有通缝。 | 观察检查。 |\n| **高层** | 2-5-7-13号 | | |\n| **混凝土强度** | 混凝土强度 | 结构混凝土强度必须符合设计要求，不得出现露筋、蜂窝、麻面等缺陷。 | 结构实体检测。 |\n| **楼板厚度** | 楼板厚度 | 现浇楼板厚度允许偏差-5mm。 | 用尺量检查。 |\n| **电梯井** | 轴线尺寸 | 电梯井道内净尺寸允许偏差为+10mm~-0mm，电梯导轨预埋件中心线允许偏差±10mm。 | 经纬仪、尺量检查。 |\n| **外立面** | 外立面垂直度与平整度 | 外立面垂直度允许偏差±10mm，平整度允许偏差±8mm。 | 用经纬仪、2m靠尺和塞尺检查。 |\n| **外立面装饰** | 外立面装饰 | 颜色一致、无污染、无明显色差、无空鼓、无裂缝、无缺棱掉角。 | 观察、检查。 |\n\n**验收人签字：**  \n**日期：**\n```\n\n该表格主要记录了结构分部验收的各项标准、主要检验内容和检验方法，确保施工质量符合规范要求。"},"elapsed_time":27.251498766010627,"total_tokens":1072,"total_steps":4,"created_at":1740976490,"finished_at":1740976517}}
2025-03-03 12:35:19.898  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_4.png
2025-03-03 12:35:19.898  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_4.png, userId=system
2025-03-03 12:35:19.898 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:35:19.898 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:35:20.124  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=cadeaa73-1374-44f0-a6ec-8a78c33a478c
2025-03-03 12:35:20.125 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"cadeaa73-1374-44f0-a6ec-8a78c33a478c"}},"response_mode":"blocking","conversation_id":"9dc6f112-0efb-4f0f-b829-e33ceffcef65","user":"fyjw"}
2025-03-03 12:35:43.158 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"7659ef9f-cab2-4c5d-9dc1-1d392ba414c3","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片内容的Markdown格式转换：\n\n```markdown\n# 户型避讳\n\n| 产品类型 | 涉及楼栋/单元 | 户型避讳 | 规避建议 |\n|----------|--------------|----------|----------|\n| **高层** | 1幢2号 | 厨房正对入户门 | **B-1户型**：调整入户门方向，使其避开厨房正对（如条件允许，设置门厅过渡空间）。 |\n|          | 1幢3号 | 主卧进深过大，采光受限 | **B-1户型**：调整主卧尺寸，增加窗户面积或优化房间布局。 |\n|          | 2幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |\n|          | 2幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |\n|          | 3幢1号 | 主卧靠近电梯，噪音影响 | **B-1户型**：增加隔音措施，如加厚墙体或安装隔音门窗。 |\n|          | 3幢2号 | 次卧面积较小 | **B-1户型**：优化房间布局，提高空间利用率。 |\n|          | 3幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |\n|          | 3幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |\n|          | 4幢1号 | 主卧靠近电梯，噪音影响 | **B-1户型**：增加隔音措施，如加厚墙体或安装隔音门窗。 |\n|          | 4幢2号 | 次卧面积较小 | **B-1户型**：优化房间布局，提高空间利用率。 |\n|          | 4幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |\n|          | 4幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |\n\n---\n\n**备注：**\n- 本表针对高层住宅不同户型的结构问题提供规避建议。\n- 规避措施基于现有建筑设计可能的优化方案。\n- 具体调整需结合施工可行性进行方案优化。\n\n**签名：**\n![签名及盖章](#)\n```\n\n该表格清晰地列出了不同户型存在的问题，并提供了相应的规避建议，包括优化房间布局、调整窗户面积、增加隔音措施等。"},"elapsed_time":22.979406911879778,"total_tokens":1083,"total_steps":4,"created_at":1740976518,"finished_at":1740976541}
2025-03-03 12:35:43.158  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_4.png, text=以下是该图片内容的Markdown格式转换：

```markdown
# 户型避讳

| 产品类型 | 涉及楼栋/单元 | 户型避讳 | 规避建议 |
|----------|--------------|----------|----------|
| **高层** | 1幢2号 | 厨房正对入户门 | **B-1户型**：调整入户门方向，使其避开厨房正对（如条件允许，设置门厅过渡空间）。 |
|          | 1幢3号 | 主卧进深过大，采光受限 | **B-1户型**：调整主卧尺寸，增加窗户面积或优化房间布局。 |
|          | 2幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |
|          | 2幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |
|          | 3幢1号 | 主卧靠近电梯，噪音影响 | **B-1户型**：增加隔音措施，如加厚墙体或安装隔音门窗。 |
|          | 3幢2号 | 次卧面积较小 | **B-1户型**：优化房间布局，提高空间利用率。 |
|          | 3幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |
|          | 3幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |
|          | 4幢1号 | 主卧靠近电梯，噪音影响 | **B-1户型**：增加隔音措施，如加厚墙体或安装隔音门窗。 |
|          | 4幢2号 | 次卧面积较小 | **B-1户型**：优化房间布局，提高空间利用率。 |
|          | 4幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |
|          | 4幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |

---

**备注：**
- 本表针对高层住宅不同户型的结构问题提供规避建议。
- 规避措施基于现有建筑设计可能的优化方案。
- 具体调整需结合施工可行性进行方案优化。

**签名：**
![签名及盖章](#)
```

该表格清晰地列出了不同户型存在的问题，并提供了相应的规避建议，包括优化房间布局、调整窗户面积、增加隔音措施等。
2025-03-03 12:35:43.158 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c3875238-6ad9-417d-9eb0-b5ef48c5e5ef","workflow_run_id":"7659ef9f-cab2-4c5d-9dc1-1d392ba414c3","data":{"id":"7659ef9f-cab2-4c5d-9dc1-1d392ba414c3","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片内容的Markdown格式转换：\n\n```markdown\n# 户型避讳\n\n| 产品类型 | 涉及楼栋/单元 | 户型避讳 | 规避建议 |\n|----------|--------------|----------|----------|\n| **高层** | 1幢2号 | 厨房正对入户门 | **B-1户型**：调整入户门方向，使其避开厨房正对（如条件允许，设置门厅过渡空间）。 |\n|          | 1幢3号 | 主卧进深过大，采光受限 | **B-1户型**：调整主卧尺寸，增加窗户面积或优化房间布局。 |\n|          | 2幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |\n|          | 2幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |\n|          | 3幢1号 | 主卧靠近电梯，噪音影响 | **B-1户型**：增加隔音措施，如加厚墙体或安装隔音门窗。 |\n|          | 3幢2号 | 次卧面积较小 | **B-1户型**：优化房间布局，提高空间利用率。 |\n|          | 3幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |\n|          | 3幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |\n|          | 4幢1号 | 主卧靠近电梯，噪音影响 | **B-1户型**：增加隔音措施，如加厚墙体或安装隔音门窗。 |\n|          | 4幢2号 | 次卧面积较小 | **B-1户型**：优化房间布局，提高空间利用率。 |\n|          | 4幢5-7号 | 过道较长，空间利用率低 | **B-1户型**：优化过道设计，增加储物空间或使其兼具功能性。 |\n|          | 4幢8号 | 厨房采光较差 | **B-1户型**：增加厨房窗户面积或调整厨房位置。 |\n\n---\n\n**备注：**\n- 本表针对高层住宅不同户型的结构问题提供规避建议。\n- 规避措施基于现有建筑设计可能的优化方案。\n- 具体调整需结合施工可行性进行方案优化。\n\n**签名：**\n![签名及盖章](#)\n```\n\n该表格清晰地列出了不同户型存在的问题，并提供了相应的规避建议，包括优化房间布局、调整窗户面积、增加隔音措施等。"},"elapsed_time":22.979406911879778,"total_tokens":1083,"total_steps":4,"created_at":1740976518,"finished_at":1740976541}}
2025-03-03 12:35:43.828  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_5.png
2025-03-03 12:35:43.828  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_5.png, userId=system
2025-03-03 12:35:43.828 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:35:43.828 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:35:44.047  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=d617b1c4-f6ba-4326-b881-6e0f4d77ca57
2025-03-03 12:35:44.047 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"d617b1c4-f6ba-4326-b881-6e0f4d77ca57"}},"response_mode":"blocking","conversation_id":"253f1e00-52cb-4f09-be3f-9a3a18d2935c","user":"fyjw"}
2025-03-03 12:36:11.811 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"ea8c9c20-647c-47a2-b332-71b86aed46bc","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 6轴10-11号\n\n### 同楼层户型产品\n周围建筑围挡相对独立，可借外部顶层产品视线优势。  \n\n### 同楼层户型说明\n- **视野及景观**：  \n  - 6轴10号户型宽景阳台面宽达A3户型宽景阳台面宽，景观视野较好。  \n  - 6轴11号户型视野开阔，客厅及主卧均可享受较好景观资源。  \n\n- **日照及朝向**：  \n  - 6轴10号户型南北通透，采光及通风条件较好。  \n  - 6轴11号户型整体朝南，日照充足，居住舒适度较高。  \n\n- **功能及布局**：  \n  - 6轴10号户型功能分区明确，动静分离，居住私密性较好。  \n  - 6轴11号户型布局紧凑，空间利用率高，适合刚需客户。  \n\n---\n\n## 高层 5轴8-9号\n\n### 相邻情况\n- **相邻户型**：  \n  - 5轴8号、9号户型相邻，均为高层产品。  \n  - 相邻户型均为南北朝向，采光及通风条件较好。  \n\n### 相邻影响\n- **视野及景观**：  \n  - 两个户型均可享受较好景观视野，无遮挡。  \n  - 5轴8号户型客厅及主卧均享受较好景观资源。  \n\n- **日照及朝向**：  \n  - 5轴8号户型整体朝南，日照充足，居住舒适度较高。  \n  - 5轴9号户型南北通透，采光及通风条件较好。  \n\n- **功能及布局**：  \n  - 5轴8号户型动静分区明确，居住私密性较好。  \n  - 5轴9号户型布局紧凑，空间利用率高，适合刚需客户。  \n\n---\n\n## 7轴12号、15号 8轴13号\n\n### 同楼层户型产品\n周围建筑围挡相对独立，可借外部顶层产品视线优势。  \n\n### 同楼层户型说明\n- **视野及景观**：  \n  - 7轴12号、15号户型客厅及主卧均享受较好景观资源。  \n  - 8轴13号户型视野开阔，无遮挡，景观视野较好。  \n\n- **日照及朝向**：  \n  - 7轴12号、15号户型南北通透，采光及通风条件较好。  \n  - 8轴13号户型整体朝南，日照充足，居住舒适度较高。  \n\n- **功能及布局**：  \n  - 7轴12号、15号户型功能分区明确，动静分离，居住私密性较好。  \n  - 8轴13号户型布局紧凑，空间利用率高，适合刚需客户。  \n\n---\n\n### 三层户型说明\n三层户型产品结构及户型开发较特殊。\n\n---\n\n**客户签名：**  \n（印章）\n\n---\n\n以上是图片中的文字内容转换为Markdown格式，确保了结构清晰，易于阅读。"},"elapsed_time":27.72028131596744,"total_tokens":1204,"total_steps":4,"created_at":1740976542,"finished_at":1740976570}
2025-03-03 12:36:11.811  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_5.png, text=以下是图片中的文字内容转换为Markdown格式：

---

## 6轴10-11号

### 同楼层户型产品
周围建筑围挡相对独立，可借外部顶层产品视线优势。  

### 同楼层户型说明
- **视野及景观**：  
  - 6轴10号户型宽景阳台面宽达A3户型宽景阳台面宽，景观视野较好。  
  - 6轴11号户型视野开阔，客厅及主卧均可享受较好景观资源。  

- **日照及朝向**：  
  - 6轴10号户型南北通透，采光及通风条件较好。  
  - 6轴11号户型整体朝南，日照充足，居住舒适度较高。  

- **功能及布局**：  
  - 6轴10号户型功能分区明确，动静分离，居住私密性较好。  
  - 6轴11号户型布局紧凑，空间利用率高，适合刚需客户。  

---

## 高层 5轴8-9号

### 相邻情况
- **相邻户型**：  
  - 5轴8号、9号户型相邻，均为高层产品。  
  - 相邻户型均为南北朝向，采光及通风条件较好。  

### 相邻影响
- **视野及景观**：  
  - 两个户型均可享受较好景观视野，无遮挡。  
  - 5轴8号户型客厅及主卧均享受较好景观资源。  

- **日照及朝向**：  
  - 5轴8号户型整体朝南，日照充足，居住舒适度较高。  
  - 5轴9号户型南北通透，采光及通风条件较好。  

- **功能及布局**：  
  - 5轴8号户型动静分区明确，居住私密性较好。  
  - 5轴9号户型布局紧凑，空间利用率高，适合刚需客户。  

---

## 7轴12号、15号 8轴13号

### 同楼层户型产品
周围建筑围挡相对独立，可借外部顶层产品视线优势。  

### 同楼层户型说明
- **视野及景观**：  
  - 7轴12号、15号户型客厅及主卧均享受较好景观资源。  
  - 8轴13号户型视野开阔，无遮挡，景观视野较好。  

- **日照及朝向**：  
  - 7轴12号、15号户型南北通透，采光及通风条件较好。  
  - 8轴13号户型整体朝南，日照充足，居住舒适度较高。  

- **功能及布局**：  
  - 7轴12号、15号户型功能分区明确，动静分离，居住私密性较好。  
  - 8轴13号户型布局紧凑，空间利用率高，适合刚需客户。  

---

### 三层户型说明
三层户型产品结构及户型开发较特殊。

---

**客户签名：**  
（印章）

---

以上是图片中的文字内容转换为Markdown格式，确保了结构清晰，易于阅读。
2025-03-03 12:36:11.812 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"9a28d30a-6d07-41b4-a8ea-2e690996d029","workflow_run_id":"ea8c9c20-647c-47a2-b332-71b86aed46bc","data":{"id":"ea8c9c20-647c-47a2-b332-71b86aed46bc","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 6轴10-11号\n\n### 同楼层户型产品\n周围建筑围挡相对独立，可借外部顶层产品视线优势。  \n\n### 同楼层户型说明\n- **视野及景观**：  \n  - 6轴10号户型宽景阳台面宽达A3户型宽景阳台面宽，景观视野较好。  \n  - 6轴11号户型视野开阔，客厅及主卧均可享受较好景观资源。  \n\n- **日照及朝向**：  \n  - 6轴10号户型南北通透，采光及通风条件较好。  \n  - 6轴11号户型整体朝南，日照充足，居住舒适度较高。  \n\n- **功能及布局**：  \n  - 6轴10号户型功能分区明确，动静分离，居住私密性较好。  \n  - 6轴11号户型布局紧凑，空间利用率高，适合刚需客户。  \n\n---\n\n## 高层 5轴8-9号\n\n### 相邻情况\n- **相邻户型**：  \n  - 5轴8号、9号户型相邻，均为高层产品。  \n  - 相邻户型均为南北朝向，采光及通风条件较好。  \n\n### 相邻影响\n- **视野及景观**：  \n  - 两个户型均可享受较好景观视野，无遮挡。  \n  - 5轴8号户型客厅及主卧均享受较好景观资源。  \n\n- **日照及朝向**：  \n  - 5轴8号户型整体朝南，日照充足，居住舒适度较高。  \n  - 5轴9号户型南北通透，采光及通风条件较好。  \n\n- **功能及布局**：  \n  - 5轴8号户型动静分区明确，居住私密性较好。  \n  - 5轴9号户型布局紧凑，空间利用率高，适合刚需客户。  \n\n---\n\n## 7轴12号、15号 8轴13号\n\n### 同楼层户型产品\n周围建筑围挡相对独立，可借外部顶层产品视线优势。  \n\n### 同楼层户型说明\n- **视野及景观**：  \n  - 7轴12号、15号户型客厅及主卧均享受较好景观资源。  \n  - 8轴13号户型视野开阔，无遮挡，景观视野较好。  \n\n- **日照及朝向**：  \n  - 7轴12号、15号户型南北通透，采光及通风条件较好。  \n  - 8轴13号户型整体朝南，日照充足，居住舒适度较高。  \n\n- **功能及布局**：  \n  - 7轴12号、15号户型功能分区明确，动静分离，居住私密性较好。  \n  - 8轴13号户型布局紧凑，空间利用率高，适合刚需客户。  \n\n---\n\n### 三层户型说明\n三层户型产品结构及户型开发较特殊。\n\n---\n\n**客户签名：**  \n（印章）\n\n---\n\n以上是图片中的文字内容转换为Markdown格式，确保了结构清晰，易于阅读。"},"elapsed_time":27.72028131596744,"total_tokens":1204,"total_steps":4,"created_at":1740976542,"finished_at":1740976570}}
2025-03-03 12:36:12.468  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_6.png
2025-03-03 12:36:12.468  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_6.png, userId=system
2025-03-03 12:36:12.468 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:36:12.468 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:36:12.631  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=9a638f3a-27a3-4c9b-bc73-a5d673c33d9e
2025-03-03 12:36:12.631 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"9a638f3a-27a3-4c9b-bc73-a5d673c33d9e"}},"response_mode":"blocking","conversation_id":"3d77c347-9c61-4224-ac46-cfe70a91eddb","user":"fyjw"}
2025-03-03 12:36:33.809  INFO 32320 --- [pool-2-thread-17] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740976275}
2025-03-03 12:36:33.809  INFO 32320 --- [pool-2-thread-16] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740976276}
2025-03-03 12:36:33.835 DEBUG 32320 --- [pool-2-thread-16] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 12:36:33.835 DEBUG 32320 --- [pool-2-thread-16] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:33.861 DEBUG 32320 --- [pool-2-thread-16] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 12:36:33.863 DEBUG 32320 --- [pool-2-thread-16] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:33.863 DEBUG 32320 --- [pool-2-thread-16] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:33.887 DEBUG 32320 --- [pool-2-thread-16] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:36.808 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"6a427a21-40d8-436e-9f0e-b238f4bef686","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 相关情况  \n\n7幢12层、15层、18层6-7号轴南侧小区大门入口；7幢12层、15层南侧阳台栏板底部；8幢16层南侧阳台栏板底部；9幢6层、9层、12层、15层、18层、21层、24层南侧阳台栏板底部。\n\n---\n\n# 图  纸  \n\n### 施工及竣工图纸相符，现场实际施工情况及观测分析  \n- **办公楼**：办公楼东南角屋面女儿墙底部裂缝。  \n- **7号楼**：12层、15层、18层6-7号轴南侧小区大门入口；7幢12层、15层南侧阳台栏板底部。  \n- **8号楼**：16层南侧阳台栏板底部。  \n- **9号楼**：6层、9层、12层、15层、18层、21层、24层南侧阳台栏板底部。  \n\n**注**：7号楼女儿墙裂缝宽度约为0.15mm，8号楼裂缝宽度约为0.15mm，9号楼裂缝宽度约为0.15mm。  \n\n---\n\n# 其他  \n\n**特别说明**：上述裂缝均为次要裂缝。  \n\n经现场调查和分析，上述裂缝对结构安全无影响，裂缝均位于建筑物次要构件，未发现明显发展趋势，建议对裂缝进行表面封闭处理，以防止水渗入影响结构耐久性。  \n\n另为严谨起见，受买人可委托有资质的检测单位对本项目裂缝进行检测，以获得更详细的裂缝信息并作进一步处理建议。  \n\n---\n\n# 签字确认  \n\n**受买人签字**：  \n日期： **20** 年 **8** 月 **20** 日  \n\n**公司盖章及签字**：  \n（盖章及签字处）  \n\n---\n\n该文件主要描述了建筑物的裂缝情况，并对其影响和处理建议进行了说明，同时提供了签字确认的部分。"},"elapsed_time":24.132012255024165,"total_tokens":916,"total_steps":4,"created_at":1740976570,"finished_at":1740976595}
2025-03-03 12:36:36.809  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_6.png, text=以下是图片中的文字内容转换为Markdown格式：

---

# 相关情况  

7幢12层、15层、18层6-7号轴南侧小区大门入口；7幢12层、15层南侧阳台栏板底部；8幢16层南侧阳台栏板底部；9幢6层、9层、12层、15层、18层、21层、24层南侧阳台栏板底部。

---

# 图  纸  

### 施工及竣工图纸相符，现场实际施工情况及观测分析  
- **办公楼**：办公楼东南角屋面女儿墙底部裂缝。  
- **7号楼**：12层、15层、18层6-7号轴南侧小区大门入口；7幢12层、15层南侧阳台栏板底部。  
- **8号楼**：16层南侧阳台栏板底部。  
- **9号楼**：6层、9层、12层、15层、18层、21层、24层南侧阳台栏板底部。  

**注**：7号楼女儿墙裂缝宽度约为0.15mm，8号楼裂缝宽度约为0.15mm，9号楼裂缝宽度约为0.15mm。  

---

# 其他  

**特别说明**：上述裂缝均为次要裂缝。  

经现场调查和分析，上述裂缝对结构安全无影响，裂缝均位于建筑物次要构件，未发现明显发展趋势，建议对裂缝进行表面封闭处理，以防止水渗入影响结构耐久性。  

另为严谨起见，受买人可委托有资质的检测单位对本项目裂缝进行检测，以获得更详细的裂缝信息并作进一步处理建议。  

---

# 签字确认  

**受买人签字**：  
日期： **20** 年 **8** 月 **20** 日  

**公司盖章及签字**：  
（盖章及签字处）  

---

该文件主要描述了建筑物的裂缝情况，并对其影响和处理建议进行了说明，同时提供了签字确认的部分。
2025-03-03 12:36:36.809 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6b151fa0-70ee-4cb5-9254-617478b2ef7e","workflow_run_id":"6a427a21-40d8-436e-9f0e-b238f4bef686","data":{"id":"6a427a21-40d8-436e-9f0e-b238f4bef686","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 相关情况  \n\n7幢12层、15层、18层6-7号轴南侧小区大门入口；7幢12层、15层南侧阳台栏板底部；8幢16层南侧阳台栏板底部；9幢6层、9层、12层、15层、18层、21层、24层南侧阳台栏板底部。\n\n---\n\n# 图  纸  \n\n### 施工及竣工图纸相符，现场实际施工情况及观测分析  \n- **办公楼**：办公楼东南角屋面女儿墙底部裂缝。  \n- **7号楼**：12层、15层、18层6-7号轴南侧小区大门入口；7幢12层、15层南侧阳台栏板底部。  \n- **8号楼**：16层南侧阳台栏板底部。  \n- **9号楼**：6层、9层、12层、15层、18层、21层、24层南侧阳台栏板底部。  \n\n**注**：7号楼女儿墙裂缝宽度约为0.15mm，8号楼裂缝宽度约为0.15mm，9号楼裂缝宽度约为0.15mm。  \n\n---\n\n# 其他  \n\n**特别说明**：上述裂缝均为次要裂缝。  \n\n经现场调查和分析，上述裂缝对结构安全无影响，裂缝均位于建筑物次要构件，未发现明显发展趋势，建议对裂缝进行表面封闭处理，以防止水渗入影响结构耐久性。  \n\n另为严谨起见，受买人可委托有资质的检测单位对本项目裂缝进行检测，以获得更详细的裂缝信息并作进一步处理建议。  \n\n---\n\n# 签字确认  \n\n**受买人签字**：  \n日期： **20** 年 **8** 月 **20** 日  \n\n**公司盖章及签字**：  \n（盖章及签字处）  \n\n---\n\n该文件主要描述了建筑物的裂缝情况，并对其影响和处理建议进行了说明，同时提供了签字确认的部分。"},"elapsed_time":24.132012255024165,"total_tokens":916,"total_steps":4,"created_at":1740976570,"finished_at":1740976595}}
2025-03-03 12:36:36.810 DEBUG 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:36:36.810  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=null, fileName=6-《臻心公告 特别告知书》.pdf, fileSize=14356
2025-03-03 12:36:36.810 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/null/document/create-by-file, fileName=6-《臻心公告 特别告知书》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:36:36.837 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:135) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:512) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:36:36.837 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 6-《臻心公告 特别告知书》.pdf
2025-03-03 12:36:36.861 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:36.861 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:36.886 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:37.008 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:36:37.009 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:37.009 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:37.031 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:37.308 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:36:37.309 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:37.310 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:37.332 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:37.461 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:36:37.462 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:37.462 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:37.488 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:37.611 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:36:37.611  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=VyUqfdiAQluC2hdYzDPcAwHFnKh, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 12:36:38.047  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897730","modified_time":"1740897731","name":"8-《臻心公告 项目周边环境因素提示》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"VyUqfdiAQluC2hdYzDPcAwHFnKh","token":"IR3Gbp9TIoNgZUxDxPBcR5PonLf","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/IR3Gbp9TIoNgZUxDxPBcR5PonLf"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,49,34,44,34,110,97,109,101,34,58,34,56,45,-29,-128,-118,-24,-121,-69,-27,-65,-125,-27,-123,-84,-27,-111,-118,32,-23,-95,-71,-25,-101,-82,-27,-111,-88,-24,-66,-71,-25,-114,-81,-27,-94,-125,-27,-101,-96,-25,-76,-96,-26,-113,-112,-25,-92,-70,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,86,121,85,113,102,100,105,65,81,108,117,67,50,104,100,89,122,68,80,99,65,119,72,70,110,75,104,34,44,34,116,111,107,101,110,34,58,34,73,82,51,71,98,112,57,84,73,111,78,103,90,85,120,68,120,80,66,99,82,53,80,111,110,76,102,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,82,51,71,98,112,57,84,73,111,78,103,90,85,120,68,120,80,66,99,82,53,80,111,110,76,102,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:36:36 GMT"],"eagleid":["1bde141e17409765958917654e"],"request-id":["d1bbd348-1d33-4bd2-91c3-b66c40a4b9c3"],"server":["Tengine"],"server-timing":["inner; dur=377","cdn-cache;desc=MISS,edge;dur=0,origin;dur=411"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache26.cn6725[411,0]"],"x-lgw-dst-svc":["-MwTsTRA-gaYp0hdD9DJXBAAuWcO3AJy1zCVkTZ4nDtxlpdceOMarzgBB6chVZfOjtWp4onnWFQ1yEwPhee9oGrMsXJy36dp0yQxfxeXFGz6vOfOEFuxyFEO73zHu1RNBs5c7Z15ma0mF3qwRf7VRz0bjKAn4HYX_iFjA23ftgAJbSZOomXy-lSWALnpmg7122riZyELi4th8IaVGF2I1BEIJSzNkKpopb8d1SMkgi4NN0L7DYCNjXO9PmSZnSzlrn2jdOI8li5u5H1YdbU6aVbR-CqIG3d2N9wj4htvxWa95U9p5QulOoE="],"x-request-id":["d1bbd348-1d33-4bd2-91c3-b66c40a4b9c3"],"x-timestamp":["1740976596.288"],"x-tt-logid":["202503031236358974730924FF06E0BC10"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e98336b807cf016fe1ab9d28ba3f14d9528e692ebd96247534371b396a0232b08c2e85d7166cac04f292231c6b78e3cb71872231002d0b07c03e6e4fc57ddfc9484a496f64e2bb5929a97aae66a392ce1a0"],"x-tt-trace-id":["00-2503031236358974730924FF06E0BC10-2D50D1545BD4D21C-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031236358974730924FF06E0BC10","statusCode":200},"request":{"folder_token":"VyUqfdiAQluC2hdYzDPcAwHFnKh"},"requestId":"202503031236358974730924FF06E0BC10"}
2025-03-03 12:36:38.047  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=IR3Gbp9TIoNgZUxDxPBcR5PonLf, fileName=8-《臻心公告 项目周边环境因素提示》.pdf, fileType=file, fileSize=null, createTime=1740897730, updateTime=1740897731)]
2025-03-03 12:36:38.536  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 12:36:38.560 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:38.561 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:38.584 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:38.745 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:36:38.746  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 12:36:38.746  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf, userId=system
2025-03-03 12:36:38.746 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:36:38.746 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:36:38.871  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=bebee452-b6dd-48e9-8b9e-81e7bc639a78
2025-03-03 12:36:38.871 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"bebee452-b6dd-48e9-8b9e-81e7bc639a78"}},"response_mode":"blocking","conversation_id":"54efede7-95f1-4e89-b61b-41d90dbe66e4","user":"fyjw"}
2025-03-03 12:36:38.900 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:36:38.900  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 12:36:38.902 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:36:38.902 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:36:38.925 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:36:39.050 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:36:39.745  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_0.png
2025-03-03 12:36:39.745  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_0.png, userId=system
2025-03-03 12:36:39.745 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:36:39.745 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:36:40.064  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=5ae2916b-b354-43ee-8622-18bd2f9fa552
2025-03-03 12:36:40.064 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"5ae2916b-b354-43ee-8622-18bd2f9fa552"}},"response_mode":"blocking","conversation_id":"6b800251-03eb-4f14-87fd-29aaae667abb","user":"fyjw"}
2025-03-03 12:37:07.495 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d9bf4f11-3c2a-459d-b0aa-4b0353e2b04a","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n# 通告公示  \n## 项目周边环境规划情况\n\n**南太湖金融城 天幕街项目**（指“名力综合体裙房”，以下简称“本项目”）\n\n---\n\n### 周边环境规划情况  \n\n| 序号 | 周边环境规划情况 | 周边项目具体情况 |\n|------|-----------------|------------------|\n| 1 | 规划行政办公用地 | 规划行政办公用地 |\n| 2 | 规划居住用地 | 太湖新城居住地块，地块编号：南太湖新区LH-10-03-01，规划用途：居住用地，容积率：2.5，建筑密度：30%，建筑高度：80米 |\n| 3 | 规划教育用地 | 规划教育用地 |\n| 4 | 规划商业用地 | 26-01地块为规划商业金融用地， 25-01地块为本项目所在地，规划用途：商业金融用地 |\n| 5 | 规划绿地 | 200米范围内有规划绿地 |\n| 6 | 200米-500米 | 周边环境规划功能完善 |\n\n**附图说明**：图中标识的“25-01”地块即为本项目所在地，周边环境规划情况如表所示。\n\n（图片右下方有签名）\n\n---\n\n请注意，该转换基于图片中的文字内容，表格格式已按Markdown格式调整。"},"elapsed_time":27.38926416193135,"total_tokens":728,"total_steps":4,"created_at":1740976598,"finished_at":1740976625}
2025-03-03 12:37:07.495  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_0.png, text=以下是该图片中的文字内容转换为Markdown格式：

---

# 通告公示  
## 项目周边环境规划情况

**南太湖金融城 天幕街项目**（指“名力综合体裙房”，以下简称“本项目”）

---

### 周边环境规划情况  

| 序号 | 周边环境规划情况 | 周边项目具体情况 |
|------|-----------------|------------------|
| 1 | 规划行政办公用地 | 规划行政办公用地 |
| 2 | 规划居住用地 | 太湖新城居住地块，地块编号：南太湖新区LH-10-03-01，规划用途：居住用地，容积率：2.5，建筑密度：30%，建筑高度：80米 |
| 3 | 规划教育用地 | 规划教育用地 |
| 4 | 规划商业用地 | 26-01地块为规划商业金融用地， 25-01地块为本项目所在地，规划用途：商业金融用地 |
| 5 | 规划绿地 | 200米范围内有规划绿地 |
| 6 | 200米-500米 | 周边环境规划功能完善 |

**附图说明**：图中标识的“25-01”地块即为本项目所在地，周边环境规划情况如表所示。

（图片右下方有签名）

---

请注意，该转换基于图片中的文字内容，表格格式已按Markdown格式调整。
2025-03-03 12:37:07.497 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6fb534e0-f292-4964-902d-3aa0dc7b0344","workflow_run_id":"d9bf4f11-3c2a-459d-b0aa-4b0353e2b04a","data":{"id":"d9bf4f11-3c2a-459d-b0aa-4b0353e2b04a","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n# 通告公示  \n## 项目周边环境规划情况\n\n**南太湖金融城 天幕街项目**（指“名力综合体裙房”，以下简称“本项目”）\n\n---\n\n### 周边环境规划情况  \n\n| 序号 | 周边环境规划情况 | 周边项目具体情况 |\n|------|-----------------|------------------|\n| 1 | 规划行政办公用地 | 规划行政办公用地 |\n| 2 | 规划居住用地 | 太湖新城居住地块，地块编号：南太湖新区LH-10-03-01，规划用途：居住用地，容积率：2.5，建筑密度：30%，建筑高度：80米 |\n| 3 | 规划教育用地 | 规划教育用地 |\n| 4 | 规划商业用地 | 26-01地块为规划商业金融用地， 25-01地块为本项目所在地，规划用途：商业金融用地 |\n| 5 | 规划绿地 | 200米范围内有规划绿地 |\n| 6 | 200米-500米 | 周边环境规划功能完善 |\n\n**附图说明**：图中标识的“25-01”地块即为本项目所在地，周边环境规划情况如表所示。\n\n（图片右下方有签名）\n\n---\n\n请注意，该转换基于图片中的文字内容，表格格式已按Markdown格式调整。"},"elapsed_time":27.38926416193135,"total_tokens":728,"total_steps":4,"created_at":1740976598,"finished_at":1740976625}}
2025-03-03 12:37:08.054  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_1.png
2025-03-03 12:37:08.055  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_1.png, userId=system
2025-03-03 12:37:08.055 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:37:08.055 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:37:08.174  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ea95c473-b579-426d-a6b9-bb71d0566ac6
2025-03-03 12:37:08.174 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"ea95c473-b579-426d-a6b9-bb71d0566ac6"}},"response_mode":"blocking","conversation_id":"45fa2034-ac4f-4059-8628-04fbdf4a2666","user":"fyjw"}
2025-03-03 12:37:24.986 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"80433d65-e432-4df2-bae4-c85216a9bcef","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n以上合同由出让人依据 2022 年 7 月及其后的国际应用法规、政策以及文件编撰，  \n并已经过出让人的律师审阅并根据其内容提供适当的修改、意见和建议。  \n出让人及其律师不对合同的适用性、可执行性或法律后果承担任何责任。  \n受让人应自行聘请律师对合同进行审阅，并就合同的法律适用性、可执行性以及法律后果寻求专业法律意见。  \n出让人无权提供任何法律意见，亦不会就合同条款的解释或执行提供任何保证。  \n\n---\n\n**受让人签字：**  \n（签名）  \n**日期：** 2022 年 8 月 22 日  \n\n---\n\n**滴水湖金融湾 天幕苑**  \n**建筑招商及独立产权井 签约结约书**  \n\n（签名）  \n\n---\n\n以上是图片中的主要文字内容，以Markdown格式呈现。"},"elapsed_time":16.772953727981076,"total_tokens":628,"total_steps":4,"created_at":1740976626,"finished_at":1740976643}
2025-03-03 12:37:24.986  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

以上合同由出让人依据 2022 年 7 月及其后的国际应用法规、政策以及文件编撰，  
并已经过出让人的律师审阅并根据其内容提供适当的修改、意见和建议。  
出让人及其律师不对合同的适用性、可执行性或法律后果承担任何责任。  
受让人应自行聘请律师对合同进行审阅，并就合同的法律适用性、可执行性以及法律后果寻求专业法律意见。  
出让人无权提供任何法律意见，亦不会就合同条款的解释或执行提供任何保证。  

---

**受让人签字：**  
（签名）  
**日期：** 2022 年 8 月 22 日  

---

**滴水湖金融湾 天幕苑**  
**建筑招商及独立产权井 签约结约书**  

（签名）  

---

以上是图片中的主要文字内容，以Markdown格式呈现。
2025-03-03 12:37:24.986 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"acdd084e-1df1-4e8f-931e-3dcef854cdaf","workflow_run_id":"80433d65-e432-4df2-bae4-c85216a9bcef","data":{"id":"80433d65-e432-4df2-bae4-c85216a9bcef","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n以上合同由出让人依据 2022 年 7 月及其后的国际应用法规、政策以及文件编撰，  \n并已经过出让人的律师审阅并根据其内容提供适当的修改、意见和建议。  \n出让人及其律师不对合同的适用性、可执行性或法律后果承担任何责任。  \n受让人应自行聘请律师对合同进行审阅，并就合同的法律适用性、可执行性以及法律后果寻求专业法律意见。  \n出让人无权提供任何法律意见，亦不会就合同条款的解释或执行提供任何保证。  \n\n---\n\n**受让人签字：**  \n（签名）  \n**日期：** 2022 年 8 月 22 日  \n\n---\n\n**滴水湖金融湾 天幕苑**  \n**建筑招商及独立产权井 签约结约书**  \n\n（签名）  \n\n---\n\n以上是图片中的主要文字内容，以Markdown格式呈现。"},"elapsed_time":16.772953727981076,"total_tokens":628,"total_steps":4,"created_at":1740976626,"finished_at":1740976643}}
2025-03-03 12:37:25.611  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_2.png
2025-03-03 12:37:25.611  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_2.png, userId=system
2025-03-03 12:37:25.611 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:37:25.611 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:37:25.823  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=0a190964-ab17-4f9d-8633-4b51daf17915
2025-03-03 12:37:25.823 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"0a190964-ab17-4f9d-8633-4b51daf17915"}},"response_mode":"blocking","conversation_id":"124b359c-f9a7-41b6-90fb-918d032609d8","user":"fyjw"}
2025-03-03 12:37:54.627 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"52783940-f909-4084-9c51-2af3a59504da","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n感谢您认可、选择本设备品牌**天津某某某项目（推广“立方体整屋”以下简称“本项目”）**的商品，请您特别留意以下事项：\n\n1. 本项目涉及的设备为定制化商品，因设备涉及板材、五金、玻璃、石材、灯光等多种定制类产品，因现场、异地运输等影响存在涂层、饰面、玻璃、五金等细小瑕疵，敬请理解。\n2. 本项目设备安装工序：\n   - 1-1 步：设备吊装进场\n   - 1-2 步：基础固定（设备找正及固定）\n   - 1-3 步：设备拼装\n   - 1-4 步：设备调试\n   - 1-5 步：验收交付\n3. 设备基础固定后，建议客户提前做好101对接后续设备、墙地砖收口及吊顶收口。\n4. 设备拼装需2-3名拼装技师操作。\n5. 设备拼装周期与设备数量、施工环境、对接设备情况有关，预计拼装周期为：\n   - 5-1 步：单台设备拼装周期4-8小时\n   - 5-2 步：拼装周期受拼装技师数量影响\n6. 设备调试阶段可结合客户需求调整设备参数。\n7. 设备调试阶段需客户提供：\n   - 7-1 步：220V电源\n   - 7-2 步：进出水接口\n   - 7-3 步：设备对接设备接口\n   - 7-4 步：客户使用需求说明\n8. 设备调试完成后进行验收交付，客户需签署《设备验收确认单》。\n9. 设备验收交付后，本项目提供：\n   - 9-1 步：设备使用培训\n   - 9-2 步：设备维护培训\n   - 9-3 步：设备保养建议\n10. 设备售后服务：\n    - 10-1 步：售后服务响应时间24小时内\n    - 10-2 步：维修周期受配件供应情况影响\n    - 10-3 步：售后服务电话：XXX-XXXXXXXX\n\n**以上事项敬请客户知悉，并对设备安装及使用过程中存在的问题提前做好安排，感谢您的支持！**\n\n签字确认：\n  \n**客户签字：**  \n**日期：** 2022年08月20日\n\n---\n\n此文本已完整转换为Markdown格式，保留了原文的结构和内容。"},"elapsed_time":28.753472296055406,"total_tokens":1013,"total_steps":4,"created_at":1740976644,"finished_at":1740976672}
2025-03-03 12:37:54.628  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_2.png, text=以下是图片中的文字内容转换为Markdown格式：

---

感谢您认可、选择本设备品牌**天津某某某项目（推广“立方体整屋”以下简称“本项目”）**的商品，请您特别留意以下事项：

1. 本项目涉及的设备为定制化商品，因设备涉及板材、五金、玻璃、石材、灯光等多种定制类产品，因现场、异地运输等影响存在涂层、饰面、玻璃、五金等细小瑕疵，敬请理解。
2. 本项目设备安装工序：
   - 1-1 步：设备吊装进场
   - 1-2 步：基础固定（设备找正及固定）
   - 1-3 步：设备拼装
   - 1-4 步：设备调试
   - 1-5 步：验收交付
3. 设备基础固定后，建议客户提前做好101对接后续设备、墙地砖收口及吊顶收口。
4. 设备拼装需2-3名拼装技师操作。
5. 设备拼装周期与设备数量、施工环境、对接设备情况有关，预计拼装周期为：
   - 5-1 步：单台设备拼装周期4-8小时
   - 5-2 步：拼装周期受拼装技师数量影响
6. 设备调试阶段可结合客户需求调整设备参数。
7. 设备调试阶段需客户提供：
   - 7-1 步：220V电源
   - 7-2 步：进出水接口
   - 7-3 步：设备对接设备接口
   - 7-4 步：客户使用需求说明
8. 设备调试完成后进行验收交付，客户需签署《设备验收确认单》。
9. 设备验收交付后，本项目提供：
   - 9-1 步：设备使用培训
   - 9-2 步：设备维护培训
   - 9-3 步：设备保养建议
10. 设备售后服务：
    - 10-1 步：售后服务响应时间24小时内
    - 10-2 步：维修周期受配件供应情况影响
    - 10-3 步：售后服务电话：XXX-XXXXXXXX

**以上事项敬请客户知悉，并对设备安装及使用过程中存在的问题提前做好安排，感谢您的支持！**

签字确认：
  
**客户签字：**  
**日期：** 2022年08月20日

---

此文本已完整转换为Markdown格式，保留了原文的结构和内容。
2025-03-03 12:37:54.628 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"8878924c-9dff-4927-a4e1-cc15d374c032","workflow_run_id":"52783940-f909-4084-9c51-2af3a59504da","data":{"id":"52783940-f909-4084-9c51-2af3a59504da","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n感谢您认可、选择本设备品牌**天津某某某项目（推广“立方体整屋”以下简称“本项目”）**的商品，请您特别留意以下事项：\n\n1. 本项目涉及的设备为定制化商品，因设备涉及板材、五金、玻璃、石材、灯光等多种定制类产品，因现场、异地运输等影响存在涂层、饰面、玻璃、五金等细小瑕疵，敬请理解。\n2. 本项目设备安装工序：\n   - 1-1 步：设备吊装进场\n   - 1-2 步：基础固定（设备找正及固定）\n   - 1-3 步：设备拼装\n   - 1-4 步：设备调试\n   - 1-5 步：验收交付\n3. 设备基础固定后，建议客户提前做好101对接后续设备、墙地砖收口及吊顶收口。\n4. 设备拼装需2-3名拼装技师操作。\n5. 设备拼装周期与设备数量、施工环境、对接设备情况有关，预计拼装周期为：\n   - 5-1 步：单台设备拼装周期4-8小时\n   - 5-2 步：拼装周期受拼装技师数量影响\n6. 设备调试阶段可结合客户需求调整设备参数。\n7. 设备调试阶段需客户提供：\n   - 7-1 步：220V电源\n   - 7-2 步：进出水接口\n   - 7-3 步：设备对接设备接口\n   - 7-4 步：客户使用需求说明\n8. 设备调试完成后进行验收交付，客户需签署《设备验收确认单》。\n9. 设备验收交付后，本项目提供：\n   - 9-1 步：设备使用培训\n   - 9-2 步：设备维护培训\n   - 9-3 步：设备保养建议\n10. 设备售后服务：\n    - 10-1 步：售后服务响应时间24小时内\n    - 10-2 步：维修周期受配件供应情况影响\n    - 10-3 步：售后服务电话：XXX-XXXXXXXX\n\n**以上事项敬请客户知悉，并对设备安装及使用过程中存在的问题提前做好安排，感谢您的支持！**\n\n签字确认：\n  \n**客户签字：**  \n**日期：** 2022年08月20日\n\n---\n\n此文本已完整转换为Markdown格式，保留了原文的结构和内容。"},"elapsed_time":28.753472296055406,"total_tokens":1013,"total_steps":4,"created_at":1740976644,"finished_at":1740976672}}
2025-03-03 12:37:54.630 DEBUG 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:37:54.630  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=null, fileName=8-《臻心公告 项目周边环境因素提示》.pdf, fileSize=4078
2025-03-03 12:37:54.630 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/null/document/create-by-file, fileName=8-《臻心公告 项目周边环境因素提示》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:37:54.664 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:135) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:512) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:37:54.664 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 12:37:54.692 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:37:54.693 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:37:54.715 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:37:54.912 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:37:54.915 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:37:54.915 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:37:54.940 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:37:55.083 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:37:55.084 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:37:55.085 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:37:55.107 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:37:55.284 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:37:55.287 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:37:55.287 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:37:55.311 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:37:55.445 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:37:55.445  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=Lz5nfmsp1l69DsdvznwcnMcOnbb, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 12:37:55.885  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897718","modified_time":"1740897719","name":"5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Lz5nfmsp1l69DsdvznwcnMcOnbb","token":"IvxCbBjEHo7mRsxXcWScjtwcnld","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/IvxCbBjEHo7mRsxXcWScjtwcnld"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,49,56,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,49,57,34,44,34,110,97,109,101,34,58,34,53,45,-29,-128,-118,-26,-69,-76,-26,-80,-76,-26,-71,-106,-23,-121,-111,-24,-98,-115,-26,-71,-66,32,-27,-92,-87,-24,-66,-119,-24,-117,-111,32,-26,-120,-73,-27,-98,-117,-27,-101,-66,-27,-113,-118,-26,-91,-68,-26,-96,-117,-26,-120,-73,-27,-98,-117,-27,-120,-122,-27,-72,-125,-24,-95,-88,32,-25,-83,-66,-25,-70,-90,-27,-111,-118,-25,-97,-91,-28,-71,-90,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,76,122,53,110,102,109,115,112,49,108,54,57,68,115,100,118,122,110,119,99,110,77,99,79,110,98,98,34,44,34,116,111,107,101,110,34,58,34,73,118,120,67,98,66,106,69,72,111,55,109,82,115,120,88,99,87,83,99,106,116,119,99,110,108,100,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,118,120,67,98,66,106,69,72,111,55,109,82,115,120,88,99,87,83,99,106,116,119,99,110,108,100,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 04:37:54 GMT"],"eagleid":["1bde141e17409766737252217e"],"request-id":["e3646b92-6a7a-4e4a-9a1a-a72096146585"],"server":["Tengine"],"server-timing":["inner; dur=398","cdn-cache;desc=MISS,edge;dur=0,origin;dur=417"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache26.cn6725[417,0]"],"x-lgw-dst-svc":["Qnp6BnW7q_2pmTET4PHKGP6rC8nxuxRIssB3iQ5z8W6kgPal385IIXyOA6UunbE-MUkYdyPLyMmG1zMZ04uaZYPxTzc8nmHgOGpEPReL5L3ZpKhElHUTybT_8hQyewH7_lGYm4rCtnWwIEzgvxLOe7FfrIxLkXjoZLwPHtdRx0ku7kNpp3zZPEyhqLWx5Jb5kIq7kHDAjhvohRZik_jlfSW-KMxiBvlThy5eIv-2FiUqMi99W6lnorqX2LqqtlxGG3xVdTR5vzXGJ8e1ZiBNsc_imtzMTW7_iO6GFUUzfBO4YzVfC7jz3SY="],"x-request-id":["e3646b92-6a7a-4e4a-9a1a-a72096146585"],"x-timestamp":["1740976674.135"],"x-tt-logid":["202503031237533DA472D195D07BEAE49E"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e9826c2b954d0bb5e81fc3aa87e77a6f3958a80b7dbe8871b56e94e05cbaa3fadb50abf957b605041fe4aea61e84b2c10eddab0dde6faac9236767a550ddf1b878d959ec0dc0a0e84b5dfc09527db2d6fc2"],"x-tt-trace-id":["00-2503031237533DA472D195D07BEAE49E-48F8189761523FCD-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031237533DA472D195D07BEAE49E","statusCode":200},"request":{"folder_token":"Lz5nfmsp1l69DsdvznwcnMcOnbb"},"requestId":"202503031237533DA472D195D07BEAE49E"}
2025-03-03 12:37:55.885  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=IvxCbBjEHo7mRsxXcWScjtwcnld, fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, fileType=file, fileSize=null, createTime=1740897718, updateTime=1740897719)]
2025-03-03 12:37:56.593  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 12:37:56.617 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:37:56.617 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:37:56.640 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:37:56.765 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:37:56.767  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 12:37:56.767  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, userId=system
2025-03-03 12:37:56.767 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:37:56.768 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:37:57.057  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=82b2b55c-493c-4921-9746-ec873ec594c6
2025-03-03 12:37:57.057 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"82b2b55c-493c-4921-9746-ec873ec594c6"}},"response_mode":"blocking","conversation_id":"41dceb3f-fe83-4d93-ac01-11c13d2d1984","user":"fyjw"}
2025-03-03 12:37:57.100 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:37:57.100  INFO 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 12:37:57.100 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:37:57.101 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:37:57.125 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:37:57.251 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:37:57.919  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_0.png
2025-03-03 12:37:57.919  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_0.png, userId=system
2025-03-03 12:37:57.919 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:37:57.919 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:37:58.152  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=4537ab36-0fea-4fd9-91a1-f05ec6c0c7a8
2025-03-03 12:37:58.152 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"4537ab36-0fea-4fd9-91a1-f05ec6c0c7a8"}},"response_mode":"blocking","conversation_id":"baee842d-111b-4405-8bd6-aab04ff6275f","user":"fyjw"}
2025-03-03 12:38:32.755 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"761a4643-2e67-4ff2-9e0b-f6d23cad70eb","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 滨水融鑫湾·天樾湾  \n户型图纸模编号码公示备案 变更告知书  \n\n**滨水融鑫湾·天樾湾**项目（推广名“滨水融鑫湾·天樾湾”）由**广西融水鼎鑫置业有限公司**开发建设。该项目位于广西壮族自治区柳州市融水县融水镇，规划总建筑面积约1088户（1-3、5-7号楼、配建租赁住房888户，1-5、7号楼）。  \n\n根据规划批复，**滨水融鑫湾·天樾湾**项目（推广名“滨水融鑫湾·天樾湾”）**本项目**户型图纸模编号码公示备案，现将变更情况告知如下：  \n\n## 变更情况  \n户型图纸模编号码变更信息详见下表（“→”表示变更前后编号对照关系）：  \n\n### 1. **1#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型1-1  | 户型1-1  |\n| 户型1-2  | 户型1-2  |\n| 户型1-3  | 户型1-3  |\n\n### 2. **2#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型2-1  | 户型2-1  |\n| 户型2-2  | 户型2-2  |\n| 户型2-3  | 户型2-3  |\n\n### 3. **3#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型3-1  | 户型3-1  |\n| 户型3-2  | 户型3-2  |\n| 户型3-3  | 户型3-3  |\n\n### 4. **5#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型5-1  | 户型5-1  |\n| 户型5-2  | 户型5-2  |\n| 户型5-3  | 户型5-3  |\n\n### 5. **7#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型7-1  | 户型7-1  |\n| 户型7-2  | 户型7-2  |\n| 户型7-3  | 户型7-3  |\n\n---\n\n**广西融水鼎鑫置业有限公司**  \n**2024年6月**"},"elapsed_time":34.55181160499342,"total_tokens":1094,"total_steps":4,"created_at":1740976676,"finished_at":1740976711}
2025-03-03 12:38:32.755  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_0.png, text=以下是图片中的文字内容转换为Markdown格式：

---

# 滨水融鑫湾·天樾湾  
户型图纸模编号码公示备案 变更告知书  

**滨水融鑫湾·天樾湾**项目（推广名“滨水融鑫湾·天樾湾”）由**广西融水鼎鑫置业有限公司**开发建设。该项目位于广西壮族自治区柳州市融水县融水镇，规划总建筑面积约1088户（1-3、5-7号楼、配建租赁住房888户，1-5、7号楼）。  

根据规划批复，**滨水融鑫湾·天樾湾**项目（推广名“滨水融鑫湾·天樾湾”）**本项目**户型图纸模编号码公示备案，现将变更情况告知如下：  

## 变更情况  
户型图纸模编号码变更信息详见下表（“→”表示变更前后编号对照关系）：  

### 1. **1#栋户型图纸模编号码变更情况表**
| 变更前编号 | 变更后编号 |
|----------|----------|
| 户型1-1  | 户型1-1  |
| 户型1-2  | 户型1-2  |
| 户型1-3  | 户型1-3  |

### 2. **2#栋户型图纸模编号码变更情况表**
| 变更前编号 | 变更后编号 |
|----------|----------|
| 户型2-1  | 户型2-1  |
| 户型2-2  | 户型2-2  |
| 户型2-3  | 户型2-3  |

### 3. **3#栋户型图纸模编号码变更情况表**
| 变更前编号 | 变更后编号 |
|----------|----------|
| 户型3-1  | 户型3-1  |
| 户型3-2  | 户型3-2  |
| 户型3-3  | 户型3-3  |

### 4. **5#栋户型图纸模编号码变更情况表**
| 变更前编号 | 变更后编号 |
|----------|----------|
| 户型5-1  | 户型5-1  |
| 户型5-2  | 户型5-2  |
| 户型5-3  | 户型5-3  |

### 5. **7#栋户型图纸模编号码变更情况表**
| 变更前编号 | 变更后编号 |
|----------|----------|
| 户型7-1  | 户型7-1  |
| 户型7-2  | 户型7-2  |
| 户型7-3  | 户型7-3  |

---

**广西融水鼎鑫置业有限公司**  
**2024年6月**
2025-03-03 12:38:32.755 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"282882c1-954b-42cb-a2ee-96f6143c4fd5","workflow_run_id":"761a4643-2e67-4ff2-9e0b-f6d23cad70eb","data":{"id":"761a4643-2e67-4ff2-9e0b-f6d23cad70eb","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 滨水融鑫湾·天樾湾  \n户型图纸模编号码公示备案 变更告知书  \n\n**滨水融鑫湾·天樾湾**项目（推广名“滨水融鑫湾·天樾湾”）由**广西融水鼎鑫置业有限公司**开发建设。该项目位于广西壮族自治区柳州市融水县融水镇，规划总建筑面积约1088户（1-3、5-7号楼、配建租赁住房888户，1-5、7号楼）。  \n\n根据规划批复，**滨水融鑫湾·天樾湾**项目（推广名“滨水融鑫湾·天樾湾”）**本项目**户型图纸模编号码公示备案，现将变更情况告知如下：  \n\n## 变更情况  \n户型图纸模编号码变更信息详见下表（“→”表示变更前后编号对照关系）：  \n\n### 1. **1#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型1-1  | 户型1-1  |\n| 户型1-2  | 户型1-2  |\n| 户型1-3  | 户型1-3  |\n\n### 2. **2#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型2-1  | 户型2-1  |\n| 户型2-2  | 户型2-2  |\n| 户型2-3  | 户型2-3  |\n\n### 3. **3#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型3-1  | 户型3-1  |\n| 户型3-2  | 户型3-2  |\n| 户型3-3  | 户型3-3  |\n\n### 4. **5#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型5-1  | 户型5-1  |\n| 户型5-2  | 户型5-2  |\n| 户型5-3  | 户型5-3  |\n\n### 5. **7#栋户型图纸模编号码变更情况表**\n| 变更前编号 | 变更后编号 |\n|----------|----------|\n| 户型7-1  | 户型7-1  |\n| 户型7-2  | 户型7-2  |\n| 户型7-3  | 户型7-3  |\n\n---\n\n**广西融水鼎鑫置业有限公司**  \n**2024年6月**"},"elapsed_time":34.55181160499342,"total_tokens":1094,"total_steps":4,"created_at":1740976676,"finished_at":1740976711}}
2025-03-03 12:38:33.467  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_1.png
2025-03-03 12:38:33.467  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_1.png, userId=system
2025-03-03 12:38:33.467 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:38:33.467 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:38:34.145  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=1e1b4461-7437-4db1-8585-63b0b474a8cb
2025-03-03 12:38:34.146 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"1e1b4461-7437-4db1-8585-63b0b474a8cb"}},"response_mode":"blocking","conversation_id":"e81da027-5238-41c0-858d-1aeac1028278","user":"fyjw"}
2025-03-03 12:38:57.081 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"8c5e9e6d-89a9-4f50-b284-228e87ee69ed","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片展示了多个户型的平面图，并包含以下内容：\n\n## 二、户型图\n\n### A 户型示意图  \n- **A1 户型示意图**（A1* 为该户型镜像户型）  \n- **A2 户型示意图**（A2* 为该户型镜像户型）  \n- **A2-1 户型示意图**  \n- **A3 户型示意图**（A3* 为该户型镜像户型）  \n\n此外，图片底部包含客户的签名或备注信息。"},"elapsed_time":22.884522825013846,"total_tokens":534,"total_steps":4,"created_at":1740976712,"finished_at":1740976735}
2025-03-03 12:38:57.081  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_1.png, text=该图片展示了多个户型的平面图，并包含以下内容：

## 二、户型图

### A 户型示意图  
- **A1 户型示意图**（A1* 为该户型镜像户型）  
- **A2 户型示意图**（A2* 为该户型镜像户型）  
- **A2-1 户型示意图**  
- **A3 户型示意图**（A3* 为该户型镜像户型）  

此外，图片底部包含客户的签名或备注信息。
2025-03-03 12:38:57.081 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"d3e5d8ca-f46a-4dbc-985f-bd24c9b797d7","workflow_run_id":"8c5e9e6d-89a9-4f50-b284-228e87ee69ed","data":{"id":"8c5e9e6d-89a9-4f50-b284-228e87ee69ed","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片展示了多个户型的平面图，并包含以下内容：\n\n## 二、户型图\n\n### A 户型示意图  \n- **A1 户型示意图**（A1* 为该户型镜像户型）  \n- **A2 户型示意图**（A2* 为该户型镜像户型）  \n- **A2-1 户型示意图**  \n- **A3 户型示意图**（A3* 为该户型镜像户型）  \n\n此外，图片底部包含客户的签名或备注信息。"},"elapsed_time":22.884522825013846,"total_tokens":534,"total_steps":4,"created_at":1740976712,"finished_at":1740976735}}
2025-03-03 12:38:57.702  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_2.png
2025-03-03 12:38:57.702  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_2.png, userId=system
2025-03-03 12:38:57.702 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:38:57.702 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:38:57.978  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=9102d173-6853-4d2a-9848-3e109a2e94c4
2025-03-03 12:38:57.978 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"9102d173-6853-4d2a-9848-3e109a2e94c4"}},"response_mode":"blocking","conversation_id":"eb1c7a90-b45f-4ae8-9afa-20ae67a206cf","user":"fyjw"}
2025-03-03 12:39:21.015 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d65a121f-43f7-414a-adbb-c485e3c72b3f","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图是建筑平面布局图，展示了多个户型的平面设计方案。以下是对图纸内容的提取和整理：\n\n# 户型平面图\n\n## **B1-1 户型示意图**\n- 两种不同的方向布局：\n  - **(B1-1 为逆户型四房单位图)**\n  - **(B1-1 为顺户型四房单位图)**\n\n## **B1 户型示意图**\n- **(B1 为逆户型四房单位图)**\n\n## **B-2 户型示意图**\n- **(B-2 为逆户型四房单位图)**\n\n## **B-3 复式户型示意图**\n- **复式户型设计，包含两层结构布局**\n\n---\n\n**图纸标注：**\n- **客户签字处**：含日期 **2024.6** 及签名 **林XX**\n\n该图纸提供了不同户型的平面布局，适用于住宅设计和购房选择参考。"},"elapsed_time":22.930414870847017,"total_tokens":631,"total_steps":4,"created_at":1740976736,"finished_at":1740976759}
2025-03-03 12:39:21.015  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_2.png, text=该图是建筑平面布局图，展示了多个户型的平面设计方案。以下是对图纸内容的提取和整理：

# 户型平面图

## **B1-1 户型示意图**
- 两种不同的方向布局：
  - **(B1-1 为逆户型四房单位图)**
  - **(B1-1 为顺户型四房单位图)**

## **B1 户型示意图**
- **(B1 为逆户型四房单位图)**

## **B-2 户型示意图**
- **(B-2 为逆户型四房单位图)**

## **B-3 复式户型示意图**
- **复式户型设计，包含两层结构布局**

---

**图纸标注：**
- **客户签字处**：含日期 **2024.6** 及签名 **林XX**

该图纸提供了不同户型的平面布局，适用于住宅设计和购房选择参考。
2025-03-03 12:39:21.016 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"cc52e0e0-01f2-4619-8a7a-955225432f63","workflow_run_id":"d65a121f-43f7-414a-adbb-c485e3c72b3f","data":{"id":"d65a121f-43f7-414a-adbb-c485e3c72b3f","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图是建筑平面布局图，展示了多个户型的平面设计方案。以下是对图纸内容的提取和整理：\n\n# 户型平面图\n\n## **B1-1 户型示意图**\n- 两种不同的方向布局：\n  - **(B1-1 为逆户型四房单位图)**\n  - **(B1-1 为顺户型四房单位图)**\n\n## **B1 户型示意图**\n- **(B1 为逆户型四房单位图)**\n\n## **B-2 户型示意图**\n- **(B-2 为逆户型四房单位图)**\n\n## **B-3 复式户型示意图**\n- **复式户型设计，包含两层结构布局**\n\n---\n\n**图纸标注：**\n- **客户签字处**：含日期 **2024.6** 及签名 **林XX**\n\n该图纸提供了不同户型的平面布局，适用于住宅设计和购房选择参考。"},"elapsed_time":22.930414870847017,"total_tokens":631,"total_steps":4,"created_at":1740976736,"finished_at":1740976759}}
2025-03-03 12:39:21.669  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_3.png
2025-03-03 12:39:21.669  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_3.png, userId=system
2025-03-03 12:39:21.669 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:39:21.669 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:39:22.108  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=80ca3ea2-6148-44e7-bac9-6b6a51efe77b
2025-03-03 12:39:22.108 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"80ca3ea2-6148-44e7-bac9-6b6a51efe77b"}},"response_mode":"blocking","conversation_id":"c45a63ae-ca22-49b8-9fb1-84c87cec6d44","user":"fyjw"}
2025-03-03 12:39:37.088 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"4941ac7d-93cc-4a67-ac67-5246f8472e49","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片是一张包含多个户型的建筑平面图，图纸上标注了不同户型的名称及面积信息。以下是图中的主要文字内容整理：\n\n---\n\n**B-4复式户型示意图（B-5为此户型镜像户型）**  \n\n**C户型示意图**  \n\n**D户型示意图（面积约125㎡）**  \n\n**270户型示意图（面积约256㎡）**  \n\n---\n\n此外，图纸右下角包含了一个客户签名的区域。"},"elapsed_time":14.922376875998452,"total_tokens":519,"total_steps":4,"created_at":1740976760,"finished_at":1740976775}
2025-03-03 12:39:37.088  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_3.png, text=该图片是一张包含多个户型的建筑平面图，图纸上标注了不同户型的名称及面积信息。以下是图中的主要文字内容整理：

---

**B-4复式户型示意图（B-5为此户型镜像户型）**  

**C户型示意图**  

**D户型示意图（面积约125㎡）**  

**270户型示意图（面积约256㎡）**  

---

此外，图纸右下角包含了一个客户签名的区域。
2025-03-03 12:39:37.088 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"b7747276-e00b-4d0b-b772-54e6b1e4deca","workflow_run_id":"4941ac7d-93cc-4a67-ac67-5246f8472e49","data":{"id":"4941ac7d-93cc-4a67-ac67-5246f8472e49","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片是一张包含多个户型的建筑平面图，图纸上标注了不同户型的名称及面积信息。以下是图中的主要文字内容整理：\n\n---\n\n**B-4复式户型示意图（B-5为此户型镜像户型）**  \n\n**C户型示意图**  \n\n**D户型示意图（面积约125㎡）**  \n\n**270户型示意图（面积约256㎡）**  \n\n---\n\n此外，图纸右下角包含了一个客户签名的区域。"},"elapsed_time":14.922376875998452,"total_tokens":519,"total_steps":4,"created_at":1740976760,"finished_at":1740976775}}
2025-03-03 12:39:37.695  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_4.png
2025-03-03 12:39:37.695  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_4.png, userId=system
2025-03-03 12:39:37.695 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 12:39:37.695 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 12:39:37.925  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=58fe918c-cb8b-47da-8645-2038d767d237
2025-03-03 12:39:37.926 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"58fe918c-cb8b-47da-8645-2038d767d237"}},"response_mode":"blocking","conversation_id":"60e4ca50-03f1-473d-b47a-53584eca768e","user":"fyjw"}
2025-03-03 12:39:54.168 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"5d819d6c-a0f2-4a5f-a633-f9d836347940","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n# 增购人知晓并认可：\n\n本人所购买的**上海市浦东新区**【楼盘名称】**小区**【楼栋号】**1088**号（1.3-5.7层），房屋建筑面积**888**平方米（1.3-5.5层）（该数据最终以测绘数据为准）。\n\n**拟**以上所购房屋的同楼栋内**增购**一套房屋（以下简称“增购房屋”），上述房屋的建筑面积、房号、楼层、单价、总价、付款方式、交房标准、交房时间等具体事项均以与开发商签署的补充协议或合同为准。\n\n现本人已充分知晓并认可上述增购房屋的相关情况，并同意按约定的条款签署相关法律文件。\n\n本人承诺增购房屋的付款方式、房款金额等事项均与开发商签署的补充协议或合同约定内容一致。\n\n**本人知晓并认可**：\n1. 本合同约定的房屋已经售出并备案，具有产权。\n2. 增购房屋的最终建筑面积、房号、楼层、单价、总价、付款方式、交房标准、交房时间等均以与开发商签署的补充协议或合同为准。\n3. 如果因政策、政府规定、开发商内部调整等原因导致本次增购无法实现，本人承诺不追究开发商责任，并同意接受开发商的最终安排。\n\n---\n\n### 确认签名：\n\n**购房人**（签名）：  \n**日期**：**20**年**月**日  \n\n**开发商代表**（签名）：  \n**日期**：**20**年**月**日  \n\n---\n\n请注意，部分内容如楼盘名称等未完全显示，可能需要补充完整。"},"elapsed_time":16.189458769047633,"total_tokens":827,"total_steps":4,"created_at":1740976776,"finished_at":1740976792}
2025-03-03 12:39:54.169  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_4.png, text=以下是该图片中的文字内容转换为Markdown格式：

---

# 增购人知晓并认可：

本人所购买的**上海市浦东新区**【楼盘名称】**小区**【楼栋号】**1088**号（1.3-5.7层），房屋建筑面积**888**平方米（1.3-5.5层）（该数据最终以测绘数据为准）。

**拟**以上所购房屋的同楼栋内**增购**一套房屋（以下简称“增购房屋”），上述房屋的建筑面积、房号、楼层、单价、总价、付款方式、交房标准、交房时间等具体事项均以与开发商签署的补充协议或合同为准。

现本人已充分知晓并认可上述增购房屋的相关情况，并同意按约定的条款签署相关法律文件。

本人承诺增购房屋的付款方式、房款金额等事项均与开发商签署的补充协议或合同约定内容一致。

**本人知晓并认可**：
1. 本合同约定的房屋已经售出并备案，具有产权。
2. 增购房屋的最终建筑面积、房号、楼层、单价、总价、付款方式、交房标准、交房时间等均以与开发商签署的补充协议或合同为准。
3. 如果因政策、政府规定、开发商内部调整等原因导致本次增购无法实现，本人承诺不追究开发商责任，并同意接受开发商的最终安排。

---

### 确认签名：

**购房人**（签名）：  
**日期**：**20**年**月**日  

**开发商代表**（签名）：  
**日期**：**20**年**月**日  

---

请注意，部分内容如楼盘名称等未完全显示，可能需要补充完整。
2025-03-03 12:39:54.169 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"620609b0-af96-4323-bcf9-64c340136909","workflow_run_id":"5d819d6c-a0f2-4a5f-a633-f9d836347940","data":{"id":"5d819d6c-a0f2-4a5f-a633-f9d836347940","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n# 增购人知晓并认可：\n\n本人所购买的**上海市浦东新区**【楼盘名称】**小区**【楼栋号】**1088**号（1.3-5.7层），房屋建筑面积**888**平方米（1.3-5.5层）（该数据最终以测绘数据为准）。\n\n**拟**以上所购房屋的同楼栋内**增购**一套房屋（以下简称“增购房屋”），上述房屋的建筑面积、房号、楼层、单价、总价、付款方式、交房标准、交房时间等具体事项均以与开发商签署的补充协议或合同为准。\n\n现本人已充分知晓并认可上述增购房屋的相关情况，并同意按约定的条款签署相关法律文件。\n\n本人承诺增购房屋的付款方式、房款金额等事项均与开发商签署的补充协议或合同约定内容一致。\n\n**本人知晓并认可**：\n1. 本合同约定的房屋已经售出并备案，具有产权。\n2. 增购房屋的最终建筑面积、房号、楼层、单价、总价、付款方式、交房标准、交房时间等均以与开发商签署的补充协议或合同为准。\n3. 如果因政策、政府规定、开发商内部调整等原因导致本次增购无法实现，本人承诺不追究开发商责任，并同意接受开发商的最终安排。\n\n---\n\n### 确认签名：\n\n**购房人**（签名）：  \n**日期**：**20**年**月**日  \n\n**开发商代表**（签名）：  \n**日期**：**20**年**月**日  \n\n---\n\n请注意，部分内容如楼盘名称等未完全显示，可能需要补充完整。"},"elapsed_time":16.189458769047633,"total_tokens":827,"total_steps":4,"created_at":1740976776,"finished_at":1740976792}}
2025-03-03 12:39:54.170 DEBUG 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 12:39:54.170  INFO 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=null, fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, fileSize=4927
2025-03-03 12:39:54.170 DEBUG 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/null/document/create-by-file, fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 12:39:54.198 ERROR 32320 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件异常

org.springframework.web.client.HttpClientErrorException$NotFound: 404 NOT FOUND: "<!doctype html><EOL><html lang=en><EOL><title>404 Not Found</title><EOL><h1>Not Found</h1><EOL><p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p><EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:113) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.uploadFile(DifyKnowledgeServiceImpl.java:135) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:512) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:39:54.199 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传到知识库失败: 5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 12:39:54.222 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:39:54.223 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:39:54.246 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:39:54.413 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:39:54.415 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:39:54.415 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:39:54.438 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:39:54.568 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:39:54.570 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:39:54.570 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:39:54.595 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:39:54.750 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:39:54.751 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:39:54.752 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:39:54.776 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:39:55.022 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:39:55.390 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\银行情况说明.docx
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:39:55.415 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:39:55.416 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:39:55.439 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:39:55.671 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:39:59.831 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\金港东九提供材料2.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:39:59.855 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:39:59.855 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:39:59.880 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:40:00.002 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:40:02.125 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\金港东九提供材料1.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:40:02.150 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:40:02.150 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:40:02.191 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:40:02.335 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:40:03.260 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\东九预看房陪看记录单.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:40:03.283 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:40:03.283 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:40:03.309 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:40:03.425 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:40:03.722 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\东九交付许可证.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:40:03.722 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:40:03.723 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:40:03.744 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:40:03.879 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:40:04.178 ERROR 32320 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\程阿金和解通知.jpg
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 12:40:04.179 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:40:04.179 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:40:04.202 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:40:04.352 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 12:40:04.353 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 12:40:04.353 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 12:40:04.376 DEBUG 32320 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 12:40:04.513 ERROR 32320 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:06:40.854  INFO 32320 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 13:06:40.855  INFO 32320 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 13:06:43.265  INFO 33332 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 33332 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 13:06:43.266 DEBUG 33332 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 13:06:43.266  INFO 33332 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 13:06:43.532  INFO 33332 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 13:06:43.533  INFO 33332 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 13:06:43.547  INFO 33332 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 13:06:43.793  INFO 33332 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 13:06:43.798  INFO 33332 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 13:06:43.798  INFO 33332 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 13:06:43.877  INFO 33332 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 13:06:43.877  INFO 33332 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 592 ms
2025-03-03 13:06:44.029  INFO 33332 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 13:06:44.029  INFO 33332 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 13:06:44.547  INFO 33332 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 13:06:44.784  INFO 33332 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477441122999861250&access_key=98421b05efc1f6770338a8449cb8e1d5&service_id=33554678&ticket=492d0fc1-b95b-49e3-84e0-fa80e61b9479 [conn_id=7477441122999861250]
2025-03-03 13:06:44.831  INFO 33332 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 13:06:44.836  INFO 33332 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.783 seconds (JVM running for 2.138)
2025-03-03 13:07:41.473  INFO 33332 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740978459}
2025-03-03 13:07:41.500  WARN 33332 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 13:07:41.505  INFO 33332 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 13:07:41.744  INFO 33332 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 13:07:41.748 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:07:41.758 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:07:41.791 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:07:41.794 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:07:41.794 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 18(String)
2025-03-03 13:07:41.814 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:07:41.814 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:07:41.815 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 18(String)
2025-03-03 13:07:41.833 DEBUG 33332 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:07:41.833  INFO 33332 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: Inw5ftqF2li3Yqd5Ih6c0alyntb
2025-03-03 13:07:42.662  INFO 33332 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 13:07:42.664  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=Inw5ftqF2li3Yqd5Ih6c0alyntb, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 13:07:43.288  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897736","modified_time":"1740897738","name":"金港东九提供材料2(3)","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"AjDpfNJillTBtUdfJG2csHein6g","type":"folder","url":"https://vcnjyexq8awr.feishu.cn/drive/folder/AjDpfNJillTBtUdfJG2csHein6g"},{"created_time":"1740897731","modified_time":"1740897732","name":"金港东九提供材料2(2)","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"VyUqfdiAQluC2hdYzDPcAwHFnKh","type":"folder","url":"https://vcnjyexq8awr.feishu.cn/drive/folder/VyUqfdiAQluC2hdYzDPcAwHFnKh"},{"created_time":"1740897719","modified_time":"1740897720","name":"金港东九提供材料2","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"Lz5nfmsp1l69DsdvznwcnMcOnbb","type":"folder","url":"https://vcnjyexq8awr.feishu.cn/drive/folder/Lz5nfmsp1l69DsdvznwcnMcOnbb"},{"created_time":"1740897458","modified_time":"1740897458","name":"银行情况说明.docx","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"AyPDbd6zVoxK3uxoA8PcUuhcnxc","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/AyPDbd6zVoxK3uxoA8PcUuhcnxc"},{"created_time":"1740897446","modified_time":"1740897458","name":"金港东九提供材料2.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"X8jnbYQOyoeyzgxTniPcLJnyntb","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/X8jnbYQOyoeyzgxTniPcLJnyntb"},{"created_time":"1740897439","modified_time":"1740897446","name":"金港东九提供材料1.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"SlMcbRvOyoFD1XxwsR5cLCK0nLb","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/SlMcbRvOyoFD1XxwsR5cLCK0nLb"},{"created_time":"1740897437","modified_time":"1740897439","name":"东九预看房陪看记录单.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"SMRtbfNgyopjqnxGHi2cw62dnMh","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/SMRtbfNgyopjqnxGHi2cw62dnMh"},{"created_time":"1740897436","modified_time":"1740897437","name":"东九交付许可证.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"ADX4baexwoHaycxsREAc9McPn7s","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/ADX4baexwoHaycxsREAc9McPn7s"},{"created_time":"1740897435","modified_time":"1740897436","name":"程阿金和解通知.jpg","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb","token":"Th1JbVpOToMDgBxjtrCc1H5LnPd","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/Th1JbVpOToMDgBxjtrCc1H5LnPd"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,56,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,40,51,41,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,44,34,116,121,112,101,34,58,34,102,111,108,100,101,114,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,100,114,105,118,101,47,102,111,108,100,101,114,47,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,49,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,50,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,40,50,41,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,86,121,85,113,102,100,105,65,81,108,117,67,50,104,100,89,122,68,80,99,65,119,72,70,110,75,104,34,44,34,116,121,112,101,34,58,34,102,111,108,100,101,114,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,100,114,105,118,101,47,102,111,108,100,101,114,47,86,121,85,113,102,100,105,65,81,108,117,67,50,104,100,89,122,68,80,99,65,119,72,70,110,75,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,49,57,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,50,48,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,76,122,53,110,102,109,115,112,49,108,54,57,68,115,100,118,122,110,119,99,110,77,99,79,110,98,98,34,44,34,116,121,112,101,34,58,34,102,111,108,100,101,114,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,100,114,105,118,101,47,102,111,108,100,101,114,47,76,122,53,110,102,109,115,112,49,108,54,57,68,115,100,118,122,110,119,99,110,77,99,79,110,98,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,53,56,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,53,56,34,44,34,110,97,109,101,34,58,34,-23,-109,-74,-24,-95,-116,-26,-125,-123,-27,-122,-75,-24,-81,-76,-26,-104,-114,46,100,111,99,120,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,65,121,80,68,98,100,54,122,86,111,120,75,51,117,120,111,65,56,80,99,85,117,104,99,110,120,99,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,65,121,80,68,98,100,54,122,86,111,120,75,51,117,120,111,65,56,80,99,85,117,104,99,110,120,99,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,52,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,53,56,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,50,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,88,56,106,110,98,89,81,79,121,111,101,121,122,103,120,84,110,105,80,99,76,74,110,121,110,116,98,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,88,56,106,110,98,89,81,79,121,111,101,121,122,103,120,84,110,105,80,99,76,74,110,121,110,116,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,57,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,52,54,34,44,34,110,97,109,101,34,58,34,-23,-121,-111,-26,-72,-81,-28,-72,-100,-28,-71,-99,-26,-113,-112,-28,-66,-101,-26,-99,-112,-26,-106,-103,49,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,83,108,77,99,98,82,118,79,121,111,70,68,49,88,120,119,115,82,53,99,76,67,75,48,110,76,98,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,83,108,77,99,98,82,118,79,121,111,70,68,49,88,120,119,115,82,53,99,76,67,75,48,110,76,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,55,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,57,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-23,-94,-124,-25,-100,-117,-26,-120,-65,-23,-103,-86,-25,-100,-117,-24,-82,-80,-27,-67,-107,-27,-115,-107,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,83,77,82,116,98,102,78,103,121,111,112,106,113,110,120,71,72,105,50,99,119,54,50,100,110,77,104,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,83,77,82,116,98,102,78,103,121,111,112,106,113,110,120,71,72,105,50,99,119,54,50,100,110,77,104,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,55,34,44,34,110,97,109,101,34,58,34,-28,-72,-100,-28,-71,-99,-28,-70,-92,-28,-69,-104,-24,-82,-72,-27,-113,-81,-24,-81,-127,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,65,68,88,52,98,97,101,120,119,111,72,97,121,99,120,115,82,69,65,99,57,77,99,80,110,55,115,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,65,68,88,52,98,97,101,120,119,111,72,97,121,99,120,115,82,69,65,99,57,77,99,80,110,55,115,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,53,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,52,51,54,34,44,34,110,97,109,101,34,58,34,-25,-88,-117,-23,-104,-65,-23,-121,-111,-27,-110,-116,-24,-89,-93,-23,-128,-102,-25,-97,-91,46,106,112,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,73,110,119,53,102,116,113,70,50,108,105,51,89,113,100,53,73,104,54,99,48,97,108,121,110,116,98,34,44,34,116,111,107,101,110,34,58,34,84,104,49,74,98,86,112,79,84,111,77,68,103,66,120,106,116,114,67,99,49,72,53,76,110,80,100,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,84,104,49,74,98,86,112,79,84,111,77,68,103,66,120,106,116,114,67,99,49,72,53,76,110,80,100,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:07:41 GMT"],"eagleid":["74c48fb117409784609532607e"],"request-id":["4bfb1bd3-9b88-4d46-887d-420dc83feba5"],"server":["Tengine"],"server-timing":["inner; dur=515","cdn-cache;desc=MISS,edge;dur=0,origin;dur=534"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache29.cn7149[534,0]"],"x-lgw-dst-svc":["_i27QkfS6nTuXkNQTR26tuyshn1mM3V82mu5xT4RzgI_KI-fcbK7qwdMLW-0X63JjrL_YdnJpQtNQu4QX7gc_VYfWvv57ESFcPWJZ1Cc7_7FCBrgWZIMjxgU9xRSJ8Z-CRVaCnoiIuLShLlKItbKN9aORBJCFSWJ-s6IABfttjq5BKm3UiHP2C9Quu8r888Nrb8LKyA8eRDG3bhkL3A7QPL6i1OrR1QgtsCFLRfWBeJkNBL49WXn7EH7-KavG0PXa0ER8ACgW-xwPw5klcXolTBUCbfwE_aR731djKSYS5GxHpLeJodQ2ww="],"x-request-id":["4bfb1bd3-9b88-4d46-887d-420dc83feba5"],"x-timestamp":["1740978461.480"],"x-tt-logid":["202503031307406703F122696530FA3618"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be2fd9e816b186332d662c93a609a1770810e9bc75ab7711fbc4b39663c8db9e2c1a36c478c02a885f0ca2740774903730adeecdba09c88cb06a01bb3acc9e45a37ed18f9ff96bba959ef3f31091f6c273"],"x-tt-trace-id":["00-2503031307406703F122696530FA3618-3FC535E41BEC9A1E-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031307406703F122696530FA3618","statusCode":200},"request":{"folder_token":"Inw5ftqF2li3Yqd5Ih6c0alyntb"},"requestId":"202503031307406703F122696530FA3618"}
2025-03-03 13:07:43.289  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=AjDpfNJillTBtUdfJG2csHein6g, fileName=金港东九提供材料2(3), fileType=folder, fileSize=null, createTime=1740897736, updateTime=1740897738), IFeishuFolderService.FileInfo(fileToken=VyUqfdiAQluC2hdYzDPcAwHFnKh, fileName=金港东九提供材料2(2), fileType=folder, fileSize=null, createTime=1740897731, updateTime=1740897732), IFeishuFolderService.FileInfo(fileToken=Lz5nfmsp1l69DsdvznwcnMcOnbb, fileName=金港东九提供材料2, fileType=folder, fileSize=null, createTime=1740897719, updateTime=1740897720), IFeishuFolderService.FileInfo(fileToken=AyPDbd6zVoxK3uxoA8PcUuhcnxc, fileName=银行情况说明.docx, fileType=file, fileSize=null, createTime=1740897458, updateTime=1740897458), IFeishuFolderService.FileInfo(fileToken=X8jnbYQOyoeyzgxTniPcLJnyntb, fileName=金港东九提供材料2.pdf, fileType=file, fileSize=null, createTime=1740897446, updateTime=1740897458), IFeishuFolderService.FileInfo(fileToken=SlMcbRvOyoFD1XxwsR5cLCK0nLb, fileName=金港东九提供材料1.pdf, fileType=file, fileSize=null, createTime=1740897439, updateTime=1740897446), IFeishuFolderService.FileInfo(fileToken=SMRtbfNgyopjqnxGHi2cw62dnMh, fileName=东九预看房陪看记录单.pdf, fileType=file, fileSize=null, createTime=1740897437, updateTime=1740897439), IFeishuFolderService.FileInfo(fileToken=ADX4baexwoHaycxsREAc9McPn7s, fileName=东九交付许可证.pdf, fileType=file, fileSize=null, createTime=1740897436, updateTime=1740897437), IFeishuFolderService.FileInfo(fileToken=Th1JbVpOToMDgBxjtrCc1H5LnPd, fileName=程阿金和解通知.jpg, fileType=file, fileSize=null, createTime=1740897435, updateTime=1740897436)]
2025-03-03 13:07:43.289  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=AjDpfNJillTBtUdfJG2csHein6g, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 13:07:43.678  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897736","modified_time":"1740897737","name":"7-《臻心公告 项目红线内不利因素提示》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"AjDpfNJillTBtUdfJG2csHein6g","token":"Gb38bcBpdoF6IfxmZOIcdVHBnDb","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/Gb38bcBpdoF6IfxmZOIcdVHBnDb"},{"created_time":"1740897735","modified_time":"1740897736","name":"6-《臻心公告 特别告知书》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"AjDpfNJillTBtUdfJG2csHein6g","token":"C3MqbydkIo1oWgxC6i8c8258ncd","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/C3MqbydkIo1oWgxC6i8c8258ncd"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,54,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,55,34,44,34,110,97,109,101,34,58,34,55,45,-29,-128,-118,-24,-121,-69,-27,-65,-125,-27,-123,-84,-27,-111,-118,32,-23,-95,-71,-25,-101,-82,-25,-70,-94,-25,-70,-65,-27,-122,-123,-28,-72,-115,-27,-120,-87,-27,-101,-96,-25,-76,-96,-26,-113,-112,-25,-92,-70,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,44,34,116,111,107,101,110,34,58,34,71,98,51,56,98,99,66,112,100,111,70,54,73,102,120,109,90,79,73,99,100,86,72,66,110,68,98,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,71,98,51,56,98,99,66,112,100,111,70,54,73,102,120,109,90,79,73,99,100,86,72,66,110,68,98,34,125,44,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,53,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,54,34,44,34,110,97,109,101,34,58,34,54,45,-29,-128,-118,-24,-121,-69,-27,-65,-125,-27,-123,-84,-27,-111,-118,32,-25,-119,-71,-27,-120,-85,-27,-111,-118,-25,-97,-91,-28,-71,-90,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,65,106,68,112,102,78,74,105,108,108,84,66,116,85,100,102,74,71,50,99,115,72,101,105,110,54,103,34,44,34,116,111,107,101,110,34,58,34,67,51,77,113,98,121,100,107,73,111,49,111,87,103,120,67,54,105,56,99,56,50,53,56,110,99,100,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,67,51,77,113,98,121,100,107,73,111,49,111,87,103,120,67,54,105,56,99,56,50,53,56,110,99,100,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:07:41 GMT"],"eagleid":["74c48fb117409784615924858e"],"request-id":["7d8ef9b1-03fa-4f06-876a-c490dbc2f048"],"server":["Tengine"],"server-timing":["inner; dur=326","cdn-cache;desc=MISS,edge;dur=0,origin;dur=350"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache29.cn7149[350,0]"],"x-lgw-dst-svc":["md0--RIgWCALdKTizjsQYq_LPGbFYsQ3PSsOFCATe_MbUFfMy_gHp3X9Yps4M1v_ZDqDkZpY00pWb2oWoHQtPPqI-1tG-uhsvH8Ifm1Y_A8So4eZalUxozWG4_KjFiSwmTLISOMR2kZxbINz-0aYMnCmfzmnIp3X7WZPGvhSUkciU6jfzo-qg9Dm8B3lGP7RgBQX9zDV5SUNOEFwzlml8UFs_4NqvKr411jVPauLKLUqmSrO1BhF15ohoaaOP_mtSt944VJsPHo3MjC573D_7DneNoyBQQjCIufldGFxmdiY7i3yfYgxyYQ="],"x-request-id":["7d8ef9b1-03fa-4f06-876a-c490dbc2f048"],"x-timestamp":["1740978461.934"],"x-tt-logid":["202503031307412902BA0A226D2EEF1585"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be3e3e808e82e5ab5fe588a26084cbd4de42f9b230ae1e0fabf19660b05f470ae422a88b04b8b7705c700cd8e116dea12bfdb9e5493a4e07780e85fc6417c7427ebb3d2f496ed0daca7dbe35b511d609db"],"x-tt-trace-id":["00-2503031307412902BA0A226D2EEF1585-38A40CF01AAF1AC5-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031307412902BA0A226D2EEF1585","statusCode":200},"request":{"folder_token":"AjDpfNJillTBtUdfJG2csHein6g"},"requestId":"202503031307412902BA0A226D2EEF1585"}
2025-03-03 13:07:43.678  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=Gb38bcBpdoF6IfxmZOIcdVHBnDb, fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, fileType=file, fileSize=null, createTime=1740897736, updateTime=1740897737), IFeishuFolderService.FileInfo(fileToken=C3MqbydkIo1oWgxC6i8c8258ncd, fileName=6-《臻心公告 特别告知书》.pdf, fileType=file, fileSize=null, createTime=1740897735, updateTime=1740897736)]
2025-03-03 13:07:44.393  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 13:07:44.414 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:07:44.414 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:07:44.434 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:07:44.561 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:07:44.562  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 13:07:44.563  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, userId=system
2025-03-03 13:07:44.564 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:07:44.564 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:07:44.870  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=51f51823-43f4-4ea3-96bb-472ac48c516b
2025-03-03 13:07:44.870 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"51f51823-43f4-4ea3-96bb-472ac48c516b"}},"response_mode":"blocking","conversation_id":"f907178a-903e-496a-922e-a9ffcbb4dd6b","user":"fyjw"}
2025-03-03 13:07:44.905 ERROR 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:07:44.905  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 13:07:44.906 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:07:44.906 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:07:44.926 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:07:45.135 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:07:46.130  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_0.png
2025-03-03 13:07:46.130  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_0.png, userId=system
2025-03-03 13:07:46.130 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:07:46.130 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:07:46.438  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=eb64befe-74ed-4126-baba-6d77f66a6b13
2025-03-03 13:07:46.438 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"eb64befe-74ed-4126-baba-6d77f66a6b13"}},"response_mode":"blocking","conversation_id":"3c4b90d7-92e0-434d-bac7-20c19f944e1c","user":"fyjw"}
2025-03-03 13:08:06.999 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"0bd213e2-8a40-4032-b2b3-ded84e1b85c8","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片的文字内容转换为Markdown格式：\n\n---\n\n# 公告  \n**项目红线内不利因素提示**\n\n### 说明  \n海尔冰山慧谷 天赋海文府（CIII#号）为商品房项目，以下简称“本项目”。  \n\n---\n\n## 主要影响因素说明  \n\n| 序号 | 主要影响因素类别 | 红线内不利因素说明 | 备注 |\n|------|----------------|-------------------|------|\n| 1 | 变电站 | 地下变电站 | 见1号图例 |\n| 2 | 供热 | 换热站 | 见2号图例 |\n| 3 | 加油站 | 距地块西北侧约50米 | 见3号图例 |\n| 4 | 住宅出入口（2个） | 1号出入口（主出入口） | 见1-3号 |\n|  |  | 2号出入口 | 见1-3号 |\n| 5 | 车库出入口（3个） | 1号车库出入口 | 见1-3号 |\n|  |  | 2号车库出入口 | 见1-3号 |\n|  |  | 3号车库出入口 | 见1-3号 |\n\n---\n\n该公告旨在提醒购房者有关项目红线范围内的不利因素，以便知情决策。  \n\n**（公告盖章）**\n\n---\n\n如果需要更详细的内容或调整格式，请告诉我！"},"elapsed_time":20.513684995938092,"total_tokens":731,"total_steps":4,"created_at":1740978464,"finished_at":1740978485}
2025-03-03 13:08:06.999  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_0.png, text=以下是该图片的文字内容转换为Markdown格式：

---

# 公告  
**项目红线内不利因素提示**

### 说明  
海尔冰山慧谷 天赋海文府（CIII#号）为商品房项目，以下简称“本项目”。  

---

## 主要影响因素说明  

| 序号 | 主要影响因素类别 | 红线内不利因素说明 | 备注 |
|------|----------------|-------------------|------|
| 1 | 变电站 | 地下变电站 | 见1号图例 |
| 2 | 供热 | 换热站 | 见2号图例 |
| 3 | 加油站 | 距地块西北侧约50米 | 见3号图例 |
| 4 | 住宅出入口（2个） | 1号出入口（主出入口） | 见1-3号 |
|  |  | 2号出入口 | 见1-3号 |
| 5 | 车库出入口（3个） | 1号车库出入口 | 见1-3号 |
|  |  | 2号车库出入口 | 见1-3号 |
|  |  | 3号车库出入口 | 见1-3号 |

---

该公告旨在提醒购房者有关项目红线范围内的不利因素，以便知情决策。  

**（公告盖章）**

---

如果需要更详细的内容或调整格式，请告诉我！
2025-03-03 13:08:06.999 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"66f0c0a9-edef-4c8a-8f7f-4aa500421c98","workflow_run_id":"0bd213e2-8a40-4032-b2b3-ded84e1b85c8","data":{"id":"0bd213e2-8a40-4032-b2b3-ded84e1b85c8","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片的文字内容转换为Markdown格式：\n\n---\n\n# 公告  \n**项目红线内不利因素提示**\n\n### 说明  \n海尔冰山慧谷 天赋海文府（CIII#号）为商品房项目，以下简称“本项目”。  \n\n---\n\n## 主要影响因素说明  \n\n| 序号 | 主要影响因素类别 | 红线内不利因素说明 | 备注 |\n|------|----------------|-------------------|------|\n| 1 | 变电站 | 地下变电站 | 见1号图例 |\n| 2 | 供热 | 换热站 | 见2号图例 |\n| 3 | 加油站 | 距地块西北侧约50米 | 见3号图例 |\n| 4 | 住宅出入口（2个） | 1号出入口（主出入口） | 见1-3号 |\n|  |  | 2号出入口 | 见1-3号 |\n| 5 | 车库出入口（3个） | 1号车库出入口 | 见1-3号 |\n|  |  | 2号车库出入口 | 见1-3号 |\n|  |  | 3号车库出入口 | 见1-3号 |\n\n---\n\n该公告旨在提醒购房者有关项目红线范围内的不利因素，以便知情决策。  \n\n**（公告盖章）**\n\n---\n\n如果需要更详细的内容或调整格式，请告诉我！"},"elapsed_time":20.513684995938092,"total_tokens":731,"total_steps":4,"created_at":1740978464,"finished_at":1740978485}}
2025-03-03 13:08:07.962  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_1.png
2025-03-03 13:08:07.963  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_1.png, userId=system
2025-03-03 13:08:07.963 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:08:07.963 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:08:08.205  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=3f95f25c-c7d6-4d4f-9d04-3de735800962
2025-03-03 13:08:08.205 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"3f95f25c-c7d6-4d4f-9d04-3de735800962"}},"response_mode":"blocking","conversation_id":"23f26770-3762-487d-b32c-d1a847f6f024","user":"fyjw"}
2025-03-03 13:08:30.550 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"4bac1076-7e4b-4390-b74a-a11a5a9d925c","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中文字的Markdown格式提取：\n\n```markdown\n| 序号 | 设施类型             | 位置                      |\n|------|----------------------|-------------------------|\n| 8    | 地下消防水泵房       | 1幢1-3号                |\n| 9    | 地下生活水泵房       | 1幢1-3号                |\n| 10   | 屋面消防水箱         | 1幢1-3号                |\n| 11   | 设备               | 1幢1-3号                |\n| 12   | 设备               | 1幢1-3号                |\n| 13   | 公共厕所           | 1幢1-3号                |\n| 14   | 兼一类汽车库       | 2幢1-3号                |\n| 15   | 物业、办公室、配电房 | 1幢5-7号，2幢5-9号      |\n\n---\n\n**客户签字：**  \n（盖章）\n```\n\n图片还包含一张建筑平面图，可能标注了设施的具体位置。"},"elapsed_time":22.309720508987084,"total_tokens":652,"total_steps":4,"created_at":1740978486,"finished_at":1740978508}
2025-03-03 13:08:30.550  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_1.png, text=以下是图片中文字的Markdown格式提取：

```markdown
| 序号 | 设施类型             | 位置                      |
|------|----------------------|-------------------------|
| 8    | 地下消防水泵房       | 1幢1-3号                |
| 9    | 地下生活水泵房       | 1幢1-3号                |
| 10   | 屋面消防水箱         | 1幢1-3号                |
| 11   | 设备               | 1幢1-3号                |
| 12   | 设备               | 1幢1-3号                |
| 13   | 公共厕所           | 1幢1-3号                |
| 14   | 兼一类汽车库       | 2幢1-3号                |
| 15   | 物业、办公室、配电房 | 1幢5-7号，2幢5-9号      |

---

**客户签字：**  
（盖章）
```

图片还包含一张建筑平面图，可能标注了设施的具体位置。
2025-03-03 13:08:30.551 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"499949f4-3581-4faf-94e0-0026f53784b9","workflow_run_id":"4bac1076-7e4b-4390-b74a-a11a5a9d925c","data":{"id":"4bac1076-7e4b-4390-b74a-a11a5a9d925c","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中文字的Markdown格式提取：\n\n```markdown\n| 序号 | 设施类型             | 位置                      |\n|------|----------------------|-------------------------|\n| 8    | 地下消防水泵房       | 1幢1-3号                |\n| 9    | 地下生活水泵房       | 1幢1-3号                |\n| 10   | 屋面消防水箱         | 1幢1-3号                |\n| 11   | 设备               | 1幢1-3号                |\n| 12   | 设备               | 1幢1-3号                |\n| 13   | 公共厕所           | 1幢1-3号                |\n| 14   | 兼一类汽车库       | 2幢1-3号                |\n| 15   | 物业、办公室、配电房 | 1幢5-7号，2幢5-9号      |\n\n---\n\n**客户签字：**  \n（盖章）\n```\n\n图片还包含一张建筑平面图，可能标注了设施的具体位置。"},"elapsed_time":22.309720508987084,"total_tokens":652,"total_steps":4,"created_at":1740978486,"finished_at":1740978508}}
2025-03-03 13:08:31.344  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_2.png
2025-03-03 13:08:31.344  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_2.png, userId=system
2025-03-03 13:08:31.344 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:08:31.344 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:08:31.573  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=30951dd4-9de1-4d0e-bb2a-b88ae4b8fb15
2025-03-03 13:08:31.573 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"30951dd4-9de1-4d0e-bb2a-b88ae4b8fb15"}},"response_mode":"blocking","conversation_id":"ab923f27-34ca-4301-a261-0b2bd65f62da","user":"fyjw"}
2025-03-03 13:09:02.221 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"008d5cac-896b-4305-87ad-0c583f8dc6f4","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中表格内容的Markdown格式转换：\n\n```markdown\n# 红线外不同道路类别的领配套标准\n\n| 序号 | 主要道路类别 | 红线外不同道路类别 | 领配套标准 | 备注 |\n|------|------------|----------------|------------|------|\n| 1    | 小区出入口 | 机动车出入口（2个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 2    | 小区出入口 | 非机动车出入口（1个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 3    | 小区出入口 | 小区出入口（3个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 4    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 5    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 6    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 7    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 8    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 9    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 10   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 11   | 公共通道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 12   | 公共通道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 13   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 14   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 15   | 配套用房 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n\n```\n\n该表格列出了不同道路类别的红线外配套标准，并提供了相应的绿化带、人行道和慢车道的具体尺寸。"},"elapsed_time":30.601582473143935,"total_tokens":1483,"total_steps":4,"created_at":1740978509,"finished_at":1740978540}
2025-03-03 13:09:02.221  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_2.png, text=以下是该图片中表格内容的Markdown格式转换：

```markdown
# 红线外不同道路类别的领配套标准

| 序号 | 主要道路类别 | 红线外不同道路类别 | 领配套标准 | 备注 |
|------|------------|----------------|------------|------|
| 1    | 小区出入口 | 机动车出入口（2个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 2    | 小区出入口 | 非机动车出入口（1个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 3    | 小区出入口 | 小区出入口（3个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 4    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 5    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 6    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 7    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 8    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 9    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 10   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 11   | 公共通道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 12   | 公共通道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 13   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 14   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |
| 15   | 配套用房 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |

```

该表格列出了不同道路类别的红线外配套标准，并提供了相应的绿化带、人行道和慢车道的具体尺寸。
2025-03-03 13:09:02.221 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"42cf9efc-9a25-43d5-83fc-5ed66b755ac7","workflow_run_id":"008d5cac-896b-4305-87ad-0c583f8dc6f4","data":{"id":"008d5cac-896b-4305-87ad-0c583f8dc6f4","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中表格内容的Markdown格式转换：\n\n```markdown\n# 红线外不同道路类别的领配套标准\n\n| 序号 | 主要道路类别 | 红线外不同道路类别 | 领配套标准 | 备注 |\n|------|------------|----------------|------------|------|\n| 1    | 小区出入口 | 机动车出入口（2个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 2    | 小区出入口 | 非机动车出入口（1个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 3    | 小区出入口 | 小区出入口（3个） | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 4    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 5    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 6    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 7    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 8    | 次要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 9    | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 10   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 11   | 公共通道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 12   | 公共通道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 13   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 14   | 主要道路 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n| 15   | 配套用房 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 | 4-5m绿化带+2m人行道+2m绿化带+4-5m慢车道 |  |\n\n```\n\n该表格列出了不同道路类别的红线外配套标准，并提供了相应的绿化带、人行道和慢车道的具体尺寸。"},"elapsed_time":30.601582473143935,"total_tokens":1483,"total_steps":4,"created_at":1740978509,"finished_at":1740978540}}
2025-03-03 13:09:03.077  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_3.png
2025-03-03 13:09:03.078  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_3.png, userId=system
2025-03-03 13:09:03.078 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:09:03.078 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:09:03.216  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=0ef996ad-f794-4dc0-81c2-d6ab8d4b48f7
2025-03-03 13:09:03.216 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"0ef996ad-f794-4dc0-81c2-d6ab8d4b48f7"}},"response_mode":"blocking","conversation_id":"10c7d1d8-b3bf-46b9-a529-d25226d69bff","user":"fyjw"}
2025-03-03 13:09:19.497 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"84e78727-ca04-4aba-902a-395efe0860d2","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 特别说明：\n\n1. 土地用途均为办公及商业用地。  \n2. 本表所载建筑面积为预测建筑面积，最终数据以政府测绘部门实测面积为准，若政府测绘部门最终确认的面积与本表所载面积有差异的，按合同约定的处理方式处理。  \n3. 本表所列“分摊建筑面积”为参考面积，最终数据以政府测绘部门实测面积为准。  \n4. 本表所列建筑面积均以平方米计算。  \n5. 本表所列数据如与政府相关部门批准的数据不一致的，以政府相关部门最终批准的数据为准。  \n6. 以上所列内容仅供参考，最终以《上海市商品房预售合同》及附件约定为准。  \n7. 以上所列内容如与合同及附件不一致的，以合同及附件约定为准。  \n\n---\n\n### 重要提示：\n在签订《上海市商品房预售合同》（上海市商品房出售合同）及补充协议后，买受人已明确知晓并理解本表所载内容。  \n\n鉴于商品房存在小数点后的尾数，买受人同意，相关数据按四舍五入计算。  \n\n买受人已了解、同意，并愿意遵守本表所述的内容。  \n\n---\n\n**买受人签字：** ✍（签名处）  \n**签订日期：** 20**年**月**日  \n\n**卖方（盖章）：** ✍（盖章处）"},"elapsed_time":16.238195372978225,"total_tokens":756,"total_steps":4,"created_at":1740978541,"finished_at":1740978557}
2025-03-03 13:09:19.497  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=7-《臻心公告 项目红线内不利因素提示》.pdf_page_3.png, text=以下是图片中的文字内容转换为Markdown格式：

---

## 特别说明：

1. 土地用途均为办公及商业用地。  
2. 本表所载建筑面积为预测建筑面积，最终数据以政府测绘部门实测面积为准，若政府测绘部门最终确认的面积与本表所载面积有差异的，按合同约定的处理方式处理。  
3. 本表所列“分摊建筑面积”为参考面积，最终数据以政府测绘部门实测面积为准。  
4. 本表所列建筑面积均以平方米计算。  
5. 本表所列数据如与政府相关部门批准的数据不一致的，以政府相关部门最终批准的数据为准。  
6. 以上所列内容仅供参考，最终以《上海市商品房预售合同》及附件约定为准。  
7. 以上所列内容如与合同及附件不一致的，以合同及附件约定为准。  

---

### 重要提示：
在签订《上海市商品房预售合同》（上海市商品房出售合同）及补充协议后，买受人已明确知晓并理解本表所载内容。  

鉴于商品房存在小数点后的尾数，买受人同意，相关数据按四舍五入计算。  

买受人已了解、同意，并愿意遵守本表所述的内容。  

---

**买受人签字：** ✍（签名处）  
**签订日期：** 20**年**月**日  

**卖方（盖章）：** ✍（盖章处）
2025-03-03 13:09:19.497 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"1cc17ae5-0566-4f17-9e1a-fa24549f2f3a","workflow_run_id":"84e78727-ca04-4aba-902a-395efe0860d2","data":{"id":"84e78727-ca04-4aba-902a-395efe0860d2","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 特别说明：\n\n1. 土地用途均为办公及商业用地。  \n2. 本表所载建筑面积为预测建筑面积，最终数据以政府测绘部门实测面积为准，若政府测绘部门最终确认的面积与本表所载面积有差异的，按合同约定的处理方式处理。  \n3. 本表所列“分摊建筑面积”为参考面积，最终数据以政府测绘部门实测面积为准。  \n4. 本表所列建筑面积均以平方米计算。  \n5. 本表所列数据如与政府相关部门批准的数据不一致的，以政府相关部门最终批准的数据为准。  \n6. 以上所列内容仅供参考，最终以《上海市商品房预售合同》及附件约定为准。  \n7. 以上所列内容如与合同及附件不一致的，以合同及附件约定为准。  \n\n---\n\n### 重要提示：\n在签订《上海市商品房预售合同》（上海市商品房出售合同）及补充协议后，买受人已明确知晓并理解本表所载内容。  \n\n鉴于商品房存在小数点后的尾数，买受人同意，相关数据按四舍五入计算。  \n\n买受人已了解、同意，并愿意遵守本表所述的内容。  \n\n---\n\n**买受人签字：** ✍（签名处）  \n**签订日期：** 20**年**月**日  \n\n**卖方（盖章）：** ✍（盖章处）"},"elapsed_time":16.238195372978225,"total_tokens":756,"total_steps":4,"created_at":1740978541,"finished_at":1740978557}}
2025-03-03 13:09:19.498 DEBUG 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 13:09:19.498  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, fileSize=5588
2025-03-03 13:09:19.498 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=7-《臻心公告 项目红线内不利因素提示》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:09:19.585  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"6838e7c8-acc9-4292-a0e7-4e5c7721a2e8","position":6,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"96b4132f-1f89-45ca-a737-e41ab479dc3a"},"data_source_detail_dict":{"upload_file":{"id":"96b4132f-1f89-45ca-a737-e41ab479dc3a","name":"7-《臻心公告 项目红线内不利因素提示》.md","size":5588,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740978557.811509}},"dataset_process_rule_id":"27f4a8e4-c18e-4ffe-9e9d-a642d9aa5684","name":"7-《臻心公告 项目红线内不利因素提示》.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740978558,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":2951,"hit_count":0,"doc_form":"text_model"},"batch":"20250303050917111724"}
2025-03-03 13:09:19.586  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 7-《臻心公告 项目红线内不利因素提示》.pdf
2025-03-03 13:09:19.608 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:09:19.608 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:09:19.627 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:09:19.771 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:09:19.772 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:09:19.772 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:09:19.793 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:09:19.950 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:09:20.652  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 6-《臻心公告 特别告知书》.pdf
2025-03-03 13:09:20.672 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:09:20.672 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:09:20.693 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:09:20.838 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:09:20.840  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf
2025-03-03 13:09:20.840  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf, userId=system
2025-03-03 13:09:20.840 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:09:20.840 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:09:21.095  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=825f68d6-b6a9-47a8-9968-1de6a8e9ae2f
2025-03-03 13:09:21.095 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"825f68d6-b6a9-47a8-9968-1de6a8e9ae2f"}},"response_mode":"blocking","conversation_id":"f0934ae4-43b1-44a0-b182-9b5a4e3745a3","user":"fyjw"}
2025-03-03 13:09:21.137 ERROR 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:09:21.137  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 6-《臻心公告 特别告知书》.pdf
2025-03-03 13:09:21.139 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:09:21.139 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:09:21.159 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:09:21.291 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:09:21.915  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_0.png
2025-03-03 13:09:21.916  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_0.png, userId=system
2025-03-03 13:09:21.916 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:09:21.916 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:09:22.057  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=5f987343-0c3d-475c-a0ea-67aaff6ad07f
2025-03-03 13:09:22.057 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"5f987343-0c3d-475c-a0ea-67aaff6ad07f"}},"response_mode":"blocking","conversation_id":"678f5481-f2a1-4b19-b9ce-3c539ac43286","user":"fyjw"}
2025-03-03 13:09:37.874 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"dc23dc56-2759-46dd-8bef-9ee08b6865ab","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"# 致心公告 特别告知书\n\n为帮助用户慎重选择用药，现就受受众人群普遍关注的事项特别注意以下事项：\n\n### 一、受众人群慎重使用的特别提示：\n1. 受众人群关于该药品的获益风险比例以及少见但严重伤害等有临床不确定性，包括下列可能存在获益风险不明或需慎重使用的人群：\n   - 老年人及/或存在肝肾功能异常者；\n   - 孕妇、哺乳期妇女、儿童青少年等身体发育未成熟的群体；\n   - 其他特殊人群（如免疫功能异常者等）。\n   \n2. 患者个人情况个体差异较大，临床研究结论对具体人群的适用性有限，不作个体的获益风险评估和治疗建议。\n\n3. 本药品的安全性有效性信息可能来源于国内外药品说明书、临床研究、相关文献资料等，部分可能存在争议，或来源于有限的研究数据。\n\n### 二、药品信息的参考与使用：\n1. 受众人群应仔细阅读药品说明书（如为进口药品，可参考国内外说明书），并在医生或药师的指导下使用。\n\n2. 受众人群应结合自身健康状况、既往病史、家族史等，综合考虑药品的获益风险，慎重决策。\n\n3. 如有疑问，建议咨询医生或药师，不可盲目跟风用药或自行调整剂量。\n\n### 三、特别提醒：\n1. 本药品可能存在罕见但严重的副作用，如过敏反应、肝肾损害、血液系统异常等，需密切关注自身反应。\n\n2. 受众人群在使用过程中如出现任何不适，建议立即停药并就医。\n\n3. 相关药品信息会根据最新研究和监管要求不断更新，受众人群应以官方发布的最新信息为准。\n\n### 四、免责声明：\n1. 本特别告知书仅供参考，不作为具体医疗建议或法律依据。\n\n2. 受众人群的用药决策需基于医生或药师的专业指导，本药品的生产、销售方不对因个人不当使用造成的后果承担责任。\n\n3. 受众人群在使用前应充分了解药品信息，并自行承担使用风险。\n\n**特此告知！**\n\n**签字：**  \n**（签名）**  \n**日期：**"},"elapsed_time":15.769674066919833,"total_tokens":978,"total_steps":4,"created_at":1740978560,"finished_at":1740978576}
2025-03-03 13:09:37.874  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_0.png, text=# 致心公告 特别告知书

为帮助用户慎重选择用药，现就受受众人群普遍关注的事项特别注意以下事项：

### 一、受众人群慎重使用的特别提示：
1. 受众人群关于该药品的获益风险比例以及少见但严重伤害等有临床不确定性，包括下列可能存在获益风险不明或需慎重使用的人群：
   - 老年人及/或存在肝肾功能异常者；
   - 孕妇、哺乳期妇女、儿童青少年等身体发育未成熟的群体；
   - 其他特殊人群（如免疫功能异常者等）。
   
2. 患者个人情况个体差异较大，临床研究结论对具体人群的适用性有限，不作个体的获益风险评估和治疗建议。

3. 本药品的安全性有效性信息可能来源于国内外药品说明书、临床研究、相关文献资料等，部分可能存在争议，或来源于有限的研究数据。

### 二、药品信息的参考与使用：
1. 受众人群应仔细阅读药品说明书（如为进口药品，可参考国内外说明书），并在医生或药师的指导下使用。

2. 受众人群应结合自身健康状况、既往病史、家族史等，综合考虑药品的获益风险，慎重决策。

3. 如有疑问，建议咨询医生或药师，不可盲目跟风用药或自行调整剂量。

### 三、特别提醒：
1. 本药品可能存在罕见但严重的副作用，如过敏反应、肝肾损害、血液系统异常等，需密切关注自身反应。

2. 受众人群在使用过程中如出现任何不适，建议立即停药并就医。

3. 相关药品信息会根据最新研究和监管要求不断更新，受众人群应以官方发布的最新信息为准。

### 四、免责声明：
1. 本特别告知书仅供参考，不作为具体医疗建议或法律依据。

2. 受众人群的用药决策需基于医生或药师的专业指导，本药品的生产、销售方不对因个人不当使用造成的后果承担责任。

3. 受众人群在使用前应充分了解药品信息，并自行承担使用风险。

**特此告知！**

**签字：**  
**（签名）**  
**日期：**
2025-03-03 13:09:37.875 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"b119c99b-8ea1-4dcf-b343-e50afb785bb0","workflow_run_id":"dc23dc56-2759-46dd-8bef-9ee08b6865ab","data":{"id":"dc23dc56-2759-46dd-8bef-9ee08b6865ab","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"# 致心公告 特别告知书\n\n为帮助用户慎重选择用药，现就受受众人群普遍关注的事项特别注意以下事项：\n\n### 一、受众人群慎重使用的特别提示：\n1. 受众人群关于该药品的获益风险比例以及少见但严重伤害等有临床不确定性，包括下列可能存在获益风险不明或需慎重使用的人群：\n   - 老年人及/或存在肝肾功能异常者；\n   - 孕妇、哺乳期妇女、儿童青少年等身体发育未成熟的群体；\n   - 其他特殊人群（如免疫功能异常者等）。\n   \n2. 患者个人情况个体差异较大，临床研究结论对具体人群的适用性有限，不作个体的获益风险评估和治疗建议。\n\n3. 本药品的安全性有效性信息可能来源于国内外药品说明书、临床研究、相关文献资料等，部分可能存在争议，或来源于有限的研究数据。\n\n### 二、药品信息的参考与使用：\n1. 受众人群应仔细阅读药品说明书（如为进口药品，可参考国内外说明书），并在医生或药师的指导下使用。\n\n2. 受众人群应结合自身健康状况、既往病史、家族史等，综合考虑药品的获益风险，慎重决策。\n\n3. 如有疑问，建议咨询医生或药师，不可盲目跟风用药或自行调整剂量。\n\n### 三、特别提醒：\n1. 本药品可能存在罕见但严重的副作用，如过敏反应、肝肾损害、血液系统异常等，需密切关注自身反应。\n\n2. 受众人群在使用过程中如出现任何不适，建议立即停药并就医。\n\n3. 相关药品信息会根据最新研究和监管要求不断更新，受众人群应以官方发布的最新信息为准。\n\n### 四、免责声明：\n1. 本特别告知书仅供参考，不作为具体医疗建议或法律依据。\n\n2. 受众人群的用药决策需基于医生或药师的专业指导，本药品的生产、销售方不对因个人不当使用造成的后果承担责任。\n\n3. 受众人群在使用前应充分了解药品信息，并自行承担使用风险。\n\n**特此告知！**\n\n**签字：**  \n**（签名）**  \n**日期：**"},"elapsed_time":15.769674066919833,"total_tokens":978,"total_steps":4,"created_at":1740978560,"finished_at":1740978576}}
2025-03-03 13:09:38.764  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_1.png
2025-03-03 13:09:38.764  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_1.png, userId=system
2025-03-03 13:09:38.764 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:09:38.764 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:09:38.926  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=1c1af06f-54ab-4541-9433-dadff0dafd89
2025-03-03 13:09:38.926 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"1c1af06f-54ab-4541-9433-dadff0dafd89"}},"response_mode":"blocking","conversation_id":"4b42790b-f432-444b-978e-55b0923dacf0","user":"fyjw"}
2025-03-03 13:09:56.874 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"ca4c018a-8f43-4436-92ff-185f1ec9d230","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 重要事项说明\n\n量与本标的有一项或上述的可能性发生变化的，买受人须书面方式声明，出让人有权决定暂停、变更或终止本次竞价活动。买受人应充分了解并认可出让人为实现本次竞价活动的公平、公正原则所作出的上述决定。  \n\n7. **如买受人竞得标的，须按有关法律法规办理相关审批、登记、税费手续**。  \n\n**二、联合竞买、签约委托、转让和科学种植管理**  \n\n1. **联合竞买**  \n   两个或两个以上的法人或非法人组织可以联合竞买，但联合竞买的，应当在竞买申请时向交易系统提交联合竞买协议，政府规定以外不得变更联合竞买人。联合竞买的，联合各方对竞买标的承担连带责任。  \n\n2. **签约委托**  \n   竞得人因特殊原因不能到场签约的，须补交书面委托书并提供委托代理人的身份证明文件，委托代理人代为签约的行为视为竞得人的行为，竞得人对委托代理人签署的合同承担全部责任。  \n\n3. **转让**  \n   竞得人不得转让竞买标的。因补充协议、补充约定等，买受人已经支付标的全部价款的，可申请办理标的转让手续，转让手续需符合相关法律法规的规定。  \n\n4. **科学种植管理**  \n   买受人须按照国家及地方相关规定，采用科学的种植管理模式，确保标的的可持续发展。买受人应妥善管理标的，严禁违法、违规使用。  \n\n**三、其他说明**  \n\n1. **竞买人应当具备一定的经济实力和良好的商业信用**，如竞买人存在失信记录，则出让人有权取消其竞买资格。  \n\n2. **竞得人应当按照规定的时间和方式支付成交价款**，如逾期未支付，出让人有权取消其竞得资格，并追究相关责任。  \n\n3. **出让人对标的的瑕疵不承担任何责任**，竞买人应当对标的的现状进行充分了解，一旦竞得标的，不得以任何理由提出退还或索赔要求。  \n\n4. **本公告的最终解释权归出让人所有**，如有未尽事宜，出让人有权根据实际情况进行补充说明。  \n\n**四、本次竞价活动的最终解释权归出让人所有。**  \n\n---\n\n**签署人：**  \n（签名盖章）  \n**日期：**"},"elapsed_time":17.89505586400628,"total_tokens":1034,"total_steps":4,"created_at":1740978577,"finished_at":1740978595}
2025-03-03 13:09:56.874  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

### 重要事项说明

量与本标的有一项或上述的可能性发生变化的，买受人须书面方式声明，出让人有权决定暂停、变更或终止本次竞价活动。买受人应充分了解并认可出让人为实现本次竞价活动的公平、公正原则所作出的上述决定。  

7. **如买受人竞得标的，须按有关法律法规办理相关审批、登记、税费手续**。  

**二、联合竞买、签约委托、转让和科学种植管理**  

1. **联合竞买**  
   两个或两个以上的法人或非法人组织可以联合竞买，但联合竞买的，应当在竞买申请时向交易系统提交联合竞买协议，政府规定以外不得变更联合竞买人。联合竞买的，联合各方对竞买标的承担连带责任。  

2. **签约委托**  
   竞得人因特殊原因不能到场签约的，须补交书面委托书并提供委托代理人的身份证明文件，委托代理人代为签约的行为视为竞得人的行为，竞得人对委托代理人签署的合同承担全部责任。  

3. **转让**  
   竞得人不得转让竞买标的。因补充协议、补充约定等，买受人已经支付标的全部价款的，可申请办理标的转让手续，转让手续需符合相关法律法规的规定。  

4. **科学种植管理**  
   买受人须按照国家及地方相关规定，采用科学的种植管理模式，确保标的的可持续发展。买受人应妥善管理标的，严禁违法、违规使用。  

**三、其他说明**  

1. **竞买人应当具备一定的经济实力和良好的商业信用**，如竞买人存在失信记录，则出让人有权取消其竞买资格。  

2. **竞得人应当按照规定的时间和方式支付成交价款**，如逾期未支付，出让人有权取消其竞得资格，并追究相关责任。  

3. **出让人对标的的瑕疵不承担任何责任**，竞买人应当对标的的现状进行充分了解，一旦竞得标的，不得以任何理由提出退还或索赔要求。  

4. **本公告的最终解释权归出让人所有**，如有未尽事宜，出让人有权根据实际情况进行补充说明。  

**四、本次竞价活动的最终解释权归出让人所有。**  

---

**签署人：**  
（签名盖章）  
**日期：**
2025-03-03 13:09:56.874 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"a1ac9080-7f37-4cd6-a13a-550df4fee523","workflow_run_id":"ca4c018a-8f43-4436-92ff-185f1ec9d230","data":{"id":"ca4c018a-8f43-4436-92ff-185f1ec9d230","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 重要事项说明\n\n量与本标的有一项或上述的可能性发生变化的，买受人须书面方式声明，出让人有权决定暂停、变更或终止本次竞价活动。买受人应充分了解并认可出让人为实现本次竞价活动的公平、公正原则所作出的上述决定。  \n\n7. **如买受人竞得标的，须按有关法律法规办理相关审批、登记、税费手续**。  \n\n**二、联合竞买、签约委托、转让和科学种植管理**  \n\n1. **联合竞买**  \n   两个或两个以上的法人或非法人组织可以联合竞买，但联合竞买的，应当在竞买申请时向交易系统提交联合竞买协议，政府规定以外不得变更联合竞买人。联合竞买的，联合各方对竞买标的承担连带责任。  \n\n2. **签约委托**  \n   竞得人因特殊原因不能到场签约的，须补交书面委托书并提供委托代理人的身份证明文件，委托代理人代为签约的行为视为竞得人的行为，竞得人对委托代理人签署的合同承担全部责任。  \n\n3. **转让**  \n   竞得人不得转让竞买标的。因补充协议、补充约定等，买受人已经支付标的全部价款的，可申请办理标的转让手续，转让手续需符合相关法律法规的规定。  \n\n4. **科学种植管理**  \n   买受人须按照国家及地方相关规定，采用科学的种植管理模式，确保标的的可持续发展。买受人应妥善管理标的，严禁违法、违规使用。  \n\n**三、其他说明**  \n\n1. **竞买人应当具备一定的经济实力和良好的商业信用**，如竞买人存在失信记录，则出让人有权取消其竞买资格。  \n\n2. **竞得人应当按照规定的时间和方式支付成交价款**，如逾期未支付，出让人有权取消其竞得资格，并追究相关责任。  \n\n3. **出让人对标的的瑕疵不承担任何责任**，竞买人应当对标的的现状进行充分了解，一旦竞得标的，不得以任何理由提出退还或索赔要求。  \n\n4. **本公告的最终解释权归出让人所有**，如有未尽事宜，出让人有权根据实际情况进行补充说明。  \n\n**四、本次竞价活动的最终解释权归出让人所有。**  \n\n---\n\n**签署人：**  \n（签名盖章）  \n**日期：**"},"elapsed_time":17.89505586400628,"total_tokens":1034,"total_steps":4,"created_at":1740978577,"finished_at":1740978595}}
2025-03-03 13:09:57.446  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_2.png
2025-03-03 13:09:57.446  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_2.png, userId=system
2025-03-03 13:09:57.446 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:09:57.446 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:09:57.552  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=0d781ca6-0e57-4d6e-a85e-253ad9515914
2025-03-03 13:09:57.553 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"0d781ca6-0e57-4d6e-a85e-253ad9515914"}},"response_mode":"blocking","conversation_id":"09ef9ff9-fa45-4456-a1c0-b092c539f291","user":"fyjw"}
2025-03-03 13:10:10.660 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"7eef9d23-c13c-4167-8faf-ea14b2b99c72","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文本内容转换为Markdown格式：\n\n---\n\n对上述全部内容均为本人作出了充分审慎的认知，并确认知悉上述提示仅为提供原则性提示，未来可能会有变化，以上提示仅供参考，实际以合同等书面资料约定为准。无论未来是否签署正式合同文件，未能通过最终审核，本人最终均可能无法开设的账户及进行相关交易，且无论出于何种原因未能开设账户及进行相关交易，本人都不会向贵公司主张任何责任。\n\n本人同意贵公司及相关合作方依据适用的法律法规和监管规定开立账户，并向本人提供相关交易服务。本人确认已阅读并理解《商品期货交易风险揭示书》及《商品期货交易须知》的全部内容，并愿意承担相应的全部风险。\n\n特此确认。\n\n买受人签字：  \n**（签名）**  \n\n日期：**2024年8月20日**  \n\n---\n\n## 诚心公告  \n### 项目重要性信息提示  \n\n澄水法拍房（以下简称“本房产”）  \n\n---\n\n以上为图片中的主要文本内容。"},"elapsed_time":13.064001499908045,"total_tokens":657,"total_steps":4,"created_at":1740978595,"finished_at":1740978608}
2025-03-03 13:10:10.661  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_2.png, text=以下是图片中的文本内容转换为Markdown格式：

---

对上述全部内容均为本人作出了充分审慎的认知，并确认知悉上述提示仅为提供原则性提示，未来可能会有变化，以上提示仅供参考，实际以合同等书面资料约定为准。无论未来是否签署正式合同文件，未能通过最终审核，本人最终均可能无法开设的账户及进行相关交易，且无论出于何种原因未能开设账户及进行相关交易，本人都不会向贵公司主张任何责任。

本人同意贵公司及相关合作方依据适用的法律法规和监管规定开立账户，并向本人提供相关交易服务。本人确认已阅读并理解《商品期货交易风险揭示书》及《商品期货交易须知》的全部内容，并愿意承担相应的全部风险。

特此确认。

买受人签字：  
**（签名）**  

日期：**2024年8月20日**  

---

## 诚心公告  
### 项目重要性信息提示  

澄水法拍房（以下简称“本房产”）  

---

以上为图片中的主要文本内容。
2025-03-03 13:10:10.661 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"166cf2d8-eddc-4294-8a41-b7e0b11b79b3","workflow_run_id":"7eef9d23-c13c-4167-8faf-ea14b2b99c72","data":{"id":"7eef9d23-c13c-4167-8faf-ea14b2b99c72","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文本内容转换为Markdown格式：\n\n---\n\n对上述全部内容均为本人作出了充分审慎的认知，并确认知悉上述提示仅为提供原则性提示，未来可能会有变化，以上提示仅供参考，实际以合同等书面资料约定为准。无论未来是否签署正式合同文件，未能通过最终审核，本人最终均可能无法开设的账户及进行相关交易，且无论出于何种原因未能开设账户及进行相关交易，本人都不会向贵公司主张任何责任。\n\n本人同意贵公司及相关合作方依据适用的法律法规和监管规定开立账户，并向本人提供相关交易服务。本人确认已阅读并理解《商品期货交易风险揭示书》及《商品期货交易须知》的全部内容，并愿意承担相应的全部风险。\n\n特此确认。\n\n买受人签字：  \n**（签名）**  \n\n日期：**2024年8月20日**  \n\n---\n\n## 诚心公告  \n### 项目重要性信息提示  \n\n澄水法拍房（以下简称“本房产”）  \n\n---\n\n以上为图片中的主要文本内容。"},"elapsed_time":13.064001499908045,"total_tokens":657,"total_steps":4,"created_at":1740978595,"finished_at":1740978608}}
2025-03-03 13:10:11.357  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_3.png
2025-03-03 13:10:11.357  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_3.png, userId=system
2025-03-03 13:10:11.358 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:10:11.358 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:10:11.587  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=85a56900-dc98-440b-94be-2a8cf5ed524c
2025-03-03 13:10:11.588 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"85a56900-dc98-440b-94be-2a8cf5ed524c"}},"response_mode":"blocking","conversation_id":"7e0148e3-4c19-4ada-a121-72369e04d032","user":"fyjw"}
2025-03-03 13:10:53.369 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"a8b9dcaa-4f97-4463-b3e7-068c54ec1e8d","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该表格内容的Markdown格式转换：\n\n```markdown\n# 样板房公关维护单\n\n## 房  号：\n## 步及楼栋/单元：\n## 装修完成度：\n## 问题描述：\n\n### **高层**\n#### **1#、3#、8#**\n##### **窗户尺寸**\n- 客厅推拉门尺寸不符（门洞尺寸偏小），影响通风、采光、美观。\n\n##### **厨房尺寸**\n- 厨房下柜尺寸偏小，影响收纳功能。\n- 橱柜台面高度偏低。\n\n##### **下水管**\n- 卫生间下水管口过高，影响淋浴房安装。\n- 厨房下水管口过高，影响橱柜安装。\n\n##### **门槛石**\n- 门槛石颜色不一致，影响美观。\n\n##### **地漏**\n- 地漏未居中，影响排水效果。\n\n#### **2# 5# 7#**\n##### **入户大堂**\n- 入户大堂墙砖铺贴不平整，影响美观。\n- 大堂地砖拼花不对称，影响整体效果。\n\n##### **电梯**\n- 电梯门套收口不平整，影响美观。\n- 电梯按键高度偏高，不符合人体工学。\n\n#### **4# 6# 13# 14#**\n##### **卫生间**\n- 卫生间台盆高度偏低，不符合人体工学。\n- 卫生间镜前灯未安装。\n\n##### **厨房**\n- 厨房烟道止逆阀未安装，影响油烟排放。\n- 厨房吊柜高度过高，使用不便。\n\n##### **外立面**\n- 外立面涂料色差明显，影响整体效果。\n\n##### **阳台**\n- 阳台栏杆高度偏低，存在安全隐患。\n- 阳台地面坡度不足，影响排水。\n\n---\n\n**甲方代表：**  \n**乙方代表：**  \n**日期：**\n```\n\n此转换完整保留了原始表格的内容，并确保格式清晰易读。"},"elapsed_time":41.74137259880081,"total_tokens":870,"total_steps":4,"created_at":1740978609,"finished_at":1740978651}
2025-03-03 13:10:53.370  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_3.png, text=以下是该表格内容的Markdown格式转换：

```markdown
# 样板房公关维护单

## 房  号：
## 步及楼栋/单元：
## 装修完成度：
## 问题描述：

### **高层**
#### **1#、3#、8#**
##### **窗户尺寸**
- 客厅推拉门尺寸不符（门洞尺寸偏小），影响通风、采光、美观。

##### **厨房尺寸**
- 厨房下柜尺寸偏小，影响收纳功能。
- 橱柜台面高度偏低。

##### **下水管**
- 卫生间下水管口过高，影响淋浴房安装。
- 厨房下水管口过高，影响橱柜安装。

##### **门槛石**
- 门槛石颜色不一致，影响美观。

##### **地漏**
- 地漏未居中，影响排水效果。

#### **2# 5# 7#**
##### **入户大堂**
- 入户大堂墙砖铺贴不平整，影响美观。
- 大堂地砖拼花不对称，影响整体效果。

##### **电梯**
- 电梯门套收口不平整，影响美观。
- 电梯按键高度偏高，不符合人体工学。

#### **4# 6# 13# 14#**
##### **卫生间**
- 卫生间台盆高度偏低，不符合人体工学。
- 卫生间镜前灯未安装。

##### **厨房**
- 厨房烟道止逆阀未安装，影响油烟排放。
- 厨房吊柜高度过高，使用不便。

##### **外立面**
- 外立面涂料色差明显，影响整体效果。

##### **阳台**
- 阳台栏杆高度偏低，存在安全隐患。
- 阳台地面坡度不足，影响排水。

---

**甲方代表：**  
**乙方代表：**  
**日期：**
```

此转换完整保留了原始表格的内容，并确保格式清晰易读。
2025-03-03 13:10:53.370 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"54931d72-8dd1-47be-a3ef-2f57d90f089b","workflow_run_id":"a8b9dcaa-4f97-4463-b3e7-068c54ec1e8d","data":{"id":"a8b9dcaa-4f97-4463-b3e7-068c54ec1e8d","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该表格内容的Markdown格式转换：\n\n```markdown\n# 样板房公关维护单\n\n## 房  号：\n## 步及楼栋/单元：\n## 装修完成度：\n## 问题描述：\n\n### **高层**\n#### **1#、3#、8#**\n##### **窗户尺寸**\n- 客厅推拉门尺寸不符（门洞尺寸偏小），影响通风、采光、美观。\n\n##### **厨房尺寸**\n- 厨房下柜尺寸偏小，影响收纳功能。\n- 橱柜台面高度偏低。\n\n##### **下水管**\n- 卫生间下水管口过高，影响淋浴房安装。\n- 厨房下水管口过高，影响橱柜安装。\n\n##### **门槛石**\n- 门槛石颜色不一致，影响美观。\n\n##### **地漏**\n- 地漏未居中，影响排水效果。\n\n#### **2# 5# 7#**\n##### **入户大堂**\n- 入户大堂墙砖铺贴不平整，影响美观。\n- 大堂地砖拼花不对称，影响整体效果。\n\n##### **电梯**\n- 电梯门套收口不平整，影响美观。\n- 电梯按键高度偏高，不符合人体工学。\n\n#### **4# 6# 13# 14#**\n##### **卫生间**\n- 卫生间台盆高度偏低，不符合人体工学。\n- 卫生间镜前灯未安装。\n\n##### **厨房**\n- 厨房烟道止逆阀未安装，影响油烟排放。\n- 厨房吊柜高度过高，使用不便。\n\n##### **外立面**\n- 外立面涂料色差明显，影响整体效果。\n\n##### **阳台**\n- 阳台栏杆高度偏低，存在安全隐患。\n- 阳台地面坡度不足，影响排水。\n\n---\n\n**甲方代表：**  \n**乙方代表：**  \n**日期：**\n```\n\n此转换完整保留了原始表格的内容，并确保格式清晰易读。"},"elapsed_time":41.74137259880081,"total_tokens":870,"total_steps":4,"created_at":1740978609,"finished_at":1740978651}}
2025-03-03 13:10:54.064  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_4.png
2025-03-03 13:10:54.064  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_4.png, userId=system
2025-03-03 13:10:54.064 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:10:54.064 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:10:54.319  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=1d020c2e-1ce6-4a68-9c6d-ff770067f6bf
2025-03-03 13:10:54.319 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"1d020c2e-1ce6-4a68-9c6d-ff770067f6bf"}},"response_mode":"blocking","conversation_id":"2a8e2f8a-10d9-44bf-891a-2ec00594868a","user":"fyjw"}
2025-03-03 13:11:42.856 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d26a0f4c-8894-46e5-951d-f8f3b8665a02","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中内容的Markdown格式转换：\n\n---\n\n# 户型避坑\n\n| 产品类型 | 涉及楼栋/单元 | 户型避坑 | 问题描述 |\n|---------|------------|---------|---------|\n| **高层** | 1#楼 3#号 | 3#号 | ① B-5户型的客厅阳台外侧有横梁，影响美观（层高降低）。<br>② B-5户型的主卧窗户与外墙交界处有大宽度剪力墙，影响采光及视野（层高降低）。 |\n| 1#楼 2#号 | 2#号 | ① B-1户型的主卧窗户在靠近外墙交界处有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 2#楼 5#号 | 5#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 2#楼 7#号 | 7#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 2#楼 8#号 | 8#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 3#楼 1#单元 | 1#单元 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 3#楼 2#单元 | 2#单元 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 1#单元 | 1#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 2#单元 | 2#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 3#单元 | 3#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 4#单元 | 4#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n\n---\n\n该表格主要列出了不同楼栋和单元的户型问题，主要集中在主卧窗户剪力墙影响采光和厨房窗户较小通风受限等方面。"},"elapsed_time":48.49506132910028,"total_tokens":1240,"total_steps":4,"created_at":1740978652,"finished_at":1740978701}
2025-03-03 13:11:42.856  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_4.png, text=以下是图片中内容的Markdown格式转换：

---

# 户型避坑

| 产品类型 | 涉及楼栋/单元 | 户型避坑 | 问题描述 |
|---------|------------|---------|---------|
| **高层** | 1#楼 3#号 | 3#号 | ① B-5户型的客厅阳台外侧有横梁，影响美观（层高降低）。<br>② B-5户型的主卧窗户与外墙交界处有大宽度剪力墙，影响采光及视野（层高降低）。 |
| 1#楼 2#号 | 2#号 | ① B-1户型的主卧窗户在靠近外墙交界处有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |
| 2#楼 5#号 | 5#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |
| 2#楼 7#号 | 7#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |
| 2#楼 8#号 | 8#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |
| 3#楼 1#单元 | 1#单元 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |
| 3#楼 2#单元 | 2#单元 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |
| 4#楼 1#单元 | 1#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |
| 4#楼 2#单元 | 2#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |
| 4#楼 3#单元 | 3#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |
| 4#楼 4#单元 | 4#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |

---

该表格主要列出了不同楼栋和单元的户型问题，主要集中在主卧窗户剪力墙影响采光和厨房窗户较小通风受限等方面。
2025-03-03 13:11:42.856 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"20c2e709-ee91-409e-a830-19b81a149bb2","workflow_run_id":"d26a0f4c-8894-46e5-951d-f8f3b8665a02","data":{"id":"d26a0f4c-8894-46e5-951d-f8f3b8665a02","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中内容的Markdown格式转换：\n\n---\n\n# 户型避坑\n\n| 产品类型 | 涉及楼栋/单元 | 户型避坑 | 问题描述 |\n|---------|------------|---------|---------|\n| **高层** | 1#楼 3#号 | 3#号 | ① B-5户型的客厅阳台外侧有横梁，影响美观（层高降低）。<br>② B-5户型的主卧窗户与外墙交界处有大宽度剪力墙，影响采光及视野（层高降低）。 |\n| 1#楼 2#号 | 2#号 | ① B-1户型的主卧窗户在靠近外墙交界处有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 2#楼 5#号 | 5#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 2#楼 7#号 | 7#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 2#楼 8#号 | 8#号 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 3#楼 1#单元 | 1#单元 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 3#楼 2#单元 | 2#单元 | ① B-1户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-1户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 1#单元 | 1#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 2#单元 | 2#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 3#单元 | 3#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n| 4#楼 4#单元 | 4#单元 | ① B-2户型的主卧窗户有剪力墙，影响采光及视野。<br>② B-2户型的厨房窗户较小，通风及采光受限。 |\n\n---\n\n该表格主要列出了不同楼栋和单元的户型问题，主要集中在主卧窗户剪力墙影响采光和厨房窗户较小通风受限等方面。"},"elapsed_time":48.49506132910028,"total_tokens":1240,"total_steps":4,"created_at":1740978652,"finished_at":1740978701}}
2025-03-03 13:11:43.538  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_5.png
2025-03-03 13:11:43.538  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_5.png, userId=system
2025-03-03 13:11:43.538 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:11:43.539 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:11:43.753  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=486b87c1-c510-4f44-b22a-eb4f8d7702cb
2025-03-03 13:11:43.753 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"486b87c1-c510-4f44-b22a-eb4f8d7702cb"}},"response_mode":"blocking","conversation_id":"0102e4e3-f0bc-4234-9f81-ab4b112e15b0","user":"fyjw"}
2025-03-03 13:12:07.672 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"5c175c15-3adc-46b6-a804-292b84ae7919","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中内容的转录：\n\n---\n\n### 6 轴 10-11 号\n#### 同类型产品\n周围建筑围护做法相似，可借鉴类似项目同类型产品做法。\n\n#### 同类型产品说明\n6 轴 10 号及周边建筑主楼 A3 产品户型建筑外立面、幕墙、阳台栏杆等均与本项目类似，可作为参考依据。\n\n#### 相邻情况\n- 6 轴 10 号建筑外立面与本项目 A1、A2 产品一致。\n- 6 轴 11 号建筑外立面与本项目 A1、A2 产品相似。\n- 6 轴 10 号与 6 轴 11 号之间存在间距，需考虑日照和景观影响。\n\n#### 说明\n- 6 轴 10 号、6 轴 11 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。\n- 需要进一步确认幕墙系统及材料的具体规格与安装方式。\n\n---\n\n### 高层\n#### 5 轴 8-9 号\n#### 同类型产品\n周围建筑围护做法相似，可借鉴类似项目同类型产品做法。\n\n#### 同类型产品说明\n5 轴 8 号建筑外立面与本项目 A3 产品户型建筑形式、幕墙、阳台栏杆等均相似，可作为参考依据。\n\n#### 相邻情况\n- 5 轴 8 号建筑外立面与本项目 A1、A2 产品一致。\n- 5 轴 9 号建筑外立面与本项目 A1、A2 产品相似。\n- 5 轴 8 号与 5 轴 9 号之间存在间距，需考虑日照和景观影响。\n\n#### 说明\n- 5 轴 8 号、5 轴 9 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。\n- 需要进一步确认幕墙系统及材料的具体规格与安装方式。\n\n---\n\n### 7 轴 12 号、15 号、18 号\n#### 同类型产品\n周围建筑围护做法相似，可借鉴类似项目同类型产品做法。\n\n#### 同类型产品说明\n7 轴 12 号、15 号、18 号建筑外立面与本项目 A3 产品户型建筑形式、幕墙、阳台栏杆等均相似，可作为参考依据。\n\n#### 相邻情况\n- 7 轴 12 号、15 号、18 号建筑外立面与本项目 A1、A2 产品一致。\n- 7 轴 12 号与 7 轴 15 号、7 轴 18 号之间存在间距，需考虑日照和景观影响。\n\n#### 说明\n- 7 轴 12 号、15 号、18 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。\n- 需要进一步确认幕墙系统及材料的具体规格与安装方式。\n\n---\n\n### 三层户型产品设计\n三层户型产品的具体设计方案待补充。\n\n---\n\n**客户公章：**  \n（盖章部分）"},"elapsed_time":23.867593576200306,"total_tokens":1166,"total_steps":4,"created_at":1740978702,"finished_at":1740978725}
2025-03-03 13:12:07.673  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_5.png, text=以下是图片中内容的转录：

---

### 6 轴 10-11 号
#### 同类型产品
周围建筑围护做法相似，可借鉴类似项目同类型产品做法。

#### 同类型产品说明
6 轴 10 号及周边建筑主楼 A3 产品户型建筑外立面、幕墙、阳台栏杆等均与本项目类似，可作为参考依据。

#### 相邻情况
- 6 轴 10 号建筑外立面与本项目 A1、A2 产品一致。
- 6 轴 11 号建筑外立面与本项目 A1、A2 产品相似。
- 6 轴 10 号与 6 轴 11 号之间存在间距，需考虑日照和景观影响。

#### 说明
- 6 轴 10 号、6 轴 11 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。
- 需要进一步确认幕墙系统及材料的具体规格与安装方式。

---

### 高层
#### 5 轴 8-9 号
#### 同类型产品
周围建筑围护做法相似，可借鉴类似项目同类型产品做法。

#### 同类型产品说明
5 轴 8 号建筑外立面与本项目 A3 产品户型建筑形式、幕墙、阳台栏杆等均相似，可作为参考依据。

#### 相邻情况
- 5 轴 8 号建筑外立面与本项目 A1、A2 产品一致。
- 5 轴 9 号建筑外立面与本项目 A1、A2 产品相似。
- 5 轴 8 号与 5 轴 9 号之间存在间距，需考虑日照和景观影响。

#### 说明
- 5 轴 8 号、5 轴 9 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。
- 需要进一步确认幕墙系统及材料的具体规格与安装方式。

---

### 7 轴 12 号、15 号、18 号
#### 同类型产品
周围建筑围护做法相似，可借鉴类似项目同类型产品做法。

#### 同类型产品说明
7 轴 12 号、15 号、18 号建筑外立面与本项目 A3 产品户型建筑形式、幕墙、阳台栏杆等均相似，可作为参考依据。

#### 相邻情况
- 7 轴 12 号、15 号、18 号建筑外立面与本项目 A1、A2 产品一致。
- 7 轴 12 号与 7 轴 15 号、7 轴 18 号之间存在间距，需考虑日照和景观影响。

#### 说明
- 7 轴 12 号、15 号、18 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。
- 需要进一步确认幕墙系统及材料的具体规格与安装方式。

---

### 三层户型产品设计
三层户型产品的具体设计方案待补充。

---

**客户公章：**  
（盖章部分）
2025-03-03 13:12:07.673 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"3e865640-4c2e-4764-bd82-5a2b75cb67d8","workflow_run_id":"5c175c15-3adc-46b6-a804-292b84ae7919","data":{"id":"5c175c15-3adc-46b6-a804-292b84ae7919","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中内容的转录：\n\n---\n\n### 6 轴 10-11 号\n#### 同类型产品\n周围建筑围护做法相似，可借鉴类似项目同类型产品做法。\n\n#### 同类型产品说明\n6 轴 10 号及周边建筑主楼 A3 产品户型建筑外立面、幕墙、阳台栏杆等均与本项目类似，可作为参考依据。\n\n#### 相邻情况\n- 6 轴 10 号建筑外立面与本项目 A1、A2 产品一致。\n- 6 轴 11 号建筑外立面与本项目 A1、A2 产品相似。\n- 6 轴 10 号与 6 轴 11 号之间存在间距，需考虑日照和景观影响。\n\n#### 说明\n- 6 轴 10 号、6 轴 11 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。\n- 需要进一步确认幕墙系统及材料的具体规格与安装方式。\n\n---\n\n### 高层\n#### 5 轴 8-9 号\n#### 同类型产品\n周围建筑围护做法相似，可借鉴类似项目同类型产品做法。\n\n#### 同类型产品说明\n5 轴 8 号建筑外立面与本项目 A3 产品户型建筑形式、幕墙、阳台栏杆等均相似，可作为参考依据。\n\n#### 相邻情况\n- 5 轴 8 号建筑外立面与本项目 A1、A2 产品一致。\n- 5 轴 9 号建筑外立面与本项目 A1、A2 产品相似。\n- 5 轴 8 号与 5 轴 9 号之间存在间距，需考虑日照和景观影响。\n\n#### 说明\n- 5 轴 8 号、5 轴 9 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。\n- 需要进一步确认幕墙系统及材料的具体规格与安装方式。\n\n---\n\n### 7 轴 12 号、15 号、18 号\n#### 同类型产品\n周围建筑围护做法相似，可借鉴类似项目同类型产品做法。\n\n#### 同类型产品说明\n7 轴 12 号、15 号、18 号建筑外立面与本项目 A3 产品户型建筑形式、幕墙、阳台栏杆等均相似，可作为参考依据。\n\n#### 相邻情况\n- 7 轴 12 号、15 号、18 号建筑外立面与本项目 A1、A2 产品一致。\n- 7 轴 12 号与 7 轴 15 号、7 轴 18 号之间存在间距，需考虑日照和景观影响。\n\n#### 说明\n- 7 轴 12 号、15 号、18 号建筑外墙材料、颜色、幕墙系统、阳台栏杆等与本项目 A1、A2 产品相似，可作为参考。\n- 需要进一步确认幕墙系统及材料的具体规格与安装方式。\n\n---\n\n### 三层户型产品设计\n三层户型产品的具体设计方案待补充。\n\n---\n\n**客户公章：**  \n（盖章部分）"},"elapsed_time":23.867593576200306,"total_tokens":1166,"total_steps":4,"created_at":1740978702,"finished_at":1740978725}}
2025-03-03 13:12:08.282  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=6-《臻心公告 特别告知书》.pdf_page_6.png
2025-03-03 13:12:08.282  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=6-《臻心公告 特别告知书》.pdf_page_6.png, userId=system
2025-03-03 13:12:08.282 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:12:08.282 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:12:08.442  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=4e3f5d10-1abf-427f-bfd8-4fa991a0d0df
2025-03-03 13:12:08.442 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"4e3f5d10-1abf-427f-bfd8-4fa991a0d0df"}},"response_mode":"blocking","conversation_id":"5a2e488a-d0bd-412d-bf4b-1c71b0defb70","user":"fyjw"}
2025-03-03 13:12:23.880 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"17f69f14-5eba-4e76-821b-c41850209dca","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 相关部位情况  \n\n7幢12层、15层，8幢6-7层电梯机房小区大门入口，7幢12层、15层，8幢6-7层电梯机房  \n\n## 围挡  \n\n**办公区围挡**：  \n办公区东侧靠围墙围挡，场地西南临近景观对外开放。  \n\n### 其他  \n\n- **办公区**  \n  1. 物资堆放整齐，标识清晰；  \n  2. 施工材料堆放整齐，标识清晰；  \n  3. 施工现场干净整洁，无建筑垃圾；  \n  4. 施工过程中无污染、噪音等影响周边环境的情况。  \n\n- **施工现场**  \n  1. 7幢12层、15层、8幢6-7层电梯机房、场地西南临近景观对外开放；  \n  2. 施工人员进入施工现场必须佩戴安全帽；  \n  3. 施工过程中应注意安全，防止高空坠物；  \n  4. 施工现场应设置安全警示标志。  \n\n---\n\n**特别说明：**  \n上述验收为公区范围。\n\n因施工需要对小区出入口进行临时封闭，给广大业主带来的不便，敬请谅解。  \n\n施工单位严格按照相关法律法规和施工标准进行施工，确保工程质量和安全。  \n\n因施工不可预见的问题，可能会造成工期的延误，施工单位将尽最大努力缩短施工周期，尽快完成施工任务，恢复小区正常通行。  \n\n感谢广大业主的理解与支持。  \n\n---\n\n**受验人签字：**  \n（盖章）  \n\n**验收日期：**  \n20**年8月**日"},"elapsed_time":15.385026759002358,"total_tokens":830,"total_steps":4,"created_at":1740978726,"finished_at":1740978742}
2025-03-03 13:12:23.880  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=6-《臻心公告 特别告知书》.pdf_page_6.png, text=以下是图片中的文字内容转换为Markdown格式：

---

## 相关部位情况  

7幢12层、15层，8幢6-7层电梯机房小区大门入口，7幢12层、15层，8幢6-7层电梯机房  

## 围挡  

**办公区围挡**：  
办公区东侧靠围墙围挡，场地西南临近景观对外开放。  

### 其他  

- **办公区**  
  1. 物资堆放整齐，标识清晰；  
  2. 施工材料堆放整齐，标识清晰；  
  3. 施工现场干净整洁，无建筑垃圾；  
  4. 施工过程中无污染、噪音等影响周边环境的情况。  

- **施工现场**  
  1. 7幢12层、15层、8幢6-7层电梯机房、场地西南临近景观对外开放；  
  2. 施工人员进入施工现场必须佩戴安全帽；  
  3. 施工过程中应注意安全，防止高空坠物；  
  4. 施工现场应设置安全警示标志。  

---

**特别说明：**  
上述验收为公区范围。

因施工需要对小区出入口进行临时封闭，给广大业主带来的不便，敬请谅解。  

施工单位严格按照相关法律法规和施工标准进行施工，确保工程质量和安全。  

因施工不可预见的问题，可能会造成工期的延误，施工单位将尽最大努力缩短施工周期，尽快完成施工任务，恢复小区正常通行。  

感谢广大业主的理解与支持。  

---

**受验人签字：**  
（盖章）  

**验收日期：**  
20**年8月**日
2025-03-03 13:12:23.880 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c491bee2-72bc-49de-951c-9a7fd3133c82","workflow_run_id":"17f69f14-5eba-4e76-821b-c41850209dca","data":{"id":"17f69f14-5eba-4e76-821b-c41850209dca","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n## 相关部位情况  \n\n7幢12层、15层，8幢6-7层电梯机房小区大门入口，7幢12层、15层，8幢6-7层电梯机房  \n\n## 围挡  \n\n**办公区围挡**：  \n办公区东侧靠围墙围挡，场地西南临近景观对外开放。  \n\n### 其他  \n\n- **办公区**  \n  1. 物资堆放整齐，标识清晰；  \n  2. 施工材料堆放整齐，标识清晰；  \n  3. 施工现场干净整洁，无建筑垃圾；  \n  4. 施工过程中无污染、噪音等影响周边环境的情况。  \n\n- **施工现场**  \n  1. 7幢12层、15层、8幢6-7层电梯机房、场地西南临近景观对外开放；  \n  2. 施工人员进入施工现场必须佩戴安全帽；  \n  3. 施工过程中应注意安全，防止高空坠物；  \n  4. 施工现场应设置安全警示标志。  \n\n---\n\n**特别说明：**  \n上述验收为公区范围。\n\n因施工需要对小区出入口进行临时封闭，给广大业主带来的不便，敬请谅解。  \n\n施工单位严格按照相关法律法规和施工标准进行施工，确保工程质量和安全。  \n\n因施工不可预见的问题，可能会造成工期的延误，施工单位将尽最大努力缩短施工周期，尽快完成施工任务，恢复小区正常通行。  \n\n感谢广大业主的理解与支持。  \n\n---\n\n**受验人签字：**  \n（盖章）  \n\n**验收日期：**  \n20**年8月**日"},"elapsed_time":15.385026759002358,"total_tokens":830,"total_steps":4,"created_at":1740978726,"finished_at":1740978742}}
2025-03-03 13:12:23.882 DEBUG 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 13:12:23.882  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=6-《臻心公告 特别告知书》.pdf, fileSize=13254
2025-03-03 13:12:23.882 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=6-《臻心公告 特别告知书》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:12:23.977  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"5a018dc1-c547-4556-a05b-634b29aa6b72","position":7,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"d3f16507-7d8b-426e-8156-f33a975bb370"},"data_source_detail_dict":{"upload_file":{"id":"d3f16507-7d8b-426e-8156-f33a975bb370","name":"6-《臻心公告 特别告知书》.md","size":13254,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740978742.205204}},"dataset_process_rule_id":"9d6d9b83-38a5-438e-bed1-83424c48b812","name":"6-《臻心公告 特别告知书》.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740978742,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":5438,"hit_count":0,"doc_form":"text_model"},"batch":"20250303051222394670"}
2025-03-03 13:12:23.977  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 6-《臻心公告 特别告知书》.pdf
2025-03-03 13:12:23.996 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:12:23.996 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:12:24.016 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:12:24.250 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:12:24.252 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:12:24.252 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:12:24.273 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:12:24.440 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:12:24.447 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:12:24.447 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:12:24.467 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:12:24.588 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:12:24.589 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:12:24.589 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:12:24.607 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:12:24.785 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:12:24.785  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=VyUqfdiAQluC2hdYzDPcAwHFnKh, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 13:12:25.215  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897730","modified_time":"1740897731","name":"8-《臻心公告 项目周边环境因素提示》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"VyUqfdiAQluC2hdYzDPcAwHFnKh","token":"IR3Gbp9TIoNgZUxDxPBcR5PonLf","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/IR3Gbp9TIoNgZUxDxPBcR5PonLf"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,51,49,34,44,34,110,97,109,101,34,58,34,56,45,-29,-128,-118,-24,-121,-69,-27,-65,-125,-27,-123,-84,-27,-111,-118,32,-23,-95,-71,-25,-101,-82,-27,-111,-88,-24,-66,-71,-25,-114,-81,-27,-94,-125,-27,-101,-96,-25,-76,-96,-26,-113,-112,-25,-92,-70,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,86,121,85,113,102,100,105,65,81,108,117,67,50,104,100,89,122,68,80,99,65,119,72,70,110,75,104,34,44,34,116,111,107,101,110,34,58,34,73,82,51,71,98,112,57,84,73,111,78,103,90,85,120,68,120,80,66,99,82,53,80,111,110,76,102,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,82,51,71,98,112,57,84,73,111,78,103,90,85,120,68,120,80,66,99,82,53,80,111,110,76,102,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:12:23 GMT"],"eagleid":["74c4871817409787430797001e"],"request-id":["1056688f-61e3-4950-918b-63e918afe17f"],"server":["Tengine"],"server-timing":["inner; dur=388","cdn-cache;desc=MISS,edge;dur=0,origin;dur=408"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache19.cn7535[408,0]"],"x-lgw-dst-svc":["PC3GvykkYF8hyZFQLgCr_s-Hex0tlRZeUaHig7VlwyRhJSgcUTWwqDqdRNBnkZGOV4BWKbWt7OtQPK4kfdlQsqtdCQjimdddzw9fIWGCx62J9-y5Ygq640gZjVoojRBZsWEYW3GLNOD4Cj5Nx8mRuffz89w3wtYK5aUpYvQYN3g7MddVAWzl6kpGuiSgGclDRK1GIIMFHc3FFRQ0AXm6WZWa92VcGlxiOhZP_r-8LiLLcFVkuDjumi1fIzXajWISH2jVEEI0M2khy7VO_2oTDOuNzHxl2bQzI-RiAYBStSb08mY9MFgESTY="],"x-request-id":["1056688f-61e3-4950-918b-63e918afe17f"],"x-timestamp":["1740978743.475"],"x-tt-logid":["20250303131223EBAD3A1698AA33F01DAD"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be2236ae61fb6bafb136d41fd3b7547bf5798adfec295c3f0bed38377f3f1d261a6b7c585bb491d673e2ec34791cf713e1cb41b102cd8a3f66ff8de6ba855b6542c0742896e5cea5d14edd9b50f2e30f3c"],"x-tt-trace-id":["00-250303131223EBAD3A1698AA33F01DAD-6A62CD370E98C571-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303131223EBAD3A1698AA33F01DAD","statusCode":200},"request":{"folder_token":"VyUqfdiAQluC2hdYzDPcAwHFnKh"},"requestId":"20250303131223EBAD3A1698AA33F01DAD"}
2025-03-03 13:12:25.215  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=IR3Gbp9TIoNgZUxDxPBcR5PonLf, fileName=8-《臻心公告 项目周边环境因素提示》.pdf, fileType=file, fileSize=null, createTime=1740897730, updateTime=1740897731)]
2025-03-03 13:12:25.700  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 13:12:25.720 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:12:25.720 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:12:25.740 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:12:25.879 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:12:25.880  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 13:12:25.880  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf, userId=system
2025-03-03 13:12:25.880 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:12:25.880 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:12:25.993  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=200b099e-1fc6-48f7-8131-fec46f78022a
2025-03-03 13:12:25.993 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"200b099e-1fc6-48f7-8131-fec46f78022a"}},"response_mode":"blocking","conversation_id":"6d79ac5c-4346-4cef-bff6-57c796984bbd","user":"fyjw"}
2025-03-03 13:12:26.023 ERROR 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:12:26.024  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 13:12:26.024 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:12:26.025 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:12:26.046 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:12:26.282 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:12:27.125  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_0.png
2025-03-03 13:12:27.125  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_0.png, userId=system
2025-03-03 13:12:27.125 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:12:27.125 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:12:27.380  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=2c25eb76-d5ad-4f5d-b57d-f573477cbcea
2025-03-03 13:12:27.380 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"2c25eb76-d5ad-4f5d-b57d-f573477cbcea"}},"response_mode":"blocking","conversation_id":"e042bd32-624b-4c2f-a477-1c3909bef9b0","user":"fyjw"}
2025-03-03 13:12:54.994 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"2ee41dfd-d82a-42c0-93e4-06f9a26251ab","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 致心公告  \n**项目周边环境影响提示**  \n\n南太湖金融城 天幕苑项目（推广名为宏融君澜苑，以下简称“本项目”）\n\n---\n\n## 周边环境情况  \n\n| 序号 | 周边环境敏感目标 | 周边环境影响情况 | 备注 |\n|------|----------------|----------------|------|\n| 1 | 规划行政办公用地 | 规划行政办公用地 |  |\n| 2 | 0~200米（含200米） | 规划行政办公用地 |  |\n| 3 | 200~500米 | 太湖国家旅游度假区、湖州市第二水源地一级保护区、湖州市南太湖水厂、湖州市市政排水设施 |  |\n| 4 | 500~1000米 | 太湖国家旅游度假区、湖州市南太湖水厂、湖州市市政排水设施 |  |\n| 5 | 1000~2000米 | 26-01地块规划住宅用地、湖州市南太湖水厂、湖州市市政排水设施 |  |\n| 6 | 2000~2500米 | 太湖国家旅游度假区、湖州市南太湖水厂、湖州市市政排水设施 |  |\n\n---\n\n**（附带红色标注区域的地图）**  \n\n（图片中包含手写签名）\n\n---\n\n这张公告主要是对南太湖金融城天幕苑项目周边环境的影响情况进行说明，列出了各个范围内的环境要素及其影响情况。"},"elapsed_time":27.573646332137287,"total_tokens":759,"total_steps":4,"created_at":1740978745,"finished_at":1740978773}
2025-03-03 13:12:54.994  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_0.png, text=以下是图片中的文字内容转换为Markdown格式：

---

# 致心公告  
**项目周边环境影响提示**  

南太湖金融城 天幕苑项目（推广名为宏融君澜苑，以下简称“本项目”）

---

## 周边环境情况  

| 序号 | 周边环境敏感目标 | 周边环境影响情况 | 备注 |
|------|----------------|----------------|------|
| 1 | 规划行政办公用地 | 规划行政办公用地 |  |
| 2 | 0~200米（含200米） | 规划行政办公用地 |  |
| 3 | 200~500米 | 太湖国家旅游度假区、湖州市第二水源地一级保护区、湖州市南太湖水厂、湖州市市政排水设施 |  |
| 4 | 500~1000米 | 太湖国家旅游度假区、湖州市南太湖水厂、湖州市市政排水设施 |  |
| 5 | 1000~2000米 | 26-01地块规划住宅用地、湖州市南太湖水厂、湖州市市政排水设施 |  |
| 6 | 2000~2500米 | 太湖国家旅游度假区、湖州市南太湖水厂、湖州市市政排水设施 |  |

---

**（附带红色标注区域的地图）**  

（图片中包含手写签名）

---

这张公告主要是对南太湖金融城天幕苑项目周边环境的影响情况进行说明，列出了各个范围内的环境要素及其影响情况。
2025-03-03 13:12:54.994 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"dfc1791f-16cc-4e6d-80b2-94f0a981a72f","workflow_run_id":"2ee41dfd-d82a-42c0-93e4-06f9a26251ab","data":{"id":"2ee41dfd-d82a-42c0-93e4-06f9a26251ab","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 致心公告  \n**项目周边环境影响提示**  \n\n南太湖金融城 天幕苑项目（推广名为宏融君澜苑，以下简称“本项目”）\n\n---\n\n## 周边环境情况  \n\n| 序号 | 周边环境敏感目标 | 周边环境影响情况 | 备注 |\n|------|----------------|----------------|------|\n| 1 | 规划行政办公用地 | 规划行政办公用地 |  |\n| 2 | 0~200米（含200米） | 规划行政办公用地 |  |\n| 3 | 200~500米 | 太湖国家旅游度假区、湖州市第二水源地一级保护区、湖州市南太湖水厂、湖州市市政排水设施 |  |\n| 4 | 500~1000米 | 太湖国家旅游度假区、湖州市南太湖水厂、湖州市市政排水设施 |  |\n| 5 | 1000~2000米 | 26-01地块规划住宅用地、湖州市南太湖水厂、湖州市市政排水设施 |  |\n| 6 | 2000~2500米 | 太湖国家旅游度假区、湖州市南太湖水厂、湖州市市政排水设施 |  |\n\n---\n\n**（附带红色标注区域的地图）**  \n\n（图片中包含手写签名）\n\n---\n\n这张公告主要是对南太湖金融城天幕苑项目周边环境的影响情况进行说明，列出了各个范围内的环境要素及其影响情况。"},"elapsed_time":27.573646332137287,"total_tokens":759,"total_steps":4,"created_at":1740978745,"finished_at":1740978773}}
2025-03-03 13:12:55.561  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_1.png
2025-03-03 13:12:55.561  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_1.png, userId=system
2025-03-03 13:12:55.561 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:12:55.561 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:12:55.714  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=c33e801a-9e54-4590-b955-93439f6e7489
2025-03-03 13:12:55.714 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"c33e801a-9e54-4590-b955-93439f6e7489"}},"response_mode":"blocking","conversation_id":"0d40798a-61ea-407d-9014-8849e33ab4f1","user":"fyjw"}
2025-03-03 13:14:36.695 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"f53c5dfa-8771-464f-82ab-8e7195d229e2","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 建筑招投标及独立履约  签约结付书\n\n以上合同由出纳已结清 2022年7月份及以前期间应用款、税费、材料及文件等费用。  \n其中包含：按合同支付的履约款项、预付款、进度款、结算款、质保金等所有相关款项，  \n并支付相应税费，已出具相应的发票、收据、收条等相关凭证，均已交付至财务归档。  \n对于未尽事宜，双方另行协商解决，出纳无须再支付任何款项，特此结清确认。  \n\n**受款人签字：**  \n（签名）  \n**日期：** 2022年8月22日  \n\n**滴水湖金融湾 天樾苑**  \n**建筑招投标及独立履约  签约结付书**  \n\n（签名）\n\n---\n\n以上是图片文本的准确转换，并保持了原格式和内容的完整性。"},"elapsed_time":100.94184417882934,"total_tokens":641,"total_steps":4,"created_at":1740978774,"finished_at":1740978874}
2025-03-03 13:14:36.695  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_1.png, text=以下是图片中的文字内容转换为Markdown格式：

---

# 建筑招投标及独立履约  签约结付书

以上合同由出纳已结清 2022年7月份及以前期间应用款、税费、材料及文件等费用。  
其中包含：按合同支付的履约款项、预付款、进度款、结算款、质保金等所有相关款项，  
并支付相应税费，已出具相应的发票、收据、收条等相关凭证，均已交付至财务归档。  
对于未尽事宜，双方另行协商解决，出纳无须再支付任何款项，特此结清确认。  

**受款人签字：**  
（签名）  
**日期：** 2022年8月22日  

**滴水湖金融湾 天樾苑**  
**建筑招投标及独立履约  签约结付书**  

（签名）

---

以上是图片文本的准确转换，并保持了原格式和内容的完整性。
2025-03-03 13:14:36.695 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"8da83545-069c-4ad4-b52b-8c2d2360633d","workflow_run_id":"f53c5dfa-8771-464f-82ab-8e7195d229e2","data":{"id":"f53c5dfa-8771-464f-82ab-8e7195d229e2","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n# 建筑招投标及独立履约  签约结付书\n\n以上合同由出纳已结清 2022年7月份及以前期间应用款、税费、材料及文件等费用。  \n其中包含：按合同支付的履约款项、预付款、进度款、结算款、质保金等所有相关款项，  \n并支付相应税费，已出具相应的发票、收据、收条等相关凭证，均已交付至财务归档。  \n对于未尽事宜，双方另行协商解决，出纳无须再支付任何款项，特此结清确认。  \n\n**受款人签字：**  \n（签名）  \n**日期：** 2022年8月22日  \n\n**滴水湖金融湾 天樾苑**  \n**建筑招投标及独立履约  签约结付书**  \n\n（签名）\n\n---\n\n以上是图片文本的准确转换，并保持了原格式和内容的完整性。"},"elapsed_time":100.94184417882934,"total_tokens":641,"total_steps":4,"created_at":1740978774,"finished_at":1740978874}}
2025-03-03 13:14:37.330  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_2.png
2025-03-03 13:14:37.330  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_2.png, userId=system
2025-03-03 13:14:37.330 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:14:37.330 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:14:37.493  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=a42db086-e14a-49a9-a9c3-4732ca011a55
2025-03-03 13:14:37.494 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"a42db086-e14a-49a9-a9c3-4732ca011a55"}},"response_mode":"blocking","conversation_id":"50258b68-361e-4d65-9dbd-efc64fc3f2d3","user":"fyjw"}
2025-03-03 13:14:56.832 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"dc462af8-aebb-4b3c-bcf3-d1dfc11f9fe3","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n# 感谢您认购 浦发绿城理想蓝本 天赋项目（推广名为金麟府，以下简称“本项目”）的商品房！请您特别关注以下事项：\n\n1. **本项目开发** 受土地成本、工程建设方案、政府规划条件、配套设施等诸多因素的影响，周边、异地、楼盘等场所的房屋价格及交易情况不作为本项目房屋价格的确定依据。\n\n2. **车位配比**  \n   - 车位总数：2136个，其中地上34个，地下2102个。  \n   - 住宅总户数：1185户，车位配比约1:1.8。  \n   - 其中：\n     - 1-2层商业配比：1:2  \n     - 住宅配比：1:1.6  \n     - 3-6层商业配比：1:2.3\n\n3. **小区配套设施**  \n   - 规划物业服务用房 约1000㎡；社区用房 约200㎡；养老服务用房 约200㎡；公厕 约35㎡。\n\n4. **住宅层高**  \n   - 标准层层高约2.95米。\n\n5. **小区建筑外立面**  \n   - 2-3层以下采用石材及涂料；3层以上采用涂料。\n\n6. **楼栋情况**  \n   - 本次销售房源楼栋号为5#、7#、8#、9#、10#楼，建筑层数为26-30层不等，建筑高度约78-98米。\n\n7. **本项目周边规划情况**  \n   - 1-4#、6#、11#-15#楼、S1-S5楼302套商品房及配套设施暂未开发建设。\n\n8. **交付标准**  \n   - 本项目住宅交付标准为 **成品住宅交付**。\n   - 交付面积以政府测绘机构实际测绘面积为准。\n\n9. **景观绿化**  \n   - 本项目内的景观绿化、园林小品、建筑小品等仅为美化环境的目的，可能会因政府要求或设计优化调整，具体以交付时的实际情况为准。\n\n10. **周边环境**  \n   - 本项目周边现状及未来规划可能因政府规划调整而变化，最终以政府最新公示为准。\n\n11. **小区管理**  \n   - 本项目为 **封闭式小区**，由物业公司实施管理。\n\n12. **商业运营**  \n   - 本项目商业部分的 **业态规划、运营方式** 由开发商自行决定，可能会调整，具体以最终运营情况为准。\n\n---\n\n**以上内容请您仔细阅读，并对相关情况予以关注，若有疑问请咨询销售人员或相关部门。**  \n**再次感谢您的支持！**\n\n---\n\n签署人：  \n**购房人：** *（签字）*  \n**日期：** 2022年8月20日  \n\n**开发商代表：** *（签字）*\n\n---\n\n请注意，以上内容是基于图片中的文字内容准确转换为Markdown格式，并保留了原有的条款和格式。"},"elapsed_time":19.282662582118064,"total_tokens":1143,"total_steps":4,"created_at":1740978875,"finished_at":1740978895}
2025-03-03 13:14:56.833  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8-《臻心公告 项目周边环境因素提示》.pdf_page_2.png, text=以下是该图片中的文字内容转换为Markdown格式：

---

# 感谢您认购 浦发绿城理想蓝本 天赋项目（推广名为金麟府，以下简称“本项目”）的商品房！请您特别关注以下事项：

1. **本项目开发** 受土地成本、工程建设方案、政府规划条件、配套设施等诸多因素的影响，周边、异地、楼盘等场所的房屋价格及交易情况不作为本项目房屋价格的确定依据。

2. **车位配比**  
   - 车位总数：2136个，其中地上34个，地下2102个。  
   - 住宅总户数：1185户，车位配比约1:1.8。  
   - 其中：
     - 1-2层商业配比：1:2  
     - 住宅配比：1:1.6  
     - 3-6层商业配比：1:2.3

3. **小区配套设施**  
   - 规划物业服务用房 约1000㎡；社区用房 约200㎡；养老服务用房 约200㎡；公厕 约35㎡。

4. **住宅层高**  
   - 标准层层高约2.95米。

5. **小区建筑外立面**  
   - 2-3层以下采用石材及涂料；3层以上采用涂料。

6. **楼栋情况**  
   - 本次销售房源楼栋号为5#、7#、8#、9#、10#楼，建筑层数为26-30层不等，建筑高度约78-98米。

7. **本项目周边规划情况**  
   - 1-4#、6#、11#-15#楼、S1-S5楼302套商品房及配套设施暂未开发建设。

8. **交付标准**  
   - 本项目住宅交付标准为 **成品住宅交付**。
   - 交付面积以政府测绘机构实际测绘面积为准。

9. **景观绿化**  
   - 本项目内的景观绿化、园林小品、建筑小品等仅为美化环境的目的，可能会因政府要求或设计优化调整，具体以交付时的实际情况为准。

10. **周边环境**  
   - 本项目周边现状及未来规划可能因政府规划调整而变化，最终以政府最新公示为准。

11. **小区管理**  
   - 本项目为 **封闭式小区**，由物业公司实施管理。

12. **商业运营**  
   - 本项目商业部分的 **业态规划、运营方式** 由开发商自行决定，可能会调整，具体以最终运营情况为准。

---

**以上内容请您仔细阅读，并对相关情况予以关注，若有疑问请咨询销售人员或相关部门。**  
**再次感谢您的支持！**

---

签署人：  
**购房人：** *（签字）*  
**日期：** 2022年8月20日  

**开发商代表：** *（签字）*

---

请注意，以上内容是基于图片中的文字内容准确转换为Markdown格式，并保留了原有的条款和格式。
2025-03-03 13:14:56.833 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"1f7a4dbf-c6ee-4403-aa7a-8563bc6dc74f","workflow_run_id":"dc462af8-aebb-4b3c-bcf3-d1dfc11f9fe3","data":{"id":"dc462af8-aebb-4b3c-bcf3-d1dfc11f9fe3","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是该图片中的文字内容转换为Markdown格式：\n\n---\n\n# 感谢您认购 浦发绿城理想蓝本 天赋项目（推广名为金麟府，以下简称“本项目”）的商品房！请您特别关注以下事项：\n\n1. **本项目开发** 受土地成本、工程建设方案、政府规划条件、配套设施等诸多因素的影响，周边、异地、楼盘等场所的房屋价格及交易情况不作为本项目房屋价格的确定依据。\n\n2. **车位配比**  \n   - 车位总数：2136个，其中地上34个，地下2102个。  \n   - 住宅总户数：1185户，车位配比约1:1.8。  \n   - 其中：\n     - 1-2层商业配比：1:2  \n     - 住宅配比：1:1.6  \n     - 3-6层商业配比：1:2.3\n\n3. **小区配套设施**  \n   - 规划物业服务用房 约1000㎡；社区用房 约200㎡；养老服务用房 约200㎡；公厕 约35㎡。\n\n4. **住宅层高**  \n   - 标准层层高约2.95米。\n\n5. **小区建筑外立面**  \n   - 2-3层以下采用石材及涂料；3层以上采用涂料。\n\n6. **楼栋情况**  \n   - 本次销售房源楼栋号为5#、7#、8#、9#、10#楼，建筑层数为26-30层不等，建筑高度约78-98米。\n\n7. **本项目周边规划情况**  \n   - 1-4#、6#、11#-15#楼、S1-S5楼302套商品房及配套设施暂未开发建设。\n\n8. **交付标准**  \n   - 本项目住宅交付标准为 **成品住宅交付**。\n   - 交付面积以政府测绘机构实际测绘面积为准。\n\n9. **景观绿化**  \n   - 本项目内的景观绿化、园林小品、建筑小品等仅为美化环境的目的，可能会因政府要求或设计优化调整，具体以交付时的实际情况为准。\n\n10. **周边环境**  \n   - 本项目周边现状及未来规划可能因政府规划调整而变化，最终以政府最新公示为准。\n\n11. **小区管理**  \n   - 本项目为 **封闭式小区**，由物业公司实施管理。\n\n12. **商业运营**  \n   - 本项目商业部分的 **业态规划、运营方式** 由开发商自行决定，可能会调整，具体以最终运营情况为准。\n\n---\n\n**以上内容请您仔细阅读，并对相关情况予以关注，若有疑问请咨询销售人员或相关部门。**  \n**再次感谢您的支持！**\n\n---\n\n签署人：  \n**购房人：** *（签字）*  \n**日期：** 2022年8月20日  \n\n**开发商代表：** *（签字）*\n\n---\n\n请注意，以上内容是基于图片中的文字内容准确转换为Markdown格式，并保留了原有的条款和格式。"},"elapsed_time":19.282662582118064,"total_tokens":1143,"total_steps":4,"created_at":1740978875,"finished_at":1740978895}}
2025-03-03 13:14:56.834 DEBUG 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 13:14:56.834  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=8-《臻心公告 项目周边环境因素提示》.pdf, fileSize=4573
2025-03-03 13:14:56.834 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=8-《臻心公告 项目周边环境因素提示》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:14:56.918  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"a89ade19-65d5-4a5a-95fe-2d129e88baf6","position":8,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"7315773f-d6a7-4a28-afae-591e2b332529"},"data_source_detail_dict":{"upload_file":{"id":"7315773f-d6a7-4a28-afae-591e2b332529","name":"8-《臻心公告 项目周边环境因素提示》.md","size":4573,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740978895.145517}},"dataset_process_rule_id":"1525821f-aa48-4413-984f-f682be8e8aeb","name":"8-《臻心公告 项目周边环境因素提示》.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740978895,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":2026,"hit_count":0,"doc_form":"text_model"},"batch":"20250303051455971321"}
2025-03-03 13:14:56.919  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 8-《臻心公告 项目周边环境因素提示》.pdf
2025-03-03 13:14:56.941 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:14:56.943 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:14:56.963 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:14:57.231 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:14:57.235 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:14:57.235 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:14:57.257 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:14:57.404 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:14:57.407 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:14:57.407 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:14:57.428 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:14:57.737 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:14:57.740 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:14:57.740 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:14:57.762 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:14:58.080 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:14:58.080  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=Lz5nfmsp1l69DsdvznwcnMcOnbb, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=18
2025-03-03 13:14:58.644  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740897718","modified_time":"1740897719","name":"5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"Lz5nfmsp1l69DsdvznwcnMcOnbb","token":"IvxCbBjEHo7mRsxXcWScjtwcnld","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/IvxCbBjEHo7mRsxXcWScjtwcnld"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,49,56,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,56,57,55,55,49,57,34,44,34,110,97,109,101,34,58,34,53,45,-29,-128,-118,-26,-69,-76,-26,-80,-76,-26,-71,-106,-23,-121,-111,-24,-98,-115,-26,-71,-66,32,-27,-92,-87,-24,-66,-119,-24,-117,-111,32,-26,-120,-73,-27,-98,-117,-27,-101,-66,-27,-113,-118,-26,-91,-68,-26,-96,-117,-26,-120,-73,-27,-98,-117,-27,-120,-122,-27,-72,-125,-24,-95,-88,32,-25,-83,-66,-25,-70,-90,-27,-111,-118,-25,-97,-91,-28,-71,-90,-29,-128,-117,46,112,100,102,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,76,122,53,110,102,109,115,112,49,108,54,57,68,115,100,118,122,110,119,99,110,77,99,79,110,98,98,34,44,34,116,111,107,101,110,34,58,34,73,118,120,67,98,66,106,69,72,111,55,109,82,115,120,88,99,87,83,99,106,116,119,99,110,108,100,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,73,118,120,67,98,66,106,69,72,111,55,109,82,115,120,88,99,87,83,99,106,116,119,99,110,108,100,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:14:56 GMT"],"eagleid":["74c4871817409788963783154e"],"request-id":["8ff841ba-4d49-445c-b65a-0a173eb4de08"],"server":["Tengine"],"server-timing":["inner; dur=406","cdn-cache;desc=MISS,edge;dur=0,origin;dur=478"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache19.cn7535[478,0]"],"x-lgw-dst-svc":["Z3ZZsbhLSXB4WvAP4wNMp3buSEQEzaQh_DFuXy-K_Ya1UiFbl-xd1XdfGUy9NnZL3b55c9p8akh99GVkU2FQKwmDpOmEhS0GaCBp25Gruplfc8plRZ-dezWi_6hzGOkto1ROWWu2wR2_ZpYzGYujDj64iGYbHIeaNhCzBmhTKwNbejZHablEB9bplQhYKsJDsf8f6s2rJ2elX24TMaFwQunTq2CfnxdTRj0pCYk732AOQOaJQ_IsarhHu5k_sG0sIqV9W_ix1yY5gIJvYy2ZYzvSFU1w94i9Qu_Rz8nWcEb63deI87k8LL0="],"x-request-id":["8ff841ba-4d49-445c-b65a-0a173eb4de08"],"x-timestamp":["1740978896.844"],"x-tt-logid":["202503031314561DFC168C64B871F6D3B6"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be2236ae61fb6bafb136d41fd3b7547bf503e5e5677591ed157939ae1e79aa89d7002205373a44bda03c8d3981df1b55a68ee9366de14758d5c7077344ad6a5f87423a1a3897e850e1b44c7decadad118d"],"x-tt-trace-id":["00-2503031314561DFC168C64B871F6D3B6-26C94B6B6ADF2930-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031314561DFC168C64B871F6D3B6","statusCode":200},"request":{"folder_token":"Lz5nfmsp1l69DsdvznwcnMcOnbb"},"requestId":"202503031314561DFC168C64B871F6D3B6"}
2025-03-03 13:14:58.645  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=IvxCbBjEHo7mRsxXcWScjtwcnld, fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, fileType=file, fileSize=null, createTime=1740897718, updateTime=1740897719)]
2025-03-03 13:14:59.273  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析Pdf: 5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 13:14:59.298 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:14:59.299 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:14:59.323 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:14:59.509 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:14:59.510  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 13:14:59.510  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, userId=system
2025-03-03 13:14:59.510 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:14:59.510 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:14:59.667  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b34d6c90-3513-4c87-9aba-c01867fa4079
2025-03-03 13:14:59.667 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"file","transfer_method":"local_file","upload_file_id":"b34d6c90-3513-4c87-9aba-c01867fa4079"}},"response_mode":"blocking","conversation_id":"4c9d8347-8aac-447a-b453-00714934e9ee","user":"fyjw"}
2025-03-03 13:14:59.711 ERROR 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件分析异常

org.springframework.web.client.HttpClientErrorException$BadRequest: 400 BAD REQUEST: "{"code": "invalid_param", "message": "'file' is not a valid FileType", "status": 400}<EOL>"
	at org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:168) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.DefaultResponseErrorHandler.handleError(DefaultResponseErrorHandler.java:122) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.ResponseErrorHandler.handleError(ResponseErrorHandler.java:63) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:825) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:783) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:717) ~[spring-web-5.3.24.jar:5.3.24]
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:608) ~[spring-web-5.3.24.jar:5.3.24]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:252) ~[classes/:na]
	at em.backend.service.impl.DifyKnowledgeServiceImpl.analyzeFileBlocking(DifyKnowledgeServiceImpl.java:288) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzePdf(FeishuFolderServiceImpl.java:463) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:249) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:240) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:14:59.712  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : PDF可能是图片类型,尝试转换为图片后分析: 5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 13:14:59.713 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:14:59.713 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:14:59.732 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:14:59.907 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:15:00.577  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_0.png
2025-03-03 13:15:00.577  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_0.png, userId=system
2025-03-03 13:15:00.577 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:15:00.577 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:15:00.893  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=08fa2dc0-3e95-493b-99bd-9ce1d0fb165f
2025-03-03 13:15:00.893 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"08fa2dc0-3e95-493b-99bd-9ce1d0fb165f"}},"response_mode":"blocking","conversation_id":"50a87c50-7751-4e94-8317-3ef5bf7d11ef","user":"fyjw"}
2025-03-03 13:15:23.747 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"fa47582d-b055-4699-a889-7a12fdae38a5","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中内容的Markdown格式转换：\n\n---\n\n# 润水湖金融海 天际湾  \n**户型图风模样产品分布备案 变更告知书**\n\n尊敬的客户:\n\n润水湖金融海 天际湾项目（以下简称“本项目”）由“广州宏宇集团 珠海市润珠房地产有限公司”开发建设。位于上冲片区南湾大道西侧（南湾大道 1088 号（1-3、5-7 号楼）、南湾北路 888 号（5-1、5-15 号））。\n\n## 变更情况说明  \n**本次调整为**：润水湖金融海 天际湾项目（“住宅分布调整、上调部分面积、下调部分面积”）。  \n\n## 具体变更情况如下：\n本项目 **5-1、5-2、5-3、5-5、5-6、5-7、5-8、5-9、5-10、5-11、5-12、5-13、5-14、5-15 号楼**（以下简称2#、6#、7#、8#、9#、10#、11#、12#、13#、14#、15#、16#、17#、18#楼）住宅产品分布调整，部分户型面积上调、部分户型面积下调。\n\n## 变更前后户型面积对比表  \n以下为调整前后各楼栋户型面积对比表：\n\n| 楼栋号 | 调整前户型面积（㎡） | 调整后户型面积（㎡） |\n|--------|----------------|----------------|\n| 5-1    | XX            | XX            |\n| 5-2    | XX            | XX            |\n| 5-3    | XX            | XX            |\n| ...    | ...           | ...           |\n\n（具体数值请参考原表格）\n\n---\n\n**特此告知！**  \n\n**珠海市润珠房地产有限公司**  \n**日期：**（手写签名及盖章）  \n\n---\n\n请注意：由于原表格中的数据较多，若需要完整的数据信息，可通过更高清的扫描或手动输入方式进行补充。"},"elapsed_time":22.813387357862666,"total_tokens":896,"total_steps":4,"created_at":1740978899,"finished_at":1740978922}
2025-03-03 13:15:23.748  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_0.png, text=以下是图片中内容的Markdown格式转换：

---

# 润水湖金融海 天际湾  
**户型图风模样产品分布备案 变更告知书**

尊敬的客户:

润水湖金融海 天际湾项目（以下简称“本项目”）由“广州宏宇集团 珠海市润珠房地产有限公司”开发建设。位于上冲片区南湾大道西侧（南湾大道 1088 号（1-3、5-7 号楼）、南湾北路 888 号（5-1、5-15 号））。

## 变更情况说明  
**本次调整为**：润水湖金融海 天际湾项目（“住宅分布调整、上调部分面积、下调部分面积”）。  

## 具体变更情况如下：
本项目 **5-1、5-2、5-3、5-5、5-6、5-7、5-8、5-9、5-10、5-11、5-12、5-13、5-14、5-15 号楼**（以下简称2#、6#、7#、8#、9#、10#、11#、12#、13#、14#、15#、16#、17#、18#楼）住宅产品分布调整，部分户型面积上调、部分户型面积下调。

## 变更前后户型面积对比表  
以下为调整前后各楼栋户型面积对比表：

| 楼栋号 | 调整前户型面积（㎡） | 调整后户型面积（㎡） |
|--------|----------------|----------------|
| 5-1    | XX            | XX            |
| 5-2    | XX            | XX            |
| 5-3    | XX            | XX            |
| ...    | ...           | ...           |

（具体数值请参考原表格）

---

**特此告知！**  

**珠海市润珠房地产有限公司**  
**日期：**（手写签名及盖章）  

---

请注意：由于原表格中的数据较多，若需要完整的数据信息，可通过更高清的扫描或手动输入方式进行补充。
2025-03-03 13:15:23.748 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"c042a7e9-77a3-4cd9-9eff-01e8588719f6","workflow_run_id":"fa47582d-b055-4699-a889-7a12fdae38a5","data":{"id":"fa47582d-b055-4699-a889-7a12fdae38a5","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中内容的Markdown格式转换：\n\n---\n\n# 润水湖金融海 天际湾  \n**户型图风模样产品分布备案 变更告知书**\n\n尊敬的客户:\n\n润水湖金融海 天际湾项目（以下简称“本项目”）由“广州宏宇集团 珠海市润珠房地产有限公司”开发建设。位于上冲片区南湾大道西侧（南湾大道 1088 号（1-3、5-7 号楼）、南湾北路 888 号（5-1、5-15 号））。\n\n## 变更情况说明  \n**本次调整为**：润水湖金融海 天际湾项目（“住宅分布调整、上调部分面积、下调部分面积”）。  \n\n## 具体变更情况如下：\n本项目 **5-1、5-2、5-3、5-5、5-6、5-7、5-8、5-9、5-10、5-11、5-12、5-13、5-14、5-15 号楼**（以下简称2#、6#、7#、8#、9#、10#、11#、12#、13#、14#、15#、16#、17#、18#楼）住宅产品分布调整，部分户型面积上调、部分户型面积下调。\n\n## 变更前后户型面积对比表  \n以下为调整前后各楼栋户型面积对比表：\n\n| 楼栋号 | 调整前户型面积（㎡） | 调整后户型面积（㎡） |\n|--------|----------------|----------------|\n| 5-1    | XX            | XX            |\n| 5-2    | XX            | XX            |\n| 5-3    | XX            | XX            |\n| ...    | ...           | ...           |\n\n（具体数值请参考原表格）\n\n---\n\n**特此告知！**  \n\n**珠海市润珠房地产有限公司**  \n**日期：**（手写签名及盖章）  \n\n---\n\n请注意：由于原表格中的数据较多，若需要完整的数据信息，可通过更高清的扫描或手动输入方式进行补充。"},"elapsed_time":22.813387357862666,"total_tokens":896,"total_steps":4,"created_at":1740978899,"finished_at":1740978922}}
2025-03-03 13:15:24.456  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_1.png
2025-03-03 13:15:24.456  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_1.png, userId=system
2025-03-03 13:15:24.456 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:15:24.456 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:15:24.747  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b7efc6a1-08d1-4cf2-818e-14e7627fb750
2025-03-03 13:15:24.748 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"b7efc6a1-08d1-4cf2-818e-14e7627fb750"}},"response_mode":"blocking","conversation_id":"e9089d6a-fb9a-4868-8334-ed988c252e1c","user":"fyjw"}
2025-03-03 13:17:40.249 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"28c3a7e5-9b13-4535-abe6-873c8e9c58e7","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片展示了不同户型的户型图，包括A户型、A1户型、A2户型、A2-1户型和A3户型。每个户型图都详细展示了房屋的布局和结构。  \n\n### 户型说明：\n- **A户型**：标准户型布局  \n- **A1户型**：A户型的四房格局户型  \n- **A2户型**：A户型的调整格局户型  \n- **A2-1户型**：A2户型的调整格局户型  \n- **A3户型**：A户型的调整格局户型  \n\n在最下方，图片还包含了“客户认定”部分，并附有签名和日期栏。这可能用于客户确认户型选择或相关文件的签署。"},"elapsed_time":135.4587945418898,"total_tokens":586,"total_steps":4,"created_at":1740978923,"finished_at":1740979058}
2025-03-03 13:17:40.249  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_1.png, text=该图片展示了不同户型的户型图，包括A户型、A1户型、A2户型、A2-1户型和A3户型。每个户型图都详细展示了房屋的布局和结构。  

### 户型说明：
- **A户型**：标准户型布局  
- **A1户型**：A户型的四房格局户型  
- **A2户型**：A户型的调整格局户型  
- **A2-1户型**：A2户型的调整格局户型  
- **A3户型**：A户型的调整格局户型  

在最下方，图片还包含了“客户认定”部分，并附有签名和日期栏。这可能用于客户确认户型选择或相关文件的签署。
2025-03-03 13:17:40.249 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"92093d06-c79c-469e-8422-7107411703dd","workflow_run_id":"28c3a7e5-9b13-4535-abe6-873c8e9c58e7","data":{"id":"28c3a7e5-9b13-4535-abe6-873c8e9c58e7","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片展示了不同户型的户型图，包括A户型、A1户型、A2户型、A2-1户型和A3户型。每个户型图都详细展示了房屋的布局和结构。  \n\n### 户型说明：\n- **A户型**：标准户型布局  \n- **A1户型**：A户型的四房格局户型  \n- **A2户型**：A户型的调整格局户型  \n- **A2-1户型**：A2户型的调整格局户型  \n- **A3户型**：A户型的调整格局户型  \n\n在最下方，图片还包含了“客户认定”部分，并附有签名和日期栏。这可能用于客户确认户型选择或相关文件的签署。"},"elapsed_time":135.4587945418898,"total_tokens":586,"total_steps":4,"created_at":1740978923,"finished_at":1740979058}}
2025-03-03 13:17:41.378  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_2.png
2025-03-03 13:17:41.378  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_2.png, userId=system
2025-03-03 13:17:41.379 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:17:41.379 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:17:41.539  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f40116e6-4c99-41d1-ba1d-e23bebc8a1db
2025-03-03 13:17:41.540 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f40116e6-4c99-41d1-ba1d-e23bebc8a1db"}},"response_mode":"blocking","conversation_id":"5433a9b5-99d9-4ae8-90ee-dc8b6d9b6d5c","user":"fyjw"}
2025-03-03 13:17:54.542 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"9069ef65-9469-41a8-b110-7ef317150c3d","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图纸展示了多个不同的户型平面图，包括：\n\n1. **B1-1 户型示意图**\n2. **B1-1 户型户型图（B1’ 为镜户型镜像户型）**\n3. **B1 户型示意图（B1’ 为镜户型镜像户型）**\n4. **B-2 分层户型建筑户型**\n5. **B-3 复式户型示意图**\n\n此外，在图纸的右下角，有手写的日期和备注信息：\n- **日期：2021.6**\n- **备注：林改38**\n\n这些图纸主要用于建筑设计或房屋规划，展示了不同类型的住宅布局，包括标准户型、镜像户型、分层户型以及复式户型等。"},"elapsed_time":12.959774838062003,"total_tokens":581,"total_steps":4,"created_at":1740979059,"finished_at":1740979072}
2025-03-03 13:17:54.543  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_2.png, text=该图纸展示了多个不同的户型平面图，包括：

1. **B1-1 户型示意图**
2. **B1-1 户型户型图（B1’ 为镜户型镜像户型）**
3. **B1 户型示意图（B1’ 为镜户型镜像户型）**
4. **B-2 分层户型建筑户型**
5. **B-3 复式户型示意图**

此外，在图纸的右下角，有手写的日期和备注信息：
- **日期：2021.6**
- **备注：林改38**

这些图纸主要用于建筑设计或房屋规划，展示了不同类型的住宅布局，包括标准户型、镜像户型、分层户型以及复式户型等。
2025-03-03 13:17:54.543 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"7db2fe74-5f82-44b3-977e-6a71930975d8","workflow_run_id":"9069ef65-9469-41a8-b110-7ef317150c3d","data":{"id":"9069ef65-9469-41a8-b110-7ef317150c3d","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图纸展示了多个不同的户型平面图，包括：\n\n1. **B1-1 户型示意图**\n2. **B1-1 户型户型图（B1’ 为镜户型镜像户型）**\n3. **B1 户型示意图（B1’ 为镜户型镜像户型）**\n4. **B-2 分层户型建筑户型**\n5. **B-3 复式户型示意图**\n\n此外，在图纸的右下角，有手写的日期和备注信息：\n- **日期：2021.6**\n- **备注：林改38**\n\n这些图纸主要用于建筑设计或房屋规划，展示了不同类型的住宅布局，包括标准户型、镜像户型、分层户型以及复式户型等。"},"elapsed_time":12.959774838062003,"total_tokens":581,"total_steps":4,"created_at":1740979059,"finished_at":1740979072}}
2025-03-03 13:17:55.168  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_3.png
2025-03-03 13:17:55.168  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_3.png, userId=system
2025-03-03 13:17:55.168 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:17:55.168 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:17:55.357  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=543e6585-f1d3-4f47-8419-74c0dca58f1a
2025-03-03 13:17:55.358 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"543e6585-f1d3-4f47-8419-74c0dca58f1a"}},"response_mode":"blocking","conversation_id":"2b5db43c-aad6-4d7b-a6e7-4007b02ece4f","user":"fyjw"}
2025-03-03 13:18:11.336 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"f2381e10-4d0b-48e6-bac4-dfe9508a9959","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片包含多个户型的平面图，并附有文字说明。以下是图片中的文字内容转换为Markdown格式：\n\n```markdown\n# 户型平面图\n\n## B-4 户型平面图\n**备注**：B-5 为该户型镜像户型\n\n## C 户型示意图\n\n## D 户型示意图（面积约125㎡）\n\n## 270 户型示意图（面积约256㎡）\n\n---\n\n**客户签字：**  \n（签名处）\n```\n\n该图片主要展示了不同户型的平面布局，包括B-4、B-5（镜像）、C、D（125㎡）和270（256㎡）户型，并提供了客户签字区域。"},"elapsed_time":15.936664114007726,"total_tokens":564,"total_steps":4,"created_at":1740979073,"finished_at":1740979089}
2025-03-03 13:18:11.336  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_3.png, text=该图片包含多个户型的平面图，并附有文字说明。以下是图片中的文字内容转换为Markdown格式：

```markdown
# 户型平面图

## B-4 户型平面图
**备注**：B-5 为该户型镜像户型

## C 户型示意图

## D 户型示意图（面积约125㎡）

## 270 户型示意图（面积约256㎡）

---

**客户签字：**  
（签名处）
```

该图片主要展示了不同户型的平面布局，包括B-4、B-5（镜像）、C、D（125㎡）和270（256㎡）户型，并提供了客户签字区域。
2025-03-03 13:18:11.336 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"9f36afac-f11f-41dd-a433-29d2f6af9619","workflow_run_id":"f2381e10-4d0b-48e6-bac4-dfe9508a9959","data":{"id":"f2381e10-4d0b-48e6-bac4-dfe9508a9959","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"该图片包含多个户型的平面图，并附有文字说明。以下是图片中的文字内容转换为Markdown格式：\n\n```markdown\n# 户型平面图\n\n## B-4 户型平面图\n**备注**：B-5 为该户型镜像户型\n\n## C 户型示意图\n\n## D 户型示意图（面积约125㎡）\n\n## 270 户型示意图（面积约256㎡）\n\n---\n\n**客户签字：**  \n（签名处）\n```\n\n该图片主要展示了不同户型的平面布局，包括B-4、B-5（镜像）、C、D（125㎡）和270（256㎡）户型，并提供了客户签字区域。"},"elapsed_time":15.936664114007726,"total_tokens":564,"total_steps":4,"created_at":1740979073,"finished_at":1740979089}}
2025-03-03 13:18:11.934  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_4.png
2025-03-03 13:18:11.934  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_4.png, userId=system
2025-03-03 13:18:11.934 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:18:11.934 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:18:12.102  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=732fbcd6-6784-4ff6-98d6-a9982344358b
2025-03-03 13:18:12.102 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"732fbcd6-6784-4ff6-98d6-a9982344358b"}},"response_mode":"blocking","conversation_id":"28bf0a1a-a0c1-40a2-bc53-8dc5e2584606","user":"fyjw"}
2025-03-03 13:19:03.534 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"9284b44a-eaa2-4161-88b5-a0a30d34f676","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 增值人办理抵押认可：\n本人所购购的**上海市浦东新区张江镇**张江高科技园区**张江三期**1088弄（1.3-5.7幢）、**丙园**城镇住宅 **888弄**（1.3-5.15幢） 上述房屋（**具体楼幢门牌号详见买卖合同**）。\n\n现以上所述房屋因购买时上手原开发商已办理银行按揭贷款抵押，尚未办理相关抵押注销手续，导致本人在银行申请购房贷款过程中，因**原开发商未办理抵押注销手续**，银行要求本人办理相关**抵押认可手续**。\n\n现本人同意认可该等抵押，愿意承担因上述未注销抵押所带来的相关风险，并承诺如因该等抵押原因导致本人所申请贷款银行无法办理抵押登记手续，造成本人贷款无法发放或产生其他损失的，本人愿意承担全部责任。\n\n此外，本人承诺：\n\n1. 该房屋尚未办理房产证。\n2. 该房屋的贷款已归还完毕，但未办理产权证。\n3. 该房屋的按揭贷款抵押尚未注销。\n\n本人知晓并理解该情况，并愿意签署本《抵押认可书》，承担由此引发的全部责任。\n\n本人签署本抵押认可书后，即视为本人已知悉该房屋的抵押情况，并同意认可该等抵押，且同意承担因该等抵押可能带来的所有责任和风险。\n\n---\n\n**购房人签名（确认无误，按承诺承担责任）：**\n\n**签名：**  \n**日期：**  \n\n---\n\n请注意，该文档是关于房屋抵押认可的声明，购房者需要明确知晓其中涉及的法律责任和风险。"},"elapsed_time":51.374874881934375,"total_tokens":831,"total_steps":4,"created_at":1740979090,"finished_at":1740979141}
2025-03-03 13:19:03.534  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf_page_4.png, text=以下是图片中的文字内容转换为Markdown格式：

---

### 增值人办理抵押认可：
本人所购购的**上海市浦东新区张江镇**张江高科技园区**张江三期**1088弄（1.3-5.7幢）、**丙园**城镇住宅 **888弄**（1.3-5.15幢） 上述房屋（**具体楼幢门牌号详见买卖合同**）。

现以上所述房屋因购买时上手原开发商已办理银行按揭贷款抵押，尚未办理相关抵押注销手续，导致本人在银行申请购房贷款过程中，因**原开发商未办理抵押注销手续**，银行要求本人办理相关**抵押认可手续**。

现本人同意认可该等抵押，愿意承担因上述未注销抵押所带来的相关风险，并承诺如因该等抵押原因导致本人所申请贷款银行无法办理抵押登记手续，造成本人贷款无法发放或产生其他损失的，本人愿意承担全部责任。

此外，本人承诺：

1. 该房屋尚未办理房产证。
2. 该房屋的贷款已归还完毕，但未办理产权证。
3. 该房屋的按揭贷款抵押尚未注销。

本人知晓并理解该情况，并愿意签署本《抵押认可书》，承担由此引发的全部责任。

本人签署本抵押认可书后，即视为本人已知悉该房屋的抵押情况，并同意认可该等抵押，且同意承担因该等抵押可能带来的所有责任和风险。

---

**购房人签名（确认无误，按承诺承担责任）：**

**签名：**  
**日期：**  

---

请注意，该文档是关于房屋抵押认可的声明，购房者需要明确知晓其中涉及的法律责任和风险。
2025-03-03 13:19:03.535 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"e9ae199e-0560-4e67-b9ba-bf609e4cc507","workflow_run_id":"9284b44a-eaa2-4161-88b5-a0a30d34f676","data":{"id":"9284b44a-eaa2-4161-88b5-a0a30d34f676","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"以下是图片中的文字内容转换为Markdown格式：\n\n---\n\n### 增值人办理抵押认可：\n本人所购购的**上海市浦东新区张江镇**张江高科技园区**张江三期**1088弄（1.3-5.7幢）、**丙园**城镇住宅 **888弄**（1.3-5.15幢） 上述房屋（**具体楼幢门牌号详见买卖合同**）。\n\n现以上所述房屋因购买时上手原开发商已办理银行按揭贷款抵押，尚未办理相关抵押注销手续，导致本人在银行申请购房贷款过程中，因**原开发商未办理抵押注销手续**，银行要求本人办理相关**抵押认可手续**。\n\n现本人同意认可该等抵押，愿意承担因上述未注销抵押所带来的相关风险，并承诺如因该等抵押原因导致本人所申请贷款银行无法办理抵押登记手续，造成本人贷款无法发放或产生其他损失的，本人愿意承担全部责任。\n\n此外，本人承诺：\n\n1. 该房屋尚未办理房产证。\n2. 该房屋的贷款已归还完毕，但未办理产权证。\n3. 该房屋的按揭贷款抵押尚未注销。\n\n本人知晓并理解该情况，并愿意签署本《抵押认可书》，承担由此引发的全部责任。\n\n本人签署本抵押认可书后，即视为本人已知悉该房屋的抵押情况，并同意认可该等抵押，且同意承担因该等抵押可能带来的所有责任和风险。\n\n---\n\n**购房人签名（确认无误，按承诺承担责任）：**\n\n**签名：**  \n**日期：**  \n\n---\n\n请注意，该文档是关于房屋抵押认可的声明，购房者需要明确知晓其中涉及的法律责任和风险。"},"elapsed_time":51.374874881934375,"total_tokens":831,"total_steps":4,"created_at":1740979090,"finished_at":1740979141}}
2025-03-03 13:19:03.536 DEBUG 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : analysisResult : 
2025-03-03 13:19:03.536  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9e74458d-e7c1-4f5d-bb67-32be98c21d1e, fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, fileSize=4933
2025-03-03 13:19:03.537 DEBUG 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9e74458d-e7c1-4f5d-bb67-32be98c21d1e/document/create-by-file, fileName=5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:19:03.627  INFO 33332 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"65681f38-44ab-4956-b8a6-d04fe7d3ec59","position":9,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"83c8ad7c-4269-42cc-ab1c-6f3f7701d38a"},"data_source_detail_dict":{"upload_file":{"id":"83c8ad7c-4269-42cc-ab1c-6f3f7701d38a","name":"5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.md","size":4933,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979141.857678}},"dataset_process_rule_id":"8d7a9b63-fc73-4c0d-9d2d-2e8e00bf3bf5","name":"5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979142,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":2162,"hit_count":0,"doc_form":"text_model"},"batch":"20250303051901701983"}
2025-03-03 13:19:03.628  INFO 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 音频分析和上传完成: 5-《滴水湖金融湾 天辉苑 户型图及楼栋户型分布表 签约告知书》.pdf
2025-03-03 13:19:03.648 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:03.649 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:03.668 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:03.896 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:19:03.898 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:03.898 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:03.918 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:04.098 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:19:04.100 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:04.101 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:04.121 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:04.297 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:19:04.297 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:04.297 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:04.318 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:04.575 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:19:04.932 ERROR 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\银行情况说明.docx
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:19:04.960 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:04.960 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:04.983 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:05.281 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:19:40.621 ERROR 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\金港东九提供材料2.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:19:40.641 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:40.641 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:40.660 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:40.837 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:19:58.030 ERROR 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\金港东九提供材料1.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:19:58.050 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:19:58.051 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:19:58.070 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:19:58.291 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:20:04.495 ERROR 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\东九预看房陪看记录单.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:20:04.514 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:20:04.515 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:04.534 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:20:04.718 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:20:05.332 ERROR 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\东九交付许可证.pdf
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:20:05.352 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:20:05.352 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:05.372 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:20:05.540 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:20:06.040 ERROR 33332 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 下载文件异常

java.nio.file.NoSuchFileException: .\temp\18\程阿金和解通知.jpg
	at java.base/sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:85) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:103) ~[na:na]
	at java.base/sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:108) ~[na:na]
	at java.base/sun.nio.fs.WindowsFileSystemProvider.newByteChannel(WindowsFileSystemProvider.java:236) ~[na:na]
	at java.base/java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:484) ~[na:na]
	at java.base/java.nio.file.Files.newOutputStream(Files.java:228) ~[na:na]
	at java.base/java.nio.file.Files.copy(Files.java:3160) ~[na:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.downloadFile(FeishuFolderServiceImpl.java:314) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:243) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 13:20:06.063 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:20:06.063 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:06.084 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:20:06.248 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:20:06.249 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:20:06.249 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:06.271 DEBUG 33332 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:20:06.411 ERROR 33332 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:20:21.890  INFO 33332 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 13:20:21.893  INFO 33332 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 13:20:23.703  INFO 21956 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 21956 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 13:20:23.704 DEBUG 21956 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 13:20:23.704  INFO 21956 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 13:20:23.950  INFO 21956 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 13:20:23.951  INFO 21956 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 13:20:23.964  INFO 21956 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 13:20:24.214  INFO 21956 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 13:20:24.218  INFO 21956 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 13:20:24.218  INFO 21956 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 13:20:24.301  INFO 21956 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 13:20:24.301  INFO 21956 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 579 ms
2025-03-03 13:20:24.463  INFO 21956 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 13:20:24.463  INFO 21956 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 13:20:25.007  INFO 21956 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 13:20:25.163  INFO 21956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477443752512241666&access_key=0ee6e629dfb4d0be5acd041414e42ab9&service_id=33554678&ticket=8fd31e7e-92a3-4be4-a144-d784f25af8b5 [conn_id=7477443752512241666]
2025-03-03 13:20:25.307  INFO 21956 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 13:20:25.312  INFO 21956 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.768 seconds (JVM running for 2.124)
2025-03-03 13:20:31.679  INFO 21956 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac","chat_type":"p2p","content":"{\"text\":\"生成文件说明\"}","create_time":"1740979229323","message_id":"om_03caa6f5d0cc748efa3f89fcdd43a25c","message_type":"text","update_time":"1740979229323"},"sender":{"sender_id":{"open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e","user_id":"d3d5egbc"},"sender_type":"user","tenant_key":"14191646f559d758"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,57,97,55,57,101,49,99,57,55,97,51,55,98,56,102,52,51,102,100,54,51,100,57,53,101,100,54,48,48,56,99,98,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,50,50,57,54,51,54,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-25,-108,-97,-26,-120,-112,-26,-106,-121,-28,-69,-74,-24,-81,-76,-26,-104,-114,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,50,50,57,51,50,51,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,48,51,99,97,97,54,102,53,100,48,99,99,55,52,56,101,102,97,51,102,56,57,102,99,100,100,52,51,97,50,53,99,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,50,50,57,51,50,51,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a73c62ce90b0d013","create_time":"1740979229636","event_id":"9a79e1c97a37b8f43fd63d95ed6008cb","event_type":"im.message.receive_v1","tenant_key":"14191646f559d758","token":""},"requestId":"","schema":"2.0","tenantKey":"14191646f559d758"}]
2025-03-03 13:20:31.679  INFO 21956 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 13:20:31.683  INFO 21956 --- [pool-2-thread-2] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_8e248fda8f4bff8499c1a7072767bfce], 查询=[生成文件说明]
2025-03-03 13:20:31.691  INFO 21956 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 13:20:31.941  INFO 21956 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 13:20:31.946 DEBUG 21956 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-03-03 13:20:31.956 DEBUG 21956 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:31.986 DEBUG 21956 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 0
2025-03-03 13:20:32.009  WARN 21956 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 13:20:32.012 DEBUG 21956 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:20:32.012 DEBUG 21956 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:32.035 DEBUG 21956 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:20:33.135  INFO 21956 --- [pool-2-thread-2] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7477448848111665153:streaming_sey]
2025-03-03 13:20:33.136  INFO 21956 --- [ForkJoinPool.commonPool-worker-1] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[生成文件说明], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 13:20:33.185 ERROR 21956 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify API 请求失败: 401 - {"code": "unauthorized", "message": "Access token is invalid", "status": 401}
2025-03-03 13:20:33.185 ERROR 21956 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : Dify返回错误: Dify API调用失败，状态码: 401
2025-03-03 13:20:33.336  INFO 21956 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7477448848111665153], sequence=[3]
2025-03-03 13:20:33.583  INFO 21956 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-03-03 13:20:52.761  INFO 21956 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"select_case","timestamp":1740979250}
2025-03-03 13:20:52.787 DEBUG 21956 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 13:20:52.787 DEBUG 21956 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:52.809 DEBUG 21956 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 13:20:52.809 DEBUG 21956 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:20:52.810 DEBUG 21956 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:52.831 DEBUG 21956 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:20:58.353  INFO 21956 --- [pool-2-thread-4] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14191646f559d758","user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"},"token":"c-7fd588e9c33bae865aa1f2344905ef8307008ab1","action":{"tag":"button","timezone":"Asia/Shanghai","name":"select_case_callback","form_value":{"Select_case":"17"}},"host":"im_message","context":{"open_message_id":"om_ec38ab5a5e2ad9fe27ed877beac0e31b","open_chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac"}},"schema":"2.0","header":{"event_id":"1c14b2c3ae7903fd4c59b92b2a0e9314","event_type":"card.action.trigger","app_id":"cli_a73c62ce90b0d013","tenant_key":"14191646f559d758","create_time":"1740979256607505","token":"za3iBwmP42XM4YMo9z0tq1OgMlRAG7tc"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,49,99,49,52,98,50,99,51,97,101,55,57,48,51,102,100,52,99,53,57,98,57,50,98,50,97,48,101,57,51,49,52,34,44,34,116,111,107,101,110,34,58,34,122,97,51,105,66,119,109,80,52,50,88,77,52,89,77,111,57,122,48,116,113,49,79,103,77,108,82,65,71,55,116,99,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,50,53,54,54,48,55,53,48,53,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,125,44,34,116,111,107,101,110,34,58,34,99,45,55,102,100,53,56,56,101,57,99,51,51,98,97,101,56,54,53,97,97,49,102,50,51,52,52,57,48,53,101,102,56,51,48,55,48,48,56,97,98,49,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,49,55,34,125,44,34,110,97,109,101,34,58,34,115,101,108,101,99,116,95,99,97,115,101,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,101,99,51,56,97,98,53,97,53,101,50,97,100,57,102,101,50,55,101,100,56,55,55,98,101,97,99,48,101,51,49,98,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,125,125,125],"headers":{}}}
2025-03-03 13:20:58.353  INFO 21956 --- [pool-2-thread-4] em.backend.handler.CardEventHandler      : 选择的案件ID: 17
2025-03-03 13:20:58.374 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:20:58.374 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 17(String)
2025-03-03 13:20:58.394 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:20:58.420 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-03-03 13:20:58.420 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:58.440 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-03-03 13:20:58.442 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-03-03 13:20:58.442 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 17(Long), 李华被撞(String), ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:20:58.483 DEBUG 21956 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-03-03 13:21:01.014  INFO 21956 --- [pool-2-thread-5] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"case_overview","timestamp":1740979259}
2025-03-03 13:21:01.036 DEBUG 21956 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 13:21:01.036 DEBUG 21956 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:21:01.057 DEBUG 21956 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 4
2025-03-03 13:21:01.058 DEBUG 21956 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:21:01.058 DEBUG 21956 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:21:01.077 DEBUG 21956 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:21:03.683  INFO 21956 --- [pool-2-thread-6] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14191646f559d758","user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"},"token":"c-a59eefc9fbb0cdc1a44b22dabba26a70c5006e7e","action":{"tag":"button","timezone":"Asia/Shanghai","name":"case_overview_callback","form_value":{"Select_case":"15"}},"host":"im_message","context":{"open_message_id":"om_afe3abee4697f9bd480069303b716a00","open_chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac"}},"schema":"2.0","header":{"event_id":"8ee9dafa38677054f0a0bbf1a31c9fcc","event_type":"card.action.trigger","app_id":"cli_a73c62ce90b0d013","tenant_key":"14191646f559d758","create_time":"1740979261940552","token":"za3iBwmP42XM4YMo9z0tq1OgMlRAG7tc"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,56,101,101,57,100,97,102,97,51,56,54,55,55,48,53,52,102,48,97,48,98,98,102,49,97,51,49,99,57,102,99,99,34,44,34,116,111,107,101,110,34,58,34,122,97,51,105,66,119,109,80,52,50,88,77,52,89,77,111,57,122,48,116,113,49,79,103,77,108,82,65,71,55,116,99,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,50,54,49,57,52,48,53,53,50,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,125,44,34,116,111,107,101,110,34,58,34,99,45,97,53,57,101,101,102,99,57,102,98,98,48,99,100,99,49,97,52,52,98,50,50,100,97,98,98,97,50,54,97,55,48,99,53,48,48,54,101,55,101,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,49,53,34,125,44,34,110,97,109,101,34,58,34,99,97,115,101,95,111,118,101,114,118,105,101,119,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,97,102,101,51,97,98,101,101,52,54,57,55,102,57,98,100,52,56,48,48,54,57,51,48,51,98,55,49,54,97,48,48,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,125,125,125],"headers":{}}}
2025-03-03 13:21:03.683  INFO 21956 --- [pool-2-thread-6] em.backend.handler.CardEventHandler      : 案件总览选择的案件ID: 15
2025-03-03 13:21:03.704 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:21:03.704 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 15(String)
2025-03-03 13:21:03.725 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:21:03.745 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-03-03 13:21:03.745 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:21:03.765 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-03-03 13:21:03.765 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-03-03 13:21:03.766 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 15(Long), 李华被撞(String), ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:21:03.809 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-03-03 13:21:03.851 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:21:03.851 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 15(String)
2025-03-03 13:21:03.870 DEBUG 21956 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:21:08.642  INFO 21956 --- [pool-2-thread-7] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740979266}
2025-03-03 13:21:27.426  INFO 21956 --- [pool-2-thread-8] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14191646f559d758","user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"},"token":"c-01b3feda728ae4b03ea78939bf40551b01e8b977","action":{"tag":"button","timezone":"Asia/Shanghai","name":"submit_create_case","form_value":{"case_desc":"测试案件","case_name":"测试案件","case_time":"2025-03-03 06:06 +0800","client_name":"测试案件","remarks":"测试案件"}},"host":"im_message","context":{"open_message_id":"om_f3d4fd44377698aa1ef534f1b639a17e","open_chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac"}},"schema":"2.0","header":{"event_id":"a73525ad519dcba75f4546a44c3b0910","event_type":"card.action.trigger","app_id":"cli_a73c62ce90b0d013","tenant_key":"14191646f559d758","create_time":"1740979285680897","token":"za3iBwmP42XM4YMo9z0tq1OgMlRAG7tc"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,97,55,51,53,50,53,97,100,53,49,57,100,99,98,97,55,53,102,52,53,52,54,97,52,52,99,51,98,48,57,49,48,34,44,34,116,111,107,101,110,34,58,34,122,97,51,105,66,119,109,80,52,50,88,77,52,89,77,111,57,122,48,116,113,49,79,103,77,108,82,65,71,55,116,99,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,50,56,53,54,56,48,56,57,55,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,125,44,34,116,111,107,101,110,34,58,34,99,45,48,49,98,51,102,101,100,97,55,50,56,97,101,52,98,48,51,101,97,55,56,57,51,57,98,102,52,48,53,53,49,98,48,49,101,56,98,57,55,55,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,99,97,115,101,95,100,101,115,99,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,34,44,34,99,97,115,101,95,110,97,109,101,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,34,44,34,99,97,115,101,95,116,105,109,101,34,58,34,50,48,50,53,45,48,51,45,48,51,32,48,54,58,48,54,32,43,48,56,48,48,34,44,34,99,108,105,101,110,116,95,110,97,109,101,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,34,44,34,114,101,109,97,114,107,115,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,34,125,44,34,110,97,109,101,34,58,34,115,117,98,109,105,116,95,99,114,101,97,116,101,95,99,97,115,101,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,102,51,100,52,102,100,52,52,51,55,55,54,57,56,97,97,49,101,102,53,51,52,102,49,98,54,51,57,97,49,55,101,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,125,125,125],"headers":{}}}
2025-03-03 13:21:27.426  INFO 21956 --- [pool-2-thread-8] em.backend.service.impl.CaseServiceImpl  : 处理创建案件表单数据: {case_desc=测试案件, case_name=测试案件, case_time=2025-03-03 06:06 +0800, client_name=测试案件, remarks=测试案件}, 操作人: ou_8e248fda8f4bff8499c1a7072767bfce
2025-03-03 13:21:28.003  INFO 21956 --- [pool-2-thread-8] e.b.s.impl.FeishuFolderServiceImpl       : 案件文件夹创建成功: 测试案件_测试案件_2025-03-03, url: https://vcnjyexq8awr.feishu.cn/drive/folder/G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 13:21:28.484  INFO 21956 --- [pool-2-thread-8] e.b.s.impl.FeishuFolderServiceImpl       : 文件夹权限设置成功, token: G20EfDOp0lI6ZWd0o3pctlXdnbg, userId: ou_8e248fda8f4bff8499c1a7072767bfce
2025-03-03 13:21:28.484  INFO 21956 --- [pool-2-thread-8] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始创建知识库: name=fce7692ae49f4afea1df8309fefc5754, description=案件描述：测试案件
当事人：测试案件
案件时间：2025-03-03 06:06 +0800
2025-03-03 13:21:28.486 DEBUG 21956 --- [pool-2-thread-8] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送创建知识库请求: url=http://1.13.79.29:8088/v1/datasets, body={"name":"fce7692ae49f4afea1df8309fefc5754","description":"案件描述：测试案件\n当事人：测试案件\n案件时间：2025-03-03 06:06 +0800","indexing_technique":"high_quality","permission":"all_team_members"}
2025-03-03 13:21:28.592  INFO 21956 --- [pool-2-thread-8] e.b.s.impl.DifyKnowledgeServiceImpl      : 创建知识库成功: response={"id":"9bf1be9c-0b02-4b0d-9004-660a9df2a224","name":"fce7692ae49f4afea1df8309fefc5754","description":"案件描述：测试案件\n当事人：测试案件\n案件时间：2025-03-03 06:06 +0800","provider":"vendor","permission":"all_team_members","indexing_technique":"high_quality","app_count":0,"document_count":0,"word_count":0,"created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979287,"updated_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","updated_at":1740979287,"embedding_model":"text-embedding-3-large","embedding_model_provider":"langgenius/openai/openai","retrieval_model_dict":{"search_method":"semantic_search","reranking_enable":false,"reranking_model":{"reranking_provider_name":"","reranking_model_name":""},"top_k":2,"score_threshold_enabled":false},"tags":[],"external_knowledge_info":{},"external_retrieval_model":{"top_k":2,"score_threshold":0.0}}
2025-03-03 13:21:28.614 DEBUG 21956 --- [pool-2-thread-8] em.backend.mapper.CaseInfoMapper.insert  : ==>  Preparing: INSERT INTO case_info ( open_id, case_name, client_name, case_desc, case_time, remarks, folder_url, dify_knowledge_id ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ? )
2025-03-03 13:21:28.616 DEBUG 21956 --- [pool-2-thread-8] em.backend.mapper.CaseInfoMapper.insert  : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String), 测试案件(String), 测试案件(String), 测试案件(String), 2025-03-03T06:06(LocalDateTime), 测试案件(String), https://vcnjyexq8awr.feishu.cn/drive/folder/G20EfDOp0lI6ZWd0o3pctlXdnbg(String), 9bf1be9c-0b02-4b0d-9004-660a9df2a224(String)
2025-03-03 13:21:28.658 DEBUG 21956 --- [pool-2-thread-8] em.backend.mapper.CaseInfoMapper.insert  : <==    Updates: 1
2025-03-03 13:21:28.680 DEBUG 21956 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-03-03 13:21:28.680 DEBUG 21956 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:21:28.701 DEBUG 21956 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-03-03 13:21:28.701 DEBUG 21956 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-03-03 13:21:28.702 DEBUG 21956 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 22(Long), 测试案件(String), ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:21:28.742 DEBUG 21956 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-03-03 13:21:58.805 ERROR 21956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 13:21:58.806  INFO 21956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477443752512241666&access_key=0ee6e629dfb4d0be5acd041414e42ab9&service_id=33554678&ticket=8fd31e7e-92a3-4be4-a144-d784f25af8b5 [conn_id=7477443752512241666]
2025-03-03 13:21:58.806  INFO 21956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 13:22:11.250  INFO 21956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 13:22:11.571  INFO 21956 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477446284792463388&access_key=9a15be698f23cc1acfec14efb0451079&service_id=33554678&ticket=c7378a9b-91ce-4a05-af81-8cef8ac52d42 [conn_id=7477446284792463388]
2025-03-03 13:22:14.791  INFO 21956 --- [pool-2-thread-9] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740979317}
2025-03-03 13:22:14.812 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:22:14.813 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:22:14.833 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:22:14.834 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:22:14.834 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:22:14.854 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:22:14.854 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:22:14.855 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:22:14.873 DEBUG 21956 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:22:14.873  INFO 21956 --- [pool-2-thread-9] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 13:22:15.419  INFO 21956 --- [pool-2-thread-9] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:22:15.421  INFO 21956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:22:15.786  INFO 21956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:22:14 GMT"],"eagleid":["1bde142217409793337173035e"],"request-id":["8f80cfdd-7056-4af4-98ef-d96e6685f8ad"],"server":["Tengine"],"server-timing":["inner; dur=316","cdn-cache;desc=MISS,edge;dur=0,origin;dur=335"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache30.cn6725[335,0]"],"x-lgw-dst-svc":["AfC1re03BhwyYHgGKul1Qgklai5rQIGMgwuomf9LCV43v0_pPd3RDAv4DX6BHYr_RUeATw3mFi7WcP_GwqyiHY-EAOekxe7adf3-DqxJSZNCccvpvgOjWFiHl0V06s1fJDHp0kA5vo7XwwhKrrum2rvWhfGxvLW5pBm7UefFy7HWjR63hZFO40OU8r5vqC6KaVth3s7stWP7Kdh87Sg7AiComUuK5IPB88A1i10siy8wLvF8tpPW5gNjFWuZ4xrMtlEg6RAOYG45-3X6dG8RP0ZdUu-rJcS4TGvO6V_Z4HRORbqlPThhem0="],"x-request-id":["8f80cfdd-7056-4af4-98ef-d96e6685f8ad"],"x-timestamp":["1740979334.043"],"x-tt-logid":["20250303132213734A471EDE30F4FB9B28"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e98a39cd9ecc14284cffa3fa072ffa760554b9481652154f19cc99c98d5aa1edf4f79633df6ad3b88aadf97aafa03e01a4268199c65bdc4ff7463dc744b6c0907d7b60d92907327389da736bb75f26207bc"],"x-tt-trace-id":["00-250303132213734A471EDE30F4FB9B28-633365D311F1534E-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303132213734A471EDE30F4FB9B28","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"20250303132213734A471EDE30F4FB9B28"}
2025-03-03 13:22:15.786  INFO 21956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 13:22:16.619  INFO 21956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:22:16.639 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:22:16.640 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:22:16.660 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:22:16.810 ERROR 21956 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:22:16.811  INFO 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:22:16.811  INFO 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 13:22:16.812 DEBUG 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:22:16.812 DEBUG 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:22:17.081  INFO 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=80a8b175-c172-40df-834b-c3608e2e4457
2025-03-03 13:22:17.081 DEBUG 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"80a8b175-c172-40df-834b-c3608e2e4457"}},"response_mode":"blocking","conversation_id":"e258b636-2a59-4c2f-a066-cb4cd87999ef","user":"fyjw"}
2025-03-03 13:22:27.709 DEBUG 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"d499b7f3-e864-45c9-bafb-b7ffdc55fbeb","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一幅由 AI 生成的插画，描绘了一位黑发少女坐在桌前使用笔记本电脑的场景。她的表情温和，背景是现代都市的高楼大厦，透过大窗户可见城市天际线。整体画风精致，带有日系动漫风格，并且光影效果柔和，营造出温馨的氛围。  \n\n请问您需要对这幅图像进行什么样的分析或描述呢？"},"elapsed_time":10.560962407151237,"total_tokens":509,"total_steps":4,"created_at":1740979335,"finished_at":1740979345}
2025-03-03 13:22:27.710  INFO 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一幅由 AI 生成的插画，描绘了一位黑发少女坐在桌前使用笔记本电脑的场景。她的表情温和，背景是现代都市的高楼大厦，透过大窗户可见城市天际线。整体画风精致，带有日系动漫风格，并且光影效果柔和，营造出温馨的氛围。  

请问您需要对这幅图像进行什么样的分析或描述呢？
2025-03-03 13:22:27.710 DEBUG 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"30a6d8bb-fa56-4d09-8362-173f88f7128f","workflow_run_id":"d499b7f3-e864-45c9-bafb-b7ffdc55fbeb","data":{"id":"d499b7f3-e864-45c9-bafb-b7ffdc55fbeb","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一幅由 AI 生成的插画，描绘了一位黑发少女坐在桌前使用笔记本电脑的场景。她的表情温和，背景是现代都市的高楼大厦，透过大窗户可见城市天际线。整体画风精致，带有日系动漫风格，并且光影效果柔和，营造出温馨的氛围。  \n\n请问您需要对这幅图像进行什么样的分析或描述呢？"},"elapsed_time":10.560962407151237,"total_tokens":509,"total_steps":4,"created_at":1740979335,"finished_at":1740979345}}
2025-03-03 13:22:27.710  INFO 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=383
2025-03-03 13:22:27.710 DEBUG 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:22:27.798  INFO 21956 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"3900611c-6daa-4644-afbf-5b42e03621b8"},"data_source_detail_dict":{"upload_file":{"id":"3900611c-6daa-4644-afbf-5b42e03621b8","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":383,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346.025135}},"dataset_process_rule_id":"0972e2c2-0045-43c6-867e-9609f07d75c1","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":0,"indexing_status":"splitting","enabled":true,"archived":false,"display_status":"indexing","word_count":131,"hit_count":0,"doc_form":"text_model"},"batch":"20250303052226953491"}
2025-03-03 13:22:27.798  INFO 21956 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:22:27.820 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:22:27.821 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:22:27.844 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:22:28.019 ERROR 21956 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:22:28.020 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:22:28.020 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:22:28.041 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:22:28.216 ERROR 21956 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:22:28.222 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:22:28.222 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:22:28.249 DEBUG 21956 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:22:28.390 ERROR 21956 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:24:40.469  INFO 21956 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 13:24:40.472  INFO 21956 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 13:24:43.446  INFO 9172 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 9172 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 13:24:43.447 DEBUG 9172 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 13:24:43.447  INFO 9172 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 13:24:43.708  INFO 9172 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 13:24:43.709  INFO 9172 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 13:24:43.722  INFO 9172 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 13:24:43.979  INFO 9172 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 13:24:43.983  INFO 9172 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 13:24:43.983  INFO 9172 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 13:24:44.060  INFO 9172 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 13:24:44.060  INFO 9172 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 592 ms
2025-03-03 13:24:44.217  INFO 9172 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 13:24:44.218  INFO 9172 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 13:24:44.721  INFO 9172 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 13:24:44.944  INFO 9172 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477446284792758300&access_key=e060c264ce43f0d0b82c47299ceab63b&service_id=33554678&ticket=69f521b3-07ed-4a5f-afe2-eac4cc26e7c2 [conn_id=7477446284792758300]
2025-03-03 13:24:45.015  INFO 9172 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 13:24:45.020  INFO 9172 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.795 seconds (JVM running for 2.144)
2025-03-03 13:24:46.862  INFO 9172 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740979484}
2025-03-03 13:24:46.889  WARN 9172 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 13:24:46.896  INFO 9172 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 13:24:47.145  INFO 9172 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 13:24:47.150 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:24:47.161 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:24:47.191 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:24:47.194 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:24:47.194 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:24:47.214 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:24:47.214 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:24:47.214 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:24:47.234 DEBUG 9172 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:24:47.234  INFO 9172 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 13:24:48.066  INFO 9172 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:24:48.067  INFO 9172 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:24:48.720  INFO 9172 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:24:46 GMT"],"eagleid":["1bde141117409794863655858e"],"request-id":["77c65414-a6d4-4d73-9904-e02ad3528582"],"server":["Tengine"],"server-timing":["inner; dur=369","cdn-cache;desc=MISS,edge;dur=0,origin;dur=515"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache13.cn6725[515,0]"],"x-lgw-dst-svc":["mNw2SSkOVHZWyznAkOa22r-bTOQpCj0pLitwzJMl_lJjRMaFcOAzKPYFlMiffSCfEeaGtwa1vBlCO5-gumkEEl8k9QsY5PrAFJqPFhtnL80JR_95-C3Tf9y6mo0PzCr-TJveJlkVKSnS7AOyKt7HsoyChdgs6NR3ehNxDaJQTJh8oaMpj6aoNZB80XQEJaN8wzkgB5x4sXho6gL-8suum69Y7_GrMBneJR8DhhOGxytAwZ5NLcNOajbCVQqvSErt4wWZurgiycoKMs7vzma-NG4eaxDgJX5K9Vt1mIeJ48AKN5ue96GJD-4="],"x-request-id":["77c65414-a6d4-4d73-9904-e02ad3528582"],"x-timestamp":["1740979486.754"],"x-tt-logid":["202503031324466E0114C4B5D8DFE2C20B"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e9851b94c829380554f062bd6044682dbb5d6cf1d1bfd00caf641541fb10546dc875ccf1000599580d001637df6787683cf083579e56feaa49e40fbec55955cf6a56b4d03d90631726380dadbebf388110c"],"x-tt-trace-id":["00-2503031324466E0114C4B5D8DFE2C20B-7E9ABFC74FB1B547-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031324466E0114C4B5D8DFE2C20B","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"202503031324466E0114C4B5D8DFE2C20B"}
2025-03-03 13:24:48.720  INFO 9172 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 13:24:50.730  INFO 9172 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:24:50.752 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:24:50.752 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:24:50.774 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:24:50.950 ERROR 9172 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:24:50.951  INFO 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:24:50.951  INFO 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 13:24:50.953 DEBUG 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:24:50.953 DEBUG 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:24:51.230  INFO 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=3e900d2e-c0e3-4fad-8f04-026e460993e3
2025-03-03 13:24:51.231 DEBUG 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"3e900d2e-c0e3-4fad-8f04-026e460993e3"}},"response_mode":"blocking","conversation_id":"a6e6f03f-b112-4625-8d57-6a66142ba816","user":"fyjw"}
2025-03-03 13:25:14.519 DEBUG 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"b058da23-a3bc-46dc-95d5-9fb7a6970495","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由人工智能生成的二次元风格的插画，描绘了一位黑发少女坐在桌前使用笔记本电脑的场景。背景是一座现代化城市的高楼大厦，窗外透进自然光，使画面显得温馨而富有生活气息。整体色调柔和，人物的神态和细节刻画精致，展现出一种宁静而专注的氛围。这种风格常见于日系插画或视觉小说的艺术表现中。"},"elapsed_time":23.237183894962072,"total_tokens":517,"total_steps":4,"created_at":1740979489,"finished_at":1740979512}
2025-03-03 13:25:14.520  INFO 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一个由人工智能生成的二次元风格的插画，描绘了一位黑发少女坐在桌前使用笔记本电脑的场景。背景是一座现代化城市的高楼大厦，窗外透进自然光，使画面显得温馨而富有生活气息。整体色调柔和，人物的神态和细节刻画精致，展现出一种宁静而专注的氛围。这种风格常见于日系插画或视觉小说的艺术表现中。
2025-03-03 13:25:14.520 DEBUG 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"e7778368-c601-495e-8003-9d890a01c264","workflow_run_id":"b058da23-a3bc-46dc-95d5-9fb7a6970495","data":{"id":"b058da23-a3bc-46dc-95d5-9fb7a6970495","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由人工智能生成的二次元风格的插画，描绘了一位黑发少女坐在桌前使用笔记本电脑的场景。背景是一座现代化城市的高楼大厦，窗外透进自然光，使画面显得温馨而富有生活气息。整体色调柔和，人物的神态和细节刻画精致，展现出一种宁静而专注的氛围。这种风格常见于日系插画或视觉小说的艺术表现中。"},"elapsed_time":23.237183894962072,"total_tokens":517,"total_steps":4,"created_at":1740979489,"finished_at":1740979512}}
2025-03-03 13:25:14.520  INFO 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=423
2025-03-03 13:25:14.520 DEBUG 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:25:14.619  INFO 9172 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"a889f4ca-d859-4d88-916c-75b398356490"},"data_source_detail_dict":{"upload_file":{"id":"a889f4ca-d859-4d88-916c-75b398356490","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":423,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979512.846232}},"dataset_process_rule_id":"fbe37072-1749-4010-84b2-5615e98224f0","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":156,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":131,"hit_count":0,"doc_form":"text_model"},"batch":"20250303052512161365"}
2025-03-03 13:25:14.620  INFO 9172 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:25:14.642 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:25:14.642 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:25:14.664 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:25:14.855 ERROR 9172 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:25:14.857 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:25:14.857 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:25:14.878 DEBUG 9172 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:25:15.039 ERROR 9172 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:28:11.369  INFO 9172 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 13:28:11.373  INFO 9172 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 13:28:14.379  INFO 22856 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 22856 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 13:28:14.380 DEBUG 22856 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 13:28:14.380  INFO 22856 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 13:28:14.630  INFO 22856 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 13:28:14.631  INFO 22856 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 13:28:14.644  INFO 22856 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 13:28:14.895  INFO 22856 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 13:28:14.903  INFO 22856 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 13:28:14.903  INFO 22856 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 13:28:14.974  INFO 22856 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 13:28:14.975  INFO 22856 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 578 ms
2025-03-03 13:28:15.134  INFO 22856 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 13:28:15.135  INFO 22856 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 13:28:15.330  WARN 22856 --- [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuEventController' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'messageEventHandler' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'fileMessageServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'caseServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'feishuFolderServiceImpl' defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 4; nested exception is org.springframework.beans.factory.BeanCurrentlyInCreationException: Error creating bean with name 'caseServiceImpl': Requested bean is currently in creation: Is there an unresolvable circular reference?
2025-03-03 13:28:15.331  INFO 22856 --- [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-03-03 13:28:15.337  INFO 22856 --- [main] ConditionEvaluationReportLoggingListener : 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2025-03-03 13:28:15.343 ERROR 22856 --- [main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

The dependencies of some of the beans in the application context form a cycle:

   feishuEventController defined in file [D:\project\feishu-fyjw\target\classes\em\backend\controller\FeishuEventController.class]
      ↓
   messageEventHandler defined in file [D:\project\feishu-fyjw\target\classes\em\backend\handler\MessageEventHandler.class]
      ↓
   fileMessageServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FileMessageServiceImpl.class]
┌─────┐
|  caseServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\CaseServiceImpl.class]
↑     ↓
|  feishuFolderServiceImpl defined in file [D:\project\feishu-fyjw\target\classes\em\backend\service\impl\FeishuFolderServiceImpl.class]
└─────┘


Action:

Relying upon circular references is discouraged and they are prohibited by default. Update your application to remove the dependency cycle between beans. As a last resort, it may be possible to break the cycle automatically by setting spring.main.allow-circular-references to true.

2025-03-03 13:29:40.482  INFO 7072 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 7072 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 13:29:40.483 DEBUG 7072 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 13:29:40.483  INFO 7072 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 13:29:40.727  INFO 7072 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 13:29:40.728  INFO 7072 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 13:29:40.740  INFO 7072 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-03-03 13:29:40.987  INFO 7072 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 13:29:40.991  INFO 7072 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 13:29:40.992  INFO 7072 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 13:29:41.068  INFO 7072 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 13:29:41.068  INFO 7072 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 567 ms
2025-03-03 13:29:41.232  INFO 7072 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 13:29:41.233  INFO 7072 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 13:29:41.817  INFO 7072 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 13:29:42.048  INFO 7072 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477446284793233436&access_key=5cd3cee4dcbbbaea320bc4d381c3c143&service_id=33554678&ticket=141ea5e5-5f85-4ad1-82ac-0943412112c5 [conn_id=7477446284793233436]
2025-03-03 13:29:42.111  INFO 7072 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 13:29:42.117  INFO 7072 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.802 seconds (JVM running for 2.126)
2025-03-03 13:29:44.751  INFO 7072 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac","chat_type":"p2p","content":"{\"text\":\"策略分析\"}","create_time":"1740979782381","message_id":"om_e6f0741176dbb23a1a521aebb1368d3e","message_type":"text","update_time":"1740979782381"},"sender":{"sender_id":{"open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e","user_id":"d3d5egbc"},"sender_type":"user","tenant_key":"14191646f559d758"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,50,101,52,52,57,57,54,51,56,53,49,57,48,55,52,101,101,49,99,101,51,53,53,53,55,100,49,98,49,99,100,97,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,55,56,50,55,50,52,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-25,-83,-106,-25,-107,-91,-27,-120,-122,-26,-98,-112,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,55,56,50,51,56,49,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,101,54,102,48,55,52,49,49,55,54,100,98,98,50,51,97,49,97,53,50,49,97,101,98,98,49,51,54,56,100,51,101,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,55,56,50,51,56,49,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a73c62ce90b0d013","create_time":"1740979782724","event_id":"2e4499638519074ee1ce35557d1b1cda","event_type":"im.message.receive_v1","tenant_key":"14191646f559d758","token":""},"requestId":"","schema":"2.0","tenantKey":"14191646f559d758"}]
2025-03-03 13:29:44.752  INFO 7072 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 13:29:44.755  INFO 7072 --- [pool-2-thread-2] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_8e248fda8f4bff8499c1a7072767bfce], 查询=[策略分析]
2025-03-03 13:29:44.763  INFO 7072 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 13:29:45.026  INFO 7072 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 13:29:45.032 DEBUG 7072 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-03-03 13:29:45.044 DEBUG 7072 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:29:45.074 DEBUG 7072 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 0
2025-03-03 13:29:45.094  WARN 7072 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 13:29:45.097 DEBUG 7072 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:29:45.097 DEBUG 7072 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:29:45.120 DEBUG 7072 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:29:46.133  INFO 7072 --- [pool-2-thread-2] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7477451225721110556:streaming_sey]
2025-03-03 13:29:46.134  INFO 7072 --- [ForkJoinPool.commonPool-worker-1] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[策略分析], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 13:29:46.179 ERROR 7072 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify API 请求失败: 401 - {"code": "unauthorized", "message": "Access token is invalid", "status": 401}
2025-03-03 13:29:46.179 ERROR 7072 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : Dify返回错误: Dify API调用失败，状态码: 401
2025-03-03 13:29:46.347  INFO 7072 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7477451225721110556], sequence=[3]
2025-03-03 13:29:46.597  INFO 7072 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-03-03 13:29:48.285  INFO 7072 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740979786}
2025-03-03 13:29:48.311 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:29:48.311 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:29:48.333 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:29:48.334 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:29:48.334 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:29:48.354 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:29:48.354 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:29:48.354 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:29:48.374 DEBUG 7072 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:29:48.374  INFO 7072 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 13:29:48.897  INFO 7072 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:29:48.898  INFO 7072 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:29:49.371  INFO 7072 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:29:47 GMT"],"eagleid":["74c4871917409797872017630e"],"request-id":["165c3c81-3593-47a5-9e1f-c7a8d6a05595"],"server":["Tengine"],"server-timing":["inner; dur=416","cdn-cache;desc=MISS,edge;dur=0,origin;dur=439"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache20.cn7535[439,0]"],"x-lgw-dst-svc":["629MuFNRDjvbZ9scWB_IzlvKi7SgN19cr28llicEz4MoDSI4-BRGqdIwHlvui0MsWViQ74loYOtmf3tDJRTbDkRsP0rob7FXqSVSwpLnRYJdIo3Fmpo9awlzvFzcxCbx0oiMzchKqhPBdH1vCLRNnnc6v2QDIXWuBGEJeYndBEb_cqe_PijzjfLTvV-jzQmZ15gVlU2eMjSwqrtMsyP4Q09gpLVPQlTsL_qfRzdmcRKgzKct1H4NfUFhLw0c46izUg3IYW8Du-TtFP1Tz2HbQbOhUhXTcQibVavzXiHXmCKC6LFpOK0qxxQ="],"x-request-id":["165c3c81-3593-47a5-9e1f-c7a8d6a05595"],"x-timestamp":["1740979787.625"],"x-tt-logid":["202503031329476DEF0780B1850FFD3E1C"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be7f606a5fbffcd1e67d12dbf406bdde177e62cf8b7b637707d93a0eaf6579fb304045139b137117fa0d3b14a4ff4fea44dbdd349b6cabab171e04b758c55cfd94f68155d4a206670b941f07ce302dca75"],"x-tt-trace-id":["00-2503031329476DEF0780B1850FFD3E1C-4AA1D8180F15F852-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031329476DEF0780B1850FFD3E1C","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"202503031329476DEF0780B1850FFD3E1C"}
2025-03-03 13:29:49.372  INFO 7072 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 13:29:50.239  INFO 7072 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:29:50.260 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:29:50.260 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:29:50.283 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:29:50.410 ERROR 7072 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:29:50.412  INFO 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:29:50.413  INFO 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 13:29:50.415 DEBUG 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:29:50.415 DEBUG 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:29:50.651  INFO 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=333d0db8-ff38-4525-8c4a-59736adae9c3
2025-03-03 13:29:50.652 DEBUG 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"333d0db8-ff38-4525-8c4a-59736adae9c3"}},"response_mode":"blocking","conversation_id":"769b25a6-d520-49fb-8687-c3d8cb374c70","user":"fyjw"}
2025-03-03 13:30:00.411 DEBUG 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"8ec0bd53-ae82-4180-874b-2a9b103e2cb0","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由AI生成的动漫风格的插画，描绘了一位长发黑发女孩坐在书桌前使用笔记本电脑的场景。她的神情温和，背景是现代都市高楼，窗外光线柔和，给人一种温暖而专注的氛围。这种风格的插画通常用于插画创作、社交媒体头像或其他视觉设计用途。"},"elapsed_time":9.701380108017474,"total_tokens":492,"total_steps":4,"created_at":1740979788,"finished_at":1740979798}
2025-03-03 13:30:00.412  INFO 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一个由AI生成的动漫风格的插画，描绘了一位长发黑发女孩坐在书桌前使用笔记本电脑的场景。她的神情温和，背景是现代都市高楼，窗外光线柔和，给人一种温暖而专注的氛围。这种风格的插画通常用于插画创作、社交媒体头像或其他视觉设计用途。
2025-03-03 13:30:00.412 DEBUG 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"1ab0d587-d876-4778-ba78-c8a8ebf1136c","workflow_run_id":"8ec0bd53-ae82-4180-874b-2a9b103e2cb0","data":{"id":"8ec0bd53-ae82-4180-874b-2a9b103e2cb0","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由AI生成的动漫风格的插画，描绘了一位长发黑发女孩坐在书桌前使用笔记本电脑的场景。她的神情温和，背景是现代都市高楼，窗外光线柔和，给人一种温暖而专注的氛围。这种风格的插画通常用于插画创作、社交媒体头像或其他视觉设计用途。"},"elapsed_time":9.701380108017474,"total_tokens":492,"total_steps":4,"created_at":1740979788,"finished_at":1740979798}}
2025-03-03 13:30:00.412  INFO 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=338
2025-03-03 13:30:00.412 DEBUG 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:30:00.524  INFO 7072 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"216e5f46-c538-4d9c-b712-76aaf1c20fff"},"data_source_detail_dict":{"upload_file":{"id":"216e5f46-c538-4d9c-b712-76aaf1c20fff","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":338,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979798.740161}},"dataset_process_rule_id":"8368f832-77e0-43dd-8861-ad52ea874fb6","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":175,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":141,"hit_count":0,"doc_form":"text_model"},"batch":"20250303052958974538"}
2025-03-03 13:30:00.524  INFO 7072 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:30:00.545 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:30:00.546 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:30:00.567 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:30:00.688 ERROR 7072 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:30:00.690 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:30:00.690 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:30:00.710 DEBUG 7072 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:30:00.850 ERROR 7072 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:31:07.941  INFO 7072 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 13:31:07.945  INFO 7072 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 13:31:10.942  INFO 18548 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 18548 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 13:31:10.943 DEBUG 18548 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 13:31:10.943  INFO 18548 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 13:31:11.199  INFO 18548 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 13:31:11.200  INFO 18548 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 13:31:11.213  INFO 18548 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-03-03 13:31:11.462  INFO 18548 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 13:31:11.466  INFO 18548 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 13:31:11.466  INFO 18548 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 13:31:11.543  INFO 18548 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 13:31:11.543  INFO 18548 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 580 ms
2025-03-03 13:31:11.703  INFO 18548 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 13:31:11.704  INFO 18548 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 13:31:12.221  INFO 18548 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 13:31:12.453  INFO 18548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477446610961694721&access_key=1b084a10297228abd9b4a7ae0d081850&service_id=33554678&ticket=47481ec1-ced0-4950-a818-d87421963008 [conn_id=7477446610961694721]
2025-03-03 13:31:12.511  INFO 18548 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 13:31:12.516  INFO 18548 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.735 seconds (JVM running for 2.076)
2025-03-03 13:31:45.039  INFO 18548 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740979903}
2025-03-03 13:31:45.068  WARN 18548 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 13:31:45.075  INFO 18548 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 13:31:45.359  INFO 18548 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 13:31:45.362 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:31:45.373 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:31:45.409 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:31:45.412 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:31:45.412 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:31:45.439 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:31:45.439 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 13:31:45.439 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 13:31:45.478 DEBUG 18548 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 13:31:45.478  INFO 18548 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 13:31:46.312  INFO 18548 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:31:46.315  INFO 18548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 13:31:46.792  INFO 18548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 05:31:44 GMT"],"eagleid":["74c4871317409799046214837e"],"request-id":["7ee764ca-cb96-4a57-86aa-87e1149c36bf"],"server":["Tengine"],"server-timing":["inner; dur=359","cdn-cache;desc=MISS,edge;dur=0,origin;dur=378"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache14.cn7535[378,0]"],"x-lgw-dst-svc":["HHabI7-5EFtBshNPnh9U89ccEgeQ2CZNmI2djWbiYeUydtAY4WkCqYWIhssdSomSQsUdjdmI1Iv37dS-MBCBCVm4s03deKKQcN-1siRDC4nCsNjtbZLvDEqWYNS_8fucs1jFRvGETXBvOIHhxE4Ivwt_DhpMxng1sd1w-FZa0QC-E08Nnl8i-tf_xbpR66lNDbkWUJJvWiz5itrgwDBYM-w5Fwl7Cugtbq2ObHD02NL3Ao4GF1dRQ0wXIA0YPGxZhYyNEsBAiLzZaQH5OK_LUvaxpb5WVfLx3Pc8NXevsMda_qUuE6aJnQ=="],"x-request-id":["7ee764ca-cb96-4a57-86aa-87e1149c36bf"],"x-timestamp":["1740979904.987"],"x-tt-logid":["20250303133144B13B66F5A41269F15CB6"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be5f16e12bbe79a9b6fcc4fa700fb7a517ddbb4c69fee0bf374d4c0225dc75fe948cee64558b3a2663e199728254dc1bcdd6017ef60366a5a5d3b22b9d1cbfa9d7f912e08965d200462c098e8be4cbdd9e"],"x-tt-trace-id":["00-250303133144B13B66F5A41269F15CB6-6533D38F5EA79F0B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303133144B13B66F5A41269F15CB6","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"20250303133144B13B66F5A41269F15CB6"}
2025-03-03 13:31:46.792  INFO 18548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 13:31:47.650  INFO 18548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:31:47.674 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:31:47.675 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:31:47.700 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:31:47.986 ERROR 18548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:31:47.987  INFO 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:31:47.987  INFO 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 13:31:47.988 DEBUG 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 13:31:47.989 DEBUG 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 13:31:48.237  INFO 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=df9e3b72-40b6-4199-a355-2e57c40c31a2
2025-03-03 13:31:48.237 DEBUG 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"df9e3b72-40b6-4199-a355-2e57c40c31a2"}},"response_mode":"blocking","conversation_id":"464b8d6f-d94c-46db-b8e7-cea899bc1318","user":"fyjw"}
2025-03-03 13:32:09.793 DEBUG 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"66b6bbe0-cf29-4da0-abfb-80b56b65d964","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由AI生成的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的外貌精致，眼神温柔，整体风格偏向日系二次元艺术。背景中可以看到城市景观，通过窗户透入自然光，使整个画面显得温馨而富有生活气息。这种风格的插画常见于动漫、插画设计或AI绘图作品。"},"elapsed_time":21.51108864485286,"total_tokens":499,"total_steps":4,"created_at":1740979906,"finished_at":1740979928}
2025-03-03 13:32:09.793  INFO 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一张由AI生成的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的外貌精致，眼神温柔，整体风格偏向日系二次元艺术。背景中可以看到城市景观，通过窗户透入自然光，使整个画面显得温馨而富有生活气息。这种风格的插画常见于动漫、插画设计或AI绘图作品。
2025-03-03 13:32:09.793 DEBUG 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"6602d9dc-23fd-44d3-8fbb-8c2d85d8ebd2","workflow_run_id":"66b6bbe0-cf29-4da0-abfb-80b56b65d964","data":{"id":"66b6bbe0-cf29-4da0-abfb-80b56b65d964","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由AI生成的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的外貌精致，眼神温柔，整体风格偏向日系二次元艺术。背景中可以看到城市景观，通过窗户透入自然光，使整个画面显得温馨而富有生活气息。这种风格的插画常见于动漫、插画设计或AI绘图作品。"},"elapsed_time":21.51108864485286,"total_tokens":499,"total_steps":4,"created_at":1740979906,"finished_at":1740979928}}
2025-03-03 13:32:09.793  INFO 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=364
2025-03-03 13:32:09.793 DEBUG 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 13:32:09.885  INFO 18548 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"dd03c777-6620-463e-b05c-09c67c2a840c"},"data_source_detail_dict":{"upload_file":{"id":"dd03c777-6620-463e-b05c-09c67c2a840c","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":364,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979928.117477}},"dataset_process_rule_id":"ae296008-e051-4e44-b447-665b4afaad97","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":139,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":114,"hit_count":0,"doc_form":"text_model"},"batch":"20250303053208153733"}
2025-03-03 13:32:09.886  INFO 18548 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 13:32:09.911 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:32:09.911 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:32:09.935 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:32:09.963  INFO 18548 --- [pool-2-thread-3] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac","chat_type":"p2p","content":"{\"text\":\"生成文件说明\"}","create_time":"1740979927782","message_id":"om_d216f9ab0b5c9385e1e0c1e89b17b3e2","message_type":"text","update_time":"1740979927782"},"sender":{"sender_id":{"open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e","user_id":"d3d5egbc"},"sender_type":"user","tenant_key":"14191646f559d758"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,102,99,55,57,53,51,56,55,101,102,98,56,54,101,97,98,52,99,52,53,50,102,52,55,56,53,102,53,51,54,97,99,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,57,50,56,48,53,51,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-25,-108,-97,-26,-120,-112,-26,-106,-121,-28,-69,-74,-24,-81,-76,-26,-104,-114,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,57,50,55,55,56,50,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,100,50,49,54,102,57,97,98,48,98,53,99,57,51,56,53,101,49,101,48,99,49,101,56,57,98,49,55,98,51,101,50,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,57,50,55,55,56,50,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a73c62ce90b0d013","create_time":"1740979928053","event_id":"fc795387efb86eab4c452f4785f536ac","event_type":"im.message.receive_v1","tenant_key":"14191646f559d758","token":""},"requestId":"","schema":"2.0","tenantKey":"14191646f559d758"}]
2025-03-03 13:32:09.964  INFO 18548 --- [pool-2-thread-3] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 13:32:09.964  INFO 18548 --- [pool-2-thread-3] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_8e248fda8f4bff8499c1a7072767bfce], 查询=[生成文件说明]
2025-03-03 13:32:09.965 DEBUG 18548 --- [pool-2-thread-3] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-03-03 13:32:09.965 DEBUG 18548 --- [pool-2-thread-3] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:32:09.988 DEBUG 18548 --- [pool-2-thread-3] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 0
2025-03-03 13:32:09.989 DEBUG 18548 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:32:09.989 DEBUG 18548 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:32:10.012 DEBUG 18548 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:32:10.101 ERROR 18548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:32:10.102 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 13:32:10.102 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 13:32:10.126 DEBUG 18548 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 13:32:10.258 ERROR 18548 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 13:32:10.885  INFO 18548 --- [pool-2-thread-3] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7477451847919714306:streaming_sey]
2025-03-03 13:32:10.887  INFO 18548 --- [ForkJoinPool.commonPool-worker-1] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[生成文件说明], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 13:32:10.912 ERROR 18548 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify API 请求失败: 401 - {"code": "unauthorized", "message": "Access token is invalid", "status": 401}
2025-03-03 13:32:10.912 ERROR 18548 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : Dify返回错误: Dify API调用失败，状态码: 401
2025-03-03 13:32:11.091  INFO 18548 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7477451847919714306], sequence=[3]
2025-03-03 13:32:11.343  INFO 18548 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-03-03 13:33:10.914 ERROR 18548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 13:33:10.914  INFO 18548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477446610961694721&access_key=1b084a10297228abd9b4a7ae0d081850&service_id=33554678&ticket=47481ec1-ced0-4950-a818-d87421963008 [conn_id=7477446610961694721]
2025-03-03 13:33:10.914  INFO 18548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 13:33:28.587  INFO 18548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 13:33:29.022  INFO 18548 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477448800618643484&access_key=aa3625edc088d064719971b364188eae&service_id=33554678&ticket=25210337-b6da-4d75-a1e7-a27b2107c26d [conn_id=7477448800618643484]
2025-03-03 14:47:26.329  INFO 18548 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 14:47:26.333  INFO 18548 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 14:47:30.526  INFO 28592 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 28592 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 14:47:30.528 DEBUG 28592 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 14:47:30.528  INFO 28592 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 14:47:30.858  INFO 28592 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 14:47:30.860  INFO 28592 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 14:47:30.875  INFO 28592 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 14:47:31.166  INFO 28592 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 14:47:31.175  INFO 28592 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 14:47:31.175  INFO 28592 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 14:47:31.283  INFO 28592 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 14:47:31.284  INFO 28592 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 735 ms
2025-03-03 14:47:31.505  INFO 28592 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 14:47:31.506  INFO 28592 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 14:47:32.193  INFO 28592 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 14:47:32.473  INFO 28592 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477468196702634012&access_key=760cced67c4bdbd8e322c0ca2533f7dc&service_id=33554678&ticket=fcf37513-6351-4c3c-8739-d861a07a6941 [conn_id=7477468196702634012]
2025-03-03 14:47:32.527  INFO 28592 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 14:47:32.533  INFO 28592 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.209 seconds (JVM running for 2.63)
2025-03-03 14:47:33.069 ERROR 28592 --- [pool-2-thread-2] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 20f2bc42-5ace-4fc2-9043-b7ce26d43ed2, trace_id: 6f77a05e70fb1cc946e0e3c633732c7d, [conn_id=7477468196702634012]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 14:47:39.835  INFO 28592 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740984457}
2025-03-03 14:47:39.866  WARN 28592 --- [pool-2-thread-3] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 14:47:39.872  INFO 28592 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 14:47:40.259  INFO 28592 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 14:47:40.263 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:47:40.274 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:47:40.310 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:47:40.313 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 14:47:40.313 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 14:47:40.341 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 14:47:40.341 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 14:47:40.341 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 14:47:40.372 DEBUG 28592 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 14:47:40.373  INFO 28592 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 14:47:41.386  INFO 28592 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 14:47:41.387  INFO 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 14:47:42.034  INFO 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 06:47:40 GMT"],"eagleid":["74c4870917409844597258165e"],"request-id":["edfeddbb-a00c-4f92-9dc0-053434f71304"],"server":["Tengine"],"server-timing":["inner; dur=498","cdn-cache;desc=MISS,edge;dur=0,origin;dur=518"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache4.cn7535[518,0]"],"x-lgw-dst-svc":["CLomC4HMvYvzvs3R932M4rmOYfOOUpg5DuTYWSr0onb3khBuY_iCS-4-4EgIm0eijGzqmjQlxlyMQ0ev-fYcheL7muqmp3odQLQgzU38DPRABgjpiIPyQKRezAPfrPofUKVL6IhiOX-wZnxURvybOwp64Ph1DWr4JAAwgqVqWjlB5IvNPUq6gNSWFLUC0es1nawXp-VR8eM7v21P7MWTylOnFmN3Nl4qcj5FzMC84T2PP5EuA23sF_U5H0-aCjEErXeg-bFsMlVFqX3eMfMxRihNDYX6zuSzOJPKZeTW41wkunuxHB5J2FQ="],"x-request-id":["edfeddbb-a00c-4f92-9dc0-053434f71304"],"x-timestamp":["1740984460.234"],"x-tt-logid":["2025030314473951DE5108AA14F6F8121B"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1bebe72cb2479f6fb525408a92b4474ed55ebd542372933703c8010341f953ac32df161e3908e5dab2c35d47b9d7f46c146565911a13ef94ff6801a47e9fd1ddbddb2c4d17eb7f7d61769ee31d74e5ae123"],"x-tt-trace-id":["00-25030314473951DE5108AA14F6F8121B-552D03023DDBC506-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030314473951DE5108AA14F6F8121B","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"2025030314473951DE5108AA14F6F8121B"}
2025-03-03 14:47:42.034  INFO 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 14:47:43.560  INFO 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:47:43.589 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:47:43.590 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:47:43.623 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:47:43.820 ERROR 28592 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:47:43.822  INFO 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:47:43.822  INFO 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 14:47:43.823 DEBUG 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 14:47:43.824 DEBUG 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 14:47:44.377  INFO 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=f845b5bf-2f27-4643-acc3-bbf5a2c95481
2025-03-03 14:47:44.378 DEBUG 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"f845b5bf-2f27-4643-acc3-bbf5a2c95481"}},"response_mode":"blocking","conversation_id":"2480fc34-fa09-4b53-91cd-85757a1ee256","user":"fyjw"}
2025-03-03 14:47:48.708 ERROR 28592 --- [pool-2-thread-4] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: ddfe224f-066a-4d4b-aadc-ef27faae02f5, trace_id: 6f77a05e70fb1cc946e0e3c633732c7d, [conn_id=7477468196702634012]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 14:48:42.503  INFO 28592 --- [pool-2-thread-5] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740984520}
2025-03-03 14:48:42.526 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:48:42.526 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:48:42.549 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:48:42.550 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 14:48:42.550 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 14:48:42.574 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 14:48:42.575 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 14:48:42.575 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 14:48:42.599 DEBUG 28592 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 14:48:42.599  INFO 28592 --- [pool-2-thread-5] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 14:48:43.247  INFO 28592 --- [pool-2-thread-5] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 14:48:43.247  INFO 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 14:48:43.676  INFO 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 06:48:41 GMT"],"eagleid":["74c4870917409845215807220e"],"request-id":["0c9aff7d-95c3-4a70-b9a6-1c5eb9d9aaee"],"server":["Tengine"],"server-timing":["inner; dur=387","cdn-cache;desc=MISS,edge;dur=0,origin;dur=403"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache4.cn7535[403,0]"],"x-lgw-dst-svc":["Wit7RmpZRhEhi7RE_CF74S2hdTi8rqn3OtcRD46I4evkrfHlCKR29IlX7kI20GqydJUbhnLrUr4dkxgzJZk9b-dXIem3LrzanSe4pSM1Nlca3NfVSlq347goqV1cthCqQTvunkpJczLhH7YElWhbrrVmz4d3uN4bf6Ev57gRAhuNJMl9rL2735hbw234Sa01HzRZNIIIKwDJpGYeWqAuuSwwRibcg_Ct1iGY8HOzeKoZMm0cJToNH2BKwEVyDqEB1tZfv91Xl05x8amAGItY72JfDjE_5K2N14LqSZFdY8vh4NvUFleFRg0="],"x-request-id":["0c9aff7d-95c3-4a70-b9a6-1c5eb9d9aaee"],"x-timestamp":["1740984521.973"],"x-tt-logid":["20250303144841ADC9407F193D18FD0AC2"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1bebe72cb2479f6fb525408a92b4474ed55ebd542372933703c8010341f953ac32dad613b0aa4f5bf8f0ed773fb42753e7a3f6100bedb2f62a286bd0638079ba929365169888cfeeabcebe6d715e2429a83"],"x-tt-trace-id":["00-250303144841ADC9407F193D18FD0AC2-3A4BED911E25836A-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303144841ADC9407F193D18FD0AC2","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"20250303144841ADC9407F193D18FD0AC2"}
2025-03-03 14:48:43.676  INFO 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 14:48:44.412  INFO 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:48:44.448 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:48:44.448 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:48:44.471 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:48:44.604 ERROR 28592 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:48:44.605  INFO 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:48:44.605  INFO 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 14:48:44.605 DEBUG 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 14:48:44.605 DEBUG 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 14:48:44.889  INFO 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=5a3eb748-c447-4443-bd89-1580260450c7
2025-03-03 14:48:44.890 DEBUG 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"5a3eb748-c447-4443-bd89-1580260450c7"}},"response_mode":"blocking","conversation_id":"a0dec2ee-71ed-4974-92c1-765cf28056dc","user":"fyjw"}
2025-03-03 14:49:03.060 DEBUG 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"7cb14941-3f29-4b9f-a475-e83e64ddf203","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由AI生成的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑的场景。她的表情温和，环境背景是现代化的城市景观，窗外有高楼大厦，光线柔和，氛围温馨。这种风格的插画通常用于二次元艺术或虚拟人物创作。请问您需要对此图进行什么处理或描述吗？"},"elapsed_time":18.124172694049776,"total_tokens":497,"total_steps":4,"created_at":1740984523,"finished_at":1740984541}
2025-03-03 14:49:03.060  INFO 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一张由AI生成的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑的场景。她的表情温和，环境背景是现代化的城市景观，窗外有高楼大厦，光线柔和，氛围温馨。这种风格的插画通常用于二次元艺术或虚拟人物创作。请问您需要对此图进行什么处理或描述吗？
2025-03-03 14:49:03.061 DEBUG 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"05aa9121-a780-4a15-be07-976c6e9c816b","workflow_run_id":"7cb14941-3f29-4b9f-a475-e83e64ddf203","data":{"id":"7cb14941-3f29-4b9f-a475-e83e64ddf203","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由AI生成的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑的场景。她的表情温和，环境背景是现代化的城市景观，窗外有高楼大厦，光线柔和，氛围温馨。这种风格的插画通常用于二次元艺术或虚拟人物创作。请问您需要对此图进行什么处理或描述吗？"},"elapsed_time":18.124172694049776,"total_tokens":497,"total_steps":4,"created_at":1740984523,"finished_at":1740984541}}
2025-03-03 14:49:03.061  INFO 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=353
2025-03-03 14:49:03.061 DEBUG 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 14:49:03.158  INFO 28592 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"576919e7-443e-4db6-b256-374faa27e6bf"},"data_source_detail_dict":{"upload_file":{"id":"576919e7-443e-4db6-b256-374faa27e6bf","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":353,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740984541.415651}},"dataset_process_rule_id":"5c0de5f6-b7f8-4a8a-853e-3ed4de2183d2","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":153,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":124,"hit_count":0,"doc_form":"text_model"},"batch":"20250303064901331396"}
2025-03-03 14:49:03.158  INFO 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:49:03.195 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:49:03.195 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:49:03.219 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:49:03.410 ERROR 28592 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:49:03.415 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:49:03.416 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:49:03.444 DEBUG 28592 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:49:03.631 ERROR 28592 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:49:03.631  INFO 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=bascng7vrxcxpig7geggXiCtadY, tableId=tblUa9vcYjWQYJCj, recordCount=1
2025-03-03 14:49:03.632 ERROR 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传数据到多维表格异常

java.lang.ClassCastException: class java.util.ArrayList cannot be cast to class java.util.Map (java.util.ArrayList and java.util.Map are in module java.base of loader 'bootstrap')
	at em.backend.service.impl.FeishuFolderServiceImpl.uploadToMultiSheet(FeishuFolderServiceImpl.java:632) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:287) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 14:49:03.632 ERROR 28592 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 上传记录到多维表格失败
2025-03-03 14:50:25.618 DEBUG 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"cf522a5a-8f50-476b-94af-06f29b834597","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由AI生成的二次元风格的插画，描绘了一位黑发的年轻女性坐在书桌前，使用笔记本电脑。背景是一个现代化的城市景观，窗外可以看到高楼大厦。整个画面给人一种温馨而专注的氛围，色调柔和，细节精致。请问您对这幅插画有什么具体的问题或需求吗？"},"elapsed_time":161.0924296930898,"total_tokens":495,"total_steps":4,"created_at":1740984462,"finished_at":1740984623}
2025-03-03 14:50:25.618  INFO 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一个由AI生成的二次元风格的插画，描绘了一位黑发的年轻女性坐在书桌前，使用笔记本电脑。背景是一个现代化的城市景观，窗外可以看到高楼大厦。整个画面给人一种温馨而专注的氛围，色调柔和，细节精致。请问您对这幅插画有什么具体的问题或需求吗？
2025-03-03 14:50:25.619 DEBUG 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"31906fac-d40b-4fe4-a373-d50d426fbb29","workflow_run_id":"cf522a5a-8f50-476b-94af-06f29b834597","data":{"id":"cf522a5a-8f50-476b-94af-06f29b834597","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由AI生成的二次元风格的插画，描绘了一位黑发的年轻女性坐在书桌前，使用笔记本电脑。背景是一个现代化的城市景观，窗外可以看到高楼大厦。整个画面给人一种温馨而专注的氛围，色调柔和，细节精致。请问您对这幅插画有什么具体的问题或需求吗？"},"elapsed_time":161.0924296930898,"total_tokens":495,"total_steps":4,"created_at":1740984462,"finished_at":1740984623}}
2025-03-03 14:50:25.619  INFO 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=350
2025-03-03 14:50:25.619 DEBUG 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 14:50:25.722  INFO 28592 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"b027df55-5278-4831-81a1-204831884ce8"},"data_source_detail_dict":{"upload_file":{"id":"b027df55-5278-4831-81a1-204831884ce8","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":350,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740984623.971629}},"dataset_process_rule_id":"76b38a05-a3fc-4a77-9e8b-35750cc4eaeb","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":144,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":119,"hit_count":0,"doc_form":"text_model"},"batch":"20250303065023141013"}
2025-03-03 14:50:25.722  INFO 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:50:25.746 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:50:25.746 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:50:25.768 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:50:25.962 ERROR 28592 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:50:25.963 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:50:25.964 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:50:25.988 DEBUG 28592 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:50:26.126 ERROR 28592 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:50:26.126  INFO 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=bascng7vrxcxpig7geggXiCtadY, tableId=tblUa9vcYjWQYJCj, recordCount=1
2025-03-03 14:50:26.126 ERROR 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传数据到多维表格异常

java.lang.ClassCastException: class java.util.ArrayList cannot be cast to class java.util.Map (java.util.ArrayList and java.util.Map are in module java.base of loader 'bootstrap')
	at em.backend.service.impl.FeishuFolderServiceImpl.uploadToMultiSheet(FeishuFolderServiceImpl.java:632) ~[classes/:na]
	at em.backend.service.impl.FeishuFolderServiceImpl.analyzeFilesAsync(FeishuFolderServiceImpl.java:287) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-5.3.24.jar:5.3.24]
	at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) ~[spring-aop-5.3.24.jar:5.3.24]
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 14:50:26.126 ERROR 28592 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传记录到多维表格失败
2025-03-03 14:51:12.151  INFO 28592 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 14:51:12.156  INFO 28592 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 14:51:16.030  INFO 36156 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 36156 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 14:51:16.031 DEBUG 36156 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 14:51:16.032  INFO 36156 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 14:51:16.327  INFO 36156 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 14:51:16.328  INFO 36156 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 14:51:16.343  INFO 36156 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 14:51:16.638  INFO 36156 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 14:51:16.643  INFO 36156 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 14:51:16.643  INFO 36156 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 14:51:16.738  INFO 36156 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 14:51:16.738  INFO 36156 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 685 ms
2025-03-03 14:51:16.909  INFO 36156 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 14:51:16.910  INFO 36156 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 14:51:17.472  INFO 36156 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 14:51:17.783  INFO 36156 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477469165596721180&access_key=365794fb19746e793b5103fe14d84d72&service_id=33554678&ticket=6fb85337-7151-464a-86fb-ad335447ba5d [conn_id=7477469165596721180]
2025-03-03 14:51:17.802  INFO 36156 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 14:51:17.807  INFO 36156 --- [main] em.backend.BackendApplication            : Started BackendApplication in 1.977 seconds (JVM running for 2.45)
2025-03-03 14:51:20.068  INFO 36156 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac","chat_type":"p2p","content":"{\"text\":\"生成文件说明\"}","create_time":"1740984677689","message_id":"om_ba4a0a01474e60900f2443f0c9288e1b","message_type":"text","update_time":"1740984677689"},"sender":{"sender_id":{"open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e","user_id":"d3d5egbc"},"sender_type":"user","tenant_key":"14191646f559d758"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,57,48,54,98,51,49,51,54,55,52,51,51,49,99,53,98,56,101,55,52,98,101,51,53,99,48,99,48,100,52,53,49,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,52,54,55,56,48,51,55,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-25,-108,-97,-26,-120,-112,-26,-106,-121,-28,-69,-74,-24,-81,-76,-26,-104,-114,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,52,54,55,55,54,56,57,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,98,97,52,97,48,97,48,49,52,55,52,101,54,48,57,48,48,102,50,52,52,51,102,48,99,57,50,56,56,101,49,98,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,52,54,55,55,54,56,57,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a73c62ce90b0d013","create_time":"1740984678037","event_id":"906b313674331c5b8e74be35c0c0d451","event_type":"im.message.receive_v1","tenant_key":"14191646f559d758","token":""},"requestId":"","schema":"2.0","tenantKey":"14191646f559d758"}]
2025-03-03 14:51:20.068  INFO 36156 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 14:51:20.072  INFO 36156 --- [pool-2-thread-2] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_8e248fda8f4bff8499c1a7072767bfce], 查询=[生成文件说明]
2025-03-03 14:51:20.080  INFO 36156 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 14:51:20.363  INFO 36156 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 14:51:20.366 DEBUG 36156 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-03-03 14:51:20.378 DEBUG 36156 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:51:20.413 DEBUG 36156 --- [pool-2-thread-2] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 0
2025-03-03 14:51:20.435  WARN 36156 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @1623b78d
2025-03-03 14:51:20.439 DEBUG 36156 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:51:20.439 DEBUG 36156 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:51:20.463 DEBUG 36156 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:51:21.649  INFO 36156 --- [pool-2-thread-2] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7477472255931105308:streaming_sey]
2025-03-03 14:51:21.650  INFO 36156 --- [ForkJoinPool.commonPool-worker-1] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[生成文件说明], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 14:51:21.698 ERROR 36156 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify API 请求失败: 401 - {"code": "unauthorized", "message": "Access token is invalid", "status": 401}
2025-03-03 14:51:21.698 ERROR 36156 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : Dify返回错误: Dify API调用失败，状态码: 401
2025-03-03 14:51:21.916  INFO 36156 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7477472255931105308], sequence=[3]
2025-03-03 14:51:22.184  INFO 36156 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-03-03 14:51:22.510  INFO 36156 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740984680}
2025-03-03 14:51:22.541 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:51:22.542 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:51:22.564 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:51:22.565 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 14:51:22.565 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 14:51:22.589 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 14:51:22.589 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 14:51:22.589 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 14:51:22.612 DEBUG 36156 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 14:51:22.613  INFO 36156 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 14:51:23.154  INFO 36156 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 14:51:23.155  INFO 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 14:51:23.633  INFO 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 06:51:21 GMT"],"eagleid":["1bdd619f17409846814883335e"],"request-id":["7e16c083-5f45-4791-87d5-dc039ea310b6"],"server":["Tengine"],"server-timing":["inner; dur=409","cdn-cache;desc=MISS,edge;dur=0,origin;dur=443"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache11.cn7150[443,0]"],"x-lgw-dst-svc":["cPa5RQ0kcgpuV3jV_r_9T-SnAOj-iA2b21_Xxk9zhp3bLs0YR33zimRQkzUIGP9IW4mXqiA5R0Gsmpw43wO-c3zs3FWrMqATm80d1ZkTzV6nrr-6R25gmpHIaFCr7Mvx9U2b9Zo5gDX3cHSRvOLyWYGwSL_Le78QAUz_mHszAd7zACMYZkKXpsIojrNdcrNihHf0rlt3Rsw0fR8lHiS2Nmdb_iSAGE5_-CgnZw1bO-xnHV-H1qVqu6pfyP-9vFn2g3CnZ0VZrL6d68aE1XNlqwS_yMfhDLv8q47Szznbl65bzLL-qWUJJzk="],"x-request-id":["7e16c083-5f45-4791-87d5-dc039ea310b6"],"x-timestamp":["1740984681.917"],"x-tt-logid":["2025030314512193409C5327EA1A1A219C"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e982dd7d553daca32495f65e5366c510f0d3756f4878c107ffa1d5aef42d1010abe811fd688a03bbfccb2a5db61570c402a83b6efca095e992a295eb1c40447c096ea410e88c6a5f96549ea53d52d23b45f"],"x-tt-trace-id":["00-25030314512193409C5327EA1A1A219C-4A24DFDB5FFC4FED-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030314512193409C5327EA1A1A219C","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"2025030314512193409C5327EA1A1A219C"}
2025-03-03 14:51:23.634  INFO 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 14:51:24.369  INFO 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:51:24.392 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:51:24.392 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:51:24.415 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:51:24.575 ERROR 36156 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:51:24.576  INFO 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:51:24.576  INFO 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 14:51:24.577 DEBUG 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 14:51:24.578 DEBUG 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 14:51:24.866  INFO 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=4ffa9f8a-ce77-4cf4-87e4-8875dc913e60
2025-03-03 14:51:24.866 DEBUG 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"4ffa9f8a-ce77-4cf4-87e4-8875dc913e60"}},"response_mode":"blocking","conversation_id":"bdde9a94-70cb-4fd5-9dff-a756a8b0361d","user":"fyjw"}
2025-03-03 14:51:53.502 DEBUG 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"c691e6b4-f313-4790-87d0-ac4e3f6edf10","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由AI生成的二次元风格的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的神情温和，背景是现代都市高楼的景色，营造出一种温馨且富有生活气息的氛围。画面细腻，光影柔和，整体风格精致且富有美感。"},"elapsed_time":28.59212100598961,"total_tokens":487,"total_steps":4,"created_at":1740984683,"finished_at":1740984711}
2025-03-03 14:51:53.503  INFO 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一个由AI生成的二次元风格的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的神情温和，背景是现代都市高楼的景色，营造出一种温馨且富有生活气息的氛围。画面细腻，光影柔和，整体风格精致且富有美感。
2025-03-03 14:51:53.503 DEBUG 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"2cf82af4-b234-4671-b142-bf4bce132b01","workflow_run_id":"c691e6b4-f313-4790-87d0-ac4e3f6edf10","data":{"id":"c691e6b4-f313-4790-87d0-ac4e3f6edf10","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由AI生成的二次元风格的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的神情温和，背景是现代都市高楼的景色，营造出一种温馨且富有生活气息的氛围。画面细腻，光影柔和，整体风格精致且富有美感。"},"elapsed_time":28.59212100598961,"total_tokens":487,"total_steps":4,"created_at":1740984683,"finished_at":1740984711}}
2025-03-03 14:51:53.503  INFO 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=296
2025-03-03 14:51:53.503 DEBUG 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 14:51:53.596  INFO 36156 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"f55fe88f-b6f1-499d-8e00-55226ec0492c"},"data_source_detail_dict":{"upload_file":{"id":"f55fe88f-b6f1-499d-8e00-55226ec0492c","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":296,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740984711.856536}},"dataset_process_rule_id":"c4dd2ad5-02d7-48e7-860a-372ac5bc2810","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":138,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":118,"hit_count":0,"doc_form":"text_model"},"batch":"20250303065151311075"}
2025-03-03 14:51:53.596  INFO 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 14:51:53.619 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:51:53.619 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:51:53.643 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:51:53.809 ERROR 36156 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:51:53.810 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 14:51:53.810 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 14:51:53.835 DEBUG 36156 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 14:51:53.994 ERROR 36156 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 14:51:53.994  INFO 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=bascng7vrxcxpig7geggXiCtadY, tableId=tblUa9vcYjWQYJCj, recordCount=1
2025-03-03 14:51:54.117 ERROR 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 数据上传失败: code=99991672, msg=Access denied. One of the following scopes is required: [bitable:app, base:record:create].应用尚未开通所需的应用身份权限：[bitable:app, base:record:create]，点击链接申请并开通任一权限即可：https://open.feishu.cn/app/cli_a73c62ce90b0d013/auth?q=bitable:app,base:record:create&op_from=openapi&token_type=tenant, reqId=202503031451523452C386EEB097F9FC1D
2025-03-03 14:51:54.117 ERROR 36156 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 上传记录到多维表格失败
2025-03-03 14:52:48.876 ERROR 36156 --- [pool-2-thread-4] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: cb917174-2f6b-494b-bb30-2ca82d5b55ac, trace_id: 6f77a05e70fb1cc946e0e3c633732c7d, [conn_id=7477469165596721180]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:00:13.226  INFO 36156 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:00:13.231  INFO 36156 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:00:17.593  INFO 34508 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 34508 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:00:17.596 DEBUG 34508 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:00:17.597  INFO 34508 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:00:17.994  INFO 34508 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:00:17.995  INFO 34508 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:00:18.012  INFO 34508 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-03-03 15:00:18.289  INFO 34508 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:00:18.293  INFO 34508 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:00:18.293  INFO 34508 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:00:18.388  INFO 34508 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:00:18.389  INFO 34508 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 763 ms
2025-03-03 15:00:18.574  INFO 34508 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:00:18.575  INFO 34508 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:00:19.305  INFO 34508 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:00:19.535  INFO 34508 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477473311515836444&access_key=1871aa253730d7672d50d597f46b6102&service_id=33554678&ticket=b67187e2-dd4a-4467-ba2d-73edaf8acb8c [conn_id=7477473311515836444]
2025-03-03 15:00:19.628  INFO 34508 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:00:19.633  INFO 34508 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.303 seconds (JVM running for 2.804)
2025-03-03 15:00:24.646  INFO 34508 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740985222}
2025-03-03 15:00:24.675  WARN 34508 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 15:00:24.682  INFO 34508 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:00:24.923  INFO 34508 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:00:24.926 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:00:24.937 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:00:24.967 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:00:24.970 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:00:24.970 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:00:24.990 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:00:24.990 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:00:24.990 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:00:25.009 DEBUG 34508 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:00:25.009  INFO 34508 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 15:00:26.030  INFO 34508 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:00:26.032  INFO 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:00:26.711  INFO 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 07:00:24 GMT"],"eagleid":["1bde141617409852243717862e"],"request-id":["929edadb-8b8c-4cfa-89f1-536000e09348"],"server":["Tengine"],"server-timing":["inner; dur=547","cdn-cache;desc=MISS,edge;dur=0,origin;dur=573"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache18.cn6725[573,0]"],"x-lgw-dst-svc":["Ngh8DICJ-W8On6861ArpnSBkc1zteZ88xhB0tRfpLDKG4rYiEtUnJkO2zux5eC5zrBRmaHzBTLGd1Mj6zF-7inPEIY6Fw-eJWm-9SrelaDuRDCvZdL_C0zULcACRkHNS0mgaOpyw5IBOtJdPhJk0FN65XnC0ROHMAIdlBS7d8tPBcX5P1V-GaAcZx1ffzir8SGVBpuZBchvg-NLBWoXwC15_OS7Kg78Z6qJxbP1lNQu_VW5TTnEb-PXDy6ZutpDrM-FNhVjl99iykztRPO_vD8AsegL-ErJvS3fiH8uhBqy6eev2-FSqNg=="],"x-request-id":["929edadb-8b8c-4cfa-89f1-536000e09348"],"x-timestamp":["1740985224.931"],"x-tt-logid":["2025030315002407DFF527FAFF3DFAFAE9"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e98bb2fd392d6ee39bd86b28caf23b7778fb8fea2315fe3a376fd75c39f0476d4b6535e710a8f84fa71f340c00a777275119147285f8c3cdcdc1e33d52b075f25e0003051d39fd0f5f98a055e1f8bbe56dc"],"x-tt-trace-id":["00-25030315002407DFF527FAFF3DFAFAE9-1CD2611F3B23627F-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030315002407DFF527FAFF3DFAFAE9","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"2025030315002407DFF527FAFF3DFAFAE9"}
2025-03-03 15:00:26.711  INFO 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 15:00:27.546  INFO 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:00:27.565 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:00:27.565 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:00:27.586 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:00:27.728 ERROR 34508 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:00:27.728  INFO 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:00:27.728  INFO 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 15:00:27.730 DEBUG 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 15:00:27.730 DEBUG 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 15:00:27.996  INFO 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=3e56da58-9630-430f-b0ba-e3a9c0613579
2025-03-03 15:00:27.996 DEBUG 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"3e56da58-9630-430f-b0ba-e3a9c0613579"}},"response_mode":"blocking","conversation_id":"b8cceeb9-4fad-4e60-a272-e5317d2943c1","user":"fyjw"}
2025-03-03 15:00:44.867 DEBUG 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"ce2e6fb2-fca5-4ea5-8c4a-ec538faec078","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一幅由AI生成的插画，描绘了一位黑发少女坐在书桌前使用笔记本电脑的场景。她的神情温和，环境明亮而现代，背景透过窗户可见城市天际线。这种风格属于日系二次元插画，具有精致的光影效果和细腻的角色设计。请问您需要我帮忙分析这幅图片的某些细节，或者有什么具体的问题吗？"},"elapsed_time":16.824365283129737,"total_tokens":505,"total_steps":4,"created_at":1740985226,"finished_at":1740985243}
2025-03-03 15:00:44.868  INFO 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一幅由AI生成的插画，描绘了一位黑发少女坐在书桌前使用笔记本电脑的场景。她的神情温和，环境明亮而现代，背景透过窗户可见城市天际线。这种风格属于日系二次元插画，具有精致的光影效果和细腻的角色设计。请问您需要我帮忙分析这幅图片的某些细节，或者有什么具体的问题吗？
2025-03-03 15:00:44.868 DEBUG 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"47e3d34b-4619-4ed3-99e1-b5b4a1527261","workflow_run_id":"ce2e6fb2-fca5-4ea5-8c4a-ec538faec078","data":{"id":"ce2e6fb2-fca5-4ea5-8c4a-ec538faec078","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一幅由AI生成的插画，描绘了一位黑发少女坐在书桌前使用笔记本电脑的场景。她的神情温和，环境明亮而现代，背景透过窗户可见城市天际线。这种风格属于日系二次元插画，具有精致的光影效果和细腻的角色设计。请问您需要我帮忙分析这幅图片的某些细节，或者有什么具体的问题吗？"},"elapsed_time":16.824365283129737,"total_tokens":505,"total_steps":4,"created_at":1740985226,"finished_at":1740985243}}
2025-03-03 15:00:44.868  INFO 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=389
2025-03-03 15:00:44.868 DEBUG 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 15:00:44.952  INFO 34508 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"4b9edf20-b6f2-4f2a-a591-981f82cba127"},"data_source_detail_dict":{"upload_file":{"id":"4b9edf20-b6f2-4f2a-a591-981f82cba127","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":389,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740985243.222619}},"dataset_process_rule_id":"9da469c4-d585-469c-87df-e4028b64e860","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":129,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":100,"hit_count":0,"doc_form":"text_model"},"batch":"20250303070043462597"}
2025-03-03 15:00:44.953  INFO 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:00:44.972 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:00:44.972 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:00:44.991 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:00:45.254 ERROR 34508 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:00:45.254  INFO 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=bascng7vrxcxpig7geggXiCtadY, tableId=tblUa9vcYjWQYJCj, recordCount=5
2025-03-03 15:00:45.372 ERROR 34508 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 数据上传失败: code=99991672, msg=Access denied. One of the following scopes is required: [bitable:app, base:record:create].应用尚未开通所需的应用身份权限：[bitable:app, base:record:create]，点击链接申请并开通任一权限即可：https://open.feishu.cn/app/cli_a73c62ce90b0d013/auth?q=bitable:app,base:record:create&op_from=openapi&token_type=tenant, reqId=20250303150043F7E05A959F7709F8D2D3
2025-03-03 15:00:45.373 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:00:45.373 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:00:45.399 DEBUG 34508 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:00:45.580 ERROR 34508 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:01:40.584  INFO 34508 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740985298}
2025-03-03 15:01:40.604 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:01:40.604 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:01:40.653 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:01:40.653 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:01:40.653 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:01:40.674 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:01:40.674 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:01:40.674 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:01:40.692 DEBUG 34508 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:01:40.692  INFO 34508 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 15:01:41.314  INFO 34508 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:01:41.314  INFO 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:01:41.832  INFO 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 07:01:40 GMT"],"eagleid":["1bde141617409852996496333e"],"request-id":["7f67200a-edee-45a5-a7c9-0472b46f01c5"],"server":["Tengine"],"server-timing":["inner; dur=474","cdn-cache;desc=MISS,edge;dur=0,origin;dur=492"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["ens-cache18.cn6725[492,0]"],"x-lgw-dst-svc":["XljxI3v2m2Av3ET3R_bJYKEIwV6_I6Ev0ICYlSoVkOZpzbDZqwvVF2pMyv6EFb01Pr8jN5s6NhDPaIbXdTf0-QWRwE_wM0Y9xzvc8bmxz9x7W_L76jFMTENRyDOAVpjdYfDexC8wtkn5MxTCKmSCrlkMHLagsPzoAmMHF1oM1cQA3Aa2GkshbQn1APJIpwP4y0elYmuxGEGpZYuI5Dy-JKrWcxHtemyq1-TmNzgbFVt74n8m5JcIq98BHqRXzkmfkeRqxFgylmh-Osc4X8GUu-caeERVst3NSbtJu7S-Xm1TasdyR7xcjKo="],"x-request-id":["7f67200a-edee-45a5-a7c9-0472b46f01c5"],"x-timestamp":["1740985300.132"],"x-tt-logid":["2025030315013978CE238634C17D0070BE"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e98bb2fd392d6ee39bd86b28caf23b7778fb8fea2315fe3a376fd75c39f0476d4b64651ecb2fc73819e9054c0b04d400dea6aecabd146536a6b9b46737b25bc4add87562ae92c7100fac4cdd5d42b1b3798"],"x-tt-trace-id":["00-25030315013978CE238634C17D0070BE-69D7A0F7780DC07F-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"2025030315013978CE238634C17D0070BE","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"2025030315013978CE238634C17D0070BE"}
2025-03-03 15:01:41.832  INFO 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 15:01:42.580  INFO 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:01:42.601 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:01:42.601 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:01:42.621 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:01:42.863 ERROR 34508 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:01:42.867  INFO 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:01:42.867  INFO 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 15:01:42.867 DEBUG 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 15:01:42.867 DEBUG 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 15:01:43.130  INFO 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=b311601d-5966-4baf-b45c-9ef630a64ed6
2025-03-03 15:01:43.130 DEBUG 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"b311601d-5966-4baf-b45c-9ef630a64ed6"}},"response_mode":"blocking","conversation_id":"2aac942e-1797-43cc-8093-521bf73c1167","user":"fyjw"}
2025-03-03 15:01:54.151 DEBUG 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"ba0920a8-b09c-4fa5-a57b-1002921989e9","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一幅由AI生成的二次元风格的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的外貌精致，眼神柔和，背景展现了现代都市的高楼景观，营造出温馨而富有生活气息的氛围。这种风格的绘画通常用于动漫、轻小说或插图作品，展现了一种理想化的生活场景。请问您需要对此图片进行什么样的分析或描述呢？"},"elapsed_time":10.974175421986729,"total_tokens":516,"total_steps":4,"created_at":1740985301,"finished_at":1740985312}
2025-03-03 15:01:54.152  INFO 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一幅由AI生成的二次元风格的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的外貌精致，眼神柔和，背景展现了现代都市的高楼景观，营造出温馨而富有生活气息的氛围。这种风格的绘画通常用于动漫、轻小说或插图作品，展现了一种理想化的生活场景。请问您需要对此图片进行什么样的分析或描述呢？
2025-03-03 15:01:54.152 DEBUG 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"07b08587-d325-46a6-b671-78bb67ed15ac","workflow_run_id":"ba0920a8-b09c-4fa5-a57b-1002921989e9","data":{"id":"ba0920a8-b09c-4fa5-a57b-1002921989e9","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一幅由AI生成的二次元风格的插画，描绘了一位黑发女孩坐在桌前使用笔记本电脑。她的外貌精致，眼神柔和，背景展现了现代都市的高楼景观，营造出温馨而富有生活气息的氛围。这种风格的绘画通常用于动漫、轻小说或插图作品，展现了一种理想化的生活场景。请问您需要对此图片进行什么样的分析或描述呢？"},"elapsed_time":10.974175421986729,"total_tokens":516,"total_steps":4,"created_at":1740985301,"finished_at":1740985312}}
2025-03-03 15:01:54.152  INFO 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=422
2025-03-03 15:01:54.152 DEBUG 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 15:01:54.249  INFO 34508 --- [task-2] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"5ccc2c5c-ff57-4197-9cc2-5ae0e27ee74a"},"data_source_detail_dict":{"upload_file":{"id":"5ccc2c5c-ff57-4197-9cc2-5ae0e27ee74a","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":422,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740985312.516577}},"dataset_process_rule_id":"059b2657-9099-4c24-8296-4f02f625efa0","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":158,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":131,"hit_count":0,"doc_form":"text_model"},"batch":"20250303070152106680"}
2025-03-03 15:01:54.249  INFO 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:01:54.270 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:01:54.271 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:01:54.291 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:01:54.489 ERROR 34508 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:01:54.489  INFO 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=bascng7vrxcxpig7geggXiCtadY, tableId=tblUa9vcYjWQYJCj, recordCount=5
2025-03-03 15:01:54.634 ERROR 34508 --- [task-2] e.b.s.impl.FeishuFolderServiceImpl       : 数据上传失败: code=1002, msg=note has been deleted, reqId=2025030315015278CE238634C17D007BAC
2025-03-03 15:01:54.635 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:01:54.635 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:01:54.656 DEBUG 34508 --- [task-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:01:54.813 ERROR 34508 --- [task-2] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:03:37.899  INFO 34508 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:03:37.905  INFO 34508 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:03:41.661  INFO 28648 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 28648 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:03:41.661 DEBUG 28648 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:03:41.662  INFO 28648 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:03:41.995  INFO 28648 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:03:41.996  INFO 28648 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:03:42.012  INFO 28648 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 15:03:42.351  INFO 28648 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:03:42.356  INFO 28648 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:03:42.356  INFO 28648 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:03:42.465  INFO 28648 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:03:42.465  INFO 28648 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 779 ms
2025-03-03 15:03:42.678  INFO 28648 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:03:42.679  INFO 28648 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:03:43.252  INFO 28648 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:03:43.453  INFO 28648 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474034842976258&access_key=dc3cac67d1873c2564e76952229b1d3d&service_id=33554678&ticket=ce992b60-8f1a-4213-b7c3-d8e71821a8e1 [conn_id=7477474034842976258]
2025-03-03 15:03:43.650  INFO 28648 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:03:43.657  INFO 28648 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.222 seconds (JVM running for 2.661)
2025-03-03 15:03:52.540  INFO 28648 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740985430}
2025-03-03 15:03:52.570  WARN 28648 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @1623b78d
2025-03-03 15:03:52.577  INFO 28648 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:03:52.833  INFO 28648 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:03:52.836 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:03:52.849 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:03:52.880 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:03:52.883 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:03:52.884 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:03:52.904 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:03:52.904 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:03:52.904 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:03:52.949 DEBUG 28648 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:03:52.950  INFO 28648 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 15:03:53.828  INFO 28648 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:03:53.829  INFO 28648 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:03:54.363  INFO 28648 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 07:03:52 GMT"],"eagleid":["1bdd6ba517409854321677447e"],"request-id":["e2cd2b5f-6268-47e0-80eb-b7de2a2400ea"],"server":["Tengine"],"server-timing":["inner; dur=393","cdn-cache;desc=MISS,edge;dur=0,origin;dur=415"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache17.cn7151[415,0]"],"x-lgw-dst-svc":["YKLo75gOTrMiqX3E_9kyLqWaqSRP-St3TwVPfvg2jgNbICuKH_PDTktFaiZwzg4ekITfxR6-_8vDZIHIWijTcC1ZwL4-4bPYcHHw7Aoy1nuUYKBhSpZX-Z1YKWCNEzEaNz0Yb-uypH2i_xFJL-EBTEo0xM5rkfE9mGPS5EQSQCqI7tBGPGseLPj4WHN2N_f4dFIlph478DVro6h8olAPrS-KkUL2knLxdpBCnJXCvzI8v6g1DH92hIscMnFATqjJ3R5jT86w4eWlRYqSl7KE2Rurj44viU6qEAitzOyL56QzTbM4rYdC9yY="],"x-request-id":["e2cd2b5f-6268-47e0-80eb-b7de2a2400ea"],"x-timestamp":["1740985432.574"],"x-tt-logid":["20250303150352BD4B8803477CFDFA0BA8"],"x-tt-trace-host":["0151447f382b622797b0197faab1bd3e98532fb019f5311b4ce238cc570e2ada8201ef985ac19fcc9d18f23cb531c7916f4f0d4671e05942e5ea403862c999c40bbc3972a27d187ea4c71fc55107c08ff1aa1ea24d6c60696e1399ccd232271ed9"],"x-tt-trace-id":["00-250303150352BD4B8803477CFDFA0BA8-4E2327535DE941C7-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303150352BD4B8803477CFDFA0BA8","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"20250303150352BD4B8803477CFDFA0BA8"}
2025-03-03 15:03:54.363  INFO 28648 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 15:03:54.918  INFO 28648 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:03:54.940 DEBUG 28648 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:03:54.940 DEBUG 28648 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:03:54.960 DEBUG 28648 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:03:55.144 ERROR 28648 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:03:55.145  INFO 28648 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:03:55.146  INFO 28648 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 15:03:55.147 DEBUG 28648 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 15:03:55.147 DEBUG 28648 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 15:03:55.402  INFO 28648 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=6016913a-ff27-40e2-984e-51648a9f7fd7
2025-03-03 15:03:55.403 DEBUG 28648 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"6016913a-ff27-40e2-984e-51648a9f7fd7"}},"response_mode":"blocking","conversation_id":"1b978bfa-02ce-4721-ad5c-4439e93c1c1e","user":"fyjw"}
2025-03-03 15:04:53.801 ERROR 28648 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 15:04:53.801  INFO 28648 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474034842976258&access_key=dc3cac67d1873c2564e76952229b1d3d&service_id=33554678&ticket=ce992b60-8f1a-4213-b7c3-d8e71821a8e1 [conn_id=7477474034842976258]
2025-03-03 15:04:53.801  INFO 28648 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 15:05:16.041  INFO 28648 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:05:16.044  INFO 28648 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:05:19.000  INFO 36032 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 36032 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:05:19.001 DEBUG 36032 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:05:19.001  INFO 36032 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:05:19.365  INFO 36032 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:05:19.366  INFO 36032 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:05:19.383  INFO 36032 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 15:05:19.695  INFO 36032 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:05:19.704  INFO 36032 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:05:19.704  INFO 36032 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:05:19.796  INFO 36032 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:05:19.797  INFO 36032 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 769 ms
2025-03-03 15:05:20.015  INFO 36032 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:05:20.015  INFO 36032 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:05:20.575  INFO 36032 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:05:20.798  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474061611319324&access_key=18ee61694461527ba669b57ca6ec6e99&service_id=33554678&ticket=4391c0c2-380d-4636-aad0-5f0ef36771a5 [conn_id=7477474061611319324]
2025-03-03 15:05:20.931  INFO 36032 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:05:20.938  INFO 36032 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.131 seconds (JVM running for 2.566)
2025-03-03 15:05:23.127  INFO 36032 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740985521}
2025-03-03 15:05:23.158  WARN 36032 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 15:05:23.164  INFO 36032 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:05:23.431  INFO 36032 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:05:23.436 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:05:23.449 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:05:23.498 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:05:23.500 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:05:23.501 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:05:23.520 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:05:23.521 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:05:23.521 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:05:23.540 DEBUG 36032 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:05:23.540  INFO 36032 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 15:05:24.375  INFO 36032 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:05:24.377  INFO 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:05:24.920  INFO 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 07:05:23 GMT"],"eagleid":["74c4871e17409855227206160e"],"request-id":["98a52ccc-1e2d-41b4-a034-9a99b8612b58"],"server":["Tengine"],"server-timing":["inner; dur=416","cdn-cache;desc=MISS,edge;dur=0,origin;dur=433"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache25.cn7535[433,0]"],"x-lgw-dst-svc":["kb0ghmEpcZ_GE-kYZP7oTq9OcZ86UQiZJMR5xKJfhgQVxk7sjL7OsObT0MVR-HmXYlE8Kr0o7HzrnYCsnDyEZSg68s08jApgq747YJxqdp_cjom-xeBfeTCP9mOWkBEMM8VFyt0aZfy4sfsl3o3-687r2Sf6HfFWTSxIdzb1nqDJFEJDSZYvCNH7fG-hmQQgNm0n0dMXl88eRap93U6zun0LM950viwVJ_j2JD9QTKjmymFhxfzAeEC3bfIaqb83IuCgOTS6XMw8hlHsDQlVz4zg4LZUS3MgnF78bRVTt2t32xzYIKqjmBE="],"x-request-id":["98a52ccc-1e2d-41b4-a034-9a99b8612b58"],"x-timestamp":["1740985523.142"],"x-tt-logid":["202503031505220793C62C7205290256D6"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be3fcc4aaf4136da3396dff313a3bd2a4f2b1a90e1b7d2140fd4b3b88074fc6dc0ccc979d723596cbf7a9d7ae5eca3db9b9936ae5be42820557570267e70b024352efb359b42ed69b8e9456388eae7d60a"],"x-tt-trace-id":["00-2503031505220793C62C7205290256D6-4BB652436F98418F-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"202503031505220793C62C7205290256D6","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"202503031505220793C62C7205290256D6"}
2025-03-03 15:05:24.921  INFO 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 15:05:25.410  INFO 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:05:25.432 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:05:25.432 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:05:25.453 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:05:25.616 ERROR 36032 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:05:25.617  INFO 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:05:25.617  INFO 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 15:05:25.618 DEBUG 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 15:05:25.619 DEBUG 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 15:05:25.938  INFO 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=ce7f3048-f997-482f-9c15-cb9b61a3e95f
2025-03-03 15:05:25.939 DEBUG 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"ce7f3048-f997-482f-9c15-cb9b61a3e95f"}},"response_mode":"blocking","conversation_id":"9d6d6b82-1841-4dc9-a1de-36767ee1c868","user":"fyjw"}
2025-03-03 15:05:35.765 DEBUG 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"1b01eeb6-e263-49ce-a14f-16647efcf47c","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由 AI 生成的动漫风格插画，描绘了一位黑发少女坐在书桌前，使用笔记本电脑。她的表情温和，眼神专注，背景是一个现代化的城市景观，透过窗户可以看到高楼大厦。整个画面充满温馨和专注的氛围，适合作为办公、学习或写作的主题插画。请问您需要对此图片进行什么具体的分析或描述吗？"},"elapsed_time":9.777487979037687,"total_tokens":509,"total_steps":4,"created_at":1740985524,"finished_at":1740985534}
2025-03-03 15:05:35.766  INFO 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一张由 AI 生成的动漫风格插画，描绘了一位黑发少女坐在书桌前，使用笔记本电脑。她的表情温和，眼神专注，背景是一个现代化的城市景观，透过窗户可以看到高楼大厦。整个画面充满温馨和专注的氛围，适合作为办公、学习或写作的主题插画。请问您需要对此图片进行什么具体的分析或描述吗？
2025-03-03 15:05:35.766 DEBUG 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"dc8e1063-9b7d-4d1d-97a6-2f7bb9979234","workflow_run_id":"1b01eeb6-e263-49ce-a14f-16647efcf47c","data":{"id":"1b01eeb6-e263-49ce-a14f-16647efcf47c","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由 AI 生成的动漫风格插画，描绘了一位黑发少女坐在书桌前，使用笔记本电脑。她的表情温和，眼神专注，背景是一个现代化的城市景观，透过窗户可以看到高楼大厦。整个画面充满温馨和专注的氛围，适合作为办公、学习或写作的主题插画。请问您需要对此图片进行什么具体的分析或描述吗？"},"elapsed_time":9.777487979037687,"total_tokens":509,"total_steps":4,"created_at":1740985524,"finished_at":1740985534}}
2025-03-03 15:05:35.766  INFO 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=403
2025-03-03 15:05:35.766 DEBUG 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 15:05:35.859  INFO 36032 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"9c69ea15-92ce-4968-a3ce-450f56c2eef0"},"data_source_detail_dict":{"upload_file":{"id":"9c69ea15-92ce-4968-a3ce-450f56c2eef0","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":403,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740985534.131065}},"dataset_process_rule_id":"96d7feb6-fc0a-462d-a559-3dbd21c94a99","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":171,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":142,"hit_count":0,"doc_form":"text_model"},"batch":"20250303070534116490"}
2025-03-03 15:05:35.859  INFO 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:05:35.881 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:05:35.882 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:05:35.902 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:05:36.086 ERROR 36032 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:05:36.086  INFO 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=AY2JbDhHBaU7HYsvjMncKMh7n6Y, tableId=tblXyJKE7HZlDWFE, recordCount=5
2025-03-03 15:05:36.351 ERROR 36032 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 数据上传失败: code=91403, msg=Forbidden, reqId=20250303150534AF310D21C6CBF7F708BA
2025-03-03 15:05:36.353 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:05:36.353 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:05:36.372 DEBUG 36032 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:05:36.555 ERROR 36032 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:06:23.720 ERROR 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 15:06:23.720  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474061611319324&access_key=18ee61694461527ba669b57ca6ec6e99&service_id=33554678&ticket=4391c0c2-380d-4636-aad0-5f0ef36771a5 [conn_id=7477474061611319324]
2025-03-03 15:06:23.720  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 15:06:45.242  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 15:06:45.517  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474034843926530&access_key=bf7dd26ed777198a9bafc7130ace0a48&service_id=33554678&ticket=6b189da0-b4a0-4668-917a-45112670bc1a [conn_id=7477474034843926530]
2025-03-03 15:08:19.787 ERROR 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 15:08:19.787  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474034843926530&access_key=bf7dd26ed777198a9bafc7130ace0a48&service_id=33554678&ticket=6b189da0-b4a0-4668-917a-45112670bc1a [conn_id=7477474034843926530]
2025-03-03 15:08:19.787  INFO 36032 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 15:08:23.372  INFO 36032 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:08:23.376  INFO 36032 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:08:25.017  INFO 26940 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 26940 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:08:25.018 DEBUG 26940 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:08:25.018  INFO 26940 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:08:25.322  INFO 26940 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:08:25.323  INFO 26940 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:08:25.339  INFO 26940 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 15:08:25.625  INFO 26940 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:08:25.629  INFO 26940 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:08:25.630  INFO 26940 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:08:25.715  INFO 26940 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:08:25.715  INFO 26940 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 675 ms
2025-03-03 15:08:25.899  INFO 26940 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:08:25.900  INFO 26940 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:08:26.478  INFO 26940 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:08:26.730  INFO 26940 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474928442441730&access_key=02f1571fa5e529ff19b796f3a570f234&service_id=33554678&ticket=04c35119-974b-47aa-b203-d237a11cb44d [conn_id=7477474928442441730]
2025-03-03 15:08:26.830  INFO 26940 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:08:26.836  INFO 26940 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.11 seconds (JVM running for 2.598)
2025-03-03 15:08:28.779  INFO 26940 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"create_case","timestamp":1740985706}
2025-03-03 15:08:30.763  INFO 26940 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740985708}
2025-03-03 15:08:30.787  WARN 26940 --- [pool-2-thread-3] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @1623b78d
2025-03-03 15:08:30.794  INFO 26940 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:08:31.146  INFO 26940 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:08:31.150 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:08:31.162 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:08:31.198 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:08:31.202 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:08:31.202 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:08:31.237 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:08:31.237 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:08:31.238 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:08:31.263 DEBUG 26940 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:08:31.263  INFO 26940 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 15:08:31.874  INFO 26940 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:08:31.875  INFO 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:08:32.433  INFO 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 07:08:30 GMT"],"eagleid":["74c48fbb17409857102107026e"],"request-id":["8ec87771-a2e7-43a2-a2f8-412bdb70cdd8"],"server":["Tengine"],"server-timing":["inner; dur=431","cdn-cache;desc=MISS,edge;dur=0,origin;dur=448"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["vcache39.cn7149[448,0]"],"x-lgw-dst-svc":["o-pzYKO5UzzTzE6GKnlZYle60VNcuAENoF2-5Y4sBa2lakkxqHoTF6U6d056V3ewrQe3raivlTuOoXOvpOq0PXfa35ScHd8t4CV8BSYFxmAuv-wjysSaN2JFGriLFDQh7AV1AcRRpAwOFgArBXQ5Scv6HpzUp8Gfzjzl82dQTBAhw_M-ND_vh0_5pY4dLozvJf-7ytc1vi8YPrKJ1e9lwZJdkJYET6Pg2NCUVAyl4n0gTYR3zbTL_3g3vF9vb2o5HFzWP6AWV0SYl_qZK3xpcV4MNl5vfTP7izq1B-FMaQu_VXRD7ateSYU="],"x-request-id":["8ec87771-a2e7-43a2-a2f8-412bdb70cdd8"],"x-timestamp":["1740985710.652"],"x-tt-logid":["20250303150830311F0DBEA7A0D1F981DD"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be22d997931844735aaaaf94e56bbd5cadaa60ee355a648352d9af8201eb47d277a7fbee10f96aa4237ffb43dbaca88368ee558d0a9b132acb6dfec234f1aeb64d24e4091766c33b64dbe8200d59d2e080"],"x-tt-trace-id":["00-250303150830311F0DBEA7A0D1F981DD-337350900BFDC757-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303150830311F0DBEA7A0D1F981DD","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"20250303150830311F0DBEA7A0D1F981DD"}
2025-03-03 15:08:32.434  INFO 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 15:08:33.028  INFO 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:08:33.055 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:08:33.056 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:08:33.083 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:08:33.241 ERROR 26940 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:08:33.242  INFO 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:08:33.242  INFO 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 15:08:33.244 DEBUG 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 15:08:33.244 DEBUG 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 15:08:33.516  INFO 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=46f0b712-0601-4e5a-b679-0103572c7aaa
2025-03-03 15:08:33.516 DEBUG 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"46f0b712-0601-4e5a-b679-0103572c7aaa"}},"response_mode":"blocking","conversation_id":"8e2b6ade-9652-4241-9756-48e0b2c106ce","user":"fyjw"}
2025-03-03 15:08:43.594 DEBUG 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"99aa78c0-0f12-46e0-9919-9141be58fd52","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由AI生成的插画，描绘了一位长发黑色的动漫风格女性坐在桌前使用笔记本电脑。背景是现代都市风景，透过窗户可以看到高楼大厦，整体氛围温暖且富有生活感。她的表情温柔友好，环境布置也很温馨，给人一种舒适的工作或学习氛围。这种风格的插画通常用于插图、壁纸或社交媒体头像。"},"elapsed_time":10.024857704993337,"total_tokens":511,"total_steps":4,"created_at":1740985711,"finished_at":1740985721}
2025-03-03 15:08:43.594  INFO 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一张由AI生成的插画，描绘了一位长发黑色的动漫风格女性坐在桌前使用笔记本电脑。背景是现代都市风景，透过窗户可以看到高楼大厦，整体氛围温暖且富有生活感。她的表情温柔友好，环境布置也很温馨，给人一种舒适的工作或学习氛围。这种风格的插画通常用于插图、壁纸或社交媒体头像。
2025-03-03 15:08:43.594 DEBUG 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"fa2db2b8-99b6-4ffa-9688-f890c03fea13","workflow_run_id":"99aa78c0-0f12-46e0-9919-9141be58fd52","data":{"id":"99aa78c0-0f12-46e0-9919-9141be58fd52","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一张由AI生成的插画，描绘了一位长发黑色的动漫风格女性坐在桌前使用笔记本电脑。背景是现代都市风景，透过窗户可以看到高楼大厦，整体氛围温暖且富有生活感。她的表情温柔友好，环境布置也很温馨，给人一种舒适的工作或学习氛围。这种风格的插画通常用于插图、壁纸或社交媒体头像。"},"elapsed_time":10.024857704993337,"total_tokens":511,"total_steps":4,"created_at":1740985711,"finished_at":1740985721}}
2025-03-03 15:08:43.595  INFO 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=398
2025-03-03 15:08:43.595 DEBUG 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 15:08:43.679  INFO 26940 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"f4620c31-0e33-46ad-97f5-42a079f3c3a2"},"data_source_detail_dict":{"upload_file":{"id":"f4620c31-0e33-46ad-97f5-42a079f3c3a2","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":398,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740985721.955918}},"dataset_process_rule_id":"808ed14c-0673-4608-a9c2-23fe7d3aee3a","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":159,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":137,"hit_count":0,"doc_form":"text_model"},"batch":"20250303070841829246"}
2025-03-03 15:08:43.680  INFO 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:08:43.706 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:08:43.707 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:08:43.733 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:08:43.910 ERROR 26940 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:08:43.910  INFO 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=AY2JbDhHBaU7HYsvjMncKMh7n6Y, tableId=tblXyJKE7HZlDWFE, recordCount=5
2025-03-03 15:08:44.188 ERROR 26940 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 数据上传失败: code=1254037, msg=Invalid client token, make sure that it complies with the specification., reqId=20250303150842AF5A093D40E384EAEC41
2025-03-03 15:08:44.189 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:08:44.190 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:08:44.217 DEBUG 26940 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:08:44.344 ERROR 26940 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:13:26.516 ERROR 26940 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-03-03 15:13:26.516  INFO 26940 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474928442441730&access_key=02f1571fa5e529ff19b796f3a570f234&service_id=33554678&ticket=04c35119-974b-47aa-b203-d237a11cb44d [conn_id=7477474928442441730]
2025-03-03 15:13:26.516  INFO 26940 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-03-03 15:13:31.032  INFO 26940 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-03-03 15:13:31.479  INFO 26940 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477475201577664540&access_key=1d97e559962fb8e671977de749217019&service_id=33554678&ticket=f0c8311d-0ccb-43c6-872f-742bb9e00dea [conn_id=7477475201577664540]
2025-03-03 15:13:42.763  INFO 26940 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:13:42.767  INFO 26940 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:13:46.634  INFO 37524 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 37524 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:13:46.635 DEBUG 37524 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:13:46.635  INFO 37524 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:13:46.935  INFO 37524 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:13:46.937  INFO 37524 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:13:46.952  INFO 37524 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-03-03 15:13:47.248  INFO 37524 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:13:47.257  INFO 37524 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:13:47.257  INFO 37524 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:13:47.344  INFO 37524 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:13:47.344  INFO 37524 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 686 ms
2025-03-03 15:13:47.538  INFO 37524 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:13:47.538  INFO 37524 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:13:48.127  INFO 37524 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:13:48.331  INFO 37524 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474928443768834&access_key=92f408808061cf6b61f431d68e46adec&service_id=33554678&ticket=d49cd35c-222c-452b-b64c-169752aa6aee [conn_id=7477474928443768834]
2025-03-03 15:13:48.490  INFO 37524 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:13:48.497  INFO 37524 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.056 seconds (JVM running for 2.501)
2025-03-03 15:13:57.147  INFO 35624 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 35624 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:13:57.148 DEBUG 35624 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:13:57.149  INFO 35624 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:13:57.511  INFO 35624 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:13:57.512  INFO 35624 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:13:57.531  INFO 35624 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-03-03 15:13:57.919  INFO 35624 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:13:57.926  INFO 35624 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:13:57.927  INFO 35624 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:13:58.042  INFO 35624 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:13:58.043  INFO 35624 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 870 ms
2025-03-03 15:13:58.271  INFO 35624 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:13:58.273  INFO 35624 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:13:58.810  INFO 35624 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:13:59.067  INFO 35624 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477474928443785218&access_key=d301c2c6b0448c98a84491538a9da2f7&service_id=33554678&ticket=2846e305-873e-43f7-a592-ca8876e8b3ff [conn_id=7477474928443785218]
2025-03-03 15:13:59.148  INFO 35624 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:13:59.155  INFO 35624 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.226 seconds (JVM running for 2.686)
2025-03-03 15:14:29.207  INFO 35624 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_analysis","timestamp":1740986067}
2025-03-03 15:14:29.236  WARN 35624 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 15:14:29.242  INFO 35624 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:14:29.501  INFO 35624 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:14:29.505 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:14:29.516 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:14:29.548 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:14:29.551 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:14:29.552 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:14:29.573 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:14:29.574 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:14:29.574 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:14:29.594 DEBUG 35624 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:14:29.595  INFO 35624 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 获取文件夹token: G20EfDOp0lI6ZWd0o3pctlXdnbg
2025-03-03 15:14:30.542  INFO 35624 --- [pool-2-thread-2] em.backend.service.impl.CaseServiceImpl  : 发送文件分类卡片成功: openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:14:30.543  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始异步分析文件: folderToken=G20EfDOp0lI6ZWd0o3pctlXdnbg, openId=ou_8e248fda8f4bff8499c1a7072767bfce, caseId=22
2025-03-03 15:14:31.132  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取文件列表响应: {"code":0,"data":{"files":[{"created_time":"1740979310","modified_time":"1740979310","name":"8a45f0de84c02736f8b4ce35d54ca01c.png","owner_id":"ou_8e248fda8f4bff8499c1a7072767bfce","parent_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg","token":"VKlJbBSRooB1ULxdkmEcYYI3nwV","type":"file","url":"https://vcnjyexq8awr.feishu.cn/file/VKlJbBSRooB1ULxdkmEcYYI3nwV"}],"has_more":false},"msg":"success","rawResponse":{"body":[123,34,99,111,100,101,34,58,48,44,34,100,97,116,97,34,58,123,34,102,105,108,101,115,34,58,91,123,34,99,114,101,97,116,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,109,111,100,105,102,105,101,100,95,116,105,109,101,34,58,34,49,55,52,48,57,55,57,51,49,48,34,44,34,110,97,109,101,34,58,34,56,97,52,53,102,48,100,101,56,52,99,48,50,55,51,54,102,56,98,52,99,101,51,53,100,53,52,99,97,48,49,99,46,112,110,103,34,44,34,111,119,110,101,114,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,112,97,114,101,110,116,95,116,111,107,101,110,34,58,34,71,50,48,69,102,68,79,112,48,108,73,54,90,87,100,48,111,51,112,99,116,108,88,100,110,98,103,34,44,34,116,111,107,101,110,34,58,34,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,44,34,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,114,108,34,58,34,104,116,116,112,115,58,47,47,118,99,110,106,121,101,120,113,56,97,119,114,46,102,101,105,115,104,117,46,99,110,47,102,105,108,101,47,86,75,108,74,98,66,83,82,111,111,66,49,85,76,120,100,107,109,69,99,89,89,73,51,110,119,86,34,125,93,44,34,104,97,115,95,109,111,114,101,34,58,102,97,108,115,101,125,44,34,109,115,103,34,58,34,115,117,99,99,101,115,115,34,125],"fileName":"","headers":{"content-type":["application/json; charset=utf-8"],"date":["Mon, 03 Mar 2025 07:14:29 GMT"],"eagleid":["74c4871317409860688871954e"],"request-id":["38b39bee-be29-4ed1-b031-846b70b66ba5"],"server":["Tengine"],"server-timing":["inner; dur=458","cdn-cache;desc=MISS,edge;dur=0,origin;dur=483"],"timing-allow-origin":["*"],"tt_stable":["1"],"vary":["Accept-Encoding"],"via":["cache14.cn7535[483,0]"],"x-lgw-dst-svc":["jJ2W3TEUF-9udqGUksE87yBGNbYu8qlAS_LpO-Gg6dUUHNY0NzoPTicqfg0xwIhanQqGZ248wu9AZ81MuJ945o7m980o0YFV5dvIZtz1fQrdLfvVgNwiOLUbOvY2NfBiin01MuM5_JrqLxV4O5Gjj2vHlrIzvPKrYCozv2e5ngoC4IgmxVvIVjd7wiSF-9yJNIU8PGDcprQig8CgDQyffR2HNXIzG9KRdUQRgolJvdjiqvdkIqBURY0g4C5eMn_vwnTxSJxlg_RKEBrGeNm_Ld5gKzE1OmY3nV6St2gXCNShjdvVPw-9e2g="],"x-request-id":["38b39bee-be29-4ed1-b031-846b70b66ba5"],"x-timestamp":["1740986069.357"],"x-tt-logid":["20250303151428972E4899256F90FE23C2"],"x-tt-trace-host":["01b93b043a888062779e8293099aa4a1be420ecdc8e7b6d7b04d735a21c92a3f5a476727bc0be0a035f1753424de8801586b183a32aff91a576dc4d18f31703ed50d7e6f182893915d08718509703e2f61c809904df45689e9bb04ffc3692b8ca0"],"x-tt-trace-id":["00-250303151428972E4899256F90FE23C2-6AE332B3770A905B-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},"requestID":"20250303151428972E4899256F90FE23C2","statusCode":200},"request":{"folder_token":"G20EfDOp0lI6ZWd0o3pctlXdnbg"},"requestId":"20250303151428972E4899256F90FE23C2"}
2025-03-03 15:14:31.132  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 获取到的文件列表: [IFeishuFolderService.FileInfo(fileToken=VKlJbBSRooB1ULxdkmEcYYI3nwV, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileType=file, fileSize=null, createTime=1740979310, updateTime=1740979310)]
2025-03-03 15:14:31.986  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始分析图片: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:14:32.012 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:14:32.012 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:14:32.034 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:14:32.178 ERROR 35624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:14:32.180  INFO 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始分析图片: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:14:32.180  INFO 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, userId=system
2025-03-03 15:14:32.180 DEBUG 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/files/upload
2025-03-03 15:14:32.182 DEBUG 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : <{file=[Byte array resource [resource loaded from byte array]], user=[system]},[Content-Type:"multipart/form-data", Authorization:"Bearer app-81sNK1GrKlJJHUUNDoVdFUy3"]>
2025-03-03 15:14:32.509  INFO 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 文件上传成功: fileId=7229bffe-96bf-45e7-bb47-66924877f38e
2025-03-03 15:14:32.509 DEBUG 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送图片分析请求: url=http://1.13.79.29:8088/v1/workflows/run, body={"inputs":{"file":{"type":"image","transfer_method":"local_file","upload_file_id":"7229bffe-96bf-45e7-bb47-66924877f38e"}},"response_mode":"blocking","conversation_id":"cd892c57-21aa-4892-8821-e37e014ae34f","user":"fyjw"}
2025-03-03 15:14:56.710 DEBUG 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : data: {"id":"786484bc-197d-441f-b522-e925121f4c15","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由人工智能生成的动漫风格的图片，描绘了一位长发的年轻女性坐在桌前使用笔记本电脑。背景是一个现代化的办公或家庭环境，窗外可以看到城市天际线。这种风格的图像通常由AI工具生成，例如清言AI（图像右下角的标识表明了这一点）。请告诉我您是否需要进一步的信息或描述！"},"elapsed_time":24.15322238393128,"total_tokens":492,"total_steps":4,"created_at":1740986070,"finished_at":1740986095}
2025-03-03 15:14:56.710  INFO 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 图片分析成功: fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, text=这是一个由人工智能生成的动漫风格的图片，描绘了一位长发的年轻女性坐在桌前使用笔记本电脑。背景是一个现代化的办公或家庭环境，窗外可以看到城市天际线。这种风格的图像通常由AI工具生成，例如清言AI（图像右下角的标识表明了这一点）。请告诉我您是否需要进一步的信息或描述！
2025-03-03 15:14:56.710 DEBUG 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : {"task_id":"ce2a28b7-2b56-4e19-b6b3-6f3d8ab9749c","workflow_run_id":"786484bc-197d-441f-b522-e925121f4c15","data":{"id":"786484bc-197d-441f-b522-e925121f4c15","workflow_id":"0959d549-80ed-4c0b-8465-94480f893761","status":"succeeded","outputs":{"image":"这是一个由人工智能生成的动漫风格的图片，描绘了一位长发的年轻女性坐在桌前使用笔记本电脑。背景是一个现代化的办公或家庭环境，窗外可以看到城市天际线。这种风格的图像通常由AI工具生成，例如清言AI（图像右下角的标识表明了这一点）。请告诉我您是否需要进一步的信息或描述！"},"elapsed_time":24.15322238393128,"total_tokens":492,"total_steps":4,"created_at":1740986070,"finished_at":1740986095}}
2025-03-03 15:14:56.710  INFO 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 开始上传文件: knowledgeId=9bf1be9c-0b02-4b0d-9004-660a9df2a224, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, fileSize=388
2025-03-03 15:14:56.710 DEBUG 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 发送上传文件请求: url=http://1.13.79.29:8088/v1/datasets/9bf1be9c-0b02-4b0d-9004-660a9df2a224/document/create-by-file, fileName=8a45f0de84c02736f8b4ce35d54ca01c.png, dataJson={"indexing_technique":"high_quality","process_rule":{"rules":{"pre_processing_rules":[{"id":"remove_extra_spaces","enabled":true},{"id":"remove_urls_emails","enabled":true}],"segmentation":{"separator":"###","max_tokens":500}},"mode":"custom"}}
2025-03-03 15:14:56.800  INFO 35624 --- [task-1] e.b.s.impl.DifyKnowledgeServiceImpl      : 上传文件成功: response={"document":{"id":"bc5c7a5f-e170-4cdc-8726-74b0627d87c3","position":1,"data_source_type":"upload_file","data_source_info":{"upload_file_id":"fe8ff6b2-acef-47b7-921e-087d44eb6ae1"},"data_source_detail_dict":{"upload_file":{"id":"fe8ff6b2-acef-47b7-921e-087d44eb6ae1","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","size":388,"extension":"md","mime_type":"application/octet-stream","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740986095.075798}},"dataset_process_rule_id":"4a891b78-5a21-43bc-a040-24b633e9fc7d","name":"8a45f0de84c02736f8b4ce35d54ca01c.md","created_from":"api","created_by":"c57027cb-91fa-479c-b9a7-bb440278b3ed","created_at":1740979346,"tokens":171,"indexing_status":"waiting","enabled":true,"archived":false,"display_status":"queuing","word_count":134,"hit_count":0,"doc_form":"text_model"},"batch":"20250303071455632505"}
2025-03-03 15:14:56.801  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 图片分析和上传完成: 8a45f0de84c02736f8b4ce35d54ca01c.png
2025-03-03 15:14:56.820 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:14:56.820 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:14:56.842 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:14:57.019 ERROR 35624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:14:57.019  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 开始上传数据到多维表格: appToken=AY2JbDhHBaU7HYsvjMncKMh7n6Y, tableId=tblXyJKE7HZlDWFE, recordCount=5
2025-03-03 15:14:59.094  INFO 35624 --- [task-1] e.b.s.impl.FeishuFolderServiceImpl       : 成功上传记录到多维表格
2025-03-03 15:14:59.117 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:14:59.117 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:14:59.139 DEBUG 35624 --- [task-1] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:14:59.282 ERROR 35624 --- [task-1] e.b.service.impl.MessageServiceImpl      : 发送消息卡片失败, code: 230001, msg: Your request contains an invalid request parameter, ext=invalid receive_id
2025-03-03 15:42:18.156  INFO 35624 --- [pool-2-thread-17] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac","chat_type":"p2p","content":"{\"text\":\"生成文件说明\"}","create_time":"1740987735955","message_id":"om_f68083e98e3d01461c808531434c713b","message_type":"text","update_time":"1740987735955"},"sender":{"sender_id":{"open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e","user_id":"d3d5egbc"},"sender_type":"user","tenant_key":"14191646f559d758"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,100,54,49,101,57,101,99,51,49,101,50,101,98,53,56,100,100,98,54,56,99,54,97,101,49,102,50,50,48,53,57,51,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,55,55,51,54,50,57,53,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-25,-108,-97,-26,-120,-112,-26,-106,-121,-28,-69,-74,-24,-81,-76,-26,-104,-114,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,55,55,51,53,57,53,53,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,102,54,56,48,56,51,101,57,56,101,51,100,48,49,52,54,49,99,56,48,56,53,51,49,52,51,52,99,55,49,51,98,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,55,55,51,53,57,53,53,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a73c62ce90b0d013","create_time":"1740987736295","event_id":"d61e9ec31e2eb58ddb68c6ae1f220593","event_type":"im.message.receive_v1","tenant_key":"14191646f559d758","token":""},"requestId":"","schema":"2.0","tenantKey":"14191646f559d758"}]
2025-03-03 15:42:18.156  INFO 35624 --- [pool-2-thread-17] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 15:42:18.157  INFO 35624 --- [pool-2-thread-17] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_8e248fda8f4bff8499c1a7072767bfce], 查询=[生成文件说明]
2025-03-03 15:42:18.180 DEBUG 35624 --- [pool-2-thread-17] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-03-03 15:42:18.180 DEBUG 35624 --- [pool-2-thread-17] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:42:18.201 DEBUG 35624 --- [pool-2-thread-17] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 0
2025-03-03 15:42:18.203 DEBUG 35624 --- [pool-2-thread-17] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:42:18.203 DEBUG 35624 --- [pool-2-thread-17] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:42:18.223 DEBUG 35624 --- [pool-2-thread-17] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:42:19.144  INFO 35624 --- [pool-2-thread-17] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7477485387817320450:streaming_sey]
2025-03-03 15:42:19.146  INFO 35624 --- [ForkJoinPool.commonPool-worker-1] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[生成文件说明], user=[ou_8e248fda8f4bff8499c1a7072767bfce]
2025-03-03 15:42:19.230 ERROR 35624 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify API 请求失败: 401 - {"code": "unauthorized", "message": "Access token is invalid", "status": 401}
2025-03-03 15:42:19.230 ERROR 35624 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : Dify返回错误: Dify API调用失败，状态码: 401
2025-03-03 15:42:19.375  INFO 35624 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7477485387817320450], sequence=[3]
2025-03-03 15:42:19.631 ERROR 35624 --- [pool-2-thread-18] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 975c8aa7-4c69-4b7c-9dad-6876a0a0cb80, trace_id: 06ecec6b2015c19e096681cba1173472, [conn_id=7477474928443785218]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:42:19.639  INFO 35624 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-03-03 15:42:21.065 ERROR 35624 --- [pool-2-thread-19] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: a64f246e-7937-4d53-b133-14abf1566aa5, trace_id: e6429084556f02f35bb8795d9b44a642, [conn_id=7477474928443785218]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:42:22.511  INFO 35624 --- [pool-2-thread-20] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_list","timestamp":1740987740}
2025-03-03 15:42:22.511  WARN 35624 --- [pool-2-thread-20] em.backend.handler.MenuEventHandler      : 未知的菜单事件: file_list
2025-03-03 15:42:35.033 ERROR 35624 --- [pool-2-thread-21] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 0beb7757-e888-40ca-8065-94b9d693ddcc, trace_id: 06ecec6b2015c19e096681cba1173472, [conn_id=7477474928443785218]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:42:35.952 ERROR 35624 --- [pool-2-thread-22] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 9357ea0a-75fd-4ce1-93c4-c87164f61486, trace_id: e6429084556f02f35bb8795d9b44a642, [conn_id=7477474928443785218]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:42:45.991  INFO 35624 --- [pool-2-thread-23] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_list","timestamp":1740987764}
2025-03-03 15:42:45.991  WARN 35624 --- [pool-2-thread-23] em.backend.handler.MenuEventHandler      : 未知的菜单事件: file_list
2025-03-03 15:43:44.834  INFO 35624 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:43:44.837  INFO 35624 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:43:46.492  INFO 38192 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 38192 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:43:46.493 DEBUG 38192 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:43:46.493  INFO 38192 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:43:46.836  INFO 38192 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:43:46.837  INFO 38192 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:43:46.854  INFO 38192 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-03-03 15:43:47.154  INFO 38192 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:43:47.163  INFO 38192 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:43:47.163  INFO 38192 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:43:47.254  INFO 38192 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:43:47.255  INFO 38192 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 738 ms
2025-03-03 15:43:47.429  INFO 38192 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:43:47.430  INFO 38192 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:43:47.981  INFO 38192 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:43:48.208  INFO 38192 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477482896218030082&access_key=5b890e9ed1d5eafcb15722e99b93608d&service_id=33554678&ticket=2c48e190-4ba0-4167-80f9-611d869f4a84 [conn_id=7477482896218030082]
2025-03-03 15:43:48.290  INFO 38192 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:43:48.295  INFO 38192 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.011 seconds (JVM running for 2.453)
2025-03-03 15:43:48.725  INFO 38192 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_list","timestamp":1740987826}
2025-03-03 15:43:48.753  WARN 38192 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @c8c12ac
2025-03-03 15:43:48.758  INFO 38192 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:43:49.034  INFO 38192 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:43:49.037 DEBUG 38192 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:43:49.049 DEBUG 38192 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:43:49.084 DEBUG 38192 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:43:49.087 DEBUG 38192 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:43:49.088 DEBUG 38192 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:43:49.110 DEBUG 38192 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:43:49.947  WARN 38192 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 未知的菜单事件: file_list
2025-03-03 15:44:53.795  INFO 38192 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:44:53.806  INFO 38192 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-03-03 15:44:57.181  INFO 26872 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 17.0.11 on LAPTOP-6DQQ7FL5 with PID 26872 (D:\project\feishu-fyjw\target\classes started by 12117 in D:\project\feishu-fyjw)
2025-03-03 15:44:57.182 DEBUG 26872 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-03-03 15:44:57.182  INFO 26872 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-03-03 15:44:57.549  INFO 26872 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-03-03 15:44:57.551  INFO 26872 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-03-03 15:44:57.577  INFO 26872 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 15 ms. Found 0 Redis repository interfaces.
2025-03-03 15:44:58.018  INFO 26872 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-03-03 15:44:58.024  INFO 26872 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-03-03 15:44:58.024  INFO 26872 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-03-03 15:44:58.130  INFO 26872 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-03-03 15:44:58.131  INFO 26872 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 927 ms
2025-03-03 15:44:58.341  INFO 26872 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: http://1.13.79.29:8088/v1
2025-03-03 15:44:58.341  INFO 26872 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-03-03 15:44:58.922  INFO 26872 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-03-03 15:44:59.160  INFO 26872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7477483678830166044&access_key=3ddb00b9307d082288846651c259a2d6&service_id=33554678&ticket=1fd53996-204b-498f-b3a2-e2213ea72a3d [conn_id=7477483678830166044]
2025-03-03 15:44:59.288  INFO 26872 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-03-03 15:44:59.294  INFO 26872 --- [main] em.backend.BackendApplication            : Started BackendApplication in 2.297 seconds (JVM running for 2.689)
2025-03-03 15:45:00.006  INFO 26872 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"file_list","timestamp":1740987898}
2025-03-03 15:45:00.034  WARN 26872 --- [pool-2-thread-2] c.b.m.c.t.support.ReflectLambdaMeta      : Unable to make field private final java.lang.Class java.lang.invoke.SerializedLambda.capturingClass accessible: module java.base does not "opens java.lang.invoke" to unnamed module @6adbc9d
2025-03-03 15:45:00.040  INFO 26872 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-03-03 15:45:00.281  INFO 26872 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-03-03 15:45:00.285 DEBUG 26872 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:45:00.295 DEBUG 26872 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:45:00.331 DEBUG 26872 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:45:00.334 DEBUG 26872 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:45:00.334 DEBUG 26872 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:45:00.354 DEBUG 26872 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:45:01.153  WARN 26872 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 未知的菜单事件: file_list
2025-03-03 15:46:35.010  INFO 26872 --- [pool-2-thread-3] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_name":"罗振荣","operator_id":{"user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"}},"event_key":"case_overview","timestamp":1740987993}
2025-03-03 15:46:35.029 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:46:35.030 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:46:35.050 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:46:35.050 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:46:35.050 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:46:35.069 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:46:35.071 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-03-03 15:46:35.071 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:46:35.091 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 5
2025-03-03 15:46:35.091 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-03-03 15:46:35.091 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:46:35.113 DEBUG 26872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-03-03 15:46:38.186  INFO 26872 --- [pool-2-thread-4] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14191646f559d758","user_id":"d3d5egbc","open_id":"ou_8e248fda8f4bff8499c1a7072767bfce","union_id":"on_f32b92112a285f8349308d9698203d3e"},"token":"c-6656192126a7bfaa294127f1f05c4fe68109ecf8","action":{"tag":"button","timezone":"Asia/Shanghai","name":"case_overview_callback","form_value":{"Select_case":"22"}},"host":"im_message","context":{"open_message_id":"om_c092310663927bad1dc6eaefa12290a2","open_chat_id":"oc_ca8485b0326b6f77e9d48085090f70ac"}},"schema":"2.0","header":{"event_id":"3d16c061665eebf9020b511b871f1663","event_type":"card.action.trigger","app_id":"cli_a73c62ce90b0d013","tenant_key":"14191646f559d758","create_time":"1740987996496142","token":"za3iBwmP42XM4YMo9z0tq1OgMlRAG7tc"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,51,100,49,54,99,48,54,49,54,54,53,101,101,98,102,57,48,50,48,98,53,49,49,98,56,55,49,102,49,54,54,51,34,44,34,116,111,107,101,110,34,58,34,122,97,51,105,66,119,109,80,52,50,88,77,52,89,77,111,57,122,48,116,113,49,79,103,77,108,82,65,71,55,116,99,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,57,56,55,57,57,54,52,57,54,49,52,50,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,99,54,50,99,101,57,48,98,48,100,48,49,51,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,49,57,49,54,52,54,102,53,53,57,100,55,53,56,34,44,34,117,115,101,114,95,105,100,34,58,34,100,51,100,53,101,103,98,99,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,101,50,52,56,102,100,97,56,102,52,98,102,102,56,52,57,57,99,49,97,55,48,55,50,55,54,55,98,102,99,101,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,102,51,50,98,57,50,49,49,50,97,50,56,53,102,56,51,52,57,51,48,56,100,57,54,57,56,50,48,51,100,51,101,34,125,44,34,116,111,107,101,110,34,58,34,99,45,54,54,53,54,49,57,50,49,50,54,97,55,98,102,97,97,50,57,52,49,50,55,102,49,102,48,53,99,52,102,101,54,56,49,48,57,101,99,102,56,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,50,50,34,125,44,34,110,97,109,101,34,58,34,99,97,115,101,95,111,118,101,114,118,105,101,119,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,99,48,57,50,51,49,48,54,54,51,57,50,55,98,97,100,49,100,99,54,101,97,101,102,97,49,50,50,57,48,97,50,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,99,97,56,52,56,53,98,48,51,50,54,98,54,102,55,55,101,57,100,52,56,48,56,53,48,57,48,102,55,48,97,99,34,125,125,125],"headers":{}}}
2025-03-03 15:46:38.187  INFO 26872 --- [pool-2-thread-4] em.backend.handler.CardEventHandler      : 案件总览选择的案件ID: 22
2025-03-03 15:46:38.207 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:46:38.207 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:46:38.228 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:46:38.256 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-03-03 15:46:38.256 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:46:38.277 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-03-03 15:46:38.279 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-03-03 15:46:38.279 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 22(Long), 测试案件(String), ou_8e248fda8f4bff8499c1a7072767bfce(String)
2025-03-03 15:46:38.318 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-03-03 15:46:38.367 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,dify_knowledge_id,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-03-03 15:46:38.367 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 22(String)
2025-03-03 15:46:38.386 DEBUG 26872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-03-03 15:47:35.042 ERROR 26872 --- [pool-2-thread-6] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 003af83a-8bee-47ad-8724-c2a0dc75c0a8, trace_id: 06ecec6b2015c19e096681cba1173472, [conn_id=7477483678830166044]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:47:35.792 ERROR 26872 --- [pool-2-thread-7] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 0def019b-0b32-4dee-ac2d-5f262f01bde2, trace_id: e6429084556f02f35bb8795d9b44a642, [conn_id=7477483678830166044]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:52:48.731 ERROR 26872 --- [pool-2-thread-10] com.lark.oapi.ws.Client                  : handle message failed, message_type: event, message_id: 1fc9c427-c40c-4af2-bd8b-786bb3110904, trace_id: 6f77a05e70fb1cc946e0e3c633732c7d, [conn_id=7477483678830166044]

com.lark.oapi.event.exception.HandlerNotFoundException: event type:im.chat.access_event.bot_p2p_chat_entered_v1, not found handler
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:272) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

2025-03-03 15:55:26.929  INFO 26872 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-03-03 15:55:26.932  INFO 26872 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
