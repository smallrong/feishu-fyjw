2025-02-28 00:00:04.934  INFO 133040 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: {"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"image_key\":\"img_v3_02ju_6bb900de-944c-4870-829c-3876a30e03dg\"}","create_time":"1740672003739","message_id":"om_4a729ae15390f1609aedaaf614da5594","message_type":"image","update_time":"1740672003739"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,51,102,98,97,97,50,57,54,56,101,57,99,101,99,53,100,97,101,50,98,100,100,54,51,102,48,49,49,54,97,98,102,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,48,48,52,48,52,53,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,105,109,97,103,101,95,107,101,121,92,34,58,92,34,105,109,103,95,118,51,95,48,50,106,117,95,54,98,98,57,48,48,100,101,45,57,52,52,99,45,52,56,55,48,45,56,50,57,99,45,51,56,55,54,97,51,48,101,48,51,100,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,48,48,51,55,51,57,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,52,97,55,50,57,97,101,49,53,51,57,48,102,49,54,48,57,97,101,100,97,97,102,54,49,52,100,97,53,53,57,52,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,105,109,97,103,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,48,48,51,55,51,57,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740672004045","event_id":"3fbaa2968e9cec5dae2bdd63f0116abf","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}
2025-02-28 00:00:04.937  INFO 133040 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[image], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:00:04.937  INFO 133040 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 未处理的消息类型: image
2025-02-28 00:00:17.647  INFO 133040 --- [pool-2-thread-3] em.backend.handler.MessageEventHandler   : 收到消息事件: {"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg\",\"file_name\":\"图片1.png\"}","create_time":"1740672016774","message_id":"om_bd4c4ca4ca38387379e1268965335307","message_type":"file","update_time":"1740672016774"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,48,97,51,102,52,102,56,54,51,50,100,54,100,56,55,98,53,54,102,55,57,57,54,56,56,52,51,54,51,50,53,101,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,48,49,55,48,51,49,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,100,100,54,48,55,100,100,98,45,51,56,48,51,45,52,56,53,98,45,98,97,53,102,45,98,53,49,54,51,50,49,102,54,102,102,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,-27,-101,-66,-25,-119,-121,49,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,48,49,54,55,55,52,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,98,100,52,99,52,99,97,52,99,97,51,56,51,56,55,51,55,57,101,49,50,54,56,57,54,53,51,51,53,51,48,55,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,48,49,54,55,55,52,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740672017031","event_id":"0a3f4f8632d6d87b56f799688436325e","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}
2025-02-28 00:00:17.648  INFO 133040 --- [pool-2-thread-3] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:00:17.652  INFO 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_bd4c4ca4ca38387379e1268965335307], fileKey=[file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg]
2025-02-28 00:00:17.791  INFO 133040 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:00:17.969  INFO 133040 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:00:17.976 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:00:18.000 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:00:18.029 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:00:18.036 DEBUG 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=17, currentCaseName=3307, createTime=2025-02-25T14:47:06, updateTime=2025-02-27T18:09:06, deleted=0)]
2025-02-28 00:00:18.041 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:00:18.041 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 17(Long)
2025-02-28 00:00:18.047 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:00:18.047 DEBUG 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=17, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=3307, clientName=3007, caseDesc=3007, caseTime=2025-02-11T18:29, remarks=3007, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/U6LCf2pUXlouUidNwqGciqR8nQc, createTime=2025-02-26T18:42:39, updateTime=2025-02-26T18:42:39, deleted=0)]
2025-02-28 00:00:18.048 DEBUG 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[U6LCf2pUXlouUidNwqGciqR8nQc]
2025-02-28 00:00:18.048  INFO 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg]
2025-02-28 00:00:18.048 DEBUG 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg]
2025-02-28 00:00:18.049 DEBUG 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_5992750002584717624.tmp]
2025-02-28 00:00:18.050 DEBUG 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:00:18.435 ERROR 133040 --- [pool-2-thread-3] c.l.oapi.service.drive.v1.resource.File  : /open-apis/drive/v1/files/:file_token/download,callError,req={"file_token":"file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg"},respHeader={"connection":["keep-alive"],"content-length":["0"],"date":["Thu, 27 Feb 2025 16:00:17 GMT"],"eagleid":["74c48fad17406720178395236e"],"request-id":["03e871c0-a317-4a00-a27e-11edabd3c5d0"],"server":["Tengine"],"server-timing":["inner; dur=109","cdn-cache;desc=MISS,edge;dur=0,origin;dur=125"],"timing-allow-origin":["*"],"tt_stable":["1"],"via":["vcache25.cn7149[125,0]"],"x-alicdn-da-ups-status":["endOs,0,404"],"x-envoy-response-flags":["-"],"x-lgw-dst-svc":["RCdHN7OeXhbU-ef5dqKRE-V3OtqYiz1pbJcuTnoUXx07btQTrZJ-AYAsMKE2j50TU4mRiuVM5ZXJQ1ervFhCqF5g3w2JR0mwhNjZDSBFDnqXTOoBt_vDZTZYmgRr4JF_207Wb9VU5-37mewRAl7VHJLce-k__qAMR4gwRu9nHkBED7l2AF56kS-gOLjuSA9YwF-2UJkSzA_Driw_hewU9AABhUC7rZ9krKGwToHsIRiAJX7J08gQHCv365LHsw07UkCNb_EQbJnGQD9Okrkfgb3OvcHpBl-8O5sDTLSG29I8ywYDnLFC1miG2tBvltoHYr2ipKs_EmfSY-L3mgZ0-w_rgXfvdsLbyMXNOCuPh0egTWceGlGR3HVoxWwknvA2ruMAyAMlbgSf4JG5n_3b5AfnVCO2CohMO7yvq90lQTZI2MICIQ=="],"x-request-id":["03e871c0-a317-4a00-a27e-11edabd3c5d0"],"x-timestamp":["1740672017.959"],"x-tt-logid":["202502280000170B24E96DCC6116C4701A"],"x-tt-mp":["0"],"x-tt-trace-host":["0126d3ef76e8e88894a9aba7c2cd3352196c5762d28229d6662cbb37f3cfc63e5f72c9d198736ca7f7e9ac78116326bd67b5cfbd6d1681c6c7c02a99383b756c845ccec623dfbfe141db88b2a1c2835229f8f72f9ad534c994fa97add6f0c3ff96"],"x-tt-trace-id":["00-2502280000170B24E96DCC6116C4701A-6EAADD4E4516A3BA-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},respStatusCode=404,respBody=,
2025-02-28 00:00:18.442 ERROR 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 下载文件异常: fileKey=[file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg], error=[The result returned by the server is illegal]

java.lang.IllegalArgumentException: The result returned by the server is illegal
	at com.lark.oapi.service.drive.v1.resource.File.download(File.java:468) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at em.backend.service.impl.FileMessageServiceImpl.downloadFile(FileMessageServiceImpl.java:183) [classes/:na]
	at em.backend.service.impl.FileMessageServiceImpl.handleFileMessage(FileMessageServiceImpl.java:74) [classes/:na]
	at em.backend.handler.MessageEventHandler.handle(MessageEventHandler.java:42) [classes/:na]
	at em.backend.controller.FeishuEventController$1.handle(FeishuEventController.java:50) [classes/:na]
	at em.backend.controller.FeishuEventController$1.handle(FeishuEventController.java:1) [classes/:na]
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:290) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) [oapi-sdk-2.4.10.jar:2.4.10]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_131]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_131]
	at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_131]

2025-02-28 00:00:18.442 ERROR 133040 --- [pool-2-thread-3] e.b.service.impl.FileMessageServiceImpl  : 下载文件失败: fileKey=[file_v3_00ju_dd607ddb-3803-485b-ba5f-b516321f6ffg]
2025-02-28 00:00:18.445 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:00:18.445 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:00:18.447 DEBUG 133040 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:01:18.606 ERROR 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:01:18.606  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476128056907907076&access_key=66fc2d1afc14d30514e3ee4c9bb45e50&service_id=33554678&ticket=186faa68-34e1-4428-98bb-f5381e1638b7 [conn_id=7476128056907907076]
2025-02-28 00:01:18.606  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:01:39.165  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:01:39.496  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476128942349647891&access_key=2bacb46a3c2023ae8314ef3e120f6c8c&service_id=33554678&ticket=65851d81-3231-43f3-910b-179a8c8cfe44 [conn_id=7476128942349647891]
2025-02-28 00:02:11.612 ERROR 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:02:11.612  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476128942349647891&access_key=2bacb46a3c2023ae8314ef3e120f6c8c&service_id=33554678&ticket=65851d81-3231-43f3-910b-179a8c8cfe44 [conn_id=7476128942349647891]
2025-02-28 00:02:11.612  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:02:31.118  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:02:31.437  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476128942350204947&access_key=b20672c787fda5b008206a5c5993e9ca&service_id=33554678&ticket=d060a629-faea-4547-aa5f-715224211e64 [conn_id=7476128942350204947]
2025-02-28 00:03:30.577 ERROR 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:03:30.578  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476128942350204947&access_key=b20672c787fda5b008206a5c5993e9ca&service_id=33554678&ticket=d060a629-faea-4547-aa5f-715224211e64 [conn_id=7476128942350204947]
2025-02-28 00:03:30.578  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:03:55.760  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:03:56.090  INFO 133040 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476129454554202131&access_key=93623639b4a24740a38f71c4b91a8e13&service_id=33554678&ticket=7385a129-0125-4c91-9ae9-bfe082d5a3fc [conn_id=7476129454554202131]
2025-02-28 00:05:50.424  INFO 133040 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:05:50.430  INFO 133040 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 00:05:53.428  INFO 129948 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 129948 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:05:53.431 DEBUG 129948 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:05:53.432  INFO 129948 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:05:54.109  INFO 129948 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:05:54.111  INFO 129948 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:05:54.148  INFO 129948 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 23 ms. Found 0 Redis repository interfaces.
2025-02-28 00:05:54.675  INFO 129948 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:05:54.687  INFO 129948 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:05:54.687  INFO 129948 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:05:54.891  INFO 129948 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:05:54.891  INFO 129948 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1418 ms
2025-02-28 00:05:56.088  INFO 129948 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:05:56.089  INFO 129948 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:05:57.383  INFO 129948 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:05:57.592  INFO 129948 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476129654652649475&access_key=8d1994db51987fe0263d874b49672f72&service_id=33554678&ticket=47bb4b07-43ae-4f2f-b2c4-5b3654f1e39b [conn_id=7476129654652649475]
2025-02-28 00:05:58.133  INFO 129948 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:05:58.145  INFO 129948 --- [main] em.backend.BackendApplication            : Started BackendApplication in 5.177 seconds (JVM running for 6.358)
2025-02-28 00:06:27.568 ERROR 129948 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:06:27.570  INFO 129948 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476129654652649475&access_key=8d1994db51987fe0263d874b49672f72&service_id=33554678&ticket=47bb4b07-43ae-4f2f-b2c4-5b3654f1e39b [conn_id=7476129654652649475]
2025-02-28 00:06:27.570  INFO 129948 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:06:32.629  INFO 128676 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 128676 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:06:32.631 DEBUG 128676 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:06:32.632  INFO 128676 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:06:33.262  INFO 128676 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:06:33.264  INFO 128676 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:06:33.297  INFO 128676 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 0 Redis repository interfaces.
2025-02-28 00:06:33.774  INFO 128676 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:06:33.783  INFO 128676 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:06:33.784  INFO 128676 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:06:33.932  INFO 128676 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:06:33.933  INFO 128676 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1262 ms
2025-02-28 00:06:35.098  INFO 128676 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:06:35.099  INFO 128676 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:06:36.316  INFO 128676 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:06:36.485  INFO 128676 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476130143727763460&access_key=bfe0b7ade18faf292de34f3af2724a7a&service_id=33554678&ticket=abd4724c-b9b1-40b5-bd5f-b1a442fada5b [conn_id=7476130143727763460]
2025-02-28 00:06:37.193  INFO 128676 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:06:37.207  INFO 128676 --- [main] em.backend.BackendApplication            : Started BackendApplication in 5.016 seconds (JVM running for 6.153)
2025-02-28 00:06:56.949  INFO 128676 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: {"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg\",\"file_name\":\"图片1.png\"}","create_time":"1740672415798","message_id":"om_49cb57ad18d81eca40d9499873291a7d","message_type":"file","update_time":"1740672415798"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,102,54,57,102,97,52,102,50,97,57,49,50,49,53,102,102,100,48,50,54,52,98,97,102,48,54,50,102,49,49,101,97,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,52,49,54,50,48,50,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,52,57,52,52,48,52,99,97,45,101,98,55,48,45,52,102,53,99,45,98,49,48,48,45,57,102,54,99,102,54,102,53,50,56,100,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,-27,-101,-66,-25,-119,-121,49,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,52,49,53,55,57,56,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,52,57,99,98,53,55,97,100,49,56,100,56,49,101,99,97,52,48,100,57,52,57,57,56,55,51,50,57,49,97,55,100,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,52,49,53,55,57,56,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740672416202","event_id":"f69fa4f2a91215ffd0264baf062f11ea","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}
2025-02-28 00:06:56.950  INFO 128676 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:06:56.953  INFO 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_49cb57ad18d81eca40d9499873291a7d], fileKey=[file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg]
2025-02-28 00:06:57.022  INFO 128676 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:06:57.169  INFO 128676 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:06:57.175 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:06:57.197 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:06:57.225 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:06:57.230 DEBUG 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=17, currentCaseName=3307, createTime=2025-02-25T14:47:06, updateTime=2025-02-27T18:09:06, deleted=0)]
2025-02-28 00:06:57.236 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:06:57.236 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 17(Long)
2025-02-28 00:06:57.240 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:06:57.241 DEBUG 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=17, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=3307, clientName=3007, caseDesc=3007, caseTime=2025-02-11T18:29, remarks=3007, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/U6LCf2pUXlouUidNwqGciqR8nQc, createTime=2025-02-26T18:42:39, updateTime=2025-02-26T18:42:39, deleted=0)]
2025-02-28 00:06:57.241 DEBUG 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[U6LCf2pUXlouUidNwqGciqR8nQc]
2025-02-28 00:06:57.241  INFO 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg]
2025-02-28 00:06:57.241 DEBUG 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg]
2025-02-28 00:06:57.242 DEBUG 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_5332758342837846974.tmp]
2025-02-28 00:06:57.244 DEBUG 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:06:57.692 ERROR 128676 --- [pool-2-thread-2] c.l.oapi.service.drive.v1.resource.File  : /open-apis/drive/v1/files/:file_token/download,callError,req={"file_token":"file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg"},respHeader={"connection":["keep-alive"],"content-length":["0"],"date":["Thu, 27 Feb 2025 16:06:57 GMT"],"eagleid":["74c48fb817406724170818154e"],"request-id":["6945fe05-90a0-4bed-acd8-056567f8ed2d"],"server":["Tengine"],"server-timing":["inner; dur=115","cdn-cache;desc=MISS,edge;dur=0,origin;dur=132"],"timing-allow-origin":["*"],"tt_stable":["1"],"via":["vcache36.cn7149[132,0]"],"x-alicdn-da-ups-status":["endOs,0,404"],"x-envoy-response-flags":["-"],"x-lgw-dst-svc":["WhFc1lJMJliRer9BBCRDlq61gGG4BkVaJYgI5d2eHKu9JLEE6gYFkURIQeEcpykJ1qYz6c3A46E_Bx20pmsZvDdmB54yyr0bjWWVTob-tJbEp3w9HwbLSOc7QVu80QhH6xPbl7c-gbZs6AJ0Qw4P7upoYDRkRDIRHz0bq1akvOC99UNABgrwADHRL5JNuEAghXGJWI83SmhaXEfi7V3FZ6HhgoM3v1Bez9tFTJnjQ7ROm1GC0ObqmcxZK9Drj6k6IjkUr5MfSjjl4Fne5iyw0LJ3KvNUCsXlzuvlbHxPS05saZ6UnALYSdp3O2uUzo6wxYo4LP_js7yFADxmcvsFOTLrUfxGIxTGvqP6SQkaMwtWUGrhSCX6q9YEHoIg1h7ImAy2JrAps655FFHG4PwciQOLPgTC9SmE0KGtmztW3kS_UR0Z"],"x-request-id":["6945fe05-90a0-4bed-acd8-056567f8ed2d"],"x-timestamp":["1740672417.208"],"x-tt-logid":["202502280006573CC10621E72536C09D39"],"x-tt-mp":["0"],"x-tt-trace-host":["0126d3ef76e8e88894a9aba7c2cd3352191d71969ef94f6e06710e202c3c8a35f7b55e5ea763361bc881aac0899ee03ee8e686efe73055d6caddb05d81b44b2cc79c18401c586c11ec9a20f91c07ce7d9f85de16bb8a20c82fea13234c74859824"],"x-tt-trace-id":["00-2502280006573CC10621E72536C09D39-52E19A861492540E-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},respStatusCode=404,respBody=,
2025-02-28 00:06:57.696 ERROR 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 下载文件异常: fileKey=[file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg], error=[The result returned by the server is illegal]

java.lang.IllegalArgumentException: The result returned by the server is illegal
	at com.lark.oapi.service.drive.v1.resource.File.download(File.java:468) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at em.backend.service.impl.FileMessageServiceImpl.downloadFile(FileMessageServiceImpl.java:183) [classes/:na]
	at em.backend.service.impl.FileMessageServiceImpl.handleFileMessage(FileMessageServiceImpl.java:74) [classes/:na]
	at em.backend.handler.MessageEventHandler.handle(MessageEventHandler.java:42) [classes/:na]
	at em.backend.controller.FeishuEventController$1.handle(FeishuEventController.java:50) [classes/:na]
	at em.backend.controller.FeishuEventController$1.handle(FeishuEventController.java:1) [classes/:na]
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:290) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) [oapi-sdk-2.4.10.jar:2.4.10]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_131]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_131]
	at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_131]

2025-02-28 00:06:57.696 ERROR 128676 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 下载文件失败: fileKey=[file_v3_00ju_494404ca-eb70-4f5c-b100-9f6cf6f528dg]
2025-02-28 00:06:57.698 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:06:57.699 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:06:57.700 DEBUG 128676 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:09:41.278  INFO 128676 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:09:41.286  INFO 128676 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 00:09:47.966  INFO 134464 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 134464 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:09:47.968 DEBUG 134464 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:09:47.968  INFO 134464 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:09:48.556  INFO 134464 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:09:48.558  INFO 134464 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:09:48.588  INFO 134464 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 17 ms. Found 0 Redis repository interfaces.
2025-02-28 00:09:48.974  INFO 134464 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:09:48.982  INFO 134464 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:09:48.982  INFO 134464 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:09:49.106  INFO 134464 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:09:49.106  INFO 134464 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1100 ms
2025-02-28 00:09:50.008  INFO 134464 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:09:50.010  INFO 134464 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:09:50.994  INFO 134464 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:09:51.202  INFO 134464 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476130810522599428&access_key=20cf7cf32ff31f5391b6b1da885f7433&service_id=33554678&ticket=4f24d087-34d3-4edb-a11e-6a447f18643c [conn_id=7476130810522599428]
2025-02-28 00:09:51.608  INFO 134464 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:09:51.617  INFO 134464 --- [main] em.backend.BackendApplication            : Started BackendApplication in 4.081 seconds (JVM running for 5.118)
2025-02-28 00:10:10.616  INFO 134464 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg\",\"file_name\":\"图片1.png\"}","create_time":"1740672609587","message_id":"om_9629ec50e9bc8edba063eb61d1acaafb","message_type":"file","update_time":"1740672609587"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,54,53,52,97,99,99,102,102,54,102,101,57,56,55,98,55,99,52,51,49,99,55,52,99,101,56,100,99,54,100,54,56,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,54,48,57,56,54,51,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,48,100,101,56,53,48,99,99,45,101,51,57,51,45,52,54,53,101,45,98,57,98,52,45,101,51,55,99,56,101,102,48,50,52,98,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,-27,-101,-66,-25,-119,-121,49,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,54,48,57,53,56,55,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,57,54,50,57,101,99,53,48,101,57,98,99,56,101,100,98,97,48,54,51,101,98,54,49,100,49,97,99,97,97,102,98,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,54,48,57,53,56,55,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740672609863","event_id":"654accff6fe987b7c431c74ce8dc6d68","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 00:10:10.617  INFO 134464 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:10:10.617  INFO 134464 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg","file_name":"图片1.png"}]
2025-02-28 00:10:10.620  INFO 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_9629ec50e9bc8edba063eb61d1acaafb], fileKey=[file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg]
2025-02-28 00:10:10.688  INFO 134464 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:10:10.841  INFO 134464 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:10:10.848 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:10:10.869 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:10:10.893 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:10:10.898 DEBUG 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=17, currentCaseName=3307, createTime=2025-02-25T14:47:06, updateTime=2025-02-27T18:09:06, deleted=0)]
2025-02-28 00:10:10.904 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:10:10.904 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 17(Long)
2025-02-28 00:10:10.908 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:10:10.909 DEBUG 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=17, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=3307, clientName=3007, caseDesc=3007, caseTime=2025-02-11T18:29, remarks=3007, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/U6LCf2pUXlouUidNwqGciqR8nQc, createTime=2025-02-26T18:42:39, updateTime=2025-02-26T18:42:39, deleted=0)]
2025-02-28 00:10:10.909 DEBUG 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[U6LCf2pUXlouUidNwqGciqR8nQc]
2025-02-28 00:10:10.909  INFO 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg]
2025-02-28 00:10:10.909 DEBUG 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg]
2025-02-28 00:10:10.910 DEBUG 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_7552266626345260210.tmp]
2025-02-28 00:10:10.911 DEBUG 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:10:11.283 ERROR 134464 --- [pool-2-thread-2] c.l.oapi.service.drive.v1.resource.File  : /open-apis/drive/v1/files/:file_token/download,callError,req={"file_token":"file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg"},respHeader={"connection":["keep-alive"],"content-length":["0"],"date":["Thu, 27 Feb 2025 16:10:10 GMT"],"eagleid":["1bdd61b217406726106616890e"],"request-id":["9a5a0cf1-0818-4d49-a353-6733737ed690"],"server":["Tengine"],"server-timing":["inner; dur=126","cdn-cache;desc=MISS,edge;dur=0,origin;dur=149"],"timing-allow-origin":["*"],"tt_stable":["1"],"via":["cache30.cn7150[149,0]"],"x-alicdn-da-ups-status":["endOs,0,404"],"x-envoy-response-flags":["-"],"x-lgw-dst-svc":["HUYnyR9kLU3CRHQGTJlCbGhL6FpoB7NSqi3W_NPbJf_m7jhEJOPiPTfJeqdqIrG5LpEEdH3woqdHeduzEx4MTZ59COpVI9xzteF0UmVa4j7SWMqEeP_sqExU9Vk0bMoGnGiAVRPh4RAQ5snpigCEZ5ycDKPPxMaIX6IreTcHWCFf3xQFWAHVT6ht0aMDYHFftf7qz9kYDoUoT0bhW3cJT3nnlyQbQqomPtfmu3BdxT-kgu0WaBDn9CyY20tRPkPmovECx4bU6es1mhk3Jc6HfPKMf4greTKJ8tUrBat2lgcXUiNBQsTYusBVGL0WShZDlfCIlPftHTUQWZ6XQvO7qxuuKVXUhJq9PZjCBo36GBtBXiGNSBNRUcikjet28RiDC5kWPAbQgwl8yzqiWs9IMhIh2Zcl1IaT4gqjQEeDA97syYphaA=="],"x-request-id":["9a5a0cf1-0818-4d49-a353-6733737ed690"],"x-timestamp":["1740672610.800"],"x-tt-logid":["202502280010103D3A552271EB38CC3EA7"],"x-tt-mp":["0"],"x-tt-trace-host":["010e0b12e70de8a9e0050941d7b5ff1ccd16325ccf620ddf191e54375718ea48ad044c00fec0d2848aadeaa01f6669c8992b84798fe430286a4e6632658f628713450e5be6c72707fbe2d47f06c6a4313a6a327466714daa33d995f221fd6f73e7"],"x-tt-trace-id":["00-2502280010103D3A552271EB38CC3EA7-6FE06E5027A7EED0-00"],"x-tt-trace-tag":["id=03;cdn-cache=miss;type=dyn"]},respStatusCode=404,respBody=,
2025-02-28 00:10:11.287 ERROR 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 下载文件异常: fileKey=[file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg], error=[The result returned by the server is illegal]

java.lang.IllegalArgumentException: The result returned by the server is illegal
	at com.lark.oapi.service.drive.v1.resource.File.download(File.java:468) ~[oapi-sdk-2.4.10.jar:2.4.10]
	at em.backend.service.impl.FileMessageServiceImpl.downloadFile(FileMessageServiceImpl.java:183) [classes/:na]
	at em.backend.service.impl.FileMessageServiceImpl.handleFileMessage(FileMessageServiceImpl.java:74) [classes/:na]
	at em.backend.handler.MessageEventHandler.handle(MessageEventHandler.java:43) [classes/:na]
	at em.backend.controller.FeishuEventController$1.handle(FeishuEventController.java:50) [classes/:na]
	at em.backend.controller.FeishuEventController$1.handle(FeishuEventController.java:1) [classes/:na]
	at com.lark.oapi.event.EventDispatcher.doWithoutValidation(EventDispatcher.java:290) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleDataFrame(Client.java:301) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Client.handleMessage(Client.java:249) [oapi-sdk-2.4.10.jar:2.4.10]
	at com.lark.oapi.ws.Listener.lambda$onMessage$0(Listener.java:38) [oapi-sdk-2.4.10.jar:2.4.10]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_131]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_131]
	at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_131]

2025-02-28 00:10:11.287 ERROR 134464 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 下载文件失败: fileKey=[file_v3_00ju_0de850cc-e393-465e-b9b4-e37c8ef024bg]
2025-02-28 00:10:11.289 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:10:11.290 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:10:11.293 DEBUG 134464 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:13:56.060  INFO 134464 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:13:56.067  INFO 134464 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 00:14:02.571  INFO 136840 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 136840 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:14:02.573 DEBUG 136840 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:14:02.574  INFO 136840 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:14:03.140  INFO 136840 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:14:03.141  INFO 136840 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:14:03.165  INFO 136840 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-02-28 00:14:03.550  INFO 136840 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:14:03.557  INFO 136840 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:14:03.557  INFO 136840 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:14:03.718  INFO 136840 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:14:03.718  INFO 136840 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1113 ms
2025-02-28 00:14:04.610  INFO 136840 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:14:04.611  INFO 136840 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:14:05.587  INFO 136840 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:14:05.823  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476131952534863875&access_key=2d5bdad08480d932629d4432af7df8a0&service_id=33554678&ticket=5bc006ea-edc5-4f28-ad8c-544a11cb1d5b [conn_id=7476131952534863875]
2025-02-28 00:14:06.275  INFO 136840 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:14:06.284  INFO 136840 --- [main] em.backend.BackendApplication            : Started BackendApplication in 4.059 seconds (JVM running for 5.016)
2025-02-28 00:14:31.185  INFO 136840 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg\",\"file_name\":\"图片1.png\"}","create_time":"1740672870152","message_id":"om_3808a658ca2441af1256649cc7748e3a","message_type":"file","update_time":"1740672870152"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,48,56,99,100,98,50,54,54,102,48,48,101,53,100,55,101,100,49,54,50,99,97,55,100,99,54,57,50,56,99,48,49,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,56,55,48,52,51,53,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,54,51,51,48,53,48,100,53,45,50,99,52,55,45,52,100,57,98,45,56,49,56,55,45,54,51,52,55,54,57,98,56,55,50,102,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,-27,-101,-66,-25,-119,-121,49,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,56,55,48,49,53,50,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,51,56,48,56,97,54,53,56,99,97,50,52,52,49,97,102,49,50,53,54,54,52,57,99,99,55,55,52,56,101,51,97,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,50,56,55,48,49,53,50,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740672870435","event_id":"08cdb266f00e5d7ed162ca7dc6928c01","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 00:14:31.185  INFO 136840 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:14:31.185  INFO 136840 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg","file_name":"图片1.png"}]
2025-02-28 00:14:31.188  INFO 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_3808a658ca2441af1256649cc7748e3a], fileKey=[file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg]
2025-02-28 00:14:31.257  INFO 136840 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:14:31.405  INFO 136840 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:14:31.415 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:14:31.438 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:14:31.462 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:14:31.467 DEBUG 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=17, currentCaseName=3307, createTime=2025-02-25T14:47:06, updateTime=2025-02-27T18:09:06, deleted=0)]
2025-02-28 00:14:31.472 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:14:31.473 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 17(Long)
2025-02-28 00:14:31.477 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:14:31.478 DEBUG 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=17, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=3307, clientName=3007, caseDesc=3007, caseTime=2025-02-11T18:29, remarks=3007, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/U6LCf2pUXlouUidNwqGciqR8nQc, createTime=2025-02-26T18:42:39, updateTime=2025-02-26T18:42:39, deleted=0)]
2025-02-28 00:14:31.478 DEBUG 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[U6LCf2pUXlouUidNwqGciqR8nQc]
2025-02-28 00:14:31.478  INFO 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg]
2025-02-28 00:14:31.478 DEBUG 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg]
2025-02-28 00:14:31.479 DEBUG 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_7883293342971195200.tmp]
2025-02-28 00:14:31.480 DEBUG 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:14:31.852 ERROR 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 下载文件失败: code=[234008], msg=[The app is not the resource sender.], reqId=[20250228001431973D27B88A090BC7B1CB], fileKey=[file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg]
2025-02-28 00:14:31.852 ERROR 136840 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 下载文件失败: fileKey=[file_v3_00ju_633050d5-2c47-4d9b-8187-634769b872fg]
2025-02-28 00:14:31.855 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:14:31.855 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:14:31.857 DEBUG 136840 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:15:02.838 ERROR 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:15:02.839  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476131952534863875&access_key=2d5bdad08480d932629d4432af7df8a0&service_id=33554678&ticket=5bc006ea-edc5-4f28-ad8c-544a11cb1d5b [conn_id=7476131952534863875]
2025-02-28 00:15:02.839  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:15:16.863  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:15:17.204  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476132173918896132&access_key=776a1984ad9c1c1a8731618c0eb72b7b&service_id=33554678&ticket=5ab4b34e-ca5f-4270-968b-edb30ba5bc7e [conn_id=7476132173918896132]
2025-02-28 00:17:35.500 ERROR 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:17:35.501  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476132173918896132&access_key=776a1984ad9c1c1a8731618c0eb72b7b&service_id=33554678&ticket=5ab4b34e-ca5f-4270-968b-edb30ba5bc7e [conn_id=7476132173918896132]
2025-02-28 00:17:35.501  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:17:56.363  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:17:56.815  INFO 136840 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476127499619172353&access_key=246f2c0bd49af16e261c9ed9a8c3d5c5&service_id=33554678&ticket=dd47c87c-039b-4744-8f3a-33b2b97f6cc0 [conn_id=7476127499619172353]
2025-02-28 00:19:38.270  INFO 136840 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:19:38.278  INFO 136840 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 00:19:45.276  INFO 133836 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 133836 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:19:45.278 DEBUG 133836 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:19:45.279  INFO 133836 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:19:45.805  INFO 133836 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:19:45.806  INFO 133836 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:19:45.835  INFO 133836 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-02-28 00:19:46.390  INFO 133836 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:19:46.409  INFO 133836 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:19:46.410  INFO 133836 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:19:46.622  INFO 133836 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:19:46.622  INFO 133836 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1311 ms
2025-02-28 00:19:47.629  INFO 133836 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:19:47.630  INFO 133836 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:19:48.701  INFO 133836 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:19:48.884  INFO 133836 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476127499619368961&access_key=6225cff3e185ab14b3ff143919c55199&service_id=33554678&ticket=813d3ce1-2e1e-4681-91e0-33c09ced9756 [conn_id=7476127499619368961]
2025-02-28 00:19:49.378  INFO 133836 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:19:49.387  INFO 133836 --- [main] em.backend.BackendApplication            : Started BackendApplication in 4.522 seconds (JVM running for 5.62)
2025-02-28 00:20:01.741  INFO 133836 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_dcbb51de-b224-48b2-bafb-f831023fe3bg\",\"file_name\":\"图片1.png\"}","create_time":"1740673200620","message_id":"om_3e2e7d6a2d8d36497a563de7fb43c6fb","message_type":"file","update_time":"1740673200620"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,98,48,49,48,52,55,55,56,55,56,97,51,101,97,100,51,49,98,98,56,100,102,48,49,55,53,57,54,55,54,56,49,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,50,48,48,57,54,56,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,100,99,98,98,53,49,100,101,45,98,50,50,52,45,52,56,98,50,45,98,97,102,98,45,102,56,51,49,48,50,51,102,101,51,98,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,-27,-101,-66,-25,-119,-121,49,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,50,48,48,54,50,48,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,51,101,50,101,55,100,54,97,50,100,56,100,51,54,52,57,55,97,53,54,51,100,101,55,102,98,52,51,99,54,102,98,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,50,48,48,54,50,48,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740673200968","event_id":"b010477878a3ead31bb8df0175967681","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 00:20:01.741  INFO 133836 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:20:01.742  INFO 133836 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_dcbb51de-b224-48b2-bafb-f831023fe3bg","file_name":"图片1.png"}]
2025-02-28 00:20:01.746  INFO 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_3e2e7d6a2d8d36497a563de7fb43c6fb], fileKey=[file_v3_00ju_dcbb51de-b224-48b2-bafb-f831023fe3bg]
2025-02-28 00:20:01.823  INFO 133836 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:20:01.985  INFO 133836 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:20:01.992 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:20:02.018 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:20:02.045 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:20:02.052 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=17, currentCaseName=3307, createTime=2025-02-25T14:47:06, updateTime=2025-02-27T18:09:06, deleted=0)]
2025-02-28 00:20:02.059 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:20:02.060 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 17(Long)
2025-02-28 00:20:02.066 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:20:02.067 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=17, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=3307, clientName=3007, caseDesc=3007, caseTime=2025-02-11T18:29, remarks=3007, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/U6LCf2pUXlouUidNwqGciqR8nQc, createTime=2025-02-26T18:42:39, updateTime=2025-02-26T18:42:39, deleted=0)]
2025-02-28 00:20:02.067 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[U6LCf2pUXlouUidNwqGciqR8nQc]
2025-02-28 00:20:02.067  INFO 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_dcbb51de-b224-48b2-bafb-f831023fe3bg], messageId=[om_3e2e7d6a2d8d36497a563de7fb43c6fb]
2025-02-28 00:20:02.067 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_dcbb51de-b224-48b2-bafb-f831023fe3bg], messageId=[om_3e2e7d6a2d8d36497a563de7fb43c6fb]
2025-02-28 00:20:02.069 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_5347671837967082266.tmp]
2025-02-28 00:20:02.069 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:20:02.865 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始写入文件内容...
2025-02-28 00:20:02.866 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 文件下载完成: path=[C:\Users\roy\AppData\Local\Temp\feishu_5347671837967082266.tmp], size=[2632]bytes
2025-02-28 00:20:02.867 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 文件下载成功: tempFile=[C:\Users\roy\AppData\Local\Temp\feishu_5347671837967082266.tmp], size=[2632]bytes
2025-02-28 00:20:02.867  INFO 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始上传文件到目标文件夹: folderToken=[U6LCf2pUXlouUidNwqGciqR8nQc]
2025-02-28 00:20:04.393  INFO 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 文件处理完成: fileKey=[file_v3_00ju_dcbb51de-b224-48b2-bafb-f831023fe3bg]
2025-02-28 00:20:04.398 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:20:04.398 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:20:04.400 DEBUG 133836 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:20:05.080 DEBUG 133836 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 清理临时文件: file=[C:\Users\roy\AppData\Local\Temp\feishu_5347671837967082266.tmp], deleted=[true]
2025-02-28 00:21:04.544 ERROR 133836 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:21:04.544  INFO 133836 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476127499619368961&access_key=6225cff3e185ab14b3ff143919c55199&service_id=33554678&ticket=813d3ce1-2e1e-4681-91e0-33c09ced9756 [conn_id=7476127499619368961]
2025-02-28 00:21:04.544  INFO 133836 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:21:29.917  INFO 133836 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:21:30.251  INFO 133836 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476128241777852444&access_key=d9e344b7585a039ab8cedf6706e0ed29&service_id=33554678&ticket=7ecbb3b8-9216-49bb-83b1-090243db6aad [conn_id=7476128241777852444]
2025-02-28 00:22:53.376  INFO 133836 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:22:53.384  INFO 133836 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 00:23:00.133  INFO 133524 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 133524 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:23:00.135 DEBUG 133524 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:23:00.135  INFO 133524 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:23:00.632  INFO 133524 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:23:00.633  INFO 133524 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:23:00.658  INFO 133524 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-02-28 00:23:01.077  INFO 133524 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:23:01.084  INFO 133524 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:23:01.084  INFO 133524 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:23:01.217  INFO 133524 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:23:01.218  INFO 133524 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1052 ms
2025-02-28 00:23:02.079  INFO 133524 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:23:02.080  INFO 133524 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:23:03.121  INFO 133524 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:23:03.372  INFO 133524 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476131253054357532&access_key=0b343b0770c8c4a0a3572c3b455fc3a1&service_id=33554678&ticket=d57d581e-01b6-4130-8cc9-693682fdbec2 [conn_id=7476131253054357532]
2025-02-28 00:23:03.822  INFO 133524 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:23:03.832  INFO 133524 --- [main] em.backend.BackendApplication            : Started BackendApplication in 4.04 seconds (JVM running for 4.925)
2025-02-28 00:23:14.217  INFO 133524 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"create_case","timestamp":1740673393}
2025-02-28 00:23:41.345  INFO 133524 --- [pool-2-thread-3] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-1f5163e1bd9be7bc211d09534ec339230165aa67","action":{"tag":"button","timezone":"Asia/Shanghai","name":"submit_create_case","form_value":{"case_desc":"王五测试案件","case_name":"我的测试案件","case_time":"2025-02-09 00:23 +0800","client_name":"王五","remarks":""}},"host":"im_message","context":{"open_message_id":"om_b7c6a8c7318381318b9680284a05cf28","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"83508a561bcb59ee3353029aaea47683","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740673420833988","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,56,51,53,48,56,97,53,54,49,98,99,98,53,57,101,101,51,51,53,51,48,50,57,97,97,101,97,52,55,54,56,51,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,50,48,56,51,51,57,56,56,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,49,102,53,49,54,51,101,49,98,100,57,98,101,55,98,99,50,49,49,100,48,57,53,51,52,101,99,51,51,57,50,51,48,49,54,53,97,97,54,55,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,99,97,115,101,95,100,101,115,99,34,58,34,-25,-114,-117,-28,-70,-108,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,34,44,34,99,97,115,101,95,110,97,109,101,34,58,34,-26,-120,-111,-25,-102,-124,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,34,44,34,99,97,115,101,95,116,105,109,101,34,58,34,50,48,50,53,45,48,50,45,48,57,32,48,48,58,50,51,32,43,48,56,48,48,34,44,34,99,108,105,101,110,116,95,110,97,109,101,34,58,34,-25,-114,-117,-28,-70,-108,34,44,34,114,101,109,97,114,107,115,34,58,34,34,125,44,34,110,97,109,101,34,58,34,115,117,98,109,105,116,95,99,114,101,97,116,101,95,99,97,115,101,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,98,55,99,54,97,56,99,55,51,49,56,51,56,49,51,49,56,98,57,54,56,48,50,56,52,97,48,53,99,102,50,56,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 00:23:41.345  INFO 133524 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 处理创建案件表单数据: {case_desc=王五测试案件, case_name=我的测试案件, case_time=2025-02-09 00:23 +0800, client_name=王五, remarks=}, 操作人: ou_834a97afdc847fa1a8f1cc4ca773fc37
2025-02-28 00:23:42.312  INFO 133524 --- [pool-2-thread-3] e.b.s.impl.FeishuFolderServiceImpl       : 案件文件夹创建成功: 我的测试案件_王五_2025-02-09, url: https://test-d814zrewver8.feishu.cn/drive/folder/Fa9gfEIN6lopDMdlJUCcYCrEnyc
2025-02-28 00:23:42.932  INFO 133524 --- [pool-2-thread-3] e.b.s.impl.FeishuFolderServiceImpl       : 文件夹权限设置成功, token: Fa9gfEIN6lopDMdlJUCcYCrEnyc, userId: ou_834a97afdc847fa1a8f1cc4ca773fc37
2025-02-28 00:23:42.978  INFO 133524 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:23:43.156  INFO 133524 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:23:43.164 DEBUG 133524 --- [pool-2-thread-3] em.backend.mapper.CaseInfoMapper.insert  : ==>  Preparing: INSERT INTO case_info ( open_id, case_name, client_name, case_desc, case_time, remarks, folder_url ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-02-28 00:23:43.190 DEBUG 133524 --- [pool-2-thread-3] em.backend.mapper.CaseInfoMapper.insert  : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String), 我的测试案件(String), 王五(String), 王五测试案件(String), 2025-02-09T00:23(LocalDateTime), (String), https://test-d814zrewver8.feishu.cn/drive/folder/Fa9gfEIN6lopDMdlJUCcYCrEnyc(String)
2025-02-28 00:23:43.230 DEBUG 133524 --- [pool-2-thread-3] em.backend.mapper.CaseInfoMapper.insert  : <==    Updates: 1
2025-02-28 00:23:43.272 DEBUG 133524 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 00:23:43.273 DEBUG 133524 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:23:43.293 DEBUG 133524 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 00:23:43.309 DEBUG 133524 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 00:23:43.312 DEBUG 133524 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 20(Long), 我的测试案件(String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:23:43.323 DEBUG 133524 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 00:23:52.860  INFO 133524 --- [pool-2-thread-4] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"select_case","timestamp":1740673432}
2025-02-28 00:23:52.888 DEBUG 133524 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-02-28 00:23:52.889 DEBUG 133524 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:23:52.905 DEBUG 133524 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 19
2025-02-28 00:23:52.911 DEBUG 133524 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:23:52.912 DEBUG 133524 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:23:52.914 DEBUG 133524 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:23:58.097  INFO 133524 --- [pool-2-thread-5] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-d485fb771f801748e9a6e9652c8672d2ce02dfb5","action":{"tag":"button","timezone":"Asia/Shanghai","name":"select_case_callback","form_value":{"Select_case":"20"}},"host":"im_message","context":{"open_message_id":"om_355eeb10e280531be104ce085e64f7de","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"393e4e05d0e2765ca9ad69594345f4ef","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740673437597171","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,51,57,51,101,52,101,48,53,100,48,101,50,55,54,53,99,97,57,97,100,54,57,53,57,52,51,52,53,102,52,101,102,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,51,55,53,57,55,49,55,49,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,100,52,56,53,102,98,55,55,49,102,56,48,49,55,52,56,101,57,97,54,101,57,54,53,50,99,56,54,55,50,100,50,99,101,48,50,100,102,98,53,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,50,48,34,125,44,34,110,97,109,101,34,58,34,115,101,108,101,99,116,95,99,97,115,101,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,51,53,53,101,101,98,49,48,101,50,56,48,53,51,49,98,101,49,48,52,99,101,48,56,53,101,54,52,102,55,100,101,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 00:23:58.097  INFO 133524 --- [pool-2-thread-5] em.backend.handler.CardEventHandler      : 选择的案件ID: 20
2025-02-28 00:23:58.100 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:23:58.101 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(String)
2025-02-28 00:23:58.105 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:23:58.105 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 00:23:58.106 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:23:58.108 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 00:23:58.110 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 00:23:58.110 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 20(Long), 我的测试案件(String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:23:58.112 DEBUG 133524 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 00:24:01.477  INFO 133524 --- [pool-2-thread-6] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"case_overview","timestamp":1740673440}
2025-02-28 00:24:01.481 DEBUG 133524 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-02-28 00:24:01.482 DEBUG 133524 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:01.487 DEBUG 133524 --- [pool-2-thread-6] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 19
2025-02-28 00:24:01.489 DEBUG 133524 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:24:01.490 DEBUG 133524 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:01.492 DEBUG 133524 --- [pool-2-thread-6] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:24:05.971  INFO 133524 --- [pool-2-thread-7] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-9258f7ad0339ad1620a0567fa218b79efe2ac95f","action":{"tag":"button","timezone":"Asia/Shanghai","name":"case_overview_callback","form_value":{"Select_case":"20"}},"host":"im_message","context":{"open_message_id":"om_9663518680b8bb82a1cfec63d65f0a66","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"85ae3f9a001b19c80a0a785442a825b4","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740673445473764","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,56,53,97,101,51,102,57,97,48,48,49,98,49,57,99,56,48,97,48,97,55,56,53,52,52,50,97,56,50,53,98,52,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,52,53,52,55,51,55,54,52,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,57,50,53,56,102,55,97,100,48,51,51,57,97,100,49,54,50,48,97,48,53,54,55,102,97,50,49,56,98,55,57,101,102,101,50,97,99,57,53,102,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,50,48,34,125,44,34,110,97,109,101,34,58,34,99,97,115,101,95,111,118,101,114,118,105,101,119,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,57,54,54,51,53,49,56,54,56,48,98,56,98,98,56,50,97,49,99,102,101,99,54,51,100,54,53,102,48,97,54,54,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 00:24:05.971  INFO 133524 --- [pool-2-thread-7] em.backend.handler.CardEventHandler      : 案件总览选择的案件ID: 20
2025-02-28 00:24:05.972 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:24:05.973 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(String)
2025-02-28 00:24:05.976 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:24:05.977 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 00:24:05.978 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:05.979 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 00:24:05.979 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 00:24:05.980 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 20(Long), 我的测试案件(String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:05.981 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 00:24:05.982 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:24:05.982 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(String)
2025-02-28 00:24:05.983 DEBUG 133524 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:24:19.920  INFO 133524 --- [pool-2-thread-8] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"text\":\"你好\"}","create_time":"1740673458800","message_id":"om_a0757c7e6e274a1292994851488c8eb4","message_type":"text","update_time":"1740673458800"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,51,57,55,49,98,97,52,53,100,50,52,97,54,51,98,48,52,97,52,57,55,56,54,53,56,51,51,57,99,100,53,102,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,53,57,48,57,53,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-28,-67,-96,-27,-91,-67,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,53,56,56,48,48,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,97,48,55,53,55,99,55,101,54,101,50,55,52,97,49,50,57,50,57,57,52,56,53,49,52,56,56,99,56,101,98,52,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,53,56,56,48,48,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740673459095","event_id":"3971ba45d24a63b04a4978658339cd5f","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 00:24:19.920  INFO 133524 --- [pool-2-thread-8] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:24:19.920  INFO 133524 --- [pool-2-thread-8] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_834a97afdc847fa1a8f1cc4ca773fc37], 查询=[你好]
2025-02-28 00:24:19.922 DEBUG 133524 --- [pool-2-thread-8] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-02-28 00:24:19.922 DEBUG 133524 --- [pool-2-thread-8] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:19.924 DEBUG 133524 --- [pool-2-thread-8] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 1
2025-02-28 00:24:19.927 DEBUG 133524 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:24:19.928 DEBUG 133524 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:19.929 DEBUG 133524 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:24:20.787  INFO 133524 --- [pool-2-thread-8] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7476135571875332099:streaming_sey]
2025-02-28 00:24:20.789  INFO 133524 --- [ForkJoinPool.commonPool-worker-9] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[你好], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:24:25.461  INFO 133524 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : 流式响应结束，停止卡片流式更新
2025-02-28 00:24:25.461  INFO 133524 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7476135571875332099], sequence=[16]
2025-02-28 00:24:25.719  INFO 133524 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-02-28 00:24:25.721  INFO 133524 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify流式API调用完成
2025-02-28 00:24:38.836  INFO 133524 --- [pool-2-thread-9] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_b72e70cc-a1a7-4b09-ba20-531d170a4d7g\",\"file_name\":\"202304061680747620807673.jpg\"}","create_time":"1740673477913","message_id":"om_7e2b3f3acf8d6948c3a5cb4456956c99","message_type":"file","update_time":"1740673477913"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,97,50,54,53,101,54,49,53,48,100,52,49,51,55,100,98,48,102,57,98,53,48,49,101,100,100,56,99,49,97,54,52,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,55,56,50,52,57,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,98,55,50,101,55,48,99,99,45,97,49,97,55,45,52,98,48,57,45,98,97,50,48,45,53,51,49,100,49,55,48,97,52,100,55,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,50,48,50,51,48,52,48,54,49,54,56,48,55,52,55,54,50,48,56,48,55,54,55,51,46,106,112,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,55,55,57,49,51,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,55,101,50,98,51,102,51,97,99,102,56,100,54,57,52,56,99,51,97,53,99,98,52,52,53,54,57,53,54,99,57,57,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,52,55,55,57,49,51,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740673478249","event_id":"a265e6150d4137db0f9b501edd8c1a64","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 00:24:38.837  INFO 133524 --- [pool-2-thread-9] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:24:38.837  INFO 133524 --- [pool-2-thread-9] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_b72e70cc-a1a7-4b09-ba20-531d170a4d7g","file_name":"202304061680747620807673.jpg"}]
2025-02-28 00:24:38.837  INFO 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_7e2b3f3acf8d6948c3a5cb4456956c99], fileKey=[file_v3_00ju_b72e70cc-a1a7-4b09-ba20-531d170a4d7g]
2025-02-28 00:24:38.839 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:24:38.840 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:38.842 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:24:38.842 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=20, currentCaseName=我的测试案件, createTime=2025-02-25T14:47:06, updateTime=2025-02-28T00:23:43, deleted=0)]
2025-02-28 00:24:38.842 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:24:38.843 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(Long)
2025-02-28 00:24:38.844 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:24:38.844 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=20, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=我的测试案件, clientName=王五, caseDesc=王五测试案件, caseTime=2025-02-09T00:23, remarks=, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/Fa9gfEIN6lopDMdlJUCcYCrEnyc, createTime=2025-02-28T00:23:43, updateTime=2025-02-28T00:23:43, deleted=0)]
2025-02-28 00:24:38.845 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[Fa9gfEIN6lopDMdlJUCcYCrEnyc]
2025-02-28 00:24:38.845  INFO 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_b72e70cc-a1a7-4b09-ba20-531d170a4d7g], messageId=[om_7e2b3f3acf8d6948c3a5cb4456956c99]
2025-02-28 00:24:38.845 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_b72e70cc-a1a7-4b09-ba20-531d170a4d7g], messageId=[om_7e2b3f3acf8d6948c3a5cb4456956c99]
2025-02-28 00:24:38.846 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_8180823963791686571.tmp]
2025-02-28 00:24:38.847 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:24:39.372 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 开始写入文件内容...
2025-02-28 00:24:39.373 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 文件下载完成: path=[C:\Users\roy\AppData\Local\Temp\feishu_8180823963791686571.tmp], size=[34523]bytes
2025-02-28 00:24:39.373 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 文件下载成功: tempFile=[C:\Users\roy\AppData\Local\Temp\feishu_8180823963791686571.tmp], size=[34523]bytes
2025-02-28 00:24:39.374  INFO 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 开始上传文件到目标文件夹: folderToken=[Fa9gfEIN6lopDMdlJUCcYCrEnyc]
2025-02-28 00:24:40.718  INFO 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 文件处理完成: fileKey=[file_v3_00ju_b72e70cc-a1a7-4b09-ba20-531d170a4d7g]
2025-02-28 00:24:40.720 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:24:40.721 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:24:40.722 DEBUG 133524 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:24:41.355 DEBUG 133524 --- [pool-2-thread-9] e.b.service.impl.FileMessageServiceImpl  : 清理临时文件: file=[C:\Users\roy\AppData\Local\Temp\feishu_8180823963791686571.tmp], deleted=[true]
2025-02-28 00:26:19.823  INFO 133524 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:26:19.829  INFO 133524 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 00:27:27.189  INFO 37600 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 37600 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 00:27:27.191 DEBUG 37600 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 00:27:27.192  INFO 37600 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 00:27:27.686  INFO 37600 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 00:27:27.688  INFO 37600 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 00:27:27.710  INFO 37600 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-02-28 00:27:28.162  INFO 37600 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 00:27:28.170  INFO 37600 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 00:27:28.170  INFO 37600 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 00:27:28.302  INFO 37600 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 00:27:28.303  INFO 37600 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1079 ms
2025-02-28 00:27:29.243  INFO 37600 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 00:27:29.244  INFO 37600 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 00:27:30.283  INFO 37600 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 00:27:30.529  INFO 37600 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476131711449956353&access_key=3de300d8a234697a7482773462849fe5&service_id=33554678&ticket=9e7529a3-fb6d-4cf0-832c-13dfcae74fe0 [conn_id=7476131711449956353]
2025-02-28 00:27:30.897  INFO 37600 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 00:27:30.906  INFO 37600 --- [main] em.backend.BackendApplication            : Started BackendApplication in 4.056 seconds (JVM running for 5.08)
2025-02-28 00:28:00.492 ERROR 37600 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 00:28:00.493  INFO 37600 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476131711449956353&access_key=3de300d8a234697a7482773462849fe5&service_id=33554678&ticket=9e7529a3-fb6d-4cf0-832c-13dfcae74fe0 [conn_id=7476131711449956353]
2025-02-28 00:28:00.493  INFO 37600 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 00:28:08.028  INFO 37600 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 00:28:08.369  INFO 37600 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476130528130318337&access_key=97194d2809fe7e45de58bc726f4bd03c&service_id=33554678&ticket=72817f3b-3d2d-4a8c-b16a-fba01e598579 [conn_id=7476130528130318337]
2025-02-28 00:28:33.583  INFO 37600 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_466963fa-0215-46c3-b730-80f4156e9d9g\",\"file_name\":\"1-案件情况表.docx\"}","create_time":"1740673712459","message_id":"om_987f12871e35a6ca051f19a110619419","message_type":"file","update_time":"1740673712459"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,100,51,98,52,51,99,55,50,97,97,53,97,100,97,50,56,48,50,99,101,49,52,51,49,55,55,51,52,49,102,98,49,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,55,49,50,55,57,49,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,52,54,54,57,54,51,102,97,45,48,50,49,53,45,52,54,99,51,45,98,55,51,48,45,56,48,102,52,49,53,54,101,57,100,57,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,49,45,-26,-95,-120,-28,-69,-74,-26,-125,-123,-27,-122,-75,-24,-95,-88,46,100,111,99,120,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,55,49,50,52,53,57,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,57,56,55,102,49,50,56,55,49,101,51,53,97,54,99,97,48,53,49,102,49,57,97,49,49,48,54,49,57,52,49,57,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,54,55,51,55,49,50,52,53,57,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740673712791","event_id":"d3b43c72aa5ada2802ce143177341fb1","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 00:28:33.583  INFO 37600 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 00:28:33.584  INFO 37600 --- [pool-2-thread-2] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_466963fa-0215-46c3-b730-80f4156e9d9g","file_name":"1-案件情况表.docx"}]
2025-02-28 00:28:33.587  INFO 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_987f12871e35a6ca051f19a110619419], fileKey=[file_v3_00ju_466963fa-0215-46c3-b730-80f4156e9d9g], fileName=[1-案件情况表.docx]
2025-02-28 00:28:33.657  INFO 37600 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 00:28:33.807  INFO 37600 --- [pool-2-thread-2] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 00:28:33.813 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:28:33.833 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:28:33.859 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:28:33.867 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=20, currentCaseName=我的测试案件, createTime=2025-02-25T14:47:06, updateTime=2025-02-28T00:23:43, deleted=0)]
2025-02-28 00:28:33.872 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 00:28:33.873 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(Long)
2025-02-28 00:28:33.876 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 00:28:33.876 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=20, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=我的测试案件, clientName=王五, caseDesc=王五测试案件, caseTime=2025-02-09T00:23, remarks=, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/Fa9gfEIN6lopDMdlJUCcYCrEnyc, createTime=2025-02-28T00:23:43, updateTime=2025-02-28T00:23:43, deleted=0)]
2025-02-28 00:28:33.876 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[Fa9gfEIN6lopDMdlJUCcYCrEnyc]
2025-02-28 00:28:33.876  INFO 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_466963fa-0215-46c3-b730-80f4156e9d9g], messageId=[om_987f12871e35a6ca051f19a110619419]
2025-02-28 00:28:33.877 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_466963fa-0215-46c3-b730-80f4156e9d9g], messageId=[om_987f12871e35a6ca051f19a110619419]
2025-02-28 00:28:33.878 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_5513170836244131990.tmp]
2025-02-28 00:28:33.879 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 00:28:34.668 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始写入文件内容...
2025-02-28 00:28:34.669 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 文件下载完成: path=[C:\Users\roy\AppData\Local\Temp\feishu_5513170836244131990.tmp], size=[11917]bytes
2025-02-28 00:28:34.669 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 文件下载成功: tempFile=[C:\Users\roy\AppData\Local\Temp\feishu_5513170836244131990.tmp], size=[11917]bytes
2025-02-28 00:28:34.669  INFO 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 开始上传文件到目标文件夹: folderToken=[Fa9gfEIN6lopDMdlJUCcYCrEnyc]
2025-02-28 00:28:36.136  INFO 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 文件处理完成: fileKey=[file_v3_00ju_466963fa-0215-46c3-b730-80f4156e9d9g]
2025-02-28 00:28:36.141 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 00:28:36.141 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 00:28:36.143 DEBUG 37600 --- [pool-2-thread-2] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 00:28:36.802 DEBUG 37600 --- [pool-2-thread-2] e.b.service.impl.FileMessageServiceImpl  : 清理临时文件: file=[C:\Users\roy\AppData\Local\Temp\feishu_5513170836244131990.tmp], deleted=[true]
2025-02-28 00:30:58.448  INFO 37600 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 00:30:58.457  INFO 37600 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 13:28:47.190  INFO 134384 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 134384 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 13:28:47.193 DEBUG 134384 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 13:28:47.194  INFO 134384 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 13:28:47.711  INFO 134384 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 13:28:47.713  INFO 134384 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 13:28:47.735  INFO 134384 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-02-28 13:28:48.143  INFO 134384 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 13:28:48.154  INFO 134384 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 13:28:48.155  INFO 134384 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 13:28:48.321  INFO 134384 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 13:28:48.321  INFO 134384 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1092 ms
2025-02-28 13:28:49.147  INFO 134384 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 13:28:49.148  INFO 134384 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 13:28:50.087  INFO 134384 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 13:28:50.385  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476333125345361948&access_key=1fff8b27bac7c82a5e9e7d75c76640c5&service_id=33554678&ticket=ee6b79a8-5474-47eb-bc5b-eeba1db2ed41 [conn_id=7476333125345361948]
2025-02-28 13:28:50.656  INFO 134384 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 13:28:50.664  INFO 134384 --- [main] em.backend.BackendApplication            : Started BackendApplication in 3.914 seconds (JVM running for 4.866)
2025-02-28 13:29:50.115 ERROR 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 13:29:50.116  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476333125345361948&access_key=1fff8b27bac7c82a5e9e7d75c76640c5&service_id=33554678&ticket=ee6b79a8-5474-47eb-bc5b-eeba1db2ed41 [conn_id=7476333125345361948]
2025-02-28 13:29:50.116  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 13:30:01.705  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 13:30:01.996  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476333125345525788&access_key=1b1346af22dbb3e648ccac6d43526060&service_id=33554678&ticket=0e050d93-e8aa-469c-932c-b4bb7e54fe4f [conn_id=7476333125345525788]
2025-02-28 13:31:50.111 ERROR 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 13:31:50.112  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476333125345525788&access_key=1b1346af22dbb3e648ccac6d43526060&service_id=33554678&ticket=0e050d93-e8aa-469c-932c-b4bb7e54fe4f [conn_id=7476333125345525788]
2025-02-28 13:31:50.112  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 13:32:01.639  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 13:32:01.928  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476335589240029186&access_key=bacfafe0ff51639baef8675354c1dc10&service_id=33554678&ticket=89c6543e-2f63-4d2e-b821-56a24daa89de [conn_id=7476335589240029186]
2025-02-28 13:33:20.135 ERROR 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 13:33:20.136  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476335589240029186&access_key=bacfafe0ff51639baef8675354c1dc10&service_id=33554678&ticket=89c6543e-2f63-4d2e-b821-56a24daa89de [conn_id=7476335589240029186]
2025-02-28 13:33:20.136  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 13:33:36.034  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 13:33:36.391  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476335589240274946&access_key=17cb744fc5674c80d28240c7b362d0c2&service_id=33554678&ticket=e26768be-c26f-43cd-bad5-c6029be09a3a [conn_id=7476335589240274946]
2025-02-28 13:35:07.881  INFO 134384 --- [pool-2-thread-5] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"text\":\"你好\"}","create_time":"1740720907187","message_id":"om_28049561382c66617eb3718184333a50","message_type":"text","update_time":"1740720907187"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,55,98,48,53,55,48,98,98,97,98,54,54,57,48,51,49,101,55,55,49,54,57,57,97,57,54,50,52,54,51,101,98,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,48,55,53,54,48,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-28,-67,-96,-27,-91,-67,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,48,55,49,56,55,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,50,56,48,52,57,53,54,49,51,56,50,99,54,54,54,49,55,101,98,51,55,49,56,49,56,52,51,51,51,97,53,48,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,48,55,49,56,55,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740720907560","event_id":"7b0570bbab669031e771699a962463eb","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 13:35:07.882  INFO 134384 --- [pool-2-thread-5] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:35:07.884  INFO 134384 --- [pool-2-thread-5] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_834a97afdc847fa1a8f1cc4ca773fc37], 查询=[你好]
2025-02-28 13:35:07.897  INFO 134384 --- [pool-2-thread-5] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 13:35:08.033  INFO 134384 --- [pool-2-thread-5] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 13:35:08.039 DEBUG 134384 --- [pool-2-thread-5] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-02-28 13:35:08.057 DEBUG 134384 --- [pool-2-thread-5] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:08.080 DEBUG 134384 --- [pool-2-thread-5] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 1
2025-02-28 13:35:08.132 DEBUG 134384 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:35:08.133 DEBUG 134384 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:08.139 DEBUG 134384 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:35:09.393  INFO 134384 --- [pool-2-thread-5] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7476339368010301468:streaming_sey]
2025-02-28 13:35:09.394  INFO 134384 --- [ForkJoinPool.commonPool-worker-9] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[你好], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:35:13.267  INFO 134384 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : 流式响应结束，停止卡片流式更新
2025-02-28 13:35:13.267  INFO 134384 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7476339368010301468], sequence=[10]
2025-02-28 13:35:13.526  INFO 134384 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-02-28 13:35:13.526  INFO 134384 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify流式API调用完成
2025-02-28 13:35:27.397  INFO 134384 --- [pool-2-thread-6] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"create_case","timestamp":1740720927}
2025-02-28 13:35:31.679  INFO 134384 --- [pool-2-thread-7] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"select_case","timestamp":1740720931}
2025-02-28 13:35:31.684 DEBUG 134384 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-02-28 13:35:31.684 DEBUG 134384 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:31.695 DEBUG 134384 --- [pool-2-thread-7] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 19
2025-02-28 13:35:31.696 DEBUG 134384 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:35:31.697 DEBUG 134384 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:31.698 DEBUG 134384 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:35:38.672  INFO 134384 --- [pool-2-thread-8] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-eb9d0b490739ecb4d68d766407e97af34be90021","action":{"tag":"button","timezone":"Asia/Shanghai","name":"select_case_callback","form_value":{"Select_case":"20"}},"host":"im_message","context":{"open_message_id":"om_46c0579f1dbf34dbcfa93e4469ff32ae","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"d659174165127c288ad1d5caa75c2574","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740720938576581","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,100,54,53,57,49,55,52,49,54,53,49,50,55,99,50,56,56,97,100,49,100,53,99,97,97,55,53,99,50,53,55,52,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,51,56,53,55,54,53,56,49,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,101,98,57,100,48,98,52,57,48,55,51,57,101,99,98,52,100,54,56,100,55,54,54,52,48,55,101,57,55,97,102,51,52,98,101,57,48,48,50,49,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,50,48,34,125,44,34,110,97,109,101,34,58,34,115,101,108,101,99,116,95,99,97,115,101,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,52,54,99,48,53,55,57,102,49,100,98,102,51,52,100,98,99,102,97,57,51,101,52,52,54,57,102,102,51,50,97,101,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 13:35:38.673  INFO 134384 --- [pool-2-thread-8] em.backend.handler.CardEventHandler      : 选择的案件ID: 20
2025-02-28 13:35:38.674 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 13:35:38.674 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(String)
2025-02-28 13:35:38.676 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 13:35:38.688 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 13:35:38.689 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:38.691 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 13:35:38.692 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 13:35:38.693 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 20(Long), 我的测试案件(String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:38.698 DEBUG 134384 --- [pool-2-thread-8] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 13:35:42.544  INFO 134384 --- [pool-2-thread-9] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"case_overview","timestamp":1740720942}
2025-02-28 13:35:42.546 DEBUG 134384 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectList     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE deleted=0 AND (open_id = ?) ORDER BY create_time DESC
2025-02-28 13:35:42.546 DEBUG 134384 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectList     : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:42.549 DEBUG 134384 --- [pool-2-thread-9] e.b.mapper.CaseInfoMapper.selectList     : <==      Total: 19
2025-02-28 13:35:42.551 DEBUG 134384 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:35:42.551 DEBUG 134384 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:42.552 DEBUG 134384 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:35:46.442  INFO 134384 --- [pool-2-thread-10] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-8d01708239c4e1e23aa3340ea5cae9fd109311ee","action":{"tag":"button","timezone":"Asia/Shanghai","name":"case_overview_callback","form_value":{"Select_case":"20"}},"host":"im_message","context":{"open_message_id":"om_2b5e07a322cbe74038ea65ed72288430","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"829436345be0057111ac8b6bba354369","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740720946359524","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,56,50,57,52,51,54,51,52,53,98,101,48,48,53,55,49,49,49,97,99,56,98,54,98,98,97,51,53,52,51,54,57,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,52,54,51,53,57,53,50,52,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,56,100,48,49,55,48,56,50,51,57,99,52,101,49,101,50,51,97,97,51,51,52,48,101,97,53,99,97,101,57,102,100,49,48,57,51,49,49,101,101,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,83,101,108,101,99,116,95,99,97,115,101,34,58,34,50,48,34,125,44,34,110,97,109,101,34,58,34,99,97,115,101,95,111,118,101,114,118,105,101,119,95,99,97,108,108,98,97,99,107,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,50,98,53,101,48,55,97,51,50,50,99,98,101,55,52,48,51,56,101,97,54,53,101,100,55,50,50,56,56,52,51,48,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 13:35:46.442  INFO 134384 --- [pool-2-thread-10] em.backend.handler.CardEventHandler      : 案件总览选择的案件ID: 20
2025-02-28 13:35:46.443 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 13:35:46.443 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(String)
2025-02-28 13:35:46.444 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 13:35:46.445 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 13:35:46.445 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:46.447 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 13:35:46.448 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 13:35:46.448 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 20(Long), 我的测试案件(String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:35:46.449 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 13:35:46.450 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 13:35:46.451 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(String)
2025-02-28 13:35:46.452 DEBUG 134384 --- [pool-2-thread-10] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 13:36:16.263  INFO 134384 --- [pool-2-thread-11] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_c53f441f-1510-4271-b67c-e7c3968500bg\",\"file_name\":\"DIV@1x (1).png\"}","create_time":"1740720975713","message_id":"om_bce9efb6593db6158a7557efbce2e32a","message_type":"file","update_time":"1740720975713"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,102,102,54,48,51,57,99,99,102,56,52,49,53,55,99,49,52,52,48,53,57,50,100,50,99,54,102,55,48,100,100,98,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,55,54,48,49,54,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,99,53,51,102,52,52,49,102,45,49,53,49,48,45,52,50,55,49,45,98,54,55,99,45,101,55,99,51,57,54,56,53,48,48,98,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,68,73,86,64,49,120,32,40,49,41,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,55,53,55,49,51,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,98,99,101,57,101,102,98,54,53,57,51,100,98,54,49,53,56,97,55,53,53,55,101,102,98,99,101,50,101,51,50,97,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,48,57,55,53,55,49,51,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740720976016","event_id":"ff6039ccf84157c1440592d2c6f70ddb","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 13:36:16.263  INFO 134384 --- [pool-2-thread-11] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:36:16.263  INFO 134384 --- [pool-2-thread-11] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_c53f441f-1510-4271-b67c-e7c3968500bg","file_name":"DIV@1x (1).png"}]
2025-02-28 13:36:16.263  INFO 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_bce9efb6593db6158a7557efbce2e32a], fileKey=[file_v3_00ju_c53f441f-1510-4271-b67c-e7c3968500bg], fileName=[DIV@1x (1).png]
2025-02-28 13:36:16.265 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:36:16.265 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:36:16.266 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:36:16.266 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=20, currentCaseName=我的测试案件, createTime=2025-02-25T14:47:06, updateTime=2025-02-28T00:23:43, deleted=0)]
2025-02-28 13:36:16.267 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 13:36:16.267 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 20(Long)
2025-02-28 13:36:16.267 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 13:36:16.267 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=20, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=我的测试案件, clientName=王五, caseDesc=王五测试案件, caseTime=2025-02-09T00:23, remarks=, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/Fa9gfEIN6lopDMdlJUCcYCrEnyc, createTime=2025-02-28T00:23:43, updateTime=2025-02-28T00:23:43, deleted=0)]
2025-02-28 13:36:16.268 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[Fa9gfEIN6lopDMdlJUCcYCrEnyc]
2025-02-28 13:36:16.268  INFO 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_c53f441f-1510-4271-b67c-e7c3968500bg], messageId=[om_bce9efb6593db6158a7557efbce2e32a]
2025-02-28 13:36:16.268 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_c53f441f-1510-4271-b67c-e7c3968500bg], messageId=[om_bce9efb6593db6158a7557efbce2e32a]
2025-02-28 13:36:16.269 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_6175798316888133681.tmp]
2025-02-28 13:36:16.270 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 13:36:17.090 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 开始写入文件内容...
2025-02-28 13:36:17.091 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 文件下载完成: path=[C:\Users\roy\AppData\Local\Temp\feishu_6175798316888133681.tmp], size=[337127]bytes
2025-02-28 13:36:17.092 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 文件下载成功: tempFile=[C:\Users\roy\AppData\Local\Temp\feishu_6175798316888133681.tmp], size=[337127]bytes
2025-02-28 13:36:17.092  INFO 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 开始上传文件到目标文件夹: folderToken=[Fa9gfEIN6lopDMdlJUCcYCrEnyc]
2025-02-28 13:36:18.489  INFO 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 文件处理完成: fileKey=[file_v3_00ju_c53f441f-1510-4271-b67c-e7c3968500bg]
2025-02-28 13:36:18.491 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:36:18.491 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:36:18.492 DEBUG 134384 --- [pool-2-thread-11] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:36:19.193 DEBUG 134384 --- [pool-2-thread-11] e.b.service.impl.FileMessageServiceImpl  : 清理临时文件: file=[C:\Users\roy\AppData\Local\Temp\feishu_6175798316888133681.tmp], deleted=[true]
2025-02-28 13:37:20.172 ERROR 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 13:37:20.172  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476335589240274946&access_key=17cb744fc5674c80d28240c7b362d0c2&service_id=33554678&ticket=e26768be-c26f-43cd-bad5-c6029be09a3a [conn_id=7476335589240274946]
2025-02-28 13:37:20.172  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 13:37:48.201  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 13:37:48.747  INFO 134384 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476335589240946690&access_key=dd9dd62b92936194d0ca0c3434b9abc3&service_id=33554678&ticket=416d534c-b071-49a4-a7c8-ac26010fa52f [conn_id=7476335589240946690]
2025-02-28 13:47:44.188  INFO 134384 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 13:47:44.191  INFO 134384 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
2025-02-28 13:47:49.117  INFO 78568 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 78568 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 13:47:49.119 DEBUG 78568 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 13:47:49.119  INFO 78568 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 13:47:49.584  INFO 78568 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 13:47:49.585  INFO 78568 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 13:47:49.609  INFO 78568 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 0 Redis repository interfaces.
2025-02-28 13:47:49.998  INFO 78568 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 13:47:50.005  INFO 78568 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 13:47:50.006  INFO 78568 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 13:47:50.114  INFO 78568 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 13:47:50.115  INFO 78568 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 971 ms
2025-02-28 13:47:51.066  INFO 78568 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 13:47:51.068  INFO 78568 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 13:47:52.011  INFO 78568 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 13:47:52.277  INFO 78568 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476341323027005441&access_key=3fd50bfa74e964eaa7856e8585507574&service_id=33554678&ticket=5106ccc1-e7dd-45e9-a574-34e457397efc [conn_id=7476341323027005441]
2025-02-28 13:47:52.686  INFO 78568 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 13:47:52.694  INFO 78568 --- [main] em.backend.BackendApplication            : Started BackendApplication in 3.879 seconds (JVM running for 4.573)
2025-02-28 13:48:29.683  INFO 141872 --- [main] em.backend.BackendApplication            : Starting BackendApplication using Java 1.8.0_131 on Haruka-ROG with PID 141872 (D:\桌面\project\feishu-bot\backend\target\classes started by roy in D:\桌面\project\feishu-bot\backend)
2025-02-28 13:48:29.685 DEBUG 141872 --- [main] em.backend.BackendApplication            : Running with Spring Boot v2.7.6, Spring v5.3.24
2025-02-28 13:48:29.686  INFO 141872 --- [main] em.backend.BackendApplication            : No active profile set, falling back to 1 default profile: "default"
2025-02-28 13:48:30.183  INFO 141872 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-02-28 13:48:30.185  INFO 141872 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-02-28 13:48:30.212  INFO 141872 --- [main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.
2025-02-28 13:48:30.608  INFO 141872 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8087 (http)
2025-02-28 13:48:30.615  INFO 141872 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-02-28 13:48:30.615  INFO 141872 --- [main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.69]
2025-02-28 13:48:30.718  INFO 141872 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-02-28 13:48:30.718  INFO 141872 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 1005 ms
2025-02-28 13:48:31.632  INFO 141872 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API URL: https://api.dify.ai/v1
2025-02-28 13:48:31.633  INFO 141872 --- [main] em.backend.dify.impl.DifyClientImpl      : Dify API Key 已加载: 是
2025-02-28 13:48:32.486  INFO 141872 --- [main] e.b.controller.FeishuEventController     : 飞书事件监听已启动
2025-02-28 13:48:32.767  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476341809728176147&access_key=bed510637736905aa57aa843c031eef4&service_id=33554678&ticket=9bcbc95c-b1eb-4417-b3a5-f189addda5ed [conn_id=7476341809728176147]
2025-02-28 13:48:33.122  INFO 141872 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8087 (http) with context path ''
2025-02-28 13:48:33.130  INFO 141872 --- [main] em.backend.BackendApplication            : Started BackendApplication in 3.773 seconds (JVM running for 4.739)
2025-02-28 13:49:03.311  INFO 141872 --- [pool-2-thread-2] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"create_case","timestamp":1740721743}
2025-02-28 13:49:13.477  INFO 141872 --- [pool-2-thread-3] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-2c9fba39def7ac14516156de10cb7f5f18298165","action":{"tag":"button","timezone":"Asia/Shanghai","name":"submit_create_case","form_value":{"case_desc":"测试案件33","case_name":"","case_time":"2025-02-17 13:49 +0800","client_name":"测试案件33","remarks":"测试案件33"}},"host":"im_message","context":{"open_message_id":"om_5c8cb230fdc3202ace1240d586eee5f1","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"b3e033489abbb8881b1aa5ec72778097","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740721753383371","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,98,51,101,48,51,51,52,56,57,97,98,98,98,56,56,56,49,98,49,97,97,53,101,99,55,50,55,55,56,48,57,55,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,53,51,51,56,51,51,55,49,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,50,99,57,102,98,97,51,57,100,101,102,55,97,99,49,52,53,49,54,49,53,54,100,101,49,48,99,98,55,102,53,102,49,56,50,57,56,49,54,53,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,99,97,115,101,95,100,101,115,99,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,51,51,34,44,34,99,97,115,101,95,110,97,109,101,34,58,34,34,44,34,99,97,115,101,95,116,105,109,101,34,58,34,50,48,50,53,45,48,50,45,49,55,32,49,51,58,52,57,32,43,48,56,48,48,34,44,34,99,108,105,101,110,116,95,110,97,109,101,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,51,51,34,44,34,114,101,109,97,114,107,115,34,58,34,-26,-75,-117,-24,-81,-107,-26,-95,-120,-28,-69,-74,51,51,34,125,44,34,110,97,109,101,34,58,34,115,117,98,109,105,116,95,99,114,101,97,116,101,95,99,97,115,101,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,53,99,56,99,98,50,51,48,102,100,99,51,50,48,50,97,99,101,49,50,52,48,100,53,56,54,101,101,101,53,102,49,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 13:49:13.477  INFO 141872 --- [pool-2-thread-3] em.backend.service.impl.CaseServiceImpl  : 处理创建案件表单数据: {case_desc=测试案件33, case_name=, case_time=2025-02-17 13:49 +0800, client_name=测试案件33, remarks=测试案件33}, 操作人: ou_834a97afdc847fa1a8f1cc4ca773fc37
2025-02-28 13:49:14.151  INFO 141872 --- [pool-2-thread-3] e.b.s.impl.FeishuFolderServiceImpl       : 案件文件夹创建成功: _测试案件33_2025-02-17, url: https://test-d814zrewver8.feishu.cn/drive/folder/MNI1fAT85lZlazdJQdtcAjMNnAv
2025-02-28 13:49:14.700  INFO 141872 --- [pool-2-thread-3] e.b.s.impl.FeishuFolderServiceImpl       : 文件夹权限设置成功, token: MNI1fAT85lZlazdJQdtcAjMNnAv, userId: ou_834a97afdc847fa1a8f1cc4ca773fc37
2025-02-28 13:49:14.727  INFO 141872 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Starting...
2025-02-28 13:49:14.850  INFO 141872 --- [pool-2-thread-3] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Start completed.
2025-02-28 13:49:14.856 DEBUG 141872 --- [pool-2-thread-3] em.backend.mapper.CaseInfoMapper.insert  : ==>  Preparing: INSERT INTO case_info ( open_id, case_name, client_name, case_desc, case_time, remarks, folder_url ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-02-28 13:49:14.874 DEBUG 141872 --- [pool-2-thread-3] em.backend.mapper.CaseInfoMapper.insert  : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String), (String), 测试案件33(String), 测试案件33(String), 2025-02-17T13:49(LocalDateTime), 测试案件33(String), https://test-d814zrewver8.feishu.cn/drive/folder/MNI1fAT85lZlazdJQdtcAjMNnAv(String)
2025-02-28 13:49:14.892 DEBUG 141872 --- [pool-2-thread-3] em.backend.mapper.CaseInfoMapper.insert  : <==    Updates: 1
2025-02-28 13:49:14.920 DEBUG 141872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 13:49:14.921 DEBUG 141872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:49:14.931 DEBUG 141872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 13:49:14.941 DEBUG 141872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 13:49:14.943 DEBUG 141872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 21(Long), (String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:49:14.947 DEBUG 141872 --- [pool-2-thread-3] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 13:49:36.046  INFO 141872 --- [pool-2-thread-4] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"file_key\":\"file_v3_00ju_be863a34-b766-41db-a894-438901d791cg\",\"file_name\":\"DIV@1x (1).png\"}","create_time":"1740721775430","message_id":"om_405dfa54ac9c7ac7272e7e71e029de45","message_type":"file","update_time":"1740721775430"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,51,99,97,100,98,56,102,52,53,54,51,57,50,53,51,100,52,102,52,52,52,55,99,97,98,50,98,57,99,54,102,54,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,55,53,55,57,52,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,102,105,108,101,95,107,101,121,92,34,58,92,34,102,105,108,101,95,118,51,95,48,48,106,117,95,98,101,56,54,51,97,51,52,45,98,55,54,54,45,52,49,100,98,45,97,56,57,52,45,52,51,56,57,48,49,100,55,57,49,99,103,92,34,44,92,34,102,105,108,101,95,110,97,109,101,92,34,58,92,34,68,73,86,64,49,120,32,40,49,41,46,112,110,103,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,55,53,52,51,48,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,52,48,53,100,102,97,53,52,97,99,57,99,55,97,99,55,50,55,50,101,55,101,55,49,101,48,50,57,100,101,52,53,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,102,105,108,101,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,55,53,52,51,48,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740721775794","event_id":"3cadb8f45639253d4f4447cab2b9c6f6","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 13:49:36.046  INFO 141872 --- [pool-2-thread-4] em.backend.handler.MessageEventHandler   : 收到消息: type=[file], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:49:36.046  INFO 141872 --- [pool-2-thread-4] em.backend.handler.MessageEventHandler   : 文件消息内容: content=[{"file_key":"file_v3_00ju_be863a34-b766-41db-a894-438901d791cg","file_name":"DIV@1x (1).png"}]
2025-02-28 13:49:36.047  INFO 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 开始处理文件消息: userId=[ou_834a97afdc847fa1a8f1cc4ca773fc37], chatId=[oc_73e98b267473bd40e40358cb5656af0f], messageId=[om_405dfa54ac9c7ac7272e7e71e029de45], fileKey=[file_v3_00ju_be863a34-b766-41db-a894-438901d791cg], fileName=[DIV@1x (1).png]
2025-02-28 13:49:36.173 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:49:36.173 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:49:36.175 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:49:36.175 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 查询到用户状态: userStatus=[UserStatus(openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, currentCaseId=21, currentCaseName=, createTime=2025-02-25T14:47:06, updateTime=2025-02-28T13:49:14, deleted=0)]
2025-02-28 13:49:36.175 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==>  Preparing: SELECT id,open_id,case_name,client_name,case_desc,case_time,remarks,folder_url,create_time,update_time,deleted FROM case_info WHERE id=? AND deleted=0
2025-02-28 13:49:36.176 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : ==> Parameters: 21(Long)
2025-02-28 13:49:36.177 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.CaseInfoMapper.selectById     : <==      Total: 1
2025-02-28 13:49:36.178 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 查询到案件信息: caseInfo=[CaseInfo(id=21, openId=ou_834a97afdc847fa1a8f1cc4ca773fc37, caseName=, clientName=测试案件33, caseDesc=测试案件33, caseTime=2025-02-17T13:49, remarks=测试案件33, folderUrl=https://test-d814zrewver8.feishu.cn/drive/folder/MNI1fAT85lZlazdJQdtcAjMNnAv, createTime=2025-02-28T13:49:14, updateTime=2025-02-28T13:49:14, deleted=0)]
2025-02-28 13:49:36.178 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 提取到文件夹token: folderToken=[MNI1fAT85lZlazdJQdtcAjMNnAv]
2025-02-28 13:49:36.178  INFO 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_be863a34-b766-41db-a894-438901d791cg], messageId=[om_405dfa54ac9c7ac7272e7e71e029de45]
2025-02-28 13:49:36.178 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 开始下载文件: fileKey=[file_v3_00ju_be863a34-b766-41db-a894-438901d791cg], messageId=[om_405dfa54ac9c7ac7272e7e71e029de45]
2025-02-28 13:49:36.179 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 创建临时文件: path=[C:\Users\roy\AppData\Local\Temp\feishu_1884008806852420765.tmp]
2025-02-28 13:49:36.180 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 发送下载请求...
2025-02-28 13:49:36.970 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 开始写入文件内容...
2025-02-28 13:49:36.971 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 文件下载完成: path=[C:\Users\roy\AppData\Local\Temp\feishu_1884008806852420765.tmp], size=[337127]bytes
2025-02-28 13:49:36.971 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 文件下载成功: tempFile=[C:\Users\roy\AppData\Local\Temp\feishu_1884008806852420765.tmp], size=[337127]bytes
2025-02-28 13:49:36.972  INFO 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 开始上传文件到目标文件夹: folderToken=[MNI1fAT85lZlazdJQdtcAjMNnAv]
2025-02-28 13:49:38.272  INFO 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 文件处理完成: fileKey=[file_v3_00ju_be863a34-b766-41db-a894-438901d791cg]
2025-02-28 13:49:38.274 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:49:38.274 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:49:38.275 DEBUG 141872 --- [pool-2-thread-4] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:49:38.955 DEBUG 141872 --- [pool-2-thread-4] e.b.service.impl.FileMessageServiceImpl  : 清理临时文件: file=[C:\Users\roy\AppData\Local\Temp\feishu_1884008806852420765.tmp], deleted=[true]
2025-02-28 13:49:46.476  INFO 141872 --- [pool-2-thread-5] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"text\":\"？\"}","create_time":"1740721785914","message_id":"om_c42e27520d86d72874f03953469b4f02","message_type":"text","update_time":"1740721785914"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,99,98,101,54,52,48,48,54,101,53,54,100,53,99,98,49,50,54,98,99,102,49,53,54,97,100,55,99,97,55,50,53,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,56,54,50,50,54,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-17,-68,-97,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,56,53,57,49,52,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,99,52,50,101,50,55,53,50,48,100,56,54,100,55,50,56,55,52,102,48,51,57,53,51,52,54,57,98,52,102,48,50,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,55,56,53,57,49,52,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740721786226","event_id":"cbe64006e56d5cb126bcf156ad7ca725","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 13:49:46.476  INFO 141872 --- [pool-2-thread-5] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:49:46.476  INFO 141872 --- [pool-2-thread-5] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_834a97afdc847fa1a8f1cc4ca773fc37], 查询=[？]
2025-02-28 13:49:46.477 DEBUG 141872 --- [pool-2-thread-5] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-02-28 13:49:46.477 DEBUG 141872 --- [pool-2-thread-5] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:49:46.482 DEBUG 141872 --- [pool-2-thread-5] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 1
2025-02-28 13:49:46.484 DEBUG 141872 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:49:46.485 DEBUG 141872 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:49:46.486 DEBUG 141872 --- [pool-2-thread-5] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:49:47.417  INFO 141872 --- [pool-2-thread-5] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7476343137659830274:streaming_sey]
2025-02-28 13:49:47.418  INFO 141872 --- [ForkJoinPool.commonPool-worker-9] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[？], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:49:53.537  INFO 141872 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : 流式响应结束，停止卡片流式更新
2025-02-28 13:49:53.537  INFO 141872 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7476343137659830274], sequence=[24]
2025-02-28 13:49:53.797  INFO 141872 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-02-28 13:49:53.799  INFO 141872 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify流式API调用完成
2025-02-28 13:50:14.935  INFO 141872 --- [pool-2-thread-6] em.backend.handler.MenuEventHandler      : 收到菜单事件: {"operator":{"operator_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"}},"event_key":"create_case","timestamp":1740721814}
2025-02-28 13:50:30.953  INFO 141872 --- [pool-2-thread-7] em.backend.handler.CardEventHandler      : 收到卡片回调事件: {"event":{"operator":{"tenant_key":"14d8959c2a4c174f","open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"token":"c-a0b72d5fec03318bbcf66c1b6d6164dd645ab82d","action":{"tag":"button","timezone":"Asia/Shanghai","name":"submit_create_case","form_value":{"case_desc":"案件名称11","case_name":"案件名称11","case_time":"2025-02-17 13:50 +0800","client_name":"案件名称11","remarks":"案件名称11"}},"host":"im_message","context":{"open_message_id":"om_99a203b7f048898f56fc00ec02423afe","open_chat_id":"oc_73e98b267473bd40e40358cb5656af0f"}},"schema":"2.0","header":{"event_id":"7425cb7d991d57ada540c8c627ba775b","event_type":"card.action.trigger","app_id":"cli_a737a171cc79d01c","tenant_key":"14d8959c2a4c174f","create_time":"1740721830866018","token":"rvqGnHui9eREbosJiSZC4enGTh8ozB1U"},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,55,52,50,53,99,98,55,100,57,57,49,100,53,55,97,100,97,53,52,48,99,56,99,54,50,55,98,97,55,55,53,98,34,44,34,116,111,107,101,110,34,58,34,114,118,113,71,110,72,117,105,57,101,82,69,98,111,115,74,105,83,90,67,52,101,110,71,84,104,56,111,122,66,49,85,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,56,51,48,56,54,54,48,49,56,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,99,97,114,100,46,97,99,116,105,111,110,46,116,114,105,103,103,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,111,112,101,114,97,116,111,114,34,58,123,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,125,44,34,116,111,107,101,110,34,58,34,99,45,97,48,98,55,50,100,53,102,101,99,48,51,51,49,56,98,98,99,102,54,54,99,49,98,54,100,54,49,54,52,100,100,54,52,53,97,98,56,50,100,34,44,34,97,99,116,105,111,110,34,58,123,34,116,97,103,34,58,34,98,117,116,116,111,110,34,44,34,116,105,109,101,122,111,110,101,34,58,34,65,115,105,97,47,83,104,97,110,103,104,97,105,34,44,34,102,111,114,109,95,118,97,108,117,101,34,58,123,34,99,97,115,101,95,100,101,115,99,34,58,34,-26,-95,-120,-28,-69,-74,-27,-112,-115,-25,-89,-80,49,49,34,44,34,99,97,115,101,95,110,97,109,101,34,58,34,-26,-95,-120,-28,-69,-74,-27,-112,-115,-25,-89,-80,49,49,34,44,34,99,97,115,101,95,116,105,109,101,34,58,34,50,48,50,53,45,48,50,45,49,55,32,49,51,58,53,48,32,43,48,56,48,48,34,44,34,99,108,105,101,110,116,95,110,97,109,101,34,58,34,-26,-95,-120,-28,-69,-74,-27,-112,-115,-25,-89,-80,49,49,34,44,34,114,101,109,97,114,107,115,34,58,34,-26,-95,-120,-28,-69,-74,-27,-112,-115,-25,-89,-80,49,49,34,125,44,34,110,97,109,101,34,58,34,115,117,98,109,105,116,95,99,114,101,97,116,101,95,99,97,115,101,34,125,44,34,104,111,115,116,34,58,34,105,109,95,109,101,115,115,97,103,101,34,44,34,99,111,110,116,101,120,116,34,58,123,34,111,112,101,110,95,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,57,57,97,50,48,51,98,55,102,48,52,56,56,57,56,102,53,54,102,99,48,48,101,99,48,50,52,50,51,97,102,101,34,44,34,111,112,101,110,95,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,125,125,125],"headers":{}}}
2025-02-28 13:50:30.954  INFO 141872 --- [pool-2-thread-7] em.backend.service.impl.CaseServiceImpl  : 处理创建案件表单数据: {case_desc=案件名称11, case_name=案件名称11, case_time=2025-02-17 13:50 +0800, client_name=案件名称11, remarks=案件名称11}, 操作人: ou_834a97afdc847fa1a8f1cc4ca773fc37
2025-02-28 13:50:31.611  INFO 141872 --- [pool-2-thread-7] e.b.s.impl.FeishuFolderServiceImpl       : 案件文件夹创建成功: 案件名称11_案件名称11_2025-02-17, url: https://test-d814zrewver8.feishu.cn/drive/folder/LqUWfwTZwlNuj1dweMScY3s3n4g
2025-02-28 13:50:32.172  INFO 141872 --- [pool-2-thread-7] e.b.s.impl.FeishuFolderServiceImpl       : 文件夹权限设置成功, token: LqUWfwTZwlNuj1dweMScY3s3n4g, userId: ou_834a97afdc847fa1a8f1cc4ca773fc37
2025-02-28 13:50:32.173 DEBUG 141872 --- [pool-2-thread-7] em.backend.mapper.CaseInfoMapper.insert  : ==>  Preparing: INSERT INTO case_info ( open_id, case_name, client_name, case_desc, case_time, remarks, folder_url ) VALUES ( ?, ?, ?, ?, ?, ?, ? )
2025-02-28 13:50:32.173 DEBUG 141872 --- [pool-2-thread-7] em.backend.mapper.CaseInfoMapper.insert  : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String), 案件名称11(String), 案件名称11(String), 案件名称11(String), 2025-02-17T13:50(LocalDateTime), 案件名称11(String), https://test-d814zrewver8.feishu.cn/drive/folder/LqUWfwTZwlNuj1dweMScY3s3n4g(String)
2025-02-28 13:50:32.176 DEBUG 141872 --- [pool-2-thread-7] em.backend.mapper.CaseInfoMapper.insert  : <==    Updates: 1
2025-02-28 13:50:32.177 DEBUG 141872 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectById   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE open_id=? AND deleted=0
2025-02-28 13:50:32.178 DEBUG 141872 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectById   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:50:32.179 DEBUG 141872 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.selectById   : <==      Total: 1
2025-02-28 13:50:32.180 DEBUG 141872 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.updateById   : ==>  Preparing: UPDATE user_status SET current_case_id=?, current_case_name=? WHERE open_id=? AND deleted=0
2025-02-28 13:50:32.180 DEBUG 141872 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.updateById   : ==> Parameters: 22(Long), 案件名称11(String), ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:50:32.181 DEBUG 141872 --- [pool-2-thread-7] e.b.mapper.UserStatusMapper.updateById   : <==    Updates: 1
2025-02-28 13:50:39.357  INFO 141872 --- [pool-2-thread-9] em.backend.handler.MessageEventHandler   : 收到消息事件: event=[{"event":{"message":{"chat_id":"oc_73e98b267473bd40e40358cb5656af0f","chat_type":"p2p","content":"{\"text\":\"你好\"}","create_time":"1740721838776","message_id":"om_b1cde20ab9ebf938e3531e45a6e3b326","message_type":"text","update_time":"1740721838776"},"sender":{"sender_id":{"open_id":"ou_834a97afdc847fa1a8f1cc4ca773fc37","union_id":"on_8b6c4401c805ecf29a3dd700df9bff31"},"sender_type":"user","tenant_key":"14d8959c2a4c174f"}},"eventReq":{"body":[123,34,115,99,104,101,109,97,34,58,34,50,46,48,34,44,34,104,101,97,100,101,114,34,58,123,34,101,118,101,110,116,95,105,100,34,58,34,52,55,98,97,102,100,102,98,49,102,53,56,100,98,101,98,57,100,57,56,99,57,51,100,98,51,98,50,101,102,97,102,34,44,34,116,111,107,101,110,34,58,34,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,56,51,57,49,54,50,34,44,34,101,118,101,110,116,95,116,121,112,101,34,58,34,105,109,46,109,101,115,115,97,103,101,46,114,101,99,101,105,118,101,95,118,49,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,44,34,97,112,112,95,105,100,34,58,34,99,108,105,95,97,55,51,55,97,49,55,49,99,99,55,57,100,48,49,99,34,125,44,34,101,118,101,110,116,34,58,123,34,109,101,115,115,97,103,101,34,58,123,34,99,104,97,116,95,105,100,34,58,34,111,99,95,55,51,101,57,56,98,50,54,55,52,55,51,98,100,52,48,101,52,48,51,53,56,99,98,53,54,53,54,97,102,48,102,34,44,34,99,104,97,116,95,116,121,112,101,34,58,34,112,50,112,34,44,34,99,111,110,116,101,110,116,34,58,34,123,92,34,116,101,120,116,92,34,58,92,34,-28,-67,-96,-27,-91,-67,92,34,125,34,44,34,99,114,101,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,56,51,56,55,55,54,34,44,34,109,101,115,115,97,103,101,95,105,100,34,58,34,111,109,95,98,49,99,100,101,50,48,97,98,57,101,98,102,57,51,56,101,51,53,51,49,101,52,53,97,54,101,51,98,51,50,54,34,44,34,109,101,115,115,97,103,101,95,116,121,112,101,34,58,34,116,101,120,116,34,44,34,117,112,100,97,116,101,95,116,105,109,101,34,58,34,49,55,52,48,55,50,49,56,51,56,55,55,54,34,125,44,34,115,101,110,100,101,114,34,58,123,34,115,101,110,100,101,114,95,105,100,34,58,123,34,111,112,101,110,95,105,100,34,58,34,111,117,95,56,51,52,97,57,55,97,102,100,99,56,52,55,102,97,49,97,56,102,49,99,99,52,99,97,55,55,51,102,99,51,55,34,44,34,117,110,105,111,110,95,105,100,34,58,34,111,110,95,56,98,54,99,52,52,48,49,99,56,48,53,101,99,102,50,57,97,51,100,100,55,48,48,100,102,57,98,102,102,51,49,34,44,34,117,115,101,114,95,105,100,34,58,110,117,108,108,125,44,34,115,101,110,100,101,114,95,116,121,112,101,34,58,34,117,115,101,114,34,44,34,116,101,110,97,110,116,95,107,101,121,34,58,34,49,52,100,56,57,53,57,99,50,97,52,99,49,55,52,102,34,125,125,125],"headers":{},"requestID":""},"header":{"app_id":"cli_a737a171cc79d01c","create_time":"1740721839162","event_id":"47bafdfb1f58dbeb9d98c93db3b2efaf","event_type":"im.message.receive_v1","tenant_key":"14d8959c2a4c174f","token":""},"requestId":"","schema":"2.0","tenantKey":"14d8959c2a4c174f"}]
2025-02-28 13:50:39.357  INFO 141872 --- [pool-2-thread-9] em.backend.handler.MessageEventHandler   : 收到消息: type=[text], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:50:39.357  INFO 141872 --- [pool-2-thread-9] e.b.service.impl.DifyMessageServiceImpl  : 处理用户消息: 用户=[ou_834a97afdc847fa1a8f1cc4ca773fc37], 查询=[你好]
2025-02-28 13:50:39.357 DEBUG 141872 --- [pool-2-thread-9] e.b.mapper.UserGroupMapper.selectById    : ==>  Preparing: SELECT open_id,chat_id,create_time,update_time,deleted FROM user_group WHERE open_id=? AND deleted=0
2025-02-28 13:50:39.358 DEBUG 141872 --- [pool-2-thread-9] e.b.mapper.UserGroupMapper.selectById    : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:50:39.359 DEBUG 141872 --- [pool-2-thread-9] e.b.mapper.UserGroupMapper.selectById    : <==      Total: 1
2025-02-28 13:50:39.361 DEBUG 141872 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==>  Preparing: SELECT open_id,current_case_id,current_case_name,create_time,update_time,deleted FROM user_status WHERE deleted=0 AND (open_id = ?)
2025-02-28 13:50:39.361 DEBUG 141872 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : ==> Parameters: ou_834a97afdc847fa1a8f1cc4ca773fc37(String)
2025-02-28 13:50:39.363 DEBUG 141872 --- [pool-2-thread-9] e.b.mapper.UserStatusMapper.selectList   : <==      Total: 1
2025-02-28 13:50:40.280  INFO 141872 --- [pool-2-thread-9] e.b.service.impl.DifyMessageServiceImpl  : 创建流式卡片成功: [7476343359218106396:streaming_sey]
2025-02-28 13:50:40.280  INFO 141872 --- [ForkJoinPool.commonPool-worker-2] em.backend.dify.impl.DifyClientImpl      : 调用Dify流式API: query=[你好], user=[ou_834a97afdc847fa1a8f1cc4ca773fc37]
2025-02-28 13:50:44.719  INFO 141872 --- [pool-1-thread-1] e.b.d.h.FeishuStreamingMessageHandler    : 流式响应结束，停止卡片流式更新
2025-02-28 13:50:44.719  INFO 141872 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新: cardId=[7476343359218106396], sequence=[18]
2025-02-28 13:50:45.018  INFO 141872 --- [pool-1-thread-1] e.b.service.impl.MessageServiceImpl      : 停止卡片流式更新成功
2025-02-28 13:50:45.019  INFO 141872 --- [pool-1-thread-1] em.backend.dify.impl.DifyClientImpl      : Dify流式API调用完成
2025-02-28 13:52:10.147 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 13:52:10.148  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476341809728176147&access_key=bed510637736905aa57aa843c031eef4&service_id=33554678&ticket=9bcbc95c-b1eb-4417-b3a5-f189addda5ed [conn_id=7476341809728176147]
2025-02-28 13:52:10.148  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 13:52:27.307  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 13:52:27.753  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476343048679931908&access_key=33242ff53f8549cf9bf7a5c6227e750a&service_id=33554678&ticket=720eee29-6b05-4ca7-972d-8233209617c7 [conn_id=7476343048679931908]
2025-02-28 13:53:56.166 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.net.SocketException: Software caused connection abort: recv failed
2025-02-28 13:53:56.167  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476343048679931908&access_key=33242ff53f8549cf9bf7a5c6227e750a&service_id=33554678&ticket=720eee29-6b05-4ca7-972d-8233209617c7 [conn_id=7476343048679931908]
2025-02-28 13:53:56.167  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 13:54:22.557  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 13:54:25.023  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476343641610043395&access_key=67f2d8d06a14d9d9a3b5b98ca83d5cec&service_id=33554678&ticket=d86e8c0f-72cb-4fc1-97fe-9c228896a3c1 [conn_id=7476343641610043395]
2025-02-28 14:12:57.102 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.net.SocketTimeoutException: Read timed out
2025-02-28 14:12:57.103  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476343641610043395&access_key=67f2d8d06a14d9d9a3b5b98ca83d5cec&service_id=33554678&ticket=d86e8c0f-72cb-4fc1-97fe-9c228896a3c1 [conn_id=7476343641610043395]
2025-02-28 14:12:57.103  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:13:19.607  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:13:20.177  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476348027945648132&access_key=0f686a651fb49f4dcb8cba2db154091d&service_id=33554678&ticket=bd5e1fa8-b67c-49b4-8992-5f399bb5508d [conn_id=7476348027945648132]
2025-02-28 14:14:20.147 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 14:14:20.149  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476348027945648132&access_key=0f686a651fb49f4dcb8cba2db154091d&service_id=33554678&ticket=bd5e1fa8-b67c-49b4-8992-5f399bb5508d [conn_id=7476348027945648132]
2025-02-28 14:14:20.149  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:14:34.016  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:14:34.454  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476348692942422020&access_key=0482abe6bbe8ab17d3b585c4d485cd35&service_id=33554678&ticket=99c7ed8b-9787-4436-add1-80a2300a9e19 [conn_id=7476348692942422020]
2025-02-28 14:16:07.120 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 14:16:07.121  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476348692942422020&access_key=0482abe6bbe8ab17d3b585c4d485cd35&service_id=33554678&ticket=99c7ed8b-9787-4436-add1-80a2300a9e19 [conn_id=7476348692942422020]
2025-02-28 14:16:07.121  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:16:14.501  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:16:15.634  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476348752569597956&access_key=972b91ebfac93c70ed2a10a4fe39f05d&service_id=33554678&ticket=b3e2166b-be08-478c-8d20-4b2c324e02cb [conn_id=7476348752569597956]
2025-02-28 14:56:03.608 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 14:56:03.609  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476348752569597956&access_key=972b91ebfac93c70ed2a10a4fe39f05d&service_id=33554678&ticket=b3e2166b-be08-478c-8d20-4b2c324e02cb [conn_id=7476348752569597956]
2025-02-28 14:56:03.609  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:56:08.975  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:56:09.546  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358050200616988&access_key=66cf287a97b45cb1e79b9d8e533d0467&service_id=33554678&ticket=4b93809f-35f7-41db-bf5b-acc290ac22d1 [conn_id=7476358050200616988]
2025-02-28 14:56:15.934  WARN 141872 --- [MyHikariCP housekeeper] com.zaxxer.hikari.pool.HikariPool        : MyHikariCP - Thread starvation or clock leap detected (housekeeper delta=21m54s962ms879µs500ns).
2025-02-28 14:57:09.177 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 14:57:09.178  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358050200616988&access_key=66cf287a97b45cb1e79b9d8e533d0467&service_id=33554678&ticket=4b93809f-35f7-41db-bf5b-acc290ac22d1 [conn_id=7476358050200616988]
2025-02-28 14:57:09.178  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:57:16.495  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:57:16.911  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358511867019266&access_key=0308a10f496200b58a939ed7bc09b9a3&service_id=33554678&ticket=64e5be25-d597-40cb-a681-e7136017c343 [conn_id=7476358511867019266]
2025-02-28 14:59:02.235 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 14:59:02.235  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358511867019266&access_key=0308a10f496200b58a939ed7bc09b9a3&service_id=33554678&ticket=64e5be25-d597-40cb-a681-e7136017c343 [conn_id=7476358511867019266]
2025-02-28 14:59:02.236  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:59:12.762  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:59:13.238  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358893439860737&access_key=21a24f9d355f0b68f8657c9806752dc1&service_id=33554678&ticket=d6eb083c-f875-4ee7-81cf-85e2166ce327 [conn_id=7476358893439860737]
2025-02-28 14:59:43.181 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 14:59:43.182  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358893439860737&access_key=21a24f9d355f0b68f8657c9806752dc1&service_id=33554678&ticket=d6eb083c-f875-4ee7-81cf-85e2166ce327 [conn_id=7476358893439860737]
2025-02-28 14:59:43.182  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 14:59:46.584  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 14:59:46.974  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358877842800642&access_key=a7e332076105541b5b6011e8706164db&service_id=33554678&ticket=0414f590-dd7b-4f2d-8373-3e1d1279e17b [conn_id=7476358877842800642]
2025-02-28 15:02:02.133 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 15:02:02.134  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358877842800642&access_key=a7e332076105541b5b6011e8706164db&service_id=33554678&ticket=0414f590-dd7b-4f2d-8373-3e1d1279e17b [conn_id=7476358877842800642]
2025-02-28 15:02:02.134  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 15:02:28.829  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 15:02:29.393  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358893440696321&access_key=7fd1817fc8b163c94a27567007007aff&service_id=33554678&ticket=63e0bde4-7405-4d33-b6f9-3018e95d950e [conn_id=7476358893440696321]
2025-02-28 15:59:17.059 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 15:59:17.063  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476358893440696321&access_key=7fd1817fc8b163c94a27567007007aff&service_id=33554678&ticket=63e0bde4-7405-4d33-b6f9-3018e95d950e [conn_id=7476358893440696321]
2025-02-28 15:59:17.063  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 15:59:42.590  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 15:59:43.129  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476375670240329731&access_key=c840a22d4d0f9f32b4983d0919512b3c&service_id=33554678&ticket=2c5c7677-6825-4410-aaed-06531367df11 [conn_id=7476375670240329731]
2025-02-28 16:01:03.161 ERROR 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : java.io.EOFException
2025-02-28 16:01:03.161  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : disconnected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476375670240329731&access_key=c840a22d4d0f9f32b4983d0919512b3c&service_id=33554678&ticket=2c5c7677-6825-4410-aaed-06531367df11 [conn_id=7476375670240329731]
2025-02-28 16:01:03.161  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : start reconnecting...
2025-02-28 16:01:27.521  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Client                  : trying to reconnect for the 1st time
2025-02-28 16:01:27.906  INFO 141872 --- [OkHttp https://msg-frontier.feishu.cn/...] com.lark.oapi.ws.Listener                : connected to wss://msg-frontier.feishu.cn/ws/v2?fpid=493&aid=552564&device_id=7476376411404713987&access_key=a0690e5b8d000332110664b08d381136&service_id=33554678&ticket=3c6cd331-b0cd-4b7b-a083-295a388f3bd5 [conn_id=7476376411404713987]
2025-02-28 16:02:57.175  INFO 141872 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown initiated...
2025-02-28 16:02:57.181  INFO 141872 --- [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : MyHikariCP - Shutdown completed.
